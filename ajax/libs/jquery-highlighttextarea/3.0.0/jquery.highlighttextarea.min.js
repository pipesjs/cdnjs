!function(t){"use strict";var i=function(s,h){this.settings=t.extend({},i.DEFAULTS),this.scrollbarWidth=e.getScrollbarWidth(),this.isInput="input"==s[0].tagName.toLowerCase(),this.active=!1,this.$el=s,this.$el.wrap("<div class=highlightTextarea></div>"),this.$main=this.$el.parent(),this.$main.prepend("<div class=container><div class=highlighter></div></div>"),this.$container=this.$main.children().first(),this.$highlighter=this.$container.children(),this.setOptions(h),this.settings.id&&(this.$main[0].id=this.settings.id),this.settings.resizable&&this.applyResizable(),this.updateCss(),this.bindEvents(),this.highlight()};i.DEFAULTS={words:{},ranges:{},color:"#ffff00",caseSensitive:!0,resizable:!1,id:"",debug:!1},i.prototype.highlight=function(){var i=e.htmlEntities(this.$el.val()),s=this;t.each(this.settings.words,function(t,e){i=i.replace(new RegExp("("+e.join("|")+")",s.regParam),'<span class="highlight" style="background-color:'+t+';">$1</span>')}),t.each(this.settings.ranges,function(t,s){i=e.strInsert(i,s.end,"</span>"),i=e.strInsert(i,s.start,'<span class="highlight" style="background-color:'+s.color+';">')}),this.$highlighter.html(i),this.updateSizePosition()},i.prototype.setWords=function(t){this.setOptions({words:t,ranges:{}})},i.prototype.setRanges=function(t){this.setOptions({words:{},ranges:t})},i.prototype.enable=function(){this.bindEvents(),this.highlight()},i.prototype.disable=function(){this.unbindEvents(),this.$highlighter.empty()},i.prototype.destroy=function(){this.disable(),e.cloneCss(this.$container,this.$el,["background-image","background-color","background-position","background-repeat","background-origin","background-clip","background-size","background-attachment"]),this.$main.replaceWith(this.$el),this.$el.removeData("highlighter")},i.prototype.setOptions=function(i){"object"!=typeof i||t.isEmptyObject(i)||(t.extend(this.settings,i),this.regParam=this.settings.caseSensitive?"gm":"gim",t.isEmptyObject(this.settings.words)?t.isEmptyObject(this.settings.ranges)||(this.settings.words={},this.settings.ranges=e.cleanRanges(this.settings.ranges,this.settings.color)):(this.settings.words=e.cleanWords(this.settings.words,this.settings.color),this.settings.ranges={}),this.settings.debug?this.$main.addClass("debug"):this.$main.removeClass("debug"),this.active&&this.highlight())},i.prototype.bindEvents=function(){if(!this.active){this.active=!0;var i=this;this.$highlighter.on({"this.highlighter":function(){i.$el.focus()}}),this.$el.on({"input.highlighter":e.throttle(function(){this.highlight()},100,this),"resize.highlighter":e.throttle(function(){this.updateSizePosition(!0)},50,this),"scroll.highlighter select.highlighter":e.throttle(function(){this.updateSizePosition()},50,this)}),this.isInput&&this.$el.on({"keydown.highlighter keypress.highlighter keyup.highlighter":function(){setTimeout(t.proxy(i.updateSizePosition,i),1)},"blur.highlighter":function(){this.value=this.value,this.scrollLeft=0,i.updateSizePosition.call(i)}})}},i.prototype.unbindEvents=function(){this.active&&(this.active=!1,this.$highlighter.off("click.highlighter"),this.$el.off("input.highlighter resize.highlighter scroll.highlighter keydown.highlighter keypress.highlighter keyup.highlighter select.highlighter blur.highlighter"))},i.prototype.updateCss=function(){e.cloneCss(this.$el,this.$main,["float","vertical-align"]),this.$main.css({width:this.$el.outerWidth(!0),height:this.$el.outerHeight(!0)}),e.cloneCss(this.$el,this.$container,["background-image","background-color","background-position","background-repeat","background-origin","background-clip","background-size","background-attachment","padding-top","padding-right","padding-bottom","padding-left"]),this.$container.css({top:e.toPx(this.$el.css("margin-top"))+e.toPx(this.$el.css("border-top-width")),left:e.toPx(this.$el.css("margin-left"))+e.toPx(this.$el.css("border-left-width")),width:this.$el.width(),height:this.$el.height()}),e.cloneCss(this.$el,this.$highlighter,["font-size","font-family","font-style","font-weight","font-variant","font-stretch","line-height","vertical-align","word-spacing","text-align","letter-spacing"]),this.$el.css({background:"none"})},i.prototype.applyResizable=function(){jQuery.ui&&this.$el.resizable({handles:"se",resize:e.throttle(function(){this.updateSizePosition(!0)},50,this)})},i.prototype.updateSizePosition=function(t){t&&(this.$main.css({width:this.$el.outerWidth(!0),height:this.$el.outerHeight(!0)}),this.$container.css({width:this.$el.width(),height:this.$el.height()}));var i,e=0;this.isInput?i=99999:((this.$el[0].clientHeight<this.$el[0].scrollHeight&&"hidden"!=this.$el.css("overflow")&&"hidden"!=this.$el.css("overflow-y")||"scroll"==this.$el.css("overflow")||"scroll"==this.$el.css("overflow-y"))&&(e=this.scrollbarWidth),i=this.$el.width()-e),this.$highlighter.css({width:i,height:this.$el.height()+this.$el.scrollTop(),top:-this.$el.scrollTop(),left:-this.$el.scrollLeft()})};var e=function(){};e.getScrollbarWidth=function(){var i=t('<div style="width:50px;height:50px;overflow:auto"><div>&nbsp;</div></div>').appendTo("body"),e=i.children(),s=e.innerWidth()-e.height(100).innerWidth();return i.remove(),s},e.cloneCss=function(t,i,e){for(var s=0,h=e.length;s<h;s++)i.css(e[s],t.css(e[s]))},e.toPx=function(i){if(i!=i.replace("em","")){var e=t('<div style="font-size:1em;margin:0;padding:0;height:auto;line-height:1;border:0;">&nbsp;</div>').appendTo("body");return i=Math.round(parseFloat(i.replace("em",""))*e.height()),e.remove(),i}return i!=i.replace("px","")?parseInt(i.replace("px","")):parseInt(i)},e.htmlEntities=function(i){return i?t("<div></div>").text(i).html():""},e.strInsert=function(t,i,e){return t.slice(0,i)+e+t.slice(i)},e.throttle=function(t,i,e){var s={pid:null,last:0};return function(){function h(){return s.last=(new Date).getTime(),e?t.apply(e,Array.prototype.slice.call(r)):t.apply(o,Array.prototype.slice.call(r))}var n=(new Date).getTime()-s.last,r=arguments,o=this;return n>i?h():(clearTimeout(s.pid),void(s.pid=setTimeout(h,i-n)))}},e.cleanWords=function(i,s){var h={};t.isArray(i)||(i=[i]);for(var n=0,r=i.length;n<r;n++){var o=i[n];if(t.isPlainObject(o)){h[o.color]||(h[o.color]=[]),t.isArray(o.words)||(o.words=[o.words]);for(var l=0,a=o.words.length;l<a;l++)h[o.color].push(e.htmlEntities(o.words[l]))}else h[s]||(h[s]=[]),h[s].push(e.htmlEntities(o))}return h},e.cleanRanges=function(i,e){var s=[];(t.isPlainObject(i)||t.isNumeric(i[0]))&&(i=[i]);for(var h=0,n=i.length;h<n;h++){var r=i[h];if(t.isArray(r))s.push({color:e,start:r[0],end:r[1]});else if(r.hasOwnProperty("ranges")){(t.isPlainObject(r.ranges)||t.isNumeric(r.ranges[0]))&&(r.ranges=[r.ranges]);for(var o=0,l=r.ranges.length;o<l;o++)t.isArray(r.ranges[o])?s.push({color:r.color,start:r.ranges[o][0],end:r.ranges[o][1]}):(r.ranges[o].length&&(r.ranges[o].end=r.ranges[o].start+r.ranges[o].length),s.push(r.ranges[o]))}else r.length&&(r.end=r.start+r.length),s.push(r)}s.sort(function(t,i){return t.start==i.start?t.end-i.end:t.start-i.start});var a=-1;return t.each(s,function(i,e){e.start>=e.end&&t.error("Invalid range end/start"),e.start<a&&t.error("Ranges overlap"),a=e.end}),s.reverse(),s},t.fn.highlightTextarea=function(e){var s=arguments;return this.each(function(){var h=t(this),n=h.data("highlighter"),r="object"==typeof e&&e;(n||"destroy"!=e)&&(n||(n=new i(h,r),h.data("highlighter",n)),"string"==typeof e&&n[e].apply(n,Array.prototype.slice.call(s,1)))})}}(jQuery);