!function(t){"function"==typeof define&&define.amd?define(["knockout","jquery"],t):t(ko,jQuery)}(function(t,e){function n(t){this.init(t)}function i(t){this.init(t),this.drop=function(e){t.drop(e,t.data)}}function a(t){this.$element=t,this.$element.addClass("drag-element").css({position:"fixed",zIndex:1060}),this.$element.on("selectstart",!1)}function r(t){this.name=t.name,this.dragStart=t.dragStart,this.dragEnd=t.dragEnd,this.data=t.data}function o(t){this.element=t,this.$element=e(t),this.scrollMargin=Math.floor(this.$element.innerHeight()/10),this.offset=this.$element.offset(),this.innerHeight=this.$element.innerHeight(),this.scrollDeltaMin=5,this.scrollDeltaMax=30}var s={},d={};n.prototype.init=function(t){this.element=t.element,this.$element=e(t.element),this.data=t.data,this.dragEnter=t.dragEnter,this.dragOver=t.dragOver,this.dragLeave=t.dragLeave,this.active=!1,this.inside=!1,this.dirty=!1},n.prototype.refreshDomInfo=function(){var t=this.$element,e=t.offset();this.top=e.top,this.left=e.left,this.width=t.outerWidth(),this.height=t.outerHeight()},n.prototype.isInside=function(t,e){return!(t<this.left||e<this.top)&&(!(this.left+this.width<t)&&!(this.top+this.height<e))},n.prototype.update=function(t,e){this.isInside(t.pageX,t.pageY)?(this.inside||this.enter(t,e),this.dragOver&&this.dragOver(t,e,this.data)):this.leave(t)},n.prototype.enter=function(t,e){this.inside=!0,this.dragEnter?this.active=this.dragEnter(t,e,this.data)!==!1:this.active=!0,this.dirty=!0},n.prototype.leave=function(t){t&&(t.target=this.element),this.inside&&this.dragLeave&&this.dragLeave(t),this.active=!1,this.inside=!1,this.dirty=!0},i.prototype=n.prototype,i.prototype.updateStyling=function(){this.dirty&&(this.$element.toggleClass("drag-over",this.active),this.$element.toggleClass("drop-rejected",this.inside&&!this.active)),this.dirty=!1},a.prototype.updatePosition=function(t){this.$element.offset({top:t.pageY,left:t.pageX})},a.prototype.remove=function(){this.$element.remove()},r.prototype.startDrag=function(){if(this.dragStart&&this.dragStart(this.data)===!1)return!1},r.prototype.drag=function(t){var e=this,n=this.name,i=s[n].concat(d[n]);i.forEach(function(t){t.refreshDomInfo()}),i.forEach(function(n){t.target=n.element,n.update(t,e.data)}),s[n].forEach(function(t){t.updateStyling()})},r.prototype.dropRejected=function(){var t=this.name;return!!s[t].some(function(t){return t.inside})&&!s[t].some(function(t){return t.active})},r.prototype.drop=function(t){var n=this.name,i=e(t.target).closest(".drop-zone"),a=s[n].filter(function(t){return t.active}).filter(function(t){return t.$element.is(i)})[0];s[n].concat(d[n]).forEach(function(e){e.leave(t)}),s[n].forEach(function(t){t.updateStyling()}),this.dragEnd&&this.dragEnd(this.data),a&&a.drop&&a.drop(this.data)},o.prototype.scroll=function(t,e){var n,i,a=this.scrollMargin+this.offset.top;e<a&&(n=(a-e)/this.scrollMargin,i=n*(this.scrollDeltaMax-this.scrollDeltaMin)+this.scrollDeltaMin,this.element.scrollTop-=i);var r=this.offset.top+this.innerHeight-this.scrollMargin;e>r&&(n=(e-r)/this.scrollMargin,i=n*(this.scrollDeltaMax-this.scrollDeltaMin)+this.scrollDeltaMin,this.element.scrollTop+=i)},t.utils.extend(t.bindingHandlers,{dropzone:{init:function(n,a,r,o,d){var l=t.utils.unwrapObservable(a()),c=l.name;s[c]=s[c]||[],e(n).addClass("drop-zone");var h=new i({element:n,data:d&&d.$data,drop:l.drop,dragEnter:l.dragEnter,dragOver:l.dragOver,dragLeave:l.dragLeave});s[c].push(h),t.utils.domNodeDisposal.addDisposeCallback(n,function(){h.leave(),s[c].splice(s[c].indexOf(h),1)})}},dragEvents:{init:function(e,i,a,r,o){var s=t.utils.unwrapObservable(i()),l=s.name;d[l]=d[l]||[];var c=new n({element:e,data:o&&o.$data,dragEnter:s.dragEnter,dragOver:s.dragOver,dragLeave:s.dragLeave});d[l].push(c),t.utils.domNodeDisposal.addDisposeCallback(e,function(){c.leave(),d[l].splice(d[l].indexOf(c),1)})}},dragzone:{init:function(n,i,o,l,c){function h(){var t=e(n).clone().appendTo(e(n).parent());return t.css({height:e(n).height(),width:e(n).width(),opacity:.7,filter:"alpha(opacity=70"}),t}function u(){var n=e("<div>").appendTo("body");return t.renderTemplate(p.element,c,{},n[0]),n}var p=t.utils.unwrapObservable(i()),g=p.name;s[g]=s[g]||[],d[g]=d[g]||[];var f=c&&c.$data,m=new r({name:g,data:f,dragStart:p.dragStart,dragEnd:p.dragEnd});e(n).on("selectstart",function(t){if(!e(t.target).is(":input"))return!1}),e(n).addClass("draggable"),e(n).on("mousedown",function(t){function i(i){function r(t){m.drag(t),m.dropRejected()!==l&&(s.toggleClass("drop-rejected",m.dropRejected()),l=m.dropRejected()),d=setTimeout(function(){r(t)},250)}e(n).off("mouseup.startdrag click.startdrag mouseleave.startdrag mousemove.startdrag");var o=null;if(p.element||(o=new a(h())),m.startDrag()===!1)return!1;var s=e('<div class="drag-overlay" unselectable="on">');s.on("selectstart",!1),s.appendTo("body"),p.element&&(o=new a(u())),o.updatePosition(t);var d=null,l=!1;s.on("mousemove.drag",function(t){return clearTimeout(d),o.updatePosition(t),r(t),!1}),s.on("mouseup",function(t){return clearTimeout(d),o.remove(),s.remove(),t.target=document.elementFromPoint(t.pageX,t.pageY),m.drop(t),e(document).off("selectstart.drag"),!1})}return 1!==t.which||(e(document).on("selectstart.drag",!1),e(n).one("mouseup.startdrag click.startdrag",function(t){return e(n).off("mouseleave.startdrag mousemove.startdrag"),e(document).off("selectstart.drag"),!0}),e(n).on("mousemove.startdrag",function(n){if(!e(n.target).is(":input")){Math.sqrt(Math.pow(t.pageX-n.pageX,2)+Math.pow(t.pageY-n.pageY,2))>10&&i(n)}}),e(n).one("mouseleave.startdrag",function(t){e(t.target).is(":input")||i(t)}),!0)}),t.utils.domNodeDisposal.addDisposeCallback(n,function(){e(document).off("selectstart.drag")})}},scrollableOnDragOver:{init:function(e,n,i){function a(){p.scroll(l,c)}function r(t){p=new o(e),h=setInterval(a,100)}function s(t){l=t.pageX,c=t.pageY}function d(t){clearTimeout(h)}var l,c,h,u=t.utils.unwrapObservable(n()),p=null;t.bindingHandlers.dragEvents.init(e,function(){return{name:u,dragEnter:r,dragOver:s,dragLeave:d}})}}})});
//# sourceMappingURL=knockout.dragdrop.min.js.map