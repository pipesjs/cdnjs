!function(t){"function"==typeof define&&define.amd?define(["knockout"],t):t(ko)}(function(t){function e(t){t=t||{};for(var e=1;e<arguments.length;e++)if(arguments[e])for(var n in arguments[e])arguments[e].hasOwnProperty(n)&&(t[n]=arguments[e][n]);return t}function n(t,e,n){var i=t.className.split(" "),r=i.indexOf(e);r>=0&&!n&&i.splice(r,1),r<0&&n&&i.push(e),t.className=i.join(" ")}function i(t,e){if(!t.tagName)return null;var n=document.documentElement;return(n.matches||n.matchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector).call(t,e)}function r(t,e){do{if(i(t,e))return t;t=t.parentNode}while(t);return null}function o(t){this.init(t)}function a(t){this.init(t),this.drop=function(e){t.drop(e,t.data)}}function s(t){this.element=t,n(this.element,"drag-element",!0),this.element.style.position="fixed",this.element.style.zIndex=9998,this.element.addEventListener("selectstart",function(){return!1},!0)}function d(t){this.element=t.element,this.name=t.name,this.dragStart=t.dragStart,this.dragEnd=t.dragEnd,this.data=t.data}function l(t,e){var n=t.getBoundingClientRect();this.element=t,this.scrollMargin=Math.floor(n.height/10),this.offset={top:n.top+window.pageYOffset-document.documentElement.clientTop,left:n.left+window.pageXOffset-document.documentElement.clientLeft},this.innerHeight=n.height,this.scrollDeltaMin=5,this.scrollDeltaMax=30,this.delay=e||0,this.inZone="center",this.scrolling=!1}function c(t){if(t.accepts)return[].concat(t.accepts);if(t.name)return[t.name];throw new Error("A drop zone must specify the drag zones it accepts")}var u={},h={},p=t.utils.arrayForEach,m=t.utils.arrayFirst,f=t.utils.arrayFilter;o.prototype.init=function(t){this.element=t.element,this.data=t.data,this.dragEnter=t.dragEnter,this.dragOver=t.dragOver,this.dragLeave=t.dragLeave,this.active=!1,this.inside=!1,this.dirty=!1},o.prototype.refreshDomInfo=function(){if(this.hidden="none"===this.element.style.display,!this.hidden){var t=this.element.getBoundingClientRect();this.top=t.top+window.pageYOffset-document.documentElement.clientTop,this.left=t.left+window.pageXOffset-document.documentElement.clientLeft,this.width=t.width,this.height=t.height}},o.prototype.isInside=function(t,e){return!this.hidden&&(!(t<this.left||e<this.top)&&(!(this.left+this.width<t)&&!(this.top+this.height<e)))},o.prototype.update=function(t,e){this.isInside(t.pageX,t.pageY)?(this.inside||this.enter(t,e),this.dragOver&&this.dragOver(t,e,this.data)):this.leave(t)},o.prototype.enter=function(t,e){this.inside=!0,this.dragEnter?this.active=this.dragEnter(t,e,this.data)!==!1:this.active=!0,this.dirty=!0},o.prototype.leave=function(t){t&&(t.target=this.element),this.inside&&this.dragLeave&&this.dragLeave(t,this.data),this.active=!1,this.inside=!1,this.dirty=!0},a.prototype=o.prototype,a.prototype.updateStyling=function(){this.dirty&&(n(this.element,"drag-over",this.active),n(this.element,"drop-rejected",this.inside&&!this.active)),this.dirty=!1},s.prototype.updatePosition=function(t){this.element.style.top=t.pageY-window.pageYOffset+"px",this.element.style.left=t.pageX-window.pageXOffset+"px"},s.prototype.remove=function(){this.element.parentNode.removeChild(this.element)},d.prototype.startDrag=function(t){if(this.dragStart&&this.dragStart(this.data,t)===!1)return!1},d.prototype.drag=function(t){var e=this,n=this.name,i=u[n].concat(h[n]);p(i,function(t){t.refreshDomInfo()}),p(i,function(n){t.target=n.element,n.update(t,e.data)}),p(u[n],function(t){t.updateStyling()})},d.prototype.dropRejected=function(){var t=this.name;return!m(u[t],function(t){return t.inside})||!m(u[t],function(t){return t.active})},d.prototype.cancelDrag=function(t){this.dragEnd&&this.dragEnd(this.data,t)},d.prototype.drop=function(t){var e=this.name,n=r(t.target,".drop-zone"),i=f(u[e],function(t){return t.active}),o=f(i,function(t){return t.element===n})[0];p(u[e].concat(h[e]),function(e){e.leave(t)}),p(u[e],function(t){t.updateStyling()}),o&&o.drop&&o.drop(this.data),this.dragEnd&&this.dragEnd(this.data,t)},l.prototype.scroll=function(t,e){this.x=t,this.y=e,this.topLimit=this.scrollMargin+this.offset.top,this.bottomLimit=this.offset.top+this.innerHeight-this.scrollMargin,e<this.topLimit?this.updateZone("top"):e>this.bottomLimit?this.updateZone("bottom"):this.updateZone("center")},l.prototype.enter=function(t){var e=this;this.delayTimer=setTimeout(function(){e.scrolling=!0},this.delay)},l.prototype.leave=function(t){this.scrolling=!1,clearTimeout(this.delayTimer)},l.prototype.over=function(t){var e,n;this.scrolling&&("top"===t?(e=(this.topLimit-this.y)/this.scrollMargin,n=e*(this.scrollDeltaMax-this.scrollDeltaMin)+this.scrollDeltaMin,this.element.scrollTop-=n):"bottom"===t&&(e=(this.y-this.bottomLimit)/this.scrollMargin,n=e*(this.scrollDeltaMax-this.scrollDeltaMin)+this.scrollDeltaMin,this.element.scrollTop+=n))},l.prototype.updateZone=function(t){this.zone!==t&&(this.leave(this.zone),this.enter(t)),this.zone=t,this.over(t)},t.utils.extend(t.bindingHandlers,{dropZone:{init:function(e,i,r,o,s){var d=t.utils.unwrapObservable(i()),l=c(d);n(e,"drop-zone",!0);var h=d.data||s&&s.$data,p=new a({element:e,data:h,drop:d.drop,dragEnter:d.dragEnter,dragOver:d.dragOver,dragLeave:d.dragLeave});l.forEach(function(t){u[t]=u[t]||[],u[t].push(p)}),t.utils.domNodeDisposal.addDisposeCallback(e,function(){p.leave(),l.forEach(function(t){u[t].splice(u[t].indexOf(p),1)})})}},dragEvents:{init:function(e,n,i,r,a){var s=t.utils.unwrapObservable(n()),d=c(s),l=s.data||a&&a.$data,u=new o({element:e,data:l,dragEnter:s.dragEnter,dragOver:s.dragOver,dragLeave:s.dragLeave});d.forEach(function(t){h[t]=h[t]||[],h[t].push(u)}),t.utils.domNodeDisposal.addDisposeCallback(e,function(){u.leave(),d.forEach(function(t){h[t].splice(h[t].indexOf(u),1)})})}},dragZone:{init:function(i,r,o,a,l){function c(){var t=i.cloneNode(!0);i.parentNode.appendChild(t);var e=window.getComputedStyle(i,null);return t.style.height=e.getPropertyValue("height"),t.style.width=e.getPropertyValue("width"),t.style.opacity=.7,t.style.filter="alpha(opacity=70)",t}function p(){var e=document.createElement("div");document.body.appendChild(e);var n="data"in f?l.createChildContext(f.data):l;return t.renderTemplate(f.element,n,{},e),e}function m(t){t.preventDefault(),t.stopPropagation()}var f=t.utils.unwrapObservable(r()),g=f.name,v="number"==typeof f.dragDistance?f.dragDistance:10;if(u[g]=u[g]||[],h[g]=h[g]||[],!g||"string"!=typeof g)throw new Error("A drag zone must specify a name");var y=f.data||l&&l.$data,E=new d({element:i,name:g,data:y,dragStart:f.dragStart,dragEnd:f.dragEnd});i.addEventListener("selectstart",function(t){return!(!t.target.tagName||"input"!==t.target.tagName.toLowerCase())||(t.preventDefault(),t.stopPropagation(),!1)},!0),n(i,"draggable",!0),i.addEventListener("mousedown",function(t){function i(i){function a(t){E.drag(t);var e=E.dropRejected();e!==g&&(n(u,"drop-rejected",e),u.style.cursor=e?"no-drop":"move",g=e),h=setTimeout(function(){a(t)},100)}function d(t){return clearTimeout(h),l&&l.remove(),u.parentNode.removeChild(u),E.cancelDrag(t),t.preventDefault(),t.stopPropagation(),!0}if(document.removeEventListener("mouseup",r,!0),document.removeEventListener("click",r,!0),document.removeEventListener("mousemove",o,!0),E.startDrag(t)===!1)return event.preventDefault(),event.stopPropagation(),!1;var l=null;void 0===f.element&&(l=new s(c()));var u=document.createElement("div");u.className="drag-overlay",u.setAttribute("unselectable","on"),u.style.zIndex=9999,u.style.position="fixed",u.style.top=0,u.style.left=0,u.style.right=0,u.style.bottom=0,u.style.cursor="move",u.style.backgroundColor="white",u.style.opacity=0,u.style.filter="alpha(opacity=0)",u.style.userSelect="none",u.style.webkitUserSelect="none",u.style.MozUserSelect="none",u.style.msUserSelect="none",u.style.OUserSelect="none",u.addEventListener("selectstart",m),document.body.appendChild(u),f.element&&(l=new s(p())),l&&l.updatePosition(t);var h=null,g=!1;u.addEventListener("mousemove",function(t){return 1!==t.which?d(t):(clearTimeout(h),l&&l.updatePosition(t),a(t),t.preventDefault(),t.stopPropagation(),!1)}),u.addEventListener("mouseup",function(t){clearTimeout(h),l&&l.remove(),u.parentNode.removeChild(u);var n=e({},t);return n.target=document.elementFromPoint(t.clientX,t.clientY),E.drop(n),document.removeEventListener("selectstart",m),t.preventDefault(),t.stopPropagation(),!1})}function r(t){return document.removeEventListener("mouseup",r,!0),document.removeEventListener("click",r,!0),document.removeEventListener("mousemove",o,!0),document.removeEventListener("selectstart",m),!0}function o(e){return!(!e.target.tagName||"input"!==e.target.tagName.toLowerCase())||(Math.sqrt(Math.pow(t.pageX-e.pageX,2)+Math.pow(t.pageY-e.pageY,2))>v&&i(e),e.preventDefault(),e.stopPropagation(),!1)}return 1!==t.which||(document.addEventListener("selectstart",m,!0),document.addEventListener("mouseup",r,!0),document.addEventListener("click",r,!0),document.addEventListener("mousemove",o,!0),!0)}),t.utils.domNodeDisposal.addDisposeCallback(i,function(){document.removeEventListener("selectstart",m)})}},scrollableOnDragOver:{init:function(e,n,i){function r(){p.scroll(c,u)}function o(t){p=new l(e,d.delay),h=setInterval(r,100)}function a(t){c=t.pageX,u=t.pageY}function s(t){clearInterval(h)}var d=t.utils.unwrapObservable(n());"string"==typeof d&&(d={name:d}),d.delay=d.delay||0;var c,u,h,p=null;t.bindingHandlers.dragEvents.init(e,function(){return{name:d.name,dragEnter:o,dragOver:a,dragLeave:s}})}}})});
//# sourceMappingURL=knockout.dragdrop.min.js.map