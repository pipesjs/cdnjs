!function(t){"function"==typeof define&&define.amd?define(["knockout","jquery"],t):t(ko,jQuery)}(function(t,e){function n(t){this.init(t)}function i(t){this.init(t),this.drop=function(e){t.drop(e,t.data)}}function r(t){this.$element=t,this.$element.addClass("drag-element").css({position:"fixed","z-index":9998}),this.$element.on("selectstart",!1)}function a(t){this.name=t.name,this.dragStart=t.dragStart,this.dragEnd=t.dragEnd,this.data=t.data}function o(t){this.element=t,this.$element=e(t),this.scrollMargin=Math.floor(this.$element.innerHeight()/10),this.offset=this.$element.offset(),this.innerHeight=this.$element.innerHeight(),this.scrollDeltaMin=5,this.scrollDeltaMax=30}function s(t){if(t.accepts)return[].concat(t.accepts);if(t.name)return[t.name];throw new Error("A drop zone must specify the drag zones it accepts")}var d={},c={},l=t.utils.arrayForEach,u=t.utils.arrayFirst,h=t.utils.arrayFilter;n.prototype.init=function(t){this.element=t.element,this.$element=e(t.element),this.data=t.data,this.dragEnter=t.dragEnter,this.dragOver=t.dragOver,this.dragLeave=t.dragLeave,this.active=!1,this.inside=!1,this.dirty=!1},n.prototype.refreshDomInfo=function(){var t=this.$element;if(this.hidden="none"===t.css("display"),!this.hidden){var e=t.offset();this.top=e.top,this.left=e.left,this.width=t.outerWidth(),this.height=t.outerHeight()}},n.prototype.isInside=function(t,e){return!this.hidden&&(!(t<this.left||e<this.top)&&(!(this.left+this.width<t)&&!(this.top+this.height<e)))},n.prototype.update=function(t,e){this.isInside(t.pageX,t.pageY)?(this.inside||this.enter(t,e),this.dragOver&&this.dragOver(t,e,this.data)):this.leave(t)},n.prototype.enter=function(t,e){this.inside=!0,this.dragEnter?this.active=this.dragEnter(t,e,this.data)!==!1:this.active=!0,this.dirty=!0},n.prototype.leave=function(t){t&&(t.target=this.element),this.inside&&this.dragLeave&&this.dragLeave(t,this.data),this.active=!1,this.inside=!1,this.dirty=!0},i.prototype=n.prototype,i.prototype.updateStyling=function(){this.dirty&&(this.$element.toggleClass("drag-over",this.active),this.$element.toggleClass("drop-rejected",this.inside&&!this.active)),this.dirty=!1},r.prototype.updatePosition=function(t){this.$element.offset({top:t.pageY,left:t.pageX})},r.prototype.remove=function(){this.$element.remove()},a.prototype.startDrag=function(t){if(this.dragStart&&this.dragStart(this.data,t)===!1)return!1},a.prototype.drag=function(t){var e=this,n=this.name,i=d[n].concat(c[n]);l(i,function(t){t.refreshDomInfo()}),l(i,function(n){t.target=n.element,n.update(t,e.data)}),l(d[n],function(t){t.updateStyling()})},a.prototype.dropRejected=function(){var t=this.name;return!!u(d[t],function(t){return t.inside})&&!u(d[t],function(t){return t.active})},a.prototype.cancelDrag=function(t){this.dragEnd&&this.dragEnd(this.data,t)},a.prototype.drop=function(t){var n=this.name,i=e(t.target).closest(".drop-zone"),r=h(d[n],function(t){return t.active}),a=h(r,function(t){return t.$element.is(i)})[0];l(d[n].concat(c[n]),function(e){e.leave(t)}),l(d[n],function(t){t.updateStyling()}),this.dragEnd&&this.dragEnd(this.data,t),a&&a.drop&&a.drop(this.data)},o.prototype.scroll=function(t,e){var n,i,r=this.scrollMargin+this.offset.top;e<r&&(n=(r-e)/this.scrollMargin,i=n*(this.scrollDeltaMax-this.scrollDeltaMin)+this.scrollDeltaMin,this.element.scrollTop-=i);var a=this.offset.top+this.innerHeight-this.scrollMargin;e>a&&(n=(e-a)/this.scrollMargin,i=n*(this.scrollDeltaMax-this.scrollDeltaMin)+this.scrollDeltaMin,this.element.scrollTop+=i)},t.utils.extend(t.bindingHandlers,{dropZone:{init:function(n,r,a,o,c){var l=t.utils.unwrapObservable(r()),u=s(l);e(n).addClass("drop-zone");var h=new i({element:n,data:c&&c.$data,drop:l.drop,dragEnter:l.dragEnter,dragOver:l.dragOver,dragLeave:l.dragLeave});u.forEach(function(t){d[t]=d[t]||[],d[t].push(h)}),t.utils.domNodeDisposal.addDisposeCallback(n,function(){h.leave(),u.forEach(function(t){d[t].splice(d[t].indexOf(h),1)})})}},dragEvents:{init:function(e,i,r,a,o){var d=t.utils.unwrapObservable(i()),l=s(d),u=d.data||o&&o.$data,h=new n({element:e,data:u,dragEnter:d.dragEnter,dragOver:d.dragOver,dragLeave:d.dragLeave});l.forEach(function(t){c[t]=c[t]||[],c[t].push(h)}),t.utils.domNodeDisposal.addDisposeCallback(e,function(){h.leave(),l.forEach(function(t){c[t].splice(c[t].indexOf(h),1)})})}},dragZone:{init:function(n,i,o,s,l){function u(){var t=e(n).clone().appendTo(e(n).parent());return t.css({height:e(n).height(),width:e(n).width(),opacity:.7,filter:"alpha(opacity=70"}),t}function h(){var n=e("<div>").appendTo("body"),i="data"in p?l.createChildContext(p.data):l;return t.renderTemplate(p.element,i,{},n[0]),n}var p=t.utils.unwrapObservable(i()),f=p.name,g=p.dragDistance||10;if(d[f]=d[f]||[],c[f]=c[f]||[],!f||"string"!=typeof f)throw new Error("A drag zone must specify a name");var m=p.data||l&&l.$data,v=new a({name:f,data:m,dragStart:p.dragStart,dragEnd:p.dragEnd});e(n).on("selectstart",function(t){if(!e(t.target).is(":input"))return!1}),e(n).addClass("draggable"),e(n).on("mousedown",function(t){function i(i){function a(t){v.drag(t),v.dropRejected()!==l&&(d.toggleClass("drop-rejected",v.dropRejected()),d.css("cursor",v.dropRejected()?"no-drop":"move"),l=v.dropRejected()),c=setTimeout(function(){a(t)},250)}function o(t){return e(n).off("mouseup.drag selectstart.drag"),clearTimeout(c),s.remove(),d.remove(),v.cancelDrag(t),!0}e(n).off("mouseup.startdrag click.startdrag mouseleave.startdrag mousemove.startdrag");var s=null;if(p.element||(s=new r(u())),v.startDrag(t)===!1)return!1;var d=e('<div class="drag-overlay" unselectable="on">');d.css({"z-index":9999,position:"fixed",top:0,left:0,right:0,bottom:0,cursor:"move","background-color":"white",opacity:0,filter:"alpha(opacity=0)","-webkit-user-select":"none","-moz-user-select":"-moz-none","-ms-user-select":"none","-o-user-select":"none","user-select":"none"}),d.on("selectstart",!1),d.appendTo("body"),p.element&&(s=new r(h())),s.updatePosition(t);var c=null,l=!1;d.on("mousemove.drag",function(t){return 1!==t.which?o(t):(clearTimeout(c),s.updatePosition(t),a(t),!1)}),d.on("mouseup.drag",function(t){return clearTimeout(c),s.remove(),d.remove(),t.target=document.elementFromPoint(t.clientX,t.clientY),v.drop(t),e(document).off("selectstart.drag"),!1})}return 1!==t.which||(e(document).on("selectstart.drag",!1),e(n).one("mouseup.startdrag click.startdrag mouseleave.startdrag",function(t){return e(n).off("mousemove.startdrag"),e(document).off("selectstart.drag"),!0}),e(n).on("mousemove.startdrag",function(n){if(!e(n.target).is(":input")){Math.sqrt(Math.pow(t.pageX-n.pageX,2)+Math.pow(t.pageY-n.pageY,2))>g&&i(n)}}),!0)}),t.utils.domNodeDisposal.addDisposeCallback(n,function(){e(document).off("selectstart.drag")})}},scrollableOnDragOver:{init:function(e,n,i){function r(){g.scroll(u,h)}function a(t){g=new o(e),p=setInterval(r,100)}function d(t){u=t.pageX,h=t.pageY}function c(t){clearTimeout(p)}var l=t.utils.unwrapObservable(n());("string"==typeof l||Array.isArray(l))&&(l={accepts:l}),l.delay=l.delay||0;var u,h,p,f=s(l),g=null;t.bindingHandlers.dragEvents.init(e,function(){return{accepts:f,dragEnter:a,dragOver:d,dragLeave:c}})}}})});
//# sourceMappingURL=knockout.dragdrop.min.js.map