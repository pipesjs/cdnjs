!function(t){"function"==typeof define&&define.amd?define(["knockout","jquery"],t):t(ko,jQuery)}(function(t,e){function n(t){this.init(t)}function i(t){this.init(t),this.drop=function(e){t.drop(e,t.data)}}function a(t){this.$element=t,this.$element.addClass("drag-element").css({position:"fixed","z-index":9998}),this.$element.on("selectstart",!1)}function r(t){this.name=t.name,this.dragStart=t.dragStart,this.dragEnd=t.dragEnd,this.data=t.data}function o(t){this.element=t,this.$element=e(t),this.scrollMargin=Math.floor(this.$element.innerHeight()/10),this.offset=this.$element.offset(),this.innerHeight=this.$element.innerHeight(),this.scrollDeltaMin=5,this.scrollDeltaMax=30}var s={},d={},l=t.utils.arrayForEach,c=t.utils.arrayFirst,u=t.utils.arrayFilter;n.prototype.init=function(t){this.element=t.element,this.$element=e(t.element),this.data=t.data,this.dragEnter=t.dragEnter,this.dragOver=t.dragOver,this.dragLeave=t.dragLeave,this.active=!1,this.inside=!1,this.dirty=!1},n.prototype.refreshDomInfo=function(){var t=this.$element;if(this.hidden="none"===t.css("display"),!this.hidden){var e=t.offset();this.top=e.top,this.left=e.left,this.width=t.outerWidth(),this.height=t.outerHeight()}},n.prototype.isInside=function(t,e){return!this.hidden&&(!(t<this.left||e<this.top)&&(!(this.left+this.width<t)&&!(this.top+this.height<e)))},n.prototype.update=function(t,e){this.isInside(t.pageX,t.pageY)?(this.inside||this.enter(t,e),this.dragOver&&this.dragOver(t,e,this.data)):this.leave(t)},n.prototype.enter=function(t,e){this.inside=!0,this.dragEnter?this.active=this.dragEnter(t,e,this.data)!==!1:this.active=!0,this.dirty=!0},n.prototype.leave=function(t){t&&(t.target=this.element),this.inside&&this.dragLeave&&this.dragLeave(t,this.data),this.active=!1,this.inside=!1,this.dirty=!0},i.prototype=n.prototype,i.prototype.updateStyling=function(){this.dirty&&(this.$element.toggleClass("drag-over",this.active),this.$element.toggleClass("drop-rejected",this.inside&&!this.active)),this.dirty=!1},a.prototype.updatePosition=function(t){this.$element.offset({top:t.pageY,left:t.pageX})},a.prototype.remove=function(){this.$element.remove()},r.prototype.startDrag=function(t){if(this.dragStart&&this.dragStart(this.data,t)===!1)return!1},r.prototype.drag=function(t){var e=this,n=this.name,i=s[n].concat(d[n]);l(i,function(t){t.refreshDomInfo()}),l(i,function(n){t.target=n.element,n.update(t,e.data)}),l(s[n],function(t){t.updateStyling()})},r.prototype.dropRejected=function(){var t=this.name;return!!c(s[t],function(t){return t.inside})&&!c(s[t],function(t){return t.active})},r.prototype.cancelDrag=function(t){this.dragEnd&&this.dragEnd(this.data,t)},r.prototype.drop=function(t){var n=this.name,i=e(t.target).closest(".drop-zone"),a=u(s[n],function(t){return t.active}),r=u(a,function(t){return t.$element.is(i)})[0];l(s[n].concat(d[n]),function(e){e.leave(t)}),l(s[n],function(t){t.updateStyling()}),this.dragEnd&&this.dragEnd(this.data,t),r&&r.drop&&r.drop(this.data)},o.prototype.scroll=function(t,e){var n,i,a=this.scrollMargin+this.offset.top;e<a&&(n=(a-e)/this.scrollMargin,i=n*(this.scrollDeltaMax-this.scrollDeltaMin)+this.scrollDeltaMin,this.element.scrollTop-=i);var r=this.offset.top+this.innerHeight-this.scrollMargin;e>r&&(n=(e-r)/this.scrollMargin,i=n*(this.scrollDeltaMax-this.scrollDeltaMin)+this.scrollDeltaMin,this.element.scrollTop+=i)},t.utils.extend(t.bindingHandlers,{dropZone:{init:function(n,a,r,o,d){var l=t.utils.unwrapObservable(a()),c=[];l.accepts?c=[].concat(l.accepts):c.push(l.name),e(n).addClass("drop-zone");var u=new i({element:n,data:d&&d.$data,drop:l.drop,dragEnter:l.dragEnter,dragOver:l.dragOver,dragLeave:l.dragLeave});c.forEach(function(t){s[t]=s[t]||[],s[t].push(u)}),t.utils.domNodeDisposal.addDisposeCallback(n,function(){u.leave(),c.forEach(function(t){s[t].splice(s[t].indexOf(u),1)})})}},dragEvents:{init:function(e,i,a,r,o){var s=t.utils.unwrapObservable(i()),l=s.name;d[l]=d[l]||[];var c=s.data||o&&o.$data,u=new n({element:e,data:c,dragEnter:s.dragEnter,dragOver:s.dragOver,dragLeave:s.dragLeave});d[l].push(u),t.utils.domNodeDisposal.addDisposeCallback(e,function(){u.leave(),d[l].splice(d[l].indexOf(u),1)})}},dragZone:{init:function(n,i,o,l,c){function u(){var t=e(n).clone().appendTo(e(n).parent());return t.css({height:e(n).height(),width:e(n).width(),opacity:.7,filter:"alpha(opacity=70"}),t}function h(){var n=e("<div>").appendTo("body"),i="data"in p?c.createChildContext(p.data):c;return t.renderTemplate(p.element,i,{},n[0]),n}var p=t.utils.unwrapObservable(i()),g=p.name,f=p.dragDistance||10;s[g]=s[g]||[],d[g]=d[g]||[];var m=p.data||c&&c.$data,v=new r({name:g,data:m,dragStart:p.dragStart,dragEnd:p.dragEnd});e(n).on("selectstart",function(t){if(!e(t.target).is(":input"))return!1}),e(n).addClass("draggable"),e(n).on("mousedown",function(t){function i(i){function r(t){v.drag(t),v.dropRejected()!==c&&(d.toggleClass("drop-rejected",v.dropRejected()),d.css("cursor",v.dropRejected()?"no-drop":"move"),c=v.dropRejected()),l=setTimeout(function(){r(t)},250)}function o(t){return e(n).off("mouseup.drag selectstart.drag"),clearTimeout(l),s.remove(),d.remove(),v.cancelDrag(t),!0}e(n).off("mouseup.startdrag click.startdrag mouseleave.startdrag mousemove.startdrag");var s=null;if(p.element||(s=new a(u())),v.startDrag(t)===!1)return!1;var d=e('<div class="drag-overlay" unselectable="on">');d.css({"z-index":9999,position:"fixed",top:0,left:0,right:0,bottom:0,cursor:"move","background-color":"white",opacity:0,filter:"alpha(opacity=0)","-webkit-user-select":"none","-moz-user-select":"-moz-none","-ms-user-select":"none","-o-user-select":"none","user-select":"none"}),d.on("selectstart",!1),d.appendTo("body"),p.element&&(s=new a(h())),s.updatePosition(t);var l=null,c=!1;d.on("mousemove.drag",function(t){return 1!==t.which?o(t):(clearTimeout(l),s.updatePosition(t),r(t),!1)}),d.on("mouseup.drag",function(t){return clearTimeout(l),s.remove(),d.remove(),t.target=document.elementFromPoint(t.clientX,t.clientY),v.drop(t),e(document).off("selectstart.drag"),!1})}return 1!==t.which||(e(document).on("selectstart.drag",!1),e(n).one("mouseup.startdrag click.startdrag mouseleave.startdrag",function(t){return e(n).off("mousemove.startdrag"),e(document).off("selectstart.drag"),!0}),e(n).on("mousemove.startdrag",function(n){if(!e(n.target).is(":input")){Math.sqrt(Math.pow(t.pageX-n.pageX,2)+Math.pow(t.pageY-n.pageY,2))>f&&i(n)}}),!0)}),t.utils.domNodeDisposal.addDisposeCallback(n,function(){e(document).off("selectstart.drag")})}},scrollableOnDragOver:{init:function(e,n,i){function a(){p.scroll(l,c)}function r(t){p=new o(e),u=setInterval(a,100)}function s(t){l=t.pageX,c=t.pageY}function d(t){clearTimeout(u)}var l,c,u,h=t.utils.unwrapObservable(n()),p=null;t.bindingHandlers.dragEvents.init(e,function(){return{name:h,dragEnter:r,dragOver:s,dragLeave:d}})}}})});
//# sourceMappingURL=knockout.dragdrop.min.js.map