!function(t){"function"==typeof define&&define.amd?define(["knockout","jquery"],t):t(ko,jQuery)}(function(t,e){function i(t){this.init(t)}function n(t){this.init(t),this.drop=function(e){t.drop(e,t.data)}}function a(t){this.$element=t,this.$element.addClass("drag-element").css({position:"fixed","z-index":9998}),this.$element.on("selectstart",!1)}function r(t){this.element=t.element,this.name=t.name,this.dragStart=t.dragStart,this.dragEnd=t.dragEnd,this.data=t.data}function o(t,i){this.element=t,this.$element=e(t),this.scrollMargin=Math.floor(this.$element.innerHeight()/10),this.offset=this.$element.offset(),this.innerHeight=this.$element.innerHeight(),this.scrollDeltaMin=5,this.scrollDeltaMax=30,this.delay=i||0,this.inZone="center",this.scrolling=!1}var s={},d={},l=t.utils.arrayForEach,c=t.utils.arrayFirst,h=t.utils.arrayFilter;i.prototype.init=function(t){this.element=t.element,this.$element=e(t.element),this.data=t.data,this.dragEnter=t.dragEnter,this.dragOver=t.dragOver,this.dragLeave=t.dragLeave,this.active=!1,this.inside=!1,this.dirty=!1},i.prototype.refreshDomInfo=function(){var t=this.$element;if(this.hidden="none"===t.css("display"),!this.hidden){var e=t.offset();this.top=e.top,this.left=e.left,this.width=t.outerWidth(),this.height=t.outerHeight()}},i.prototype.isInside=function(t,e){return!this.hidden&&(!(t<this.left||e<this.top)&&(!(this.left+this.width<t)&&!(this.top+this.height<e)))},i.prototype.update=function(t,e){this.isInside(t.pageX,t.pageY)?(this.inside||this.enter(t,e),this.dragOver&&this.dragOver(t,e,this.data)):this.leave(t)},i.prototype.enter=function(t,e){this.inside=!0,this.dragEnter?this.active=this.dragEnter(t,e,this.data)!==!1:this.active=!0,this.dirty=!0},i.prototype.leave=function(t){t&&(t.target=this.element),this.inside&&this.dragLeave&&this.dragLeave(t,this.data),this.active=!1,this.inside=!1,this.dirty=!0},n.prototype=i.prototype,n.prototype.updateStyling=function(){this.dirty&&(this.$element.toggleClass("drag-over",this.active),this.$element.toggleClass("drop-rejected",this.inside&&!this.active)),this.dirty=!1},a.prototype.updatePosition=function(t){this.$element.offset({top:t.pageY,left:t.pageX})},a.prototype.remove=function(){this.$element.remove()},r.prototype.startDrag=function(t){if(this.dragStart&&this.dragStart(this.data,t)===!1)return!1},r.prototype.drag=function(t){var e=this,i=this.name,n=s[i].concat(d[i]);l(n,function(t){t.refreshDomInfo()}),l(n,function(i){t.target=i.element,i.update(t,e.data)}),l(s[i],function(t){t.updateStyling()})},r.prototype.dropRejected=function(){var t=this.name;return!c(s[t],function(t){return t.inside})||!c(s[t],function(t){return t.active})},r.prototype.cancelDrag=function(t){this.dragEnd&&this.dragEnd(this.data,t)},r.prototype.drop=function(t){var i=this.name,n=e(t.target).closest(".drop-zone"),a=h(s[i],function(t){return t.active}),r=h(a,function(t){return t.$element.is(n)})[0];l(s[i].concat(d[i]),function(e){e.leave(t)}),l(s[i],function(t){t.updateStyling()}),r&&r.drop&&r.drop(this.data),this.dragEnd&&this.dragEnd(this.data,t)},o.prototype.scroll=function(t,e){this.x=t,this.y=e,this.topLimit=this.scrollMargin+this.offset.top,this.bottomLimit=this.offset.top+this.innerHeight-this.scrollMargin,e<this.topLimit?this.updateZone("top"):e>this.bottomLimit?this.updateZone("bottom"):this.updateZone("center")},o.prototype.enter=function(t){var e=this;this.delayTimer=setTimeout(function(){e.scrolling=!0},this.delay)},o.prototype.leave=function(t){this.scrolling=!1,clearTimeout(this.delayTimer)},o.prototype.over=function(t){var e,i;this.scrolling&&("top"===t?(e=(this.topLimit-this.y)/this.scrollMargin,i=e*(this.scrollDeltaMax-this.scrollDeltaMin)+this.scrollDeltaMin,this.element.scrollTop-=i):"bottom"===t&&(e=(this.y-this.bottomLimit)/this.scrollMargin,i=e*(this.scrollDeltaMax-this.scrollDeltaMin)+this.scrollDeltaMin,this.element.scrollTop+=i))},o.prototype.updateZone=function(t){this.zone!==t&&(this.leave(this.zone),this.enter(t)),this.zone=t,this.over(t)},t.utils.extend(t.bindingHandlers,{dropZone:{init:function(i,a,r,o,d){var l=t.utils.unwrapObservable(a()),c=[];l.accepts?c=[].concat(l.accepts):c.push(l.name),e(i).addClass("drop-zone");var h=l.data||d&&d.$data,u=new n({element:i,data:h,drop:l.drop,dragEnter:l.dragEnter,dragOver:l.dragOver,dragLeave:l.dragLeave});c.forEach(function(t){s[t]=s[t]||[],s[t].push(u)}),t.utils.domNodeDisposal.addDisposeCallback(i,function(){u.leave(),c.forEach(function(t){s[t].splice(s[t].indexOf(u),1)})})}},dragEvents:{init:function(e,n,a,r,o){var s=t.utils.unwrapObservable(n()),l=s.name;d[l]=d[l]||[];var c=s.data||o&&o.$data,h=new i({element:e,data:c,dragEnter:s.dragEnter,dragOver:s.dragOver,dragLeave:s.dragLeave});d[l].push(h),t.utils.domNodeDisposal.addDisposeCallback(e,function(){h.leave(),d[l].splice(d[l].indexOf(h),1)})}},dragZone:{init:function(i,n,o,l,c){function h(){var t=e(i).clone().appendTo(e(i).parent());return t.css({height:e(i).height(),width:e(i).width(),opacity:.7,filter:"alpha(opacity=70"}),t}function u(){var i=e("<div>").appendTo("body"),n="data"in p?c.createChildContext(p.data):c;return t.renderTemplate(p.element,n,{},i[0]),i}var p=t.utils.unwrapObservable(n()),g=p.name,f=p.dragDistance||10;s[g]=s[g]||[],d[g]=d[g]||[];var m=p.data||c&&c.$data,v=new r({element:i,name:g,data:m,dragStart:p.dragStart,dragEnd:p.dragEnd});e(i).on("selectstart",function(t){if(!e(t.target).is(":input"))return!1}),e(i).addClass("draggable"),e(i).on("mousedown",function(t){function n(n){function r(t){v.drag(t),v.dropRejected()!==c&&(d.toggleClass("drop-rejected",v.dropRejected()),d.css("cursor",v.dropRejected()?"no-drop":"move"),c=v.dropRejected()),l=setTimeout(function(){r(t)},100)}function o(t){return e(i).off("mouseup.drag selectstart.drag"),clearTimeout(l),s&&s.remove(),d.remove(),v.cancelDrag(t),!0}if(e(i).off("mouseup.startdrag click.startdrag mouseleave.startdrag mousemove.startdrag"),v.startDrag(t)===!1)return!1;var s=null;void 0===p.element&&(s=new a(h()));var d=e('<div class="drag-overlay" unselectable="on">');d.css({"z-index":9999,position:"fixed",top:0,left:0,right:0,bottom:0,cursor:"move","background-color":"white",opacity:0,filter:"alpha(opacity=0)","-webkit-user-select":"none","-moz-user-select":"-moz-none","-ms-user-select":"none","-o-user-select":"none","user-select":"none"}),d.on("selectstart",!1),d.appendTo("body"),p.element&&(s=new a(u())),s&&s.updatePosition(t);var l=null,c=!1;d.on("mousemove.drag",function(t){return 1!==t.which?o(t):(clearTimeout(l),s&&s.updatePosition(t),r(t),!1)}),d.on("mouseup.drag",function(t){return clearTimeout(l),s&&s.remove(),d.remove(),t.target=document.elementFromPoint(t.clientX,t.clientY),v.drop(t),e(document).off("selectstart.drag"),!1})}return 1!==t.which||(t.preventDefault(),e(document).on("selectstart.drag",!1),e(i).one("mouseup.startdrag click.startdrag mouseleave.startdrag",function(t){return e(i).off("mousemove.startdrag"),e(document).off("selectstart.drag"),!0}),e(i).on("mousemove.startdrag",function(i){if(!e(i.target).is(":input")){Math.sqrt(Math.pow(t.pageX-i.pageX,2)+Math.pow(t.pageY-i.pageY,2))>f&&n(i)}}),!0)}),t.utils.domNodeDisposal.addDisposeCallback(i,function(){e(document).off("selectstart.drag")})}},scrollableOnDragOver:{init:function(e,i,n){function a(){p.scroll(c,h)}function r(t){p=new o(e,l.delay),u=setInterval(a,100)}function s(t){c=t.pageX,h=t.pageY}function d(t){clearInterval(u)}var l=t.utils.unwrapObservable(i());"string"==typeof l&&(l={name:l}),l.delay=l.delay||0;var c,h,u,p=null;t.bindingHandlers.dragEvents.init(e,function(){return{name:l.name,dragEnter:r,dragOver:s,dragLeave:d}})}}})});
//# sourceMappingURL=knockout.dragdrop.min.js.map