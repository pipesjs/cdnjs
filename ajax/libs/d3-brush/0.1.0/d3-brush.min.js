!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-dispatch"),require("d3-drag"),require("d3-interpolate"),require("d3-selection"),require("d3-transition")):"function"==typeof define&&define.amd?define(["exports","d3-dispatch","d3-drag","d3-interpolate","d3-selection","d3-transition"],e):e(t.d3_brush=t.d3_brush||{},t.d3_dispatch,t.d3_drag,t.d3_interpolate,t.d3_selection,t.d3_transition)}(this,function(t,e,n,r,s,i){"use strict";function a(t){return function(){return t}}function u(t,e,n){this.target=t,this.type=e,this.selection=n}function o(t){return{type:t}}function c(){var t=this.ownerSVGElement;return[[0,0],t?[t.width.baseVal.value,t.height.baseVal.value]:[this.clientWidth,this.clientHeight]]}function l(t){for(;!t.__brush;)if(!(t=t.parentNode))return;return t.__brush}function h(){return f(g)}function p(){return f(_)}function d(){return f(k)}function f(t){function h(e){var n=e.property("__brush",k).selectAll(".background").data([o("background")]);n.enter().append("rect").attr("class","background").attr("fill","none").attr("pointer-events","all").attr("cursor",x.background).merge(n).each(function(){var t=l(this).extent;s.select(this).attr("x",t[0][0]).attr("y",t[0][1]).attr("width",t[1][0]-t[0][0]).attr("height",t[1][1]-t[0][1])}),e.selectAll(".selection").data([o("selection")]).enter().append("rect").attr("class","selection").attr("cursor",x.selection).attr("fill","rgba(0,0,0,0.15)");var r=e.selectAll(".resize").data(t.resize,function(t){return t.type});r.exit().remove(),r.enter().append("rect").attr("class",function(t){return"resize resize--"+t.type}).attr("cursor",function(t){return x[t.type]}).attr("fill","none"),e.each(p).attr("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",b)}function p(){var t=s.select(this),e=l(this).selection;e?(t.selectAll(".selection").style("display",null).attr("x",e[0][0]).attr("y",e[0][1]).attr("width",e[1][0]-e[0][0]).attr("height",e[1][1]-e[0][1]),t.selectAll(".resize").style("display",null).attr("x",function(t){return"e"===t.type[t.type.length-1]?e[1][0]-3:e[0][0]-3}).attr("y",function(t){return"s"===t.type[0]?e[1][1]-3:e[0][1]-3}).attr("width",function(t){return"n"===t.type||"s"===t.type?e[1][0]-e[0][0]+6:6}).attr("height",function(t){return"e"===t.type||"w"===t.type?e[1][1]-e[0][1]+6:6})):t.selectAll(".selection,.resize").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function d(t,e){return t.__brush.emitter||new f(t,e)}function f(t,e){this.that=t,this.args=e,this.state=t.__brush,this.active=0}function b(){function e(){I=s.mouse(P),r()}function r(){var t;switch(V=I[0]-L[0],C=I[1]-L[1],G){case w:case m:H&&(V=Math.max(Y-c,Math.min(F-k,V)),h=c+V,D=k+V),N&&(C=Math.max(B-f,Math.min(J-E,C)),b=f+C,K=E+C);break;case v:0>H?(V=Math.max(Y-c,Math.min(F-c,V)),h=c+V,D=k):H>0&&(V=Math.max(Y-k,Math.min(F-k,V)),h=c,D=k+V),0>N?(C=Math.max(B-f,Math.min(J-f,C)),b=f+C,K=E):N>0&&(C=Math.max(B-E,Math.min(J-E,C)),b=f,K=E+C);break;case y:H&&(h=Math.max(Y,Math.min(F,c-V*H)),D=Math.max(Y,Math.min(F,k+V*H))),N&&(b=Math.max(B,Math.min(J,f-C*N)),K=Math.max(B,Math.min(J,E+C*N)))}h>D&&(H*=-1,t=c,c=k,k=t,t=h,h=D,D=t,j in M&&T.attr("cursor",x[j=M[j]])),b>K&&(N*=-1,t=f,f=E,E=t,t=b,b=K,K=t,j in z&&T.attr("cursor",x[j=z[j]])),X[0][0]===h&&X[0][1]===b&&X[1][0]===D&&X[1][1]===K||(X[0][0]=h,X[0][1]=b,X[1][0]=D,X[1][1]=K,p.call(P),O.brush())}function a(){n.dragEnable(event.view),R.attr("pointer-events","all"),T.attr("cursor",x.background),Q.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null),h!==D&&b!==K||(S.selection=null,p.call(P)),O.end()}function u(){switch(event.keyCode){case 18:G===v&&(H&&(k=D-V*H,c=h+V*H),N&&(E=K-C*N,f=b+C*N),G=y,r());break;case 32:G!==v&&G!==y||(0>H?k=D-V:H>0&&(c=h-V),0>N?E=K-C:N>0&&(f=b-C),G=w,T.attr("cursor",x.selection),r());break;case 16:break;default:return}event.preventDefault(),event.stopImmediatePropagation()}function o(){switch(event.keyCode){case 18:G===y&&(0>H?k=D:H>0&&(c=h),0>N?E=K:N>0&&(f=b),G=v,r());break;case 32:G===w&&(event.altKey?(H&&(k=D-V*H,c=h+V*H),N&&(E=K-C*N,f=b+C*N),G=y):(0>H?k=D:H>0&&(c=h),0>N?E=K:N>0&&(f=b),G=v),T.attr("cursor",x[j]),r());break;case 16:break;default:return}event.preventDefault(),event.stopImmediatePropagation()}var c,h,f,b,k,D,E,K,V,C,I,P=this,j=event.target.__data__.type,G="selection"===(event.metaKey?j="background":j)?m:event.altKey?y:v,H=t===_?null:A[j],N=t===g?null:q[j],S=l(P),W=S.extent,X=S.selection,Y=W[0][0],B=W[0][1],F=W[1][0],J=W[1][1],L=s.mouse(P),O=d(P,arguments).beforestart();"background"===j?S.selection=X=[[c=t===_?Y:L[0],f=t===g?B:L[1]],[k=t===_?F:c,E=t===g?J:f]]:(c=X[0][0],f=X[0][1],k=X[1][0],E=X[1][1]),h=c,b=f,D=k,K=E;var Q=s.select(event.view).on("keydown.brush",u,!0).on("keyup.brush",o,!0).on("mousemove.brush",e,!0).on("mouseup.brush",a,!0),R=s.select(P).attr("pointer-events","none"),T=R.selectAll(".background").attr("cursor",x[j]);i.interrupt(P),n.dragDisable(event.view),p.call(P),O.start()}function k(){var t=this.__brush||{selection:null};return t.extent=D.apply(this,arguments),t}var D=c,E=e.dispatch(h,"start","brush","end");return h.move=function(e,n){e.selection?e.on("start.brush",function(){d(this,arguments).beforestart().start()}).on("interrupt.brush end.brush",function(){d(this,arguments).end()}).tween("brush",function(){function e(t){i.selection=c(t),p.call(s),a.brush()}var s=this,i=s.__brush,a=d(s,arguments),u=i.selection,o=t.input("function"==typeof n?n.apply(this,arguments):n,i.extent),c=r.interpolate(u,o);return u&&o?e:e(1)}):e.each(function(){var e=this,r=arguments,s=d(e,r).beforestart(),a=e.__brush;i.interrupt(e),a.selection=t.input("function"==typeof n?n.apply(e,r):n,a.extent),p.call(e),s.start().brush().end()})},f.prototype={beforestart:function(){return 1===++this.active&&(this.state.emitter=this,this.starting=!0),this},start:function(){return this.starting&&(this.starting=!1,this.emit("start")),this},brush:function(){return this.emit("brush"),this},end:function(){return 0===--this.active&&(delete this.state.emitter,this.emit("end")),this},emit:function(e){s.customEvent(new u(h,e,t.output(this.state.selection)),E.apply,E,[e,this.that,this.args])}},h.extent=function(t){return arguments.length?(D="function"==typeof t?t:a([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),h):D},h.on=function(){var t=E.on.apply(E,arguments);return t===E?h:t},h}var b="0.1.0",m={name:"drag"},w={name:"space"},v={name:"resize"},y={name:"center"},g={name:"x",resize:["e","w"].map(o),input:function(t,e){return t&&[[t[0],e[0][1]],[t[1],e[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},_={name:"y",resize:["n","s"].map(o),input:function(t,e){return t&&[[e[0][0],t[0]],[e[1][0],t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},k={name:"xy",resize:["n","e","s","w","nw","ne","se","sw"].map(o),input:function(t){return t},output:function(t){return t}},x={background:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},M={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},z={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},A={background:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},q={background:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};t.version=b,t.brush=d,t.brushX=h,t.brushY=p});