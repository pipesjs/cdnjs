/**
 * Vidom
 * @author Filatov Dmitry <dfilatov@inbox.ru>
 * @version 0.9.3
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.vidom=t.vidom||{})}(this,function(t){"use strict";function e(t){t+="";for(var e=t.length,n=0;e-- >0;)switch(t[e]){case"&":n|=1;break;case'"':n|=2}return 1==(1&n)&&(t=t.replace(ie,"&amp;")),2==(2&n)&&(t=t.replace(re,"&quot;")),t}function n(t,e){for(var n=t.length,i=0;i<n;)if(t[i++]==e)return!0;return!1}function i(t){return t.replace(oe,"$1-$2").toLowerCase()}function r(t,e,n){if("type"===e&&"INPUT"===t.tagName){var i=t.value;t.setAttribute(e,""+n),t.value=i}else t.setAttribute(m(e),""+n)}function o(t,e,n){n?r(t,e,n):u(t,e)}function s(t,e,n){t[e]=n}function a(t,e,n){if(he){var i=typeof n;if("object"!==i)throw TypeError('vidom: "'+e+'" attribute value must be an object, not a '+i)}var r=t[e];for(var o in n)r[o]=null==n[o]?"":n[o]}function h(t,e,n){"value"===e&&"SELECT"===t.tagName?d(t,n):t[e]!==n&&(t[e]=n)}function u(t,e){t.removeAttribute(m(e))}function l(t,e){"style"===e?t[e].cssText="":"value"===e&&"SELECT"===t.tagName?c(t):t[e]=v(t.tagName,e)}function d(t,e){if(Array.isArray(e))for(var i=t.options,r=i.length,o=0,s=void 0;o<r;)s=i[o++],s.selected=null!=e&&n(e,s.value);else t.value=e}function c(t){for(var e=t.options,n=e.length,i=0;i<n;)e[i++].selected=!1}function f(t,n){return!1===n?"":m(t)+(!0===n?"":'="'+e(n)+'"')}function _(t,e){return e?m(t):""}function p(t,e){var n="",r=void 0;for(r in e)null!=e[r]&&(n+=i(r)+":"+e[r]+";");return n?t+'="'+n+'"':n}function v(t,e){var n=t+":"+e;if(le.has(n))return le.get(n);var i=void 0;ue.has(t)?i=ue.get(t):ue.set(t,i=document.createElement(t));var r=i[e];return le.set(n,r),r}function m(t){if(de.has(t))return de.get(t);var e=t.toLowerCase();return de.set(t,e),e}function g(t,e){if(Array.isArray(t))C(e,t[1]);else if(Array.isArray(e)){for(var n=e[0],i=void 0,r=e[1];n!==r;)i=n.nextSibling,t.appendChild(n),n=i;t.appendChild(r)}else t.appendChild(e)}function y(t){if(Array.isArray(t)){for(var e=t[0],n=void 0,i=t[1],r=i.parentNode;e!==i;)n=e.nextSibling,r.removeChild(e),e=n;r.removeChild(i)}else t.parentNode.removeChild(t)}function C(t,e){if(Array.isArray(e)&&(e=e[0]),Array.isArray(t)){for(var n=t[0],i=void 0,r=t[1],o=r.parentNode;n!==r;)i=n.nextSibling,o.insertBefore(n,e),n=i;o.insertBefore(r,e)}else e.parentNode.insertBefore(t,e)}function N(t,e,n){if(n){Array.isArray(e)&&(e=e[1]);var i=e.nextSibling;i?C(t,i):g(e.parentNode,t)}else C(t,e)}function A(t,e){Array.isArray(t)?(C(e,t),y(t)):t.parentNode.replaceChild(e,t)}function w(t){if(Array.isArray(t))for(var e=t[0].nextSibling,n=void 0,i=t[1],r=i.parentNode;e!==i;)n=e.nextSibling,r.removeChild(e),e=n;else t.textContent=""}function b(t,e,n){if(Array.isArray(t)){var i=t[1],r=i.previousSibling;r===t[0]?i.parentNode.insertBefore(document.createTextNode(e),i):r.nodeValue=e}else if(n){var o=t.firstChild;o?o.nodeValue=e:t.textContent=e}else t.innerHTML=e}function x(t){if(Array.isArray(t)){var e=t[0].nextSibling;e.parentNode.removeChild(e)}else t.textContent=""}function D(t){var e="on"+t;if(e in document)return!0;var n=document.createElement("div");return n.setAttribute(e,"return;"),"function"==typeof n[e]||"wheel"===t&&document.implementation&&document.implementation.hasFeature&&!0!==document.implementation.hasFeature("","")&&document.implementation.hasFeature("Events.wheel","3.0")}function k(t,e){this.type=t,this.target=e.target,this.nativeEvent=e,this._isPropagationStopped=!1,this._isDefaultPrevented=!1,this._isPersisted=!1}function T(t,e){if(t in ye){var n=ye[t];if(!n._isPersisted)return n.target=e.target,n.nativeEvent=e,n._isPropagationStopped=!1,n._isDefaultPrevented=!1,n}return ye[t]=new k(t,e)}function R(t,e){return Ce in t?t[Ce]:e?null:t[Ce]=Ne++}function F(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.type;if(ze)for(var n=t.target,i=Fe.get(e),r=i.listenersCount,o=void 0,s=void 0,a=void 0;r&&n&&n!==document;){if((s=R(n,!0))&&Re.has(s)&&null!=(o=Re.get(s)[e])&&(o(a||(a=T(e,t))),0==--r||a.isPropagationStopped()))return;n=n.parentNode}}function z(t){ze&&Re.get(R(t.currentTarget))[t.type](T(t.type,t))}function S(t,e,n){t.bubbles?++t.listenersCount:e.addEventListener(n,z,!1)}function E(t,e,n){if(Fe.has(e)){var i=Fe.get(e);i.set||(null!==i.setup?i.setup():i.bubbles&&document.addEventListener(e,F,!1),i.set=!0);var r=R(t),o=void 0;Re.has(r)?(o=Re.get(r),null==o[e]&&S(i,t,e)):(Re.set(r,o={}),S(i,t,e)),o[e]=n}}function M(t,e,n){t.bubbles?--t.listenersCount:e.removeEventListener(n,z)}function P(t,e){var n=R(t,!0);if(null!==n&&Re.has(n)){Re.get(n)[e]=null,M(Fe.get(e),t,e)}}function j(t){var e=R(t,!0);if(null!==e&&Re.has(e)){var n=Re.get(e);for(var i in n)null!==n[i]&&M(Fe.get(i),t,i);Re.delete(e)}}function U(){ze=!1}function I(){ze=!0}function O(t){return Array.isArray(t)?L(t):t.namespaceURI===Se?null:t.namespaceURI}function L(t){return O((Array.isArray(t)?t[t.length-1]:t).parentNode)}function q(t,e){var n=t.getDomNode();ge.append(n,e.renderToDom(O(n))),e.mount()}function B(t,e){var n=e.getDomNode();ge.insertBefore(t.renderToDom(L(n)),n),t.mount()}function K(t){var e=t.getDomNode();t.unmount(),ge.remove(e)}function H(t,e,n){var i=document.activeElement;U(),ge.move(t.getDomNode(),e.getDomNode(),n),document.activeElement!==i&&i.focus(),I()}function V(t){for(var e=t.getDomNode(),n=t.children,i=n.length,r=0;r<i;)n[r++].unmount();ge.removeChildren(e)}function W(t,e){var n=t.getDomNode();t.unmount(),ge.replace(n,e.renderToDom(L(n))),e.mount()}function Z(t,e,n){var i=t.getDomNode();Me.has(e)?E(i,Me.get(e),n):me(e).set(i,e,n)}function $(t,e){var n=t.getDomNode();Me.has(e)?P(n,Me.get(e)):me(e).remove(n,e)}function G(t,e,n){ge.updateText(t.getDomNode(),e,n)}function J(t){ge.removeText(t.getDomNode())}function Q(t,e){if(t.getDomNode())throw Error('vidom: Detected unexpected attempt to reuse the same node "'+e+'".')}function X(t,e){var n=void 0;if(null===e)Ue.has(t)?n=Ue.get(t):Ue.set(t,n="!"===t?document.createComment(""):document.createElement(t));else{var i=e+":"+t;Ue.has(i)?n=Ue.get(i):Ue.set(i,n=document.createElementNS(e,t))}return n.cloneNode()}function Y(t,e){var n=t.children,i=e.children,r=n.length,o=i.length;if(1===r&&1===o)return void n[0].patch(i[0]);for(var s=0,a=r-1,h=n[s],u=h.key,l=n[a],d=l.key,c=0,f=o-1,_=i[c],p=_.key,v=i[f],m=v.key,g=0,y=null,C=void 0,N=void 0,A={};s<=a&&c<=f;)s in A?g=1:a in A?g=2:u===p?(h.patch(_),g=5):d===m?(l.patch(v),g=10):null!==u&&u===m?(je.moveChild(h,l,!0),h.patch(v),g=9):null!==d&&d===p?(je.moveChild(l,h,!1),l.patch(_),g=6):null!==u&&null===p?(je.insertChild(_,h),g=4):null===u&&null!==p?(je.removeChild(h),g=1):(null===y&&(y=tt(n,s,a)),p in y?(C=y[p],N=n[C],A[C]=!0,je.moveChild(N,h,!1),N.patch(_)):je.insertChild(_,h),g=4),1==(1&g)&&++s<=a&&(h=n[s],u=h.key),2==(2&g)&&--a>=s&&(l=n[a],d=l.key),4==(4&g)&&++c<=f&&(_=i[c],p=_.key),8==(8&g)&&--f>=c&&(v=i[f],m=v.key),g=0;for(;s<=a;)A[s]||je.removeChild(n[s]),++s;for(;c<=f;)f<o-1?je.insertChild(i[c],i[f+1]):je.appendChild(e,i[c]),++c}function tt(t,e,n){for(var i={},r=void 0;e<n;)r=t[e].key,null!==r&&(i[r]=e),++e;return i}function et(){}function nt(t,e){var n="__"+e+"__";Object.defineProperty(t,e,{get:function(){return t[n]},set:function(i){if(t.__isFrozen)throw TypeError("vidom: "+e+" is readonly");t[n]=i}})}function it(t){return he&&(this._sets&$e&&console.warn("Key is already set and shouldn't be set again"),this.__isFrozen=!1),this.key=t,he&&(this._sets|=$e,this.__isFrozen=!0),this}function rt(t){return he&&this._sets&Ge&&console.warn("Ref is already set and shouldn't be set again."),this._ref=t,he&&(this._sets|=Ge),this}function ot(){he&&(nt(this,"type"),nt(this,"key"),nt(this,"children"),this.__isFrozen=!1),this.type=Ve,this.key=null,this.children=null,he&&(this.__isFrozen=!0,this._sets=0),this._domNode=null,this._ctx=Ie}function st(t){if(null==t)return null;var e=Array.isArray(t)?t:[t];return he&&Zt(e),e}function at(t,e){var n={};for(var i in t)n[i]=t[i];for(var r in e)n[r]=e[r];return n}function ht(t){he&&(nt(this,"type"),nt(this,"key"),nt(this,"attrs"),nt(this,"children"),this.__isFrozen=!1),this.type=Ze,this.key=null,this.attrs=Ie,this.children=null,he&&(this.__isFrozen=!0,this._sets=0),this._component=t,this._rootNode=null,this._ctx=Ie}function ut(){he&&(nt(this,"type"),nt(this,"key"),nt(this,"children"),this.__isFrozen=!1),this.type=He,this.key=null,this.children=null,he&&(this.__isFrozen=!0),this._domNode=null}function lt(t){return null==t||"string"==typeof t?t:t.toString()}function dt(){for(var t=0;t<Qe.length;)Qe[t++]();Qe=[]}function ct(t){1===Qe.push(t)&&Je(dt)}function ft(){this._listeners={}}function _t(t){this.type=Be,this._childNode=t,this._ns=null}function pt(t,e,n,i,r){if(he&&!Wt(e))throw TypeError("vidom: Unexpected type of node is passed to mount.");var o=R(t),s=Xe.get(o),a=void 0;if(s&&null!==s.tree){a=++s.id;var h=function(){if((s=Xe.get(o))&&s.id===a){var t=s.tree,r=new _t(e);r.setNs(t._ns).setCtx(n),t.patch(r),s.tree=r,mt(i),he&&tn.emit("replace",t,r)}};r?h():ct(h)}else{if(Xe.set(o,s={tree:null,id:a=++Ye}),t.childNodes.length>0){var u=gt(t);if(null!==u){var l=s.tree=new _t(e);return l.setNs(O(t)).setCtx(n),l.adoptDom(u),l.mount(),mt(i),void(he&&tn.emit("mount",l))}t.textContent=""}var d=function(){var r=Xe.get(o);if(r&&r.id===a){var s=r.tree=new _t(e);s.setNs(O(t)).setCtx(n),ge.append(t,s.renderToDom()),s.mount(),mt(i),he&&tn.emit("mount",s)}};r?d():ct(d)}}function vt(t,e,n){var i=R(t),r=Xe.get(i);r?function(){var t=++r.id,o=function(){if((r=Xe.get(i))&&r.id===t){Xe.delete(i);var n=r.tree;if(null!==n){var o=n.getDomNode();n.unmount(),ge.remove(o)}mt(e),he&&n&&tn.emit("unmount",n)}};r.tree?n?o():ct(o):n||mt(e)}():n||mt(e)}function mt(t){t&&t()}function gt(t){for(var e=t.childNodes,n=e.length,i=0,r=null,o=void 0;i<n;)o=e[i++],r?r.push(o):o.nodeType===Node.COMMENT_NODE&&"vidom"===o.textContent&&(r=[]);return r}function yt(t,e,n,i){"function"==typeof n&&(i=n,n=this),pt(t,e,n,i,!1)}function Ct(t,e,n){pt(t,e,n,null,!0)}function Nt(t,e){vt(t,e,!1)}function At(t){vt(t,null,!0)}function wt(){var t=[];return Xe.forEach(function(e){var n=e.tree;n&&t.push(n)}),t}function bt(){this.__isMounted=!0,this.onMount()}function xt(){this.__isMounted=!1,this.onUnmount()}function Dt(t,e,n,i){if(this.isMounted()){t=this.__buildAttrs(t);var r=this.attrs,o=this.children,s=this.context;if(i){var a=this.__isUpdating;this.__isUpdating=!0,he&&(this.__isFrozen=!1),this.attrs=t,he&&(this.__isFrozen=!0),this.onAttrsReceive(r),he&&(this.__isFrozen=!1),this.children=e,he&&(this.__isFrozen=!0),this.onChildrenReceive(o),he&&(this.__isFrozen=!1),this.context=n,he&&(Object.freeze(this.context),this.__isFrozen=!0),this.onContextReceive(s),this.__isUpdating=a}if(!this.__isUpdating){var h=this.shouldRerender(r,o,this.__prevState,s);if(he){var u=typeof h;"boolean"!==u&&Le.warn("Component#shouldRerender() should return boolean instead of "+u)}if(h){var l=this.__rootNode;this.__rootNode=this.render(),l.patch(this.__rootNode),this.onUpdate(r,o,this.__prevState,s)}}}}function kt(){return!0}function Tt(){return null}function Rt(t){return this.__rootNode.renderToDom(t)}function Ft(){return this.__rootNode.renderToString()}function zt(t,e){return this.__rootNode.adoptDom(t,e)}function St(){return this.__rootNode.getDomNode()}function Et(){return Ie}function Mt(t){var e=void 0;null===this.__rootNode?e=t===Ie?t:at(this.state,t):(this.update(this.state===this.__prevState?Pt:null),e=at(this.state,t)),he&&(this.__isFrozen=!1),this.state=e,he&&(Object.freeze(this.state),this.__isFrozen=!0)}function Pt(){this.__prevState=this.state}function jt(){var t=this.onRender(),e=null===t?Yt("!"):t;if(he&&("object"!=typeof e||Array.isArray(e)))throw TypeError("vidom: Component#onRender must return a single node on the top level or null.");var n=this.onChildContextRequest(),i=n===Ie?this.context:this.context===Ie?n:at(this.context,n);return he&&Object.freeze(i),e.setCtx(i),e}function Ut(t){var e=this;this.__isUpdating?t&&ct(function(){return t.call(e)}):(this.__isUpdating=!0,ct(function(){if(e.isMounted()){e.__isUpdating=!1;var n=e.__rootNode;e.patch(e.attrs,e.children,e.context,!1),t&&t.call(e),he&&tn.emit("replace",n,e.__rootNode)}}))}function It(){return this.__rootNode}function Ot(){return this.__isMounted}function Lt(){return this}function qt(t){if(t===this.attrs)return t;var e=this.constructor.defaultAttrs,n=null!=e,i=t===Ie?n?e:t:n?at(e,t):t;return he&&Object.freeze(i),i}function Bt(t,e){var n=function(t,e,n){he&&(nt(this,"attrs"),nt(this,"children"),nt(this,"state"),nt(this,"context"),this.__isFrozen=!1),this.attrs=this.__buildAttrs(t),this.children=e,this.state=Ie,this.context=n,he&&(this.__isFrozen=!0),this.__isMounted=!1,this.__isUpdating=!1,this.__rootNode=null,this.onInit(),this.__prevState=this.state,this.__rootNode=this.render()},i={constructor:n,onInit:et,mount:bt,unmount:xt,onMount:et,onUnmount:et,onAttrsReceive:et,onChildrenReceive:et,onContextReceive:et,shouldRerender:kt,onRender:Tt,onUpdate:et,isMounted:Ot,setState:Mt,renderToDom:Rt,renderToString:Ft,adoptDom:zt,getDomNode:St,getRootNode:It,render:jt,update:Ut,patch:Dt,onChildContextRequest:Et,onRefRequest:Lt,__buildAttrs:qt};for(var r in t)i[r]=t[r];n.prototype=i;for(var o in e)n[o]=e[o];return n.__vidom__component__=!0,n}function Kt(t,e){var n=nn.get(t);n?n.push(e):nn.set(t,[e])}function Ht(t,e){for(var n=nn.get(t),i=n.length,r=0;r<i;){if(n[r]===e)return void(1===i?nn.delete(t):n.splice(r,1));r++}}function Vt(t){he&&(nt(this,"type"),nt(this,"key"),nt(this,"attrs"),nt(this,"children"),this.__isFrozen=!1),this.type=We,this.key=null,this.attrs=Ie,this.children=null,he&&(this.__isFrozen=!0,this._sets=0),this._component=t,this._instance=null,this._ctx=Ie,this._ref=null}function Wt(t){return t instanceof Vt||t instanceof ot||t instanceof ht||t instanceof Jt||t instanceof ut}function Zt(t){for(var e={},n=t.length,i=0,r=void 0;i<n;){if(r=t[i++],!Wt(r))throw TypeError("vidom: Unexpected type of child. Only a node is expected to be here.");if(null!=r.key){if(r.key in e)throw Error("vidom: Childrens' keys must be unique across the children. Found duplicate of \""+r._key+'" key.');e[r.key]=!0}}}function $t(t){t+="";for(var e=t.length,n=0;e-- >0;)switch(t[e]){case"&":n|=1;break;case"<":n|=2;break;case">":n|=4}return 1==(1&n)&&(t=t.replace(an,"&amp;")),2==(2&n)&&(t=t.replace(hn,"&lt;")),4==(4&n)&&(t=t.replace(un,"&gt;")),t}function Gt(t,e,n){var i=dn[e]||"div",r=cn[i]||(cn[i]=document.createElement(i));if(!n||!ln[n]||ln[n]===e)return r.innerHTML=t,r.removeChild(r.firstChild);var o=ln[n];return r.innerHTML="<"+o+' xmlns="'+n+'">'+t+"</"+o+">",r.removeChild(r.firstChild).firstChild}function Jt(t){he&&(nt(this,"type"),nt(this,"tag"),nt(this,"key"),nt(this,"attrs"),nt(this,"children"),this.__isFrozen=!1),this.type=Ke,this.tag=t,this.key=null,this.attrs=Ie,this.children=null,he&&(this.__isFrozen=!0,this._sets=0),this._domNode=null,this._ns=null,this._escapeChildren=!0,this._ctx=Ie,this._ref=null}function Qt(t){if(null==t)return null;var e=typeof t;if("object"===e){var n=Array.isArray(t)?t:[t];return he&&Zt(n),n}return"string"===e?t:""+t}function Xt(t){for(var e in t)if("on"===e.substr(0,2)&&!Me.has(e))throw Error('vidom: Unsupported type of dom event listener "'+e+'".')}function Yt(t){switch(typeof t){case"string":switch(t){case"fragment":return new ot;case"text":return new ut;case"input":return new Vt(en);case"textarea":return new Vt(pn);case"select":return new Vt(vn);default:return new Jt(t)}case"function":return t.__vidom__component__?new Vt(t):new ht(t);default:if(he)throw TypeError("vidom: Unexpected type of node is passed to the node factory.")}}function te(t){return"<!--vidom-->"+t.renderToString()}function ee(t){if(null==t)return null;var e=typeof t;if("object"!==e)return"string"===e?t||null:""+t;if(!Array.isArray(t))return t;if(0===t.length)return null;for(var n=t,i=0,r=!1,o=void 0,s=t.length,a={};i<s;){if(null===(o=i in a?a[i]:ee(t[i])))null!==n&&(r?n===t&&(n=t.slice(0,i)):n=null);else if("object"==typeof o)Array.isArray(o)?n=r?(n===t?n.slice(0,i):Array.isArray(n)?n:[ne(n)]).concat(o):o:n!==t?r?Array.isArray(n)?n.push(o):n=[ne(n),o]:n=o:o!==t[i]&&(r?(n=n.slice(0,i),n.push(o)):n=o),r=!0;else{for(var h=void 0,u=i;++u<s;)if("string"==typeof(h=a[u]=ee(t[u])))o+=h;else if(null!==h)break;r?Array.isArray(n)?(n===t&&(n=n.slice(0,i)),n.push(ne(o))):n=[n,ne(o)]:n=""+o,i=u-1,r=!0}++i}return n}function ne(t){return"object"==typeof t?t:Yt("text").setChildren(t)}var ie=/&/g,re=/"/g,oe=/([^A-Z]+)([A-Z])/g,se=void 0;"undefined"==typeof Map?(se=function(t){if(this._storage={},t)for(var e=0;e<t.length;e++)this._storage[t[e][0]]=t[e][1]},se.prototype={has:function(t){return t in this._storage},get:function(t){return this._storage[t]},set:function(t,e){return this._storage[t]=e,this},delete:function(t){return delete this._storage[t]},forEach:function(t,e){var n=this._storage;for(var i in n)t.call(e,n[i],i,this)}}):se=Map;var ae=se,he=!1,ue=new ae,le=new ae,de=new ae([["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]]),ce={set:r,remove:u,toString:f},fe={set:o,remove:u,toString:_},_e={set:s,remove:l,toString:f},pe={set:s,remove:l,toString:_},ve=new ae([["autoPlay",fe],["checked",pe],["controls",_e],["disabled",fe],["id",_e],["ismap",fe],["loop",_e],["multiple",pe],["muted",_e],["open",fe],["readOnly",pe],["selected",pe],["srcDoc",_e],["style",{set:a,remove:l,toString:p}],["value",{set:h,remove:l,toString:f}]]),me=function(t){return ve.has(t)?ve.get(t):ce},ge={append:g,remove:y,insertBefore:C,move:N,replace:A,removeChildren:w,updateText:b,removeText:x};k.prototype={stopPropagation:function(){this._isPropagationStopped=!0;var t=this.nativeEvent;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},isPropagationStopped:function(){return this._isPropagationStopped},preventDefault:function(){this._isDefaultPrevented=!0;var t=this.nativeEvent;t.preventDefault?t.preventDefault():t.returnValue=!1},isDefaultPrevented:function(){return this._isDefaultPrevented},persist:function(){this._isPersisted=!0}};var ye={},Ce="__vidom__id__",Ne=1,Ae="undefined"==typeof navigator?"":navigator.userAgent,we=Ae.indexOf("Trident")>-1,be=Ae.indexOf("Edge")>-1,xe=/iPad|iPhone|iPod/.test(Ae)&&"undefined"==typeof MSStream,De=["click","mousedown","mousemove","mouseout","mouseover","mouseup"],ke=["blur","change","contextmenu","copy","cut","dblclick","drag","dragend","dragenter","dragleave","dragover","dragstart","drop","focus","input","keydown","keypress","keyup","paste","submit","touchcancel","touchend","touchmove","touchstart","wheel"],Te=["canplay","canplaythrough","complete","durationchange","emptied","ended","error","load","loadeddata","loadedmetadata","loadstart","mouseenter","mouseleave","pause","play","playing","progress","ratechange","scroll","seeked","seeking","select","stalled","suspend","timeupdate","volumechange","waiting"];xe?Te=[].concat(Te,De):ke=[].concat(ke,De);var Re=new ae,Fe=new ae,ze=!0;"undefined"!=typeof document&&function(){for(var t={focus:"focusin",blur:"focusout"},e=0,n=void 0;e<ke.length;)n=ke[e++],Fe.set(n,{type:n,bubbles:!0,listenersCount:0,set:!1,setup:t[n]?D(t[n])?function(){var e=this.type;document.addEventListener(t[e],function(t){F(t,e)})}:function(){document.addEventListener(this.type,F,!0)}:null});for(e=0;e<Te.length;)Fe.set(Te[e++],{type:n,bubbles:!1,set:!1,setup:null})}();for(var Se="http://www.w3.org/1999/xhtml",Ee=["onAnimationEnd","onAnimationIteration","onAnimationStart","onBlur","onCanPlay","onCanPlayThrough","onChange","onClick","onComplete","onContextMenu","onCopy","onCut","onDblClick","onDrag","onDragEnd","onDragEnter","onDragLeave","onDragOver","onDragStart","onDrop","onDurationChange","onEmptied","onEnded","onError","onFocus","onInput","onKeyDown","onKeyPress","onKeyUp","onLoad","onLoadedData","onLoadedMetadata","onLoadStart","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onPaste","onPause","onPlay","onPlaying","onProgress","onRateChange","onScroll","onSeeked","onSeeking","onSelect","onStalled","onSubmit","onSuspend","onTimeUpdate","onTouchCancel","onTouchEnd","onTouchMove","onTouchStart","onTransitionEnd","onVolumeChange","onWaiting","onWheel"],Me=new ae,Pe=0;Pe<Ee.length;Pe++)Me.set(Ee[Pe],Ee[Pe].substr(2).toLowerCase());var je={appendChild:q,insertChild:B,removeChild:K,moveChild:H,removeChildren:V,replace:W,updateAttr:Z,removeAttr:$,updateText:G,removeText:J},Ue=new ae,Ie={};he&&Object.freeze(Ie);var Oe="undefined"==typeof console?null:console,Le={},qe={log:"",info:"",warn:"Warning!",error:"Error!"};["log","info","warn","error"].forEach(function(t){Le[t]=Oe?Oe[t]?function(e,n,i,r,o){var s=qe[t];switch(arguments.length){case 1:Oe[t](s,e);break;case 2:Oe[t](s,e,n);break;case 3:Oe[t](s,e,n,i);break;case 4:Oe[t](s,e,n,i,r);break;case 5:Oe[t](s,e,n,i,r,o)}}:function(){Oe.log.apply(Oe,arguments)}:et});var Be=1,Ke=2,He=3,Ve=4,We=5,Ze=6,$e=1,Ge=2;ot.prototype={getDomNode:function(){return this._domNode},setKey:it,setChildren:function(t){return he&&(8&this._sets&&Le.warn("Children are already set and shouldn't be set again."),this.__isFrozen=!1),this.children=st(t),he&&(Array.isArray(this.children)&&Object.freeze(this.children),this._sets|=8,this.__isFrozen=!0),this},setCtx:function(t){if(t!==Ie){this._ctx=t;var e=this.children;if(null!==e)for(var n=e.length,i=0;i<n;)e[i++].setCtx(t)}return this},renderToDom:function(t){he&&Q(this,"fragment");var e=this.children,n=[X("!",null),X("!",null)],i=document.createDocumentFragment();if(i.appendChild(n[0]),null!==e)for(var r=e.length,o=0;o<r;)i.appendChild(e[o++].renderToDom(t));return i.appendChild(n[1]),this._domNode=n,i},renderToString:function(){var t=this.children,e="<!---->";if(null!==t)for(var n=t.length-1;n>=0;)e=t[n--].renderToString()+e;return"<!---->"+e},adoptDom:function(t,e){he&&Q(this,"fragment");var n=[t[e++]],i=this.children;if(null!==i)for(var r=i.length,o=0;o<r;)e=i[o++].adoptDom(t,e);return n.push(t[e]),this._domNode=n,e+1},mount:function(){var t=this.children;if(null!==t)for(var e=0,n=t.length;e<n;)t[e++].mount()},unmount:function(){var t=this.children;if(null!==t)for(var e=t.length,n=0;n<e;)t[n++].unmount()},clone:function(){var t=new ot;return he&&(t.__isFrozen=!1),t.key=this.key,t.children=this.children,he&&(t.__isFrozen=!0),t._ctx=this._ctx,t},patch:function(t){this===t?this._patchChildren(t):this.type===t.type?(t._domNode=this._domNode,this._patchChildren(t)):je.replace(this,t)},_patchChildren:function(t){var e=this.children,n=t.children;if(null!==e||null!==n){if(null===n||0===n.length)return void(null!==e&&e.length>0&&je.removeChildren(this));if(null!==e&&0!==e.length)Y(this,t);else for(var i=n.length,r=0;r<i;)je.appendChild(t,n[r++])}}},he&&(ot.prototype.setRef=function(){throw Error("vidom: Fragment nodes don't support refs.")});ht.prototype={getDomNode:function(){return null===this._rootNode?null:this._rootNode.getDomNode()},setKey:it,setAttrs:function(t){return he&&(4&this._sets&&Le.warn("Attrs are already set and shouldn't be set again."),this.__isFrozen=!1),this.attrs=this.attrs===Ie?t:at(this.attrs,t),he&&(Object.freeze(this.attrs),this._sets|=4,this.__isFrozen=!0),this},setChildren:function(t){return he&&(8&this._sets&&Le.warn("Children are already set and shouldn't be set again."),this.__isFrozen=!1),this.children=t,he&&(this._sets|=8,this.__isFrozen=!0),this},setCtx:function(t){return this._ctx=t,this},renderToDom:function(t){return he&&Q(this,this._component.name||"Anonymous"),this._getRootNode().renderToDom(t)},renderToString:function(){return this._getRootNode().renderToString()},adoptDom:function(t,e){return he&&Q(this,this._component.name||"Anonymous"),this._getRootNode().adoptDom(t,e)},mount:function(){this._getRootNode().mount()},unmount:function(){null!==this._rootNode&&(this._rootNode.unmount(),this._rootNode=null)},clone:function(){var t=new ht(this._component);return he&&(t.__isFrozen=!1),t.key=this.key,t.attrs=this.attrs,t.children=this.children,he&&(t.__isFrozen=!0),t._ctx=this._ctx,t},patch:function(t){if(this===t){var e=this._getRootNode();this._rootNode=null,e.patch(this._getRootNode())}else this.type===t.type&&this._component===t._component?(this._getRootNode().patch(t._getRootNode()),this._rootNode=null):(je.replace(this,t),this._rootNode=null)},_getRootNode:function(){if(null!==this._rootNode)return this._rootNode;var t=this._component(this.attrs,this.children,this._ctx)||Yt("!");if(he&&("object"!=typeof t||Array.isArray(t)))throw Error("vidom: Function component must return a single node on the top level.");return t.setCtx(this._ctx),this._rootNode=t}},he&&(ht.prototype.setRef=function(){throw Error("vidom: Function component nodes don't support refs.")});ut.prototype={getDomNode:function(){return this._domNode},setKey:it,setChildren:function(t){return he&&(8&this._sets&&console.warn("Children are already set and shouldn't be set again."),this.__isFrozen=!1),this.children=lt(t),he&&(this._sets|=8,this.__isFrozen=!0),this},setCtx:function(){return this},renderToDom:function(){he&&Q(this,"text");var t=document.createDocumentFragment(),e=[X("!",null),X("!",null)],n=this.children;return t.appendChild(e[0]),null!==n&&t.appendChild(document.createTextNode(n)),t.appendChild(e[1]),this._domNode=e,t},renderToString:function(){return"<!---->"+(this.children||"")+"<!---->"},adoptDom:function(t,e){he&&Q(this,"text");var n=[t[e++]];return this.children&&e++,n.push(t[e++]),this._domNode=n,e},mount:et,unmount:et,clone:function(){var t=new ut;return he&&(t.__isFrozen=!1),t.key=this.key,t.children=this.children,he&&(t.__isFrozen=!0),t},patch:function(t){this!==t&&(this.type===t.type?(t._domNode=this._domNode,this._patchChildren(t)):je.replace(this,t))},_patchChildren:function(t){var e=this.children,n=t.children;e!==n&&(n?je.updateText(this,n,!1):e&&je.removeText(this))}},he&&(ut.prototype.setRef=function(){throw Error("vidom: Text nodes don't support refs.")});var Je="undefined"!=typeof window&&(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame)||function(t){setTimeout(t,1e3/60)},Qe=[];ft.prototype={on:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,fnCtx:n}),this},off:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=this._listeners[t];if(i)for(var r=0,o=void 0;r<i.length;){if(o=i[r],o.fn===e&&o.fnCtx===n){i.splice(r,1);break}r++}return this},emit:function(t){var e=this._listeners[t];if(e){for(var n=0,i=arguments.length,r=Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];for(;n<e.length;){var s=e[n++],a=s.fn,h=s.fnCtx;a.call.apply(a,[h].concat(r))}}return this}},_t.prototype={getDomNode:function(){return this._childNode.getDomNode()},setNs:function(t){return t&&(this._ns=t),this},setCtx:function(t){return t&&this._childNode.setCtx(t),this},renderToDom:function(){return this._childNode.renderToDom(this._ns)},adoptDom:function(t){this._childNode.adoptDom(t,0)},patch:function(t){this._childNode.patch(t._childNode)},mount:function(){this._childNode.mount()},unmount:function(){this._childNode.unmount()}};var Xe=new ae,Ye=0,tn=new ft;tn.getRootNodes=wt,he&&"undefined"!=typeof window&&(window.__vidom__hook__=tn);var en=Bt({onInit:function(){var t=this;this._addAttrs={onChange:null,onInput:function(e){t.onInput(e)}}},onRender:function(){return new Jt("input").setAttrs(at(this.attrs,this._addAttrs))},onInput:function(t){var e=this.attrs.onChange;if(e&&e(t),dt(),this.isMounted()){var n=this.getDomNode(),i=this.attrs.value;void 0!==i&&n.value!==i&&(n.value=i)}},onRefRequest:function(){return this.getDomNode()}}),nn=new ae,rn=Bt({onInit:function(){var t=this;this._addAttrs={onChange:function(e){t.onChange(e)}}},onRender:function(){return new Jt("input").setAttrs(at(this.attrs,this._addAttrs))},onMount:function(){var t=this.attrs.name;t&&Kt(t,this)},onUpdate:function(t){var e=t.name,n=this.attrs.name;n!==e&&(e&&Ht(e,this),n&&Kt(n,this))},onUnmount:function(){var t=this.attrs.name;t&&Ht(t,this)},onChange:function(t){var e=this.attrs.onChange;if(e&&e(t),dt(),this.isMounted()){var n=this.getDomNode(),i=this.attrs,r=i.name,o=i.checked;if(void 0!==o&&n.checked!==o)if(r){for(var s=nn.get(r),a=s.length,h=0,u=void 0,l=void 0;h<a;)if(u=s[h++],void 0!==(l=u.attrs.checked)){var d=u.getDomNode();l!==d.checked&&(d.checked=l)}}else n.checked=o}},onRefRequest:function(){return this.getDomNode()}}),on=Bt({onInit:function(){var t=this;this._addAttrs={onChange:function(e){t.onChange(e)}}},onRender:function(){return new Jt("input").setAttrs(at(this.attrs,this._addAttrs))},onChange:function(t){var e=this.attrs.onChange;if(e&&e(t),dt(),this.isMounted()){var n=this.getDomNode(),i=this.attrs.checked;void 0!==i&&n.checked!==i&&(n.checked=i)}},onRefRequest:function(){return this.getDomNode()}}),sn=Bt({onRender:function(){return new Jt("input").setAttrs(this.attrs)},onRefRequest:function(){return this.getDomNode()}});Vt.prototype={getDomNode:function(){return null===this._instance?null:this._instance.getDomNode()},setKey:it,setRef:rt,setAttrs:function(t){if(he&&(4&this._sets&&console.warn("Attrs are already set and shouldn't be set again."),this.__isFrozen=!1),this.attrs=this.attrs===Ie?t:at(this.attrs,t),he&&(Object.freeze(this.attrs),this._sets|=4,this.__isFrozen=!0),this._component===en)switch(this.attrs.type){case"radio":this._component=rn;break;case"checkbox":this._component=on;break;case"file":this._component=sn}return this},setChildren:function(t){return he&&(8&this._sets&&console.warn("Children are already set and shouldn't be set again."),this.__isFrozen=!1),this.children=t,he&&(this._sets|=8,this.__isFrozen=!0),this},setCtx:function(t){return this._ctx=t,this},renderToDom:function(t){return he&&Q(this,this._component.name||"Anonymous"),this._getInstance().renderToDom(t)},renderToString:function(){return this._getInstance().renderToString()},adoptDom:function(t,e){return he&&Q(this,this._component.name||"Anonymous"),this._getInstance().adoptDom(t,e)},mount:function(){this._instance.getRootNode().mount(),this._instance.mount(),null!==this._ref&&this._ref(this._instance.onRefRequest())},unmount:function(){null!==this._instance&&(this._instance.getRootNode().unmount(),this._instance.unmount(),this._instance=null),null!==this._ref&&this._ref(null)},clone:function(){var t=new Vt(this._component);return he&&(t.__isFrozen=!1),t.key=this.key,t.attrs=this.attrs,t.children=this.children,he&&(t.__isFrozen=!0),t._ctx=this._ctx,t._ref=this._ref,t},patch:function(t){var e=this._getInstance();this===t?e.patch(t.attrs,t.children,t._ctx,!0):this.type===t.type&&this._component===t._component?(e.patch(t.attrs,t.children,t._ctx,!0),t._instance=e,this._patchRef(t)):(je.replace(this,t),this._instance=null)},_patchRef:function(t){null!==this._ref?this._ref!==t._ref&&(this._ref(null),null!==t._ref&&t._ref(t._instance.onRefRequest())):null!==t._ref&&t._ref(t._instance.onRefRequest())},_getInstance:function(){return null===this._instance?this._instance=new this._component(this.attrs,this.children,this._ctx):this._instance}};var an=/&/g,hn=/</g,un=/>/g,ln={"http://www.w3.org/2000/svg":"svg","http://www.w3.org/1998/Math/MathML":"math"},dn={thead:"table",tbody:"table",tfoot:"table",tr:"tbody",td:"tr"},cn={},fn=new ae([["area"],["base"],["br"],["col"],["command"],["embed"],["hr"],["img"],["input"],["keygen"],["link"],["menuitem"],["meta"],["param"],["source"],["track"],["wbr"]]),_n=we||be;Jt.prototype={getDomNode:function(){return this._domNode},setKey:it,setRef:rt,setNs:function(t){return he&&16&this._sets&&Le.warn("Namespace is already set and shouldn't be set again."),this._ns=t,he&&(this._sets|=16),this},setAttrs:function(t){return he&&(4&this._sets&&Le.warn("Attrs are already set and shouldn't be set again."),Xt(t),this.__isFrozen=!1),this.attrs=this.attrs===Ie?t:at(this.attrs,t),he&&(Object.freeze(this.attrs),this._sets|=4,this.__isFrozen=!0),this},setChildren:function(t){return he&&(8&this._sets&&Le.warn("Children are already set and shouldn't be set again."),
this.__isFrozen=!1),this.children=Qt(t),he&&(Array.isArray(this.children)&&Object.freeze(this.children),this._sets|=8,this.__isFrozen=!0),this},setHtml:function(t){return he&&(8&this._sets&&Le.warn("Children are already set and shouldn't be set again."),this.__isFrozen=!1),this.children=t,he&&(this._sets|=8,this.__isFrozen=!0),this._escapeChildren=!1,this},setCtx:function(t){if(t!==Ie){this._ctx=t;var e=this.children;if(null!==e&&"string"!=typeof e)for(var n=e.length,i=0;i<n;)e[i++].setCtx(t)}return this},renderToDom:function(t){he&&Q(this,this.tag);var e=this.tag,n=this.children,i=this._ns||t;if(_n&&n&&"string"!=typeof n){var r=Gt(this.renderToString(),e,i);return this.adoptDom([r],0),r}var o=this._domNode=X(e,i),s=this.attrs;if(null!==n)if("string"==typeof n)this._escapeChildren?o.textContent=n:o.innerHTML=n;else for(var a=0,h=n.length;a<h;)o.appendChild(n[a++].renderToDom(i));if(s!==Ie){var u=void 0,l=void 0;for(u in s)null!=(l=s[u])&&(Me.has(u)?E(o,Me.get(u),l):me(u).set(o,u,l))}return o},renderToString:function(){var t=this.tag;if("!"===t)return"<!---->";var e=this._ns,i=this.attrs,r=this.children,o="<"+t;if(null!==e&&(o+=' xmlns="'+e+'"'),i!==Ie){var s=void 0,a=void 0,h=void 0;for(s in i)if(null!=(a=i[s])){if("value"===s)switch(t){case"textarea":r=a;continue;case"select":this.setCtx({value:a,multiple:i.multiple});continue;case"option":var u=this._ctx;(u.multiple?n(u.value,a):u.value===a)&&(o+=" "+me("selected").toString("selected",!0))}Me.has(s)||""===(h=me(s).toString(s,a))||(o+=" "+h)}}if(fn.has(t))o+="/>";else{if(o+=">",null!==r)if("string"==typeof r)o+=this._escapeChildren?$t(r):r;else for(var l=0,d=r.length;l<d;)o+=r[l++].renderToString();o+="</"+t+">"}return o},adoptDom:function(t,e){he&&Q(this,this.tag);var n=this._domNode=t[e],i=this.attrs,r=this.children;if(i!==Ie){var o=void 0,s=void 0;for(o in i)null!=(s=i[o])&&Me.has(o)&&E(n,Me.get(o),s)}if(null!==r&&"string"!=typeof r){var a=0,h=r.length;if(h>0)for(var u=n.childNodes,l=0;a<h;)l=r[a++].adoptDom(u,l)}return e+1},mount:function(){var t=this.children;if(null!==t&&"string"!=typeof t)for(var e=0,n=t.length;e<n;)t[e++].mount();this._ref&&this._ref(this._domNode)},unmount:function(){var t=this.children;if(t&&"string"!=typeof t)for(var e=0,n=t.length;e<n;)t[e++].unmount();j(this._domNode),this._domNode=null,this._ref&&this._ref(null)},clone:function(){var t=new Jt(this.tag);return he&&(t.__isFrozen=!1),t.key=this.key,t.attrs=this.attrs,t.children=this.children,he&&(t.__isFrozen=!0),t._sets=16,t._ns=this._ns,t._escapeChildren=this._escapeChildren,t._ctx=this._ctx,t._ref=this._ref,t},patch:function(t){this===t?this._patchChildren(t):this.type===t.type&&this.tag===t.tag&&this._ns===t._ns?(t._domNode=this._domNode,this._patchAttrs(t),this._patchChildren(t),this._patchRef(t)):je.replace(this,t)},_patchChildren:function(t){var e=this.children,n=t.children;if(null!==e||null!==n){var i="string"==typeof e;if("string"==typeof n)return i?void(e!==n&&je.updateText(this,n,t._escapeChildren)):(null!==e&&e.length>0&&je.removeChildren(this),void(""!==n&&je.updateText(this,n,t._escapeChildren)));if(null===n||0===n.length)return void(e&&(i?je.removeText(this):e.length>0&&je.removeChildren(this)));if(i&&""!==e&&je.removeText(this),i||null===e||0===e.length)for(var r=n.length,o=0;o<r;)je.appendChild(t,n[o++]);else Y(this,t)}},_patchAttrs:function(t){var e=this.attrs,n=t.attrs;if(e!==n){var i=void 0;if(n!==Ie){var r=void 0,o=void 0,s=void 0,a=void 0;for(i in n)o=n[i],e===Ie||null==(r=e[i])?null!=o&&je.updateAttr(this,i,o):null==o?je.removeAttr(this,i):"object"==typeof o&&"object"==typeof r?(a=Array.isArray(o),s=Array.isArray(r),a||s?a&&s?this._patchAttrArr(i,r,o):je.updateAttr(this,i,o):this._patchAttrObj(i,r,o)):r!==o&&je.updateAttr(this,i,o)}if(e!==Ie)for(i in e)n!==Ie&&i in n||null==e[i]||je.removeAttr(this,i)}},_patchAttrArr:function(t,e,n){if(e!==n){var i=e.length,r=!1;if(i===n.length)for(var o=0;!r&&o<i;)e[o]!=n[o]&&(r=!0),++o;else r=!0;r&&je.updateAttr(this,t,n)}},_patchAttrObj:function(t,e,n){if(e!==n){var i={},r=!1;for(var o in n)e[o]!=n[o]&&(r=!0,i[o]=n[o]);for(var s in e)null==e[s]||s in n||(r=!0,i[s]=null);r&&je.updateAttr(this,t,i)}},_patchRef:function(t){null!==this._ref?this._ref!==t._ref&&(this._ref(null),null!==t._ref&&t._ref(t._domNode)):null!==t._ref&&t._ref(t._domNode)}};var pn=Bt({onInit:function(){var t=this;this._addAttrs={onChange:null,onInput:function(e){t.onInput(e)}}},onRender:function(){return new Jt("textarea").setAttrs(at(this.attrs,this._addAttrs))},onInput:function(t){var e=this.attrs.onChange;if(e&&e(t),dt(),this.isMounted()){var n=this.getDomNode(),i=this.attrs.value;void 0!==i&&n.value!==i&&(n.value=i)}},onRefRequest:function(){return this.getDomNode()}}),vn=Bt({onInit:function(){var t=this;this._addAttrs={onChange:function(e){t.onChange(e)}}},onRender:function(){return new Jt("select").setAttrs(at(this.attrs,this._addAttrs)).setChildren(this.children)},onChange:function(t){var e=t.target,i=this.attrs,r=i.onChange,o=i.multiple;if(r)if(o){for(var s=[],a=e.options,h=a.length,u=0,l=void 0;u<h;)l=a[u++],l.selected&&s.push(l.value);r(t,s)}else r(t);if(dt(),this.isMounted()){var d=this.attrs,c=d.value,f=d.multiple;if(void 0!==c)if(f)for(var _=e.options,p=_.length,v=0,m=void 0;v<p;)m=_[v++],m.selected=n(c,m.value);else e.value!=c&&(e.value=c)}},onRefRequest:function(){return this.getDomNode()}}),mn=Bt();t.node=Yt,t.createComponent=Bt,t.renderToString=te,t.normalizeChildren=ee,t.IS_DEBUG=he,t.console=Le,t.Component=mn,t.mount=yt,t.mountSync=Ct,t.unmount=Nt,t.unmountSync=At,t.getMountedRootNodes=wt,Object.defineProperty(t,"__esModule",{value:!0})});
