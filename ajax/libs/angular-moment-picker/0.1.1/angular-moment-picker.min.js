/*! Angular Moment Picker - v0.1.1 - https://github.com/indrimuska/angular-moment-picker - (c) 2015 Indri Muska - MIT */
!function(a){var b=function(){function b(){defaults={locale:"en",format:"L LT",monthsFormat:"MMM",daysFormat:"D",hoursFormat:"HH:[00]",minutesFormat:moment.localeData().longDateFormat("LT").replace(/[aA]/,""),minutesStep:5,minView:"year",maxView:"hour",startView:"year",leftArrow:"&larr;",rightArrow:"&rarr;"}}return b.prototype.options=function(b){return a.extend(defaults,b),a.copy(defaults)},b.prototype.$get=function(){return defaults},b}(),c=function(){function c(a,c,d,e,f){this.restrict="A",this.scope={model:"=momentPicker",locale:"@?",format:"@?",startView:"@?",minView:"@?",maxView:"@?",minDate:"=?",maxDate:"=?",leftArrow:"@?",rightArrow:"@?"},$timeout=a,$sce=c,$compile=d,$document=e,b=f}return c.prototype.$inject=["$timeout","$sce","$compile","$document","momentPicker"],c.prototype.link=function(c,d,e){c.template='<div class="moment-picker-container {{view.selected}}-view" ng-show="view.isOpen" ng-class="{open:view.isOpen}"><table class="header-view"><thead><tr><th ng-class="{disabled: !view.previous.selectable}" ng-bind-html="view.previous.label" ng-click="view.previous.set()"></th><th ng-bind="view.title" ng-click="view.setParentView()"></th><th ng-class="{disabled: !view.next.selectable}" ng-bind-html="view.next.label" ng-click="view.next.set()"></th></tr></thead></table><div class="moment-picker-specific-views"><table ng-if="view.selected == \'year\'"><tbody><tr ng-repeat="fourMonth in yearView.fourMonths"><td ng-repeat="month in fourMonth track by month.month" ng-class="month.class" ng-bind="month.label" ng-click="yearView.setMonth(month)"></td></tr></tbody></table><table ng-if="view.selected == \'month\'"><thead><tr><th ng-repeat="day in monthView.days" ng-bind="day"></th></tr></thead><tbody><tr ng-repeat="(week, days) in monthView.weeks"><td ng-repeat="day in days track by day.date" ng-class="day.class" ng-bind="day.label" ng-click="monthView.setDate(day)"></td></tr></tbody></table><table ng-if="view.selected == \'day\'"><tbody><tr ng-repeat="threeHours in dayView.threeHours"><td ng-repeat="hour in threeHours track by hour.hour" ng-class="hour.class" ng-bind="hour.label" ng-click="dayView.setHour(hour)"></td></tr></tbody></table><table ng-if="view.selected == \'hour\'"><tbody><tr ng-repeat="minutes in hourView.minutes"><td ng-repeat="minute in minutes" ng-class="minute.class" ng-bind="minute.label" ng-click="hourView.setMinute(minute)"></td></tr></tbody></table></div></div>',a.forEach(["locale","format","startView","minView","maxView","leftArrow","rightArrow"],function(d){a.isDefined(c[d])||(c[d]=b[d]),a.isDefined(e[d])||(e[d]=c[d])}),c.momentToDate=function(b){return a.isDefined(b)&&b.isValid()?b.clone().toDate():void 0},c.valueUpdate=function(){c.value=c.momentToDate(c.valueMoment)},c.limits={isAfterOrEqualMin:function(b,d){return!a.isDefined(c.minDateMoment)||b.isAfter(c.minDateMoment,d)||b.isSame(c.minDateMoment,d)},isBeforeOrEqualMax:function(b,d){return!a.isDefined(c.maxDateMoment)||b.isBefore(c.maxDateMoment,d)||b.isSame(c.maxDateMoment,d)},isSelectable:function(a,b){return c.limits.isAfterOrEqualMin(a,b)&&c.limits.isBeforeOrEqualMax(a,b)},checkValue:function(){a.isDefined(c.valueMoment)&&(c.limits.isAfterOrEqualMin(c.valueMoment)||c.valueUpdate(c.valueMoment=c.minDateMoment.clone()),c.limits.isBeforeOrEqualMax(c.valueMoment)||c.valueUpdate(c.valueMoment=c.maxDateMoment.clone()))},checkView:function(){a.isDefined(c.view.moment)||(c.view.moment=moment().locale(c.locale)),c.limits.isAfterOrEqualMin(c.view.moment)||(c.view.moment=c.minDateMoment.clone()),c.limits.isBeforeOrEqualMax(c.view.moment)||(c.view.moment=c.maxDateMoment.clone()),c.view.update()}},c.views={all:["year","month","day","hour"],formats:{year:"M{1,4}(?![Mo])|Mo|Q|[Ll]{1,4}(?!T)",month:"[Dd]{1,4}(?![Ddo])|DDDo|[Dd]o|[Ww]{1,2}(?![Wwo])|[Ww]o|[Ee]|L{1,4}(?!T)|l{1,4}",day:"[Hh]{1,2}|LTS?",hour:"m{1,2}|[Ll]{3,4}|LTS?"},detectMinMax:function(){var b,d;a.forEach(c.views.formats,function(e,f){var g=new RegExp("("+e+")(?![^[]*])","g");c.format.match(g)&&(a.isDefined(b)||(b=f),d=f)}),b=a.isDefined(b)?Math.max(0,c.views.all.indexOf(b)):0,d=a.isDefined(d)?Math.min(c.views.all.length-1,c.views.all.indexOf(d)):c.views.all.length-1,b>c.views.all.indexOf(c.minView)&&(c.minView=c.views.all[b]),d<c.views.all.indexOf(c.maxView)&&(c.maxView=c.views.all[d])}},c.view={isOpen:!1,selected:c.startView,update:function(){c.view.value=c.momentToDate(c.view.moment)},toggle:function(){c.view.isOpen?c.view.close():c.view.open()},open:function(){a.forEach($document[0].querySelectorAll(".moment-picker-container.open"),function(b){((a.element(b).scope().view||{}).close||a.noop)()}),c.view.isOpen=!0},close:function(){c.view.isOpen=!1,c.view.selected=c.startView},title:"",previous:{selectable:!0,label:$sce.trustAsHtml(c.leftArrow),selectable:!0,set:function(){c.view.previous.selectable&&c.view.update(c.view.moment.subtract(1,c.view.selected).toDate())}},next:{selectable:!0,label:$sce.trustAsHtml(c.rightArrow),set:function(){c.view.next.selectable&&c.view.update(c.view.moment.add(1,c.view.selected).toDate())}},setParentView:function(){c.view.change(c.views.all[Math.max(0,c.views.all.indexOf(c.view.selected)-1)])},render:function(){var a=c.view.moment.clone().startOf(c.view.selected).subtract(1,c.view.selected),b=c.view.moment.clone().endOf(c.view.selected).add(1,c.view.selected);c.view.previous.selectable=c.limits.isAfterOrEqualMin(a,c.view.selected),c.view.previous.label=$sce.trustAsHtml(c.view.previous.selectable?c.leftArrow:"&nbsp;"),c.view.next.selectable=c.limits.isBeforeOrEqualMax(b,c.view.selected),c.view.next.label=$sce.trustAsHtml(c.view.next.selectable?c.rightArrow:"&nbsp;"),c.view.title=c[c.view.selected+"View"].render()},change:function(a){var b=c.views.all.indexOf(a),d=c.views.all.indexOf(c.minView),e=c.views.all.indexOf(c.maxView);0>b||b>e?(c.valueUpdate(c.valueMoment=c.view.moment.clone()),c.view.close()):b>=d&&(c.view.selected=a)}},c.yearView={fourMonths:{},render:function(){var a=c.view.moment.clone().startOf("year"),d=moment.monthsShort();return c.yearView.fourMonths=[],d.forEach(function(d,e){var f=Math.floor(e/4),g=c.limits.isSelectable(a,"month");c.yearView.fourMonths[f]||(c.yearView.fourMonths[f]=[]),c.yearView.fourMonths[f].push({label:a.format(b.monthsFormat),year:a.year(),month:a.month(),"class":g?a.isSame(c.valueMoment,"month")?"selected":"":"disabled",selectable:g}),a.add(1,"months")}),c.view.moment.format("YYYY")},setMonth:function(a){a.selectable&&(c.view.update(c.view.moment.year(a.year).month(a.month)),c.view.change("month"))}},c.monthView={days:function(){for(var a=[],b=moment().locale(c.locale).startOf("week"),d=0;7>d;d++)a.push(b.format("dd")),b.add(1,"days");return a}(),weeks:{},render:function(){var a=c.view.moment.month(),d=c.view.moment.clone().startOf("month").startOf("week"),e=(c.view.moment.clone().endOf("month").endOf("week"),d.week()),f=e+5;c.monthView.weeks={};for(var g=e;f>=g;g++)c.monthView.weeks[g]="0000000".split("").map(function(){var e=c.limits.isSelectable(d,"day"),f={label:d.format(b.daysFormat),year:d.year(),date:d.date(),month:d.month(),"class":e&&d.month()==a?d.isSame(c.valueMoment,"day")?"selected":"":"disabled",selectable:e};return d.add(1,"days"),f});return c.view.moment.format("MMMM YYYY")},setDate:function(a){a.selectable&&(c.view.update(c.view.moment.year(a.year).month(a.month).date(a.date)),c.view.change("day"))}},c.dayView={threeHours:[],render:function(){var a=c.view.moment.clone().startOf("day");moment.localeData().longDateFormat("LT").replace(/[aA]/,"");c.dayView.threeHours=[];for(var d=0;24>d;d++){var e=Math.floor(d/4),f=c.limits.isSelectable(a,"hour");c.dayView.threeHours[e]||(c.dayView.threeHours[e]=[]),c.dayView.threeHours[e].push({label:a.format(b.hoursFormat),year:a.year(),month:a.month(),date:a.date(),hour:a.hour(),"class":f?a.isSame(c.valueMoment,"hour")?"selected":"":"disabled",selectable:f}),a.add(1,"hours")}return c.view.moment.format("LL")},setHour:function(a){a.selectable&&(c.view.update(c.view.moment.year(a.year).month(a.month).date(a.date).hour(a.hour)),c.view.change("hour"))}},c.hourView={minutes:[],render:function(){var a=0,d=c.view.moment.clone().startOf("hour");c.hourView.minutes=[];for(var e=0;60>e;e+=b.minutesStep){var f=Math.floor(a/4),g=c.limits.isSelectable(d,"minute");c.hourView.minutes[f]||(c.hourView.minutes[f]=[]),c.hourView.minutes[f].push({label:d.format(b.minutesFormat),year:d.year(),month:d.month(),date:d.date(),hour:d.hour(),minute:d.minute(),"class":g?d.isSame(c.valueMoment,"minute")?"selected":"":"disabled",selectable:g}),a++,d.add(b.minutesStep,"minutes")}return c.view.moment.clone().startOf("hour").format("lll")},setMinute:function(a){a.selectable&&(c.view.update(c.view.moment.year(a.year).month(a.month).date(a.date).hour(a.hour).minute(a.minute)),c.view.change("minute"))}},c.picker=a.element('<span class="moment-picker"></span>'),d.after(c.picker),c.contents=d.addClass("moment-picker-contents").removeAttr("moment-picker"),c.container=$compile(c.template)(c),c.picker.append(c.contents),c.picker.append(c.container),c.views.detectMinMax(),c.limits.checkView(),c.$watch("model",function(b,d){a.isDefined(b)&&(c.valueMoment=moment(b,c.format,c.locale),c.valueMoment.isValid()||(c.valueMoment=void 0)),c.valueUpdate(c.valueMoment),c.limits.checkValue()}),c.$watch("value",function(b,d){a.isDefined(c.valueMoment)&&$timeout(function(){c.view.update(c.view.moment=c.valueMoment.clone()),c.model=c.valueMoment.format(c.format)})}),c.$watch("[view.selected, view.value]",c.view.render,!0),c.$watch("[minView, maxView]",function(){c.views.detectMinMax(),c.startView=c.views.all[Math.max(Math.min(c.views.all.indexOf(c.startView),c.views.all.indexOf(c.maxView)),c.views.all.indexOf(c.minView))]}),c.$watch("[minDate, maxDate]",function(){a.forEach(["minDate","maxDate"],function(b){a.isDefined(c[b])&&(c[b+"Moment"]=moment(c[b],c.format,c.locale),c[b+"Moment"].isValid()||(c[b+"Moment"]=void 0))}),c.limits.checkValue(),c.limits.checkView(),c.view.render()},!0),$document.on("click",function(){c.view.isOpen&&$timeout(c.view.close)}),c.container.on("click",function(a){a.stopPropagation()}),c.contents.on("click",function(a){a.stopPropagation(),c.view.isOpen||$timeout(c.view.open)}),a.element(c.contents[0].querySelector("input")).on("focus",function(){c.view.isOpen||$timeout(c.view.open)})},c}();a.module("moment-picker",[]).provider("momentPicker",[function(){return new b}]).directive("momentPicker",["$timeout","$sce","$compile","$document","momentPicker",function(a,b,d,e,f){return new c(a,b,d,e,f)}])}(window.angular);