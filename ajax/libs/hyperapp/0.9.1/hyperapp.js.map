{"version":3,"file":"hyperapp.js","sources":["../src/h.js","../src/app.js","../src/router.js"],"sourcesContent":["export default function(tag, data) {\n  var node\n  var stack = []\n  var children = []\n\n  for (var i = arguments.length; i-- > 2; ) {\n    stack[stack.length] = arguments[i]\n  }\n\n  while (stack.length) {\n    if (Array.isArray((node = stack.pop()))) {\n      for (var i = node.length; i--; ) {\n        stack[stack.length] = node[i]\n      }\n    } else if (node != null && node !== true && node !== false) {\n      if (typeof node === \"number\") {\n        node = node + \"\"\n      }\n      children[children.length] = node\n    }\n  }\n\n  return typeof tag === \"string\"\n    ? {\n        tag: tag,\n        data: data || {},\n        children: children\n      }\n    : tag(data, children)\n}\n","export default function(app) {\n  var state = {}\n  var view = app.view\n  var actions = {}\n  var events = {}\n  var node\n  var element\n\n  for (var i = -1, plugins = app.plugins || []; i < plugins.length; i++) {\n    var plugin = plugins[i] ? plugins[i](app) : app\n\n    if (plugin.state != null) {\n      state = merge(state, plugin.state)\n    }\n\n    init(actions, plugin.actions)\n\n    Object.keys(plugin.events || []).map(function(key) {\n      events[key] = (events[key] || []).concat(plugin.events[key])\n    })\n  }\n\n  if (document.readyState[0] !== \"l\") {\n    load()\n  } else {\n    addEventListener(\"DOMContentLoaded\", load)\n  }\n\n  function init(namespace, children, lastName) {\n    Object.keys(children || []).map(function(key) {\n      var action = children[key]\n      var name = lastName ? lastName + \".\" + key : key\n\n      if (typeof action === \"function\") {\n        namespace[key] = function(data) {\n          var result = action(\n            state,\n            actions,\n            emit(\"action\", {\n              name: name,\n              data: data\n            }).data,\n            emit\n          )\n\n          if (result == null || typeof result.then === \"function\") {\n            return result\n          }\n\n          render((state = merge(state, emit(\"update\", result))), view)\n        }\n      } else {\n        init(namespace[key] || (namespace[key] = {}), action, name)\n      }\n    })\n  }\n\n  function load() {\n    render(state, view)\n    emit(\"loaded\")\n  }\n\n  function emit(name, data) {\n    ;(events[name] || []).map(function(cb) {\n      var result = cb(state, actions, data, emit)\n      if (result != null) {\n        data = result\n      }\n    })\n\n    return data\n  }\n\n  function render(state, view) {\n    element = patch(\n      app.root || (app.root = document.body),\n      element,\n      node,\n      (node = emit(\"render\", view)(state, actions))\n    )\n  }\n\n  function merge(a, b) {\n    var obj = {}\n\n    if (typeof b !== \"object\" || Array.isArray(b)) {\n      return b\n    }\n\n    for (var i in a) {\n      obj[i] = a[i]\n    }\n    for (var i in b) {\n      obj[i] = b[i]\n    }\n\n    return obj\n  }\n\n  function createElementFrom(node, isSVG) {\n    if (typeof node === \"string\") {\n      var element = document.createTextNode(node)\n    } else {\n      var element = (isSVG = isSVG || node.tag === \"svg\")\n        ? document.createElementNS(\"http://www.w3.org/2000/svg\", node.tag)\n        : document.createElement(node.tag)\n\n      for (var i = 0; i < node.children.length; ) {\n        element.appendChild(createElementFrom(node.children[i++], isSVG))\n      }\n\n      for (var i in node.data) {\n        if (i === \"oncreate\") {\n          node.data[i](element)\n        } else {\n          setElementData(element, i, node.data[i])\n        }\n      }\n    }\n\n    return element\n  }\n\n  function setElementData(element, name, value, oldValue) {\n    if (name === \"key\") {\n    } else if (name === \"style\") {\n      for (var i in merge(oldValue, (value = value || {}))) {\n        element.style[i] = value[i] || \"\"\n      }\n    } else {\n      try {\n        element[name] = value\n      } catch (_) {}\n\n      if (typeof value !== \"function\") {\n        if (value) {\n          element.setAttribute(name, value)\n        } else {\n          element.removeAttribute(name)\n        }\n      }\n    }\n  }\n\n  function updateElementData(element, oldData, data) {\n    for (var name in merge(oldData, data)) {\n      var value = data[name]\n      var oldValue = oldData[name]\n\n      if (name === \"onupdate\") {\n        value(element)\n      } else if (value !== oldValue || value !== element[name]) {\n        setElementData(element, name, value, oldValue)\n      }\n    }\n  }\n\n  function getKeyFrom(node) {\n    if (node && (node = node.data)) {\n      return node.key\n    }\n  }\n\n  function removeElement(parent, element, node) {\n    if (node.data && node.data.onremove) {\n      node.data.onremove(element)\n    }\n    parent.removeChild(element)\n  }\n\n  function patch(parent, element, oldNode, node) {\n    if (oldNode == null) {\n      element = parent.insertBefore(createElementFrom(node), element)\n    } else if (node.tag && node.tag === oldNode.tag) {\n      updateElementData(element, oldNode.data, node.data)\n\n      var len = node.children.length\n      var oldLen = oldNode.children.length\n      var reusableChildren = {}\n      var oldElements = []\n      var newKeys = {}\n\n      for (var i = 0; i < oldLen; i++) {\n        var oldElement = element.childNodes[i]\n        oldElements[i] = oldElement\n\n        var oldChild = oldNode.children[i]\n        var oldKey = getKeyFrom(oldChild)\n\n        if (null != oldKey) {\n          reusableChildren[oldKey] = [oldElement, oldChild]\n        }\n      }\n\n      var i = 0\n      var j = 0\n\n      while (j < len) {\n        var oldElement = oldElements[i]\n        var oldChild = oldNode.children[i]\n        var newChild = node.children[j]\n\n        var oldKey = getKeyFrom(oldChild)\n        if (newKeys[oldKey]) {\n          i++\n          continue\n        }\n\n        var newKey = getKeyFrom(newChild)\n\n        var reusableChild = reusableChildren[newKey]\n        var reusableElement = 0\n        var reusableNode = 0\n\n        if (reusableChild) {\n          reusableElement = reusableChild[0]\n          reusableNode = reusableChild[1]\n        }\n\n        if (null == newKey) {\n          if (null == oldKey) {\n            patch(element, oldElement, oldChild, newChild)\n            j++\n          }\n          i++\n        } else {\n          if (oldKey === newKey) {\n            patch(element, reusableElement, reusableNode, newChild)\n            i++\n          } else if (reusableElement) {\n            element.insertBefore(reusableElement, oldElement)\n            patch(element, reusableElement, reusableNode, newChild)\n          } else {\n            patch(element, oldElement, null, newChild)\n          }\n\n          j++\n          newKeys[newKey] = newChild\n        }\n      }\n\n      while (i < oldLen) {\n        var oldChild = oldNode.children[i]\n        var oldKey = getKeyFrom(oldChild)\n        if (null == oldKey) {\n          removeElement(element, oldElements[i], oldChild)\n        }\n        i++\n      }\n\n      for (var i in reusableChildren) {\n        var reusableChild = reusableChildren[i]\n        var reusableNode = reusableChild[1]\n        if (!newKeys[reusableNode.data.key]) {\n          removeElement(element, reusableChild[0], reusableNode)\n        }\n      }\n    } else if (node !== oldNode) {\n      var i = element\n      parent.replaceChild((element = createElementFrom(node)), i)\n    }\n\n    return element\n  }\n}\n","export default function(app) {\n  return {\n    state: {\n      router: match(location.pathname)\n    },\n    actions: {\n      router: {\n        match: function(state, actions, data, emit) {\n          return {\n            router: emit(\"route\", match(data))\n          }\n        },\n        go: function(state, actions, data) {\n          history.pushState({}, \"\", data)\n          actions.router.match(data)\n        }\n      }\n    },\n    events: {\n      loaded: function(state, actions) {\n        match()\n        addEventListener(\"popstate\", match)\n        function match() {\n          actions.router.match(location.pathname)\n        }\n      },\n      render: function(state, actions, view) {\n        return view[state.router.match]\n      }\n    }\n  }\n\n  function match(data) {\n    var match\n    var params = {}\n\n    for (var route in app.view) {\n      var keys = []\n\n      if (!match && route !== \"*\") {\n        data.replace(\n          RegExp(\n            \"^\" +\n              route\n                .replace(/\\//g, \"\\\\/\")\n                .replace(/:([\\w]+)/g, function(_, key) {\n                  keys.push(key)\n                  return \"([-\\\\w]+)\"\n                }) +\n              \"/?$\",\n            \"g\"\n          ),\n          function() {\n            for (var i = 1; i < arguments.length - 2; ) {\n              params[keys.shift()] = arguments[i++]\n            }\n            match = route\n          }\n        )\n      }\n    }\n\n    return {\n      match: match || \"*\",\n      params: params\n    }\n  }\n}\n"],"names":["tag","data","node","stack","children","i","arguments","length","Array","isArray","pop","app","init","namespace","lastName","Object","keys","map","key","action","name","result","state","actions","emit","then","render","merge","view","load","events","cb","element","patch","root","document","body","a","b","obj","createElementFrom","isSVG","createTextNode","createElementNS","createElement","appendChild","setElementData","value","oldValue","style","_","setAttribute","removeAttribute","updateElementData","oldData","getKeyFrom","removeElement","parent","onremove","removeChild","oldNode","insertBefore","len","oldLen","reusableChildren","oldElements","newKeys","oldElement","childNodes","oldChild","oldKey","j","newChild","newKey","reusableChild","reusableElement","reusableNode","replaceChild","plugins","plugin","concat","readyState","addEventListener","match","params","route","replace","RegExp","push","shift","router","location","pathname","go","history","pushState","loaded"],"mappings":"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"}