{"version":3,"file":"hyperapp.js","sources":["../src/h.js","../src/app.js","../src/router.js"],"sourcesContent":["export default function (tag, data) {\n  var node\n  var canConcat\n  var oldCanConcat\n\n  var stack = []\n  var children = []\n\n  for (var i = arguments.length; i-- > 2;) {\n    stack.push(arguments[i])\n  }\n\n  while (stack.length) {\n    if (Array.isArray(node = stack.pop())) {\n      i = node.length\n\n      while (i--) {\n        stack.push(node[i])\n      }\n    } else if (node != null && node !== true && node !== false) {\n      i = children.length\n\n      if (typeof node === \"number\") {\n        node = node + \"\"\n      }\n\n      canConcat = typeof node === \"string\"\n\n      if (canConcat && oldCanConcat) {\n        children[i - 1] += node\n      } else {\n        children[i] = node\n        oldCanConcat = canConcat\n      }\n    }\n  }\n\n  return typeof tag === \"string\"\n    ? {\n      tag: tag,\n      data: data || {},\n      children: children\n    }\n    : tag(data, children)\n}\n","export default function (app) {\n  var state = {}\n  var view = app.view\n  var actions = {}\n  var events = {}\n  var node\n  var element\n\n  for (var i = -1, plugins = app.plugins || []; i < plugins.length; i++) {\n    var plugin = plugins[i] ? plugins[i](app) : app\n\n    if (plugin.state != null) {\n      state = merge(state, plugin.state)\n    }\n\n    init(actions, plugin.actions)\n\n    Object.keys(plugin.events || []).map(function (key) {\n      events[key] = (events[key] || []).concat(plugin.events[key])\n    })\n  }\n\n  if (document.readyState[0] !== \"l\") {\n    load()\n  } else {\n    addEventListener(\"DOMContentLoaded\", load)\n  }\n\n  function init(namespace, children, lastName) {\n    Object.keys(children || []).map(function (key) {\n      var action = children[key]\n      var name = lastName ? lastName + \".\" + key : key\n\n      if (typeof action === \"function\") {\n        namespace[key] = function (data) {\n          var result = action(state, emit(\"action\", {\n            name: name,\n            data: data\n          }).data, actions, emit)\n\n          if (result == null || typeof result.then === \"function\") {\n            return result\n          }\n\n          render(state = merge(state, emit(\"update\", result)), view)\n        }\n      } else {\n        init(namespace[key] || (namespace[key] = {}), action, name)\n      }\n    })\n  }\n\n  function load() {\n    render(state, view)\n    emit(\"loaded\", emit)\n  }\n\n  function emit(name, data) {\n    (events[name] || []).map(function (cb) {\n      var result = cb(state, actions, data, emit)\n      if (result != null) {\n        data = result\n      }\n    })\n\n    return data\n  }\n\n  function render(state, view) {\n    element = patch(\n      app.root || (app.root = document.body),\n      element,\n      node,\n      node = emit(\"render\", view)(state, actions)\n    )\n  }\n\n  function merge(a, b) {\n    var obj = {}\n\n    if (typeof b !== \"object\" || Array.isArray(b)) {\n      return b\n    }\n\n    for (var i in a) {\n      obj[i] = a[i]\n    }\n    for (var i in b) {\n      obj[i] = b[i]\n    }\n\n    return obj\n  }\n\n  function createElementFrom(node, isSVG) {\n    if (typeof node === \"string\") {\n      var element = document.createTextNode(node)\n\n    } else {\n      var element = (isSVG = isSVG || node.tag === \"svg\")\n        ? document.createElementNS(\"http://www.w3.org/2000/svg\", node.tag)\n        : document.createElement(node.tag)\n\n      for (var i = 0; i < node.children.length;) {\n        element.appendChild(createElementFrom(node.children[i++], isSVG))\n      }\n\n      for (var name in node.data) {\n        if (name === \"onCreate\") {\n          node.data[name](element)\n        } else {\n          setElementData(element, name, node.data[name])\n        }\n      }\n    }\n\n    return element\n  }\n\n  function setElementData(element, name, value, oldValue) {\n    if (name === \"key\") {\n    } else if ((name = name.toLowerCase()) === \"style\") {\n      for (var i in merge(oldValue, value = value || {})) {\n        element.style[i] = value[i] || \"\"\n      }\n    } else {\n      try {\n        element[name] = value\n      } catch (_) {\n      }\n\n      if (typeof value !== \"function\") {\n        if (value) {\n          element.setAttribute(name, value)\n        } else {\n          element.removeAttribute(name)\n        }\n      }\n    }\n  }\n\n  function updateElementData(element, oldData, data) {\n    for (var name in merge(oldData, data)) {\n      var value = data[name]\n      var oldValue = oldData[name]\n\n      if (name === \"onUpdate\") {\n        value(element)\n\n      } else if (value !== oldValue || value !== element[name]) {\n        setElementData(element, name, value, oldValue)\n      }\n    }\n  }\n\n  function getKeyFrom(node) {\n    if (node && (node = node.data)) {\n      return node.key\n    }\n  }\n\n  function removeElement(parent, element, node) {\n    if (node.data.onRemove) {\n      node.data.onRemove(element)\n    }\n    parent.removeChild(element)\n  }\n\n  function patch(parent, element, oldNode, node) {\n    if (oldNode == null) {\n      element = parent.insertBefore(createElementFrom(node), element)\n\n    } else if (node.tag && node.tag === oldNode.tag) {\n      updateElementData(element, oldNode.data, node.data)\n\n      var len = node.children.length\n      var oldLen = oldNode.children.length\n      var reusableChildren = {}\n      var oldElements = []\n      var newKeys = {}\n\n      for (var i = 0; i < oldLen; i++) {\n        var oldElement = element.childNodes[i]\n        oldElements[i] = oldElement\n\n        var oldChild = oldNode.children[i]\n        var oldKey = getKeyFrom(oldChild)\n\n        if (null != oldKey) {\n          reusableChildren[oldKey] = [oldElement, oldChild]\n        }\n      }\n\n      var i = 0\n      var j = 0\n\n      while (j < len) {\n        var oldElement = oldElements[i]\n        var oldChild = oldNode.children[i]\n        var newChild = node.children[j]\n\n        var oldKey = getKeyFrom(oldChild)\n        if (newKeys[oldKey]) {\n          i++\n          continue\n        }\n\n        var newKey = getKeyFrom(newChild)\n\n        var reusableChild = reusableChildren[newKey]\n        var reusableElement = 0\n        var reusableNode = 0\n\n        if (reusableChild) {\n          reusableElement = reusableChild[0]\n          reusableNode = reusableChild[1]\n        }\n\n        if (null == oldKey && null == newKey) {\n          patch(element, oldElement, oldChild, newChild)\n          j++\n          i++\n\n        } else if (null == oldKey && null != newKey) {\n          if (reusableElement) {\n            element.insertBefore(reusableElement, oldElement)\n            patch(element, reusableElement, reusableNode, newChild)\n          } else {\n            patch(element, oldElement, null, newChild)\n          }\n\n          j++\n          newKeys[newKey] = newChild\n\n        } else if (null != oldKey && null == newKey) {\n          i++\n\n        } else {\n          if (oldKey === newKey) {\n            patch(element, reusableElement, reusableNode, newChild)\n            i++\n\n          } else if (reusableElement) {\n            element.insertBefore(reusableElement, oldElement)\n            patch(element, reusableElement, reusableNode, newChild)\n\n          } else {\n            patch(element, oldElement, null, newChild)\n          }\n\n          j++\n          newKeys[newKey] = newChild\n        }\n      }\n\n      while (i < oldLen) {\n        var oldChild = oldNode.children[i]\n        var oldKey = getKeyFrom(oldChild)\n        if (null == oldKey) {\n          removeElement(element, oldElements[i], oldChild)\n        }\n        i++\n      }\n\n      for (var i in reusableChildren) {\n        var reusableChild = reusableChildren[i]\n        var reusableNode = reusableChild[1]\n        if (!newKeys[reusableNode.data.key]) {\n          removeElement(element, reusableChild[0], reusableNode)\n        }\n      }\n    } else if (node !== oldNode) {\n      var i = element\n      parent.replaceChild(element = createElementFrom(node), i)\n    }\n\n    return element\n  }\n}\n\n","export default function (app) {\n  return {\n    actions: {\n      router: {\n        match: function (state, data, actions, emit) {\n          return {\n            router: match(data, emit)\n          }\n        },\n        go: function (state, data, actions) {\n          history.pushState({}, \"\", data)\n          actions.router.match(data)\n        }\n      }\n    },\n    events: {\n      loaded: function (state, actions) {\n        addEventListener(\"popstate\", function () {\n          actions.router.match(location.pathname)\n        })\n      },\n      render: function (state, actions, view, emit) {\n        return view[(state.router || (\n          state.router = match(location.pathname, emit))).match]\n      }\n    }\n  }\n\n  function match(data, emit) {\n    var match\n    var params = {}\n\n    for (var route in app.view) {\n      var keys = []\n\n      if (!match && route !== \"*\") {\n        data.replace(new RegExp(\"^\" + route\n          .replace(/\\//g, \"\\\\/\")\n          .replace(/:([A-Za-z0-9_]+)/g, function (_, key) {\n            keys.push(key)\n\n            return \"([-A-Za-z0-9_]+)\"\n          }) + \"/?$\", \"g\"), function () {\n\n            for (var i = 1; i < arguments.length - 2;) {\n              params[keys.shift()] = arguments[i++]\n            }\n\n            match = route\n          })\n      }\n    }\n\n    return emit(\"route\", {\n      match: match || \"*\",\n      params: params\n    })\n  }\n}\n\n"],"names":["tag","data","node","canConcat","oldCanConcat","stack","children","i","arguments","length","push","Array","isArray","pop","app","init","namespace","lastName","Object","keys","map","key","action","name","result","state","emit","actions","then","render","merge","view","load","events","cb","element","patch","root","document","body","a","b","obj","createElementFrom","isSVG","createTextNode","createElementNS","createElement","appendChild","setElementData","value","oldValue","toLowerCase","style","_","setAttribute","removeAttribute","updateElementData","oldData","getKeyFrom","removeElement","parent","onRemove","removeChild","oldNode","insertBefore","len","oldLen","reusableChildren","oldElements","newKeys","oldElement","childNodes","oldChild","oldKey","j","newChild","newKey","reusableChild","reusableElement","reusableNode","replaceChild","plugins","plugin","concat","readyState","addEventListener","match","params","route","replace","RegExp","shift","router","go","history","pushState","loaded","location","pathname"],"mappings":"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"}