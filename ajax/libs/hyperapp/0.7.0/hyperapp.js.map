{"version":3,"file":"hyperapp.js","sources":["../src/h.js","../src/router.js","../src/app.js"],"sourcesContent":["var i, node, children, stack = []\n\nexport default function (tag, data) {\n  var canConcat, oldCanConcat\n\n  children = []\n  i = arguments.length\n\n  while (i-- > 2) {\n    stack.push(arguments[i])\n  }\n\n  while (stack.length) {\n    if (Array.isArray(node = stack.pop())) {\n      i = node.length\n\n      while (i--) {\n        stack.push(node[i])\n      }\n    } else if (node != null && node !== true && node !== false) {\n      // Ignore nulls and booleans; this is conditional rendering.\n\n      if (typeof node === \"number\") {\n        node = node + \"\"\n      }\n\n      // Concatenate contiguous number/string nodes into one string.\n      // The idea is to avoid creating unnecessary text nodes.\n\n      canConcat = typeof node === \"string\"\n\n      if (canConcat && oldCanConcat) {\n        children[children.length - 1] += node\n      } else {\n        children.push(node)\n        oldCanConcat = canConcat\n      }\n    }\n  }\n\n  if (typeof tag === \"function\") {\n    return tag(data, children)\n  }\n\n  if (tag === \"svg\") {\n    svg(tag, data, children)\n  }\n\n  return {\n    tag: tag,\n    data: data || {},\n    children: children\n  }\n}\n\nfunction svg(tag, data, children) {\n  data.ns = \"http://www.w3.org/2000/svg\"\n\n  for (var i = 0; i < children.length; i++) {\n    var node = children[i]\n    if (node.data) {\n      svg(node.tag, node.data, node.children)\n    }\n  }\n}\n","export default function (options) {\n  return {\n    model: {\n      router: match(options.view, location.pathname)\n    },\n    actions: {\n      router: {\n        match: function (_, data) {\n          return {\n            router: match(options.view, data)\n          }\n        },\n        go: function (_, data, actions) {\n          history.pushState({}, \"\", data)\n          actions.router.match(data)\n        }\n      }\n    },\n    hooks: {\n      onRender: function (model) {\n        return options.view[model.router.match]\n      }\n    },\n    subscriptions: [\n      function (_, actions) {\n        addEventListener(\"popstate\", function () {\n          actions.router.match(location.pathname)\n        })\n      }\n    ]\n  }\n}\n\nfunction match(routes, path) {\n  var match, params = {}\n\n  for (var route in routes) {\n    var keys = []\n\n    if (route === \"*\") {\n      continue\n    }\n\n    path.replace(new RegExp(\"^\" + route\n      .replace(/\\//g, \"\\\\/\")\n      .replace(/:([A-Za-z0-9_]+)/g, function (_, key) {\n        keys.push(key)\n        return \"([A-Za-z0-9_]+)\"\n      }) + \"/?$\", \"g\"), function () {\n\n        for (var i = 1; i < arguments.length - 2; i++) {\n          params[keys.shift()] = arguments[i]\n        }\n        match = route\n      })\n\n    if (match) {\n      break\n    }\n  }\n\n  return {\n    match: match || \"*\",\n    params: params\n  }\n}\n","export default function (app) {\n  var view = app.view || function () {\n    return \"\"\n  }\n\n  var model\n  var actions = {}\n  var subscriptions = []\n  var hooks = {\n    onError: [],\n    onAction: [],\n    onUpdate: [],\n    onRender: []\n  }\n\n  var plugins = [app].concat((app.plugins || []).map(function (plugin) {\n    return plugin(app)\n  }))\n\n  var node\n  var root\n  var batch = []\n\n  for (var i = 0; i < plugins.length; i++) {\n    var plugin = plugins[i]\n\n    if (plugin.model !== undefined) {\n      model = merge(model, plugin.model)\n    }\n\n    if (plugin.actions) {\n      init(actions, plugin.actions)\n    }\n\n    if (plugin.subscriptions) {\n      subscriptions = subscriptions.concat(plugin.subscriptions)\n    }\n\n    var _hooks = plugin.hooks\n    if (_hooks) {\n      Object.keys(_hooks).forEach(function (key) {\n        hooks[key].push(_hooks[key])\n      })\n    }\n  }\n\n  function onError(error) {\n    for (var i = 0; i < hooks.onError.length; i++) {\n      hooks.onError[i](error)\n    }\n\n    if (i <= 0) {\n      throw error\n    }\n  }\n\n  function init(container, group, lastName) {\n    Object.keys(group).forEach(function (key) {\n      if (!container[key]) {\n        container[key] = {}\n      }\n\n      var name = lastName ? lastName + \".\" + key : key\n      var action = group[key]\n      var i\n\n      if (typeof action === \"function\") {\n        container[key] = function (data) {\n          for (i = 0; i < hooks.onAction.length; i++) {\n            hooks.onAction[i](name, data)\n          }\n\n          var result = action(model, data, actions, onError)\n\n          if (result === undefined || typeof result.then === \"function\") {\n            return result\n\n          } else {\n            for (i = 0; i < hooks.onUpdate.length; i++) {\n              hooks.onUpdate[i](model, result, data)\n            }\n\n            model = merge(model, result)\n            render(model, view)\n          }\n        }\n      } else {\n        init(container[key], action, name)\n      }\n    })\n  }\n\n  load(function () {\n    root = app.root || document.body.appendChild(document.createElement(\"div\"))\n\n    render(model, view)\n\n    for (var i = 0; i < subscriptions.length; i++) {\n      subscriptions[i](model, actions, onError)\n    }\n  })\n\n  function load(fn) {\n    if (document.readyState[0] !== \"l\") {\n      fn()\n    } else {\n      document.addEventListener(\"DOMContentLoaded\", fn)\n    }\n  }\n\n  function render(model, view) {\n    for (i = 0; i < hooks.onRender.length; i++) {\n      view = hooks.onRender[i](model, view)\n    }\n\n    patch(root, node, node = view(model, actions), 0)\n\n    for (var i = 0; i < batch.length; i++) {\n      batch[i]()\n    }\n\n    batch = []\n  }\n\n  function merge(a, b) {\n    var obj = {}\n    var key\n\n    if (isPrimitive(b) || Array.isArray(b)) {\n      return b\n    }\n\n    for (key in a) {\n      obj[key] = a[key]\n    }\n    for (key in b) {\n      obj[key] = b[key]\n    }\n\n    return obj\n  }\n\n  function isPrimitive(type) {\n    type = typeof type\n    return type === \"string\" || type === \"number\" || type === \"boolean\"\n  }\n\n  function defer(fn, data) {\n    setTimeout(function () {\n      fn(data)\n    }, 0)\n  }\n\n  function shouldUpdate(a, b) {\n    return a.tag !== b.tag || typeof a !== typeof b || isPrimitive(a) && a !== b\n  }\n\n  function createElementFrom(node) {\n    var element\n\n    // There are only two types of nodes. A string node, which is\n    // converted into a Text node or an object that describes an\n    // HTML element and may also contain children.\n\n    if (typeof node === \"string\") {\n      element = document.createTextNode(node)\n\n    } else {\n      element = node.data && node.data.ns\n        ? document.createElementNS(node.data.ns, node.tag)\n        : document.createElement(node.tag)\n\n      for (var name in node.data) {\n        if (name === \"oncreate\") {\n          defer(node.data[name], element)\n        } else {\n          setElementData(element, name, node.data[name])\n        }\n      }\n\n      for (var i = 0; i < node.children.length; i++) {\n        element.appendChild(createElementFrom(node.children[i]))\n      }\n    }\n\n    return element\n  }\n\n  function removeElementData(element, name, value) {\n    // Hyperx adds a className attribute to nodes we must handle.\n\n    element.removeAttribute(name === \"className\" ? \"class\" : name)\n\n    if (typeof value === \"boolean\" || value === \"true\" || value === \"false\") {\n      element[name] = false\n    }\n  }\n\n  function setElementData(element, name, value, oldValue) {\n    if (name === \"style\") {\n      for (var i in value) {\n        element.style[i] = value[i]\n      }\n\n    } else if (name[0] === \"o\" && name[1] === \"n\") {\n      var event = name.substr(2)\n\n      element.removeEventListener(event, oldValue)\n      element.addEventListener(event, value)\n\n    } else {\n      if (value === \"false\" || value === false) {\n        element.removeAttribute(name)\n        element[name] = false\n\n      } else {\n        element.setAttribute(name, value)\n        if (element.namespaceURI !== \"http://www.w3.org/2000/svg\") {\n          // SVG element's props are read only in strict mode.\n\n          element[name] = value\n        }\n      }\n    }\n  }\n\n  function updateElementData(element, data, oldData) {\n    for (var name in merge(oldData, data)) {\n      var value = data[name]\n      var oldValue = oldData[name]\n      var realValue = element[name]\n\n      if (value === undefined) {\n        removeElementData(element, name, oldValue)\n\n      } else if (name === \"onupdate\") {\n        defer(value, element)\n\n      } else if (\n        value !== oldValue ||\n        typeof realValue === \"boolean\" &&\n        realValue !== value\n      ) {\n        // This prevents cases where the node's data is out of sync with\n        // the element's. For example, a list of checkboxes in which one\n        // of the elements is recycled.\n\n        setElementData(element, name, value, oldValue)\n      }\n    }\n  }\n\n  function patch(parent, oldNode, node, index) {\n    if (oldNode === undefined) {\n      parent.appendChild(createElementFrom(node))\n\n    } else if (node === undefined) {\n      var element = parent.childNodes[index]\n\n      // Removing a child one at a time updates the DOM, so we end up\n      // with an index out of date that needs to be adjusted. Instead,\n      // collect all the elements and delete them in a batch.\n\n      batch.push(parent.removeChild.bind(parent, element))\n\n      if (oldNode && oldNode.data && oldNode.data.onremove) {\n        defer(oldNode.data.onremove, element)\n      }\n\n    } else if (shouldUpdate(node, oldNode)) {\n      parent.replaceChild(createElementFrom(node), parent.childNodes[index])\n\n    } else if (node.tag) {\n      var element = parent.childNodes[index]\n\n      updateElementData(element, node.data, oldNode.data)\n\n      var len = node.children.length, oldLen = oldNode.children.length\n\n      for (var i = 0; i < len || i < oldLen; i++) {\n        var child = node.children[i]\n\n        patch(element, oldNode.children[i], child, i)\n      }\n    }\n  }\n}\n"],"names":["svg","tag","data","children","ns","i","length","node","match","routes","path","params","route","keys","replace","RegExp","_","key","push","arguments","shift","stack","canConcat","oldCanConcat","Array","isArray","pop","app","onError","error","hooks","init","container","group","lastName","Object","forEach","name","action","onAction","result","model","actions","undefined","then","onUpdate","merge","render","view","load","fn","document","readyState","addEventListener","onRender","patch","root","batch","a","b","obj","isPrimitive","type","defer","setTimeout","shouldUpdate","createElementFrom","element","createTextNode","createElementNS","createElement","setElementData","appendChild","removeElementData","value","removeAttribute","oldValue","style","event","substr","removeEventListener","setAttribute","namespaceURI","updateElementData","oldData","realValue","parent","oldNode","index","childNodes","removeChild","bind","onremove","replaceChild","len","oldLen","child","subscriptions","plugins","concat","map","plugin","_hooks","body","options","router","location","pathname","go","history","pushState"],"mappings":"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"}