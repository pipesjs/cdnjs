/*! videojs-chromecast - v1.0.0 - 2014-09-22
* https://github.com/kim-company/videojs-chromecast
* Copyright (c) 2014 KIM Keep In Mind GmbH, srl; Licensed MIT */

(function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};vjs.addLanguage("de",{"CASTING TO":"WIEDERGABE AUF"}),vjs.addLanguage("it",{"CASTING TO":"PLAYBACK SU"}),vjs.plugin("chromecast",function(a){return this.chromecastComponent=new vjs.ChromecastComponent(this,a),this.controlBar.addChild(this.chromecastComponent)}),vjs.ChromecastComponent=function(a){function c(a,b){this.settings=b,vjs.Button.call(this,a,b),a.controls()||this.disable(),this.hide(),this.initializeApi()}return b(c,a),c.prototype.buttonText="Chromecast",c.prototype.inactivityTimeout=2e3,c.prototype.apiInitialized=!1,c.prototype.apiSession=null,c.prototype.apiMedia=null,c.prototype.casting=!1,c.prototype.paused=!0,c.prototype.muted=!1,c.prototype.currentVolume=1,c.prototype.currentMediaTime=0,c.prototype.timer=null,c.prototype.timerStep=1e3,c.prototype.initializeApi=function(){var a,b;if(vjs.IS_CHROME)return chrome.cast&&chrome.cast.isAvailable?(b=new chrome.cast.SessionRequest(this.settings.appId?this.settings.appId:chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID),a=new chrome.cast.ApiConfig(b,this.sessionJoinedListener,this.receiverListener.bind(this)),chrome.cast.initialize(a,this.onInitSuccess.bind(this),this.castError)):void setTimeout(this.initializeApi.bind(this),1e3)},c.prototype.sessionJoinedListener=function(){return void 0},c.prototype.receiverListener=function(a){return"available"===a?this.show():void 0},c.prototype.onInitSuccess=function(){return this.apiInitialized=!0},c.prototype.castError=function(a){return vjs.log("Cast Error: "+JSON.stringify(a))},c.prototype.doLaunch=function(){return this.apiInitialized?chrome.cast.requestSession(this.onSessionSuccess.bind(this),this.castError):vjs.log("Session not initialized")},c.prototype.onSessionSuccess=function(a){var b,c,d;return this.apiSession=a,this.addClass("connected"),d=new chrome.cast.media.MediaInfo(this.player_.currentSrc(),"video/mp4"),this.settings.metadata&&(d.metadata=new chrome.cast.media.GenericMediaMetadata,this.settings.metadata.title&&(d.metadata.title=this.settings.metadata.title),this.settings.metadata.subtitle&&(d.metadata.subtitle=this.settings.metadata.subtitle),this.player_.options_.poster&&(b=new chrome.cast.Image(this.player_.options_.poster),d.metadata.images=[b])),c=new chrome.cast.media.LoadRequest(d),c.autoplay=!0,c.currentTime=this.player_.currentTime(),this.apiSession.loadMedia(c,this.onMediaDiscovered.bind(this),this.castError),this.apiSession.addUpdateListener(this.onSessionUpdate.bind(this))},c.prototype.onMediaDiscovered=function(a){return this.apiMedia=a,this.apiMedia.addUpdateListener(this.onMediaStatusUpdate.bind(this)),this.startProgressTimer(this.incrementMediaTime.bind(this)),this.player_.loadTech("ChromecastTech",{receiver:this.apiSession.receiver.friendlyName}),this.casting=!0,this.paused=this.player_.paused(),this.inactivityTimeout=this.player_.options_.inactivityTimeout,this.player_.options_.inactivityTimeout=0,this.player_.userActive(!0)},c.prototype.onSessionUpdate=function(a){return this.apiMedia?a?void 0:this.onStopAppSuccess():void 0},c.prototype.onMediaStatusUpdate=function(){if(this.apiMedia)switch(this.currentMediaTime=this.apiMedia.currentTime,this.apiMedia.playerState){case chrome.cast.media.PlayerState.IDLE:return this.currentMediaTime=0,this.trigger("timeupdate"),this.onStopAppSuccess();case chrome.cast.media.PlayerState.PAUSED:if(this.paused)return;return this.player_.pause(),this.paused=!0;case chrome.cast.media.PlayerState.PLAYING:if(!this.paused)return;return this.player_.play(),this.paused=!1}},c.prototype.startProgressTimer=function(a){return this.timer&&(clearInterval(this.timer),this.timer=null),this.timer=setInterval(a.bind(this),this.timerStep)},c.prototype.play=function(){return this.apiMedia&&this.paused?(this.apiMedia.play(null,this.mediaCommandSuccessCallback.bind(this,"Playing: "+this.apiMedia.sessionId),this.onError),this.paused=!1):void 0},c.prototype.pause=function(){return this.apiMedia?this.paused?void 0:(this.apiMedia.pause(null,this.mediaCommandSuccessCallback.bind(this,"Paused: "+this.apiMedia.sessionId),this.onError),this.paused=!0):void 0},c.prototype.seekMedia=function(a){var b;return b=new chrome.cast.media.SeekRequest,b.currentTime=a,this.apiMedia.seek(b,this.onSeekSuccess.bind(this,a),this.onError)},c.prototype.onSeekSuccess=function(a){return this.currentMediaTime=a},c.prototype.setMediaVolume=function(a,b){var c,d;if(this.apiMedia)return d=new chrome.cast.Volume,d.level=a,d.muted=b,this.currentVolume=d.level,this.muted=b,c=new chrome.cast.media.VolumeRequest,c.volume=d,this.apiMedia.setVolume(c,this.mediaCommandSuccessCallback.bind(this,"Volume changed"),this.onError),this.player_.trigger("volumechange")},c.prototype.incrementMediaTime=function(){return this.apiMedia.playerState===chrome.cast.media.PlayerState.PLAYING?this.currentMediaTime<this.apiMedia.media.duration?(this.currentMediaTime+=1,this.trigger("timeupdate")):(this.currentMediaTime=0,clearInterval(this.timer)):void 0},c.prototype.mediaCommandSuccessCallback=function(a){return vjs.log(a)},c.prototype.onError=function(){return vjs.log("error")},c.prototype.stopCasting=function(){return this.apiSession.stop(this.onStopAppSuccess.bind(this),this.onError)},c.prototype.onStopAppSuccess=function(){return clearInterval(this.timer),this.casting=!1,this.removeClass("connected"),this.player_.src(this.player_.options_.sources),vjs.insertFirst(this.player_.tech.el_,this.player_.el()),this.player_.tech.setControls(!1),this.player_.options_.inactivityTimeout=this.inactivityTimeout,this.player_.ready(function(){return this.player_.currentTime(this.currentMediaTime),this.paused?void 0:this.player_.play()}),this.apiMedia=null,this.apiSession=null},c.prototype.buildCSSClass=function(){return"vjs-chromecast-button "+vjs.Button.prototype.buildCSSClass.call(this)},c.prototype.createEl=function(){return vjs.Button.prototype.createEl.call(this,"div")},c.prototype.onClick=function(){return vjs.Button.prototype.onClick.call(this),this.casting?this.stopCasting():this.doLaunch()},c}(vjs.Button),vjs.ChromecastTech=function(a){function c(a,b,c){this.featuresVolumeControl=!0,this.movingMediaElementInDOM=!1,this.featuresFullscreenResize=!1,this.featuresProgressEvents=!0,vjs.MediaTechController.call(this,a,b,c),this.el_=videojs.Component.prototype.createEl("div",{id:""+this.player_.id_+"_chromecast_api",className:"vjs-tech vjs-tech-chromecast",innerHTML:'<div class="casting-image" style="background-image: url(\''+this.player_.options_.poster+'\')"></div><div class="casting-overlay"><div class="casting-information"><div class="casting-icon">&#58880</div><div class="casting-description"><small>'+this.localize("CASTING TO")+"</small><br>"+b.source.receiver+"</div></div>"}),vjs.insertFirst(this.el_,this.player_.el()),this.triggerReady()}return b(c,a),c.isSupported=function(){return this.player_.chromecastComponent.apiInitialized},c.canPlaySource=function(a){return"video/mp4"===a.type},c.prototype.dispose=function(){return vjs.MediaTechController.prototype.dispose.call(this)},c.prototype.play=function(){return this.player_.chromecastComponent.play(),this.player_.onPlay()},c.prototype.pause=function(){return this.player_.chromecastComponent.pause(),this.player_.onPause()},c.prototype.paused=function(){return this.player_.chromecastComponent.paused},c.prototype.currentTime=function(){return this.player_.chromecastComponent.currentMediaTime},c.prototype.setCurrentTime=function(a){return this.player_.chromecastComponent.seekMedia(a)},c.prototype.volume=function(){return this.player_.chromecastComponent.currentVolume},c.prototype.setVolume=function(a){return this.player_.chromecastComponent.setMediaVolume(a,!1)},c.prototype.muted=function(){return this.player_.chromecastComponent.muted},c.prototype.setMuted=function(a){return this.player_.chromecastComponent.setMediaVolume(this.player_.chromecastComponent.currentVolume,a)},c.prototype.supportsFullScreen=function(){return!1},c}(vjs.MediaTechController)}).call(this);