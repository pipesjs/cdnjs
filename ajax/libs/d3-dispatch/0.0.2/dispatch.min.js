"undefined"==typeof Map&&(Map=function(){this.clear()},Map.prototype={set:function(t,n){return this._[t]=n,this},get:function(t){return this._[t]},has:function(t){return t in this._},"delete":function(t){return t in this._&&delete this._[t]},clear:function(){this._=Object.create(null)},get size(){var t=0;for(var n in this._)++t;return t},forEach:function(t){for(var n in this._)t(this._[n],n,this)}}),function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.dispatch=n()}(this,function(){"use strict";function t(){this.callbacks=[],this.callbackByName=new Map}function n(n){function e(t){return function(){return t.apply(this,arguments),s}}var i,a,c=-1,l=n.length,r=new Map,s=this;for(s.on=function(t,n){var e=(t+="").indexOf("."),i="";return e>=0&&(i=t.slice(e+1),t=t.slice(0,e)),t?(t=r.get(t),arguments.length<2?t.on(i):(t.on(i,n),s)):2===arguments.length?(null==n&&r.forEach(function(t){t.on(i,null)}),s):void 0};++c<l;){if(a=n[c]+"",a in s)throw new Error("illegal or duplicate type: "+a);i=new t,r.set(a,i),s[a]=e(i)}}t.prototype={apply:function(t,n){for(var e,i=this.callbacks,a=-1,c=i.length;++a<c;)(e=i[a].value)&&e.apply(t,n)},on:function(t,n){var e,i=this.callbackByName.get(t+="");return arguments.length<2?i&&i.value:(i&&(i.value=null,e=this.callbacks.indexOf(i),this.callbacks=this.callbacks.slice(0,e).concat(this.callbacks.slice(e+1)),this.callbackByName["delete"](t)),void(n&&(n={value:n},this.callbackByName.set(t,n),this.callbacks.push(n))))}};var e=function(){return new n(arguments)},i=e;return i});