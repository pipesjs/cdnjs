var toGeoJSON=function(){"use strict";function e(e){if(!e||!e.length)return 0;for(var t=0,r=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t)|0;return r}function t(e,t){return e.getElementsByTagName(t)}function r(e,t){return e.getAttribute(t)}function n(e,t){return parseFloat(r(e,t))}function o(e,r){var n=t(e,r);return n.length?n[0]:null}function i(e){return e.normalize&&e.normalize(),e}function a(e){for(var t=0,r=[];t<e.length;t++)r[t]=parseFloat(e[t]);return r}function s(e){var t={};for(var r in e)e[r]&&(t[r]=e[r]);return t}function l(e){return e&&i(e),e&&e.textContent||""}function u(e){return a(e.replace(m,"").split(","))}function c(e){for(var t=e.replace(d,"").split(y),r=[],n=0;n<t.length;n++)r.push(u(t[n]));return r}function g(e){var t,r=[n(e,"lon"),n(e,"lat")],i=o(e,"ele"),a=o(e,"gpxtpx:hr")||o(e,"hr"),s=o(e,"time");return i&&(t=parseFloat(l(i)),isNaN(t)||r.push(t)),{coordinates:r,time:s?l(s):null,heartRate:a?parseFloat(l(a)):null}}function f(){return{type:"FeatureCollection",features:[]}}function p(e){return void 0!==e.xml?e.xml:h.serializeToString(e)}var h,m=/\s*/g,d=/^\s*|\s*$/g,y=/\s+/;return"undefined"!=typeof XMLSerializer?h=new XMLSerializer:"object"!=typeof exports||"object"!=typeof process||process.browser||(h=new(require("xmldom").XMLSerializer)),{kml:function(n){function i(e){var t,r;return e=e||"","#"===e.substr(0,1)&&(e=e.substr(1)),6!==e.length&&3!==e.length||(t=e),8===e.length&&(r=parseInt(e.substr(0,2),16)/255,t="#"+e.substr(2)),[t,isNaN(r)?void 0:r]}function s(e){return a(e.split(" "))}function g(e){var r=t(e,"coord","gx"),n=[],o=[];0===r.length&&(r=t(e,"gx:coord"));for(var i=0;i<r.length;i++)n.push(s(l(r[i])));for(var a=t(e,"when"),u=0;u<a.length;u++)o.push(l(a[u]));return{coords:n,times:o}}function h(e){var r,n,i,a,s,f=[],p=[];if(o(e,"MultiGeometry"))return h(o(e,"MultiGeometry"));if(o(e,"MultiTrack"))return h(o(e,"MultiTrack"));if(o(e,"gx:MultiTrack"))return h(o(e,"gx:MultiTrack"));for(i=0;i<y.length;i++)if(n=t(e,y[i]))for(a=0;a<n.length;a++)if(r=n[a],"Point"===y[i])f.push({type:"Point",coordinates:u(l(o(r,"coordinates")))});else if("LineString"===y[i])f.push({type:"LineString",coordinates:c(l(o(r,"coordinates")))});else if("Polygon"===y[i]){var m=t(r,"LinearRing"),d=[];for(s=0;s<m.length;s++)d.push(c(l(o(m[s],"coordinates"))));f.push({type:"Polygon",coordinates:d})}else if("Track"===y[i]||"gx:Track"===y[i]){var v=g(r);f.push({type:"LineString",coordinates:v.coords}),v.times.length&&p.push(v.times)}return{geoms:f,coordTimes:p}}for(var m=f(),d={},y=["Polygon","LineString","Point","Track","gx:Track"],v=t(n,"Placemark"),S=t(n,"Style"),k=t(n,"StyleMap"),T=0;T<S.length;T++)d["#"+r(S[T],"id")]=e(p(S[T])).toString(16);for(var x=0;x<k.length;x++)d["#"+r(k[x],"id")]=e(p(k[x])).toString(16);for(var N=0;N<v.length;N++)m.features=m.features.concat(function(e){var n,a=h(e),s={},u=l(o(e,"name")),c=l(o(e,"styleUrl")),g=l(o(e,"description")),f=o(e,"TimeSpan"),p=o(e,"ExtendedData"),m=o(e,"LineStyle"),y=o(e,"PolyStyle");if(!a.geoms.length)return[];if(u&&(s.name=u),"#"!==c[0]&&(c="#"+c),c&&d[c]&&(s.styleUrl=c,s.styleHash=d[c]),g&&(s.description=g),f){var v=l(o(f,"begin")),S=l(o(f,"end"));s.timespan={begin:v,end:S}}if(m){var k=i(l(o(m,"color"))),T=k[0],x=k[1],N=parseFloat(l(o(m,"width")));T&&(s.stroke=T),isNaN(x)||(s["stroke-opacity"]=x),isNaN(N)||(s["stroke-width"]=N)}if(y){var b=i(l(o(y,"color"))),L=b[0],M=b[1],F=l(o(y,"fill")),P=l(o(y,"outline"));L&&(s.fill=L),isNaN(M)||(s["fill-opacity"]=M),F&&(s["fill-opacity"]="1"===F?1:0),P&&(s["stroke-opacity"]="1"===P?1:0)}if(p){var R=t(p,"Data"),w=t(p,"SimpleData");for(n=0;n<R.length;n++)s[R[n].getAttribute("name")]=l(o(R[n],"value"));for(n=0;n<w.length;n++)s[w[n].getAttribute("name")]=l(w[n])}a.coordTimes.length&&(s.coordTimes=1===a.coordTimes.length?a.coordTimes[0]:a.coordTimes);var z={type:"Feature",geometry:1===a.geoms.length?a.geoms[0]:{type:"GeometryCollection",geometries:a.geoms},properties:s};return r(e,"id")&&(z.id=r(e,"id")),[z]}(v[N]));return m},gpx:function(e){function r(e,r){var n=t(e,r),o=[],i=[],a=[],s=n.length;if(s<2)return{};for(var l=0;l<s;l++){var u=g(n[l]);o.push(u.coordinates),u.time&&i.push(u.time),u.heartRate&&a.push(u.heartRate)}return{line:o,times:i,heartRates:a}}function n(e){var t,r=["name","desc","author","copyright","link","time","keywords"],n={};for(t=0;t<r.length;t++)n[r[t]]=l(o(e,r[t]));return s(n)}var i,a,u=t(e,"trk"),c=t(e,"rte"),p=t(e,"wpt"),h=f();for(i=0;i<u.length;i++)(a=function(e){for(var o,i=t(e,"trkseg"),a=[],s=[],l=[],u=0;u<i.length;u++)o=r(i[u],"trkpt"),o.line&&a.push(o.line),o.times&&o.times.length&&s.push(o.times),o.heartRates&&o.heartRates.length&&l.push(o.heartRates);if(0!==a.length){var c=n(e);return s.length&&(c.coordTimes=1===a.length?s[0]:s),l.length&&(c.heartRates=1===a.length?l[0]:l),{type:"Feature",properties:c,geometry:{type:1===a.length?"LineString":"MultiLineString",coordinates:1===a.length?a[0]:a}}}}(u[i]))&&h.features.push(a);for(i=0;i<c.length;i++)(a=function(e){var t=r(e,"rtept");if(t.line){return{type:"Feature",properties:n(e),geometry:{type:"LineString",coordinates:t.line}}}}(c[i]))&&h.features.push(a);for(i=0;i<p.length;i++)h.features.push(function(e){var t=n(e);return t.sym=l(o(e,"sym")),{type:"Feature",properties:t,geometry:{type:"Point",coordinates:g(e).coordinates}}}(p[i]));return h}}}();"undefined"!=typeof module&&(module.exports=toGeoJSON);
//# sourceMappingURL=togeojson.min.js.map