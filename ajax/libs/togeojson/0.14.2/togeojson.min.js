var toGeoJSON=function(){"use strict";function e(e){if(!e||!e.length)return 0;for(var t=0,r=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t)|0;return r}function t(e,t){return e.getElementsByTagName(t)}function r(e,t){return e.getAttribute(t)}function n(e,t){return parseFloat(r(e,t))}function i(e,r){var n=t(e,r);return n.length?n[0]:null}function o(e){return e.normalize&&e.normalize(),e}function a(e){for(var t=0,r=[];t<e.length;t++)r[t]=parseFloat(e[t]);return r}function s(e){var t={};for(var r in e)e[r]&&(t[r]=e[r]);return t}function l(e){return e&&o(e),e&&e.textContent||""}function u(e){return a(e.replace(m,"").split(","))}function c(e){for(var t=e.replace(y,"").split(d),r=[],n=0;n<t.length;n++)r.push(u(t[n]));return r}function f(e){var t,r=[n(e,"lon"),n(e,"lat")],o=i(e,"ele"),a=i(e,"gpxtpx:hr")||i(e,"hr"),s=i(e,"time");return o&&(t=parseFloat(l(o)),isNaN(t)||r.push(t)),{coordinates:r,time:s?l(s):null,heartRate:a?parseFloat(l(a)):null}}function g(){return{type:"FeatureCollection",features:[]}}function p(e){return void 0!==e.xml?e.xml:h.serializeToString(e)}var h,m=/\s*/g,y=/^\s*|\s*$/g,d=/\s+/;return"undefined"!=typeof XMLSerializer?h=new XMLSerializer:"object"!=typeof exports||"object"!=typeof process||process.browser||(h=new(require("xmldom").XMLSerializer)),{kml:function(n){function o(e){var t,r;return e=e||"","#"===e.substr(0,1)&&(e=e.substr(1)),6!==e.length&&3!==e.length||(t=e),8===e.length&&(r=parseInt(e.substr(0,2),16)/255,t="#"+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)),[t,isNaN(r)?void 0:r]}function s(e){return a(e.split(" "))}function f(e){var r=t(e,"coord","gx"),n=[],i=[];0===r.length&&(r=t(e,"gx:coord"));for(var o=0;o<r.length;o++)n.push(s(l(r[o])));for(var a=t(e,"when"),u=0;u<a.length;u++)i.push(l(a[u]));return{coords:n,times:i}}function h(e){var r,n,o,a,s,g=[],p=[];if(i(e,"MultiGeometry"))return h(i(e,"MultiGeometry"));if(i(e,"MultiTrack"))return h(i(e,"MultiTrack"));if(i(e,"gx:MultiTrack"))return h(i(e,"gx:MultiTrack"));for(o=0;o<S.length;o++)if(n=t(e,S[o]))for(a=0;a<n.length;a++)if(r=n[a],"Point"===S[o])g.push({type:"Point",coordinates:u(l(i(r,"coordinates")))});else if("LineString"===S[o])g.push({type:"LineString",coordinates:c(l(i(r,"coordinates")))});else if("Polygon"===S[o]){var m=t(r,"LinearRing"),y=[];for(s=0;s<m.length;s++)y.push(c(l(i(m[s],"coordinates"))));g.push({type:"Polygon",coordinates:y})}else if("Track"===S[o]||"gx:Track"===S[o]){var d=f(r);g.push({type:"LineString",coordinates:d.coords}),d.times.length&&p.push(d.times)}return{geoms:g,coordTimes:p}}for(var m=g(),y={},d={},v={},S=["Polygon","LineString","Point","Track","gx:Track"],k=t(n,"Placemark"),T=t(n,"Style"),b=t(n,"StyleMap"),x=0;x<T.length;x++){var L=e(p(T[x])).toString(16);y["#"+r(T[x],"id")]=L,d[L]=T[x]}for(var N=0;N<b.length;N++){y["#"+r(b[N],"id")]=e(p(b[N])).toString(16);for(var M=t(b[N],"Pair"),P={},F=0;F<M.length;F++)P[l(i(M[F],"key"))]=l(i(M[F],"styleUrl"));v["#"+r(b[N],"id")]=P}for(var w=0;w<k.length;w++)m.features=m.features.concat(function(e){var n,a=h(e),s={},u=l(i(e,"name")),c=l(i(e,"styleUrl")),f=l(i(e,"description")),g=i(e,"TimeSpan"),p=i(e,"TimeStamp"),m=i(e,"ExtendedData"),S=i(e,"LineStyle"),k=i(e,"PolyStyle"),T=i(e,"visibility");if(!a.geoms.length)return[];if(u&&(s.name=u),c){"#"!==c[0]&&(c="#"+c),s.styleUrl=c,y[c]&&(s.styleHash=y[c]),v[c]&&(s.styleMapHash=v[c],s.styleHash=y[v[c].normal]);var b=d[s.styleHash];b&&(S||(S=i(b,"LineStyle")),k||(k=i(b,"PolyStyle")))}if(f&&(s.description=f),g){var x=l(i(g,"begin")),L=l(i(g,"end"));s.timespan={begin:x,end:L}}if(p&&(s.timestamp=l(i(p,"when"))),S){var N=o(l(i(S,"color"))),M=N[0],P=N[1],F=parseFloat(l(i(S,"width")));M&&(s.stroke=M),isNaN(P)||(s["stroke-opacity"]=P),isNaN(F)||(s["stroke-width"]=F)}if(k){var w=o(l(i(k,"color"))),R=w[0],z=w[1],G=l(i(k,"fill")),A=l(i(k,"outline"));R&&(s.fill=R),isNaN(z)||(s["fill-opacity"]=z),G&&(s["fill-opacity"]="1"===G?s["fill-opacity"]||1:0),A&&(s["stroke-opacity"]="1"===A?s["stroke-opacity"]||1:0)}if(m){var C=t(m,"Data"),H=t(m,"SimpleData");for(n=0;n<C.length;n++)s[C[n].getAttribute("name")]=l(i(C[n],"value"));for(n=0;n<H.length;n++)s[H[n].getAttribute("name")]=l(H[n])}T&&(s.visibility=l(T)),a.coordTimes.length&&(s.coordTimes=1===a.coordTimes.length?a.coordTimes[0]:a.coordTimes);var D={type:"Feature",geometry:1===a.geoms.length?a.geoms[0]:{type:"GeometryCollection",geometries:a.geoms},properties:s};return r(e,"id")&&(D.id=r(e,"id")),[D]}(k[w]));return m},gpx:function(e){function r(e,r){var n=t(e,r),i=[],o=[],a=[],s=n.length;if(s<2)return{};for(var l=0;l<s;l++){var u=f(n[l]);i.push(u.coordinates),u.time&&o.push(u.time),u.heartRate&&a.push(u.heartRate)}return{line:i,times:o,heartRates:a}}function n(e){var t,r=["name","desc","author","copyright","link","time","keywords"],n={};for(t=0;t<r.length;t++)n[r[t]]=l(i(e,r[t]));return s(n)}var o,a,u=t(e,"trk"),c=t(e,"rte"),p=t(e,"wpt"),h=g();for(o=0;o<u.length;o++)(a=function(e){for(var i,o=t(e,"trkseg"),a=[],s=[],l=[],u=0;u<o.length;u++)(i=r(o[u],"trkpt"))&&(i.line&&a.push(i.line),i.times&&i.times.length&&s.push(i.times),i.heartRates&&i.heartRates.length&&l.push(i.heartRates));if(0!==a.length){var c=n(e);return s.length&&(c.coordTimes=1===a.length?s[0]:s),l.length&&(c.heartRates=1===a.length?l[0]:l),{type:"Feature",properties:c,geometry:{type:1===a.length?"LineString":"MultiLineString",coordinates:1===a.length?a[0]:a}}}}(u[o]))&&h.features.push(a);for(o=0;o<c.length;o++)(a=function(e){var t=r(e,"rtept");if(t.line){return{type:"Feature",properties:n(e),geometry:{type:"LineString",coordinates:t.line}}}}(c[o]))&&h.features.push(a);for(o=0;o<p.length;o++)h.features.push(function(e){var t=n(e);return t.sym=l(i(e,"sym")),{type:"Feature",properties:t,geometry:{type:"Point",coordinates:f(e).coordinates}}}(p[o]));return h}}}();"undefined"!=typeof module&&(module.exports=toGeoJSON);
//# sourceMappingURL=togeojson.min.js.map