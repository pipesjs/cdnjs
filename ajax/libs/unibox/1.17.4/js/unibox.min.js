var UniBox=function(){var B=-1;var u;var e;var i;var f="";var p="";var H=-80;var J;var a;var l=[];var R=true;var r;var g;var s=300;var o="";var m=2;var x;var v;var O;var d;var c;var E;var P=[];var t="all";var C=-1;var A="";var b=false;var N=[];var j=[];var w=undefined;var T=undefined;var Q=true;var U=undefined;var D=undefined;var V=true;var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function M(X){X=X||window.event;if(X!==undefined){var Y=X.keyCode||X.which;var Z=u.val();if(Y==27||Y==13||Y==9||Z.length<m){z(X);if(Y==13&&x!==undefined&&B==-1){x.call(this,Z)}B=-1}}else{z(X);B=-1}}function z(X){if(c!==undefined){c.call(this,X,i.val())}i.removeClass("uniboxActive");i.slideUp(s);q()}function I(Y,X){var Z=null;return function(){var ab=this,aa=arguments;clearTimeout(Z);Z=window.setTimeout(function(){Y.apply(ab,aa)},X||50)}}function K(Y,X){if(!R){return Y}var ae=X.replace(/[^a-zA-Z0-9äöüÄÖÜß]|\s+|\r?\n|\r/gmi," ").replace(/[^a-zA-Z0-9äöüÄÖÜß]/g," ").split(" ");ae.sort(function(ag,af){return af.length-ag.length});var ad={};jQuery.each(ae,function(af,ak){if(ak.length<1){return}var aj=Y.match(new RegExp("(("+ak+")(?!#<##|-\\d+#<##))(?!.*\\1)","gi"));if(aj!=null){for(var ai=0;ai<aj.length;ai++){var ah=aj[ai];var ag=ah.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");Y=Y.replace(new RegExp("("+ag+")(?!#<##|-\\d+#<##)","g"),"##>#"+af+"-"+ai+"#<##");ad["##>#"+af+"-"+ai+"#<##"]='<span class="unibox-highlight">'+ah+"</span>"}}});var ab=Object.keys(ad).reverse();for(var Z=0;Z<ab.length;Z++){var ac=ab[Z];var aa=ad[ac];Y=Y.replace(new RegExp(ac,"gi"),aa)}return Y}function S(X){return X.replace(/[ "§$%&/(){}+*,.;|]/g,"_").toLowerCase()}function y(X){return String(X).replace(/[&<>"'\/]/g,function(Y){return n[Y]})}function W(ac){if(C==13){M();return}var Y=u.val();var ad=y(Y);i.html("");var aa=false;var X=false;var ab=Object.keys(ac.suggests);if(N&&N.length>0){ab=N;jQuery.each(Object.keys(ac.suggests),function(ae,af){if(jQuery.inArray(af,ab)<0){ab.push(af)}})}jQuery.each(ab,function(ae,ah){var ag=ac.suggests[ah];if(!ag||ag.length==0){return true}var af=0;jQuery.each(ab,function(ak,am){var al=ac.suggests[am];if(!al||ah===am||al.length==0){return true}af+=al.length});var aj=jQuery('<div class="unibox-suggest-cluster unibox-suggest-'+S(ah)+" "+("unibox-"+ag.length+"-entries")+" "+(af==0?"unibox-single-suggestion-block":"")+'"></div>');if(ah.replace(/_/,"").length>0&&ag.length>0){var ai=jQuery("<h4>"+ah+"</h4>");aj.append(ai)}jQuery.each(ag,function(av,at){var ap='<div class="unibox-selectable">';if(at.image!=undefined&&Q){var ax=at.image.length===0&&J?J:at.image.length===0||at.image.indexOf("/")===0||at.image.indexOf("http")===0?at.image:p+at.image;ap+='<div class="unibox-selectable-img-container"><img src="'+ax+'"';var aq=new Image();aq.src=ax;if(!aq.complete){ap+=' style="display: none;" onload="this.style.display=null;"'}ap+="/></div>"}if(at.link!=undefined&&at.link!=""){ap+='<a class="uniboxSearchContent" href="'+at.link+'">';ap+=K(at.name,ad);ap+="</a>"}else{ap+='<span class="uniboxSearchContent">'+K(at.name,ad)+"</span>"}if(r!=undefined){var au=r.match(/##(.*?)##/gi);var ao=r;var am=false;for(var an=0;an<au.length;an++){var ar=au[an];if(ar===undefined||ar.length==0){continue}var al=ar.replace(/#/g,"");var ak=at[al];if(ak==undefined){am=true;continue}var ay=new RegExp(ar,"g");ao=ao.replace(ay,ak)}if(!am){ap+='<div class="unibox-extra">'+ao+"</div>"}}ap+='<div class="unibox-ca"></div></div>';if(g!==undefined){ap=g.call(this,ap,ah,av,at)}var aw=jQuery(ap);aj.append(aw);aa=true});i.append(aj)});l=e.find(".unibox-selectable");if(j&&j.length>0){l=[];jQuery.each(j,function(ae,af){l=l.concat(e.find(".unibox-suggest-"+S(af)+":first .unibox-selectable").get())});jQuery.each(jQuery.grep(Object.keys(ac.suggests),function(ae){if(j.indexOf(ae)<0){return true}}),function(ae,af){l=l.concat(e.find(".unibox-suggest-"+S(af)+":first .unibox-selectable").get())})}B=-1;jQuery(l).mousedown(function(){var af=jQuery(this).find(".uniboxSearchContent:first").text();u.val(af);var ae=undefined;try{ae=jQuery(this).find("a:first").attr("href")}catch(ag){}if(v!=undefined){v.call(this,af,ae)}M()});e.find(".unibox-selectable .unibox-extra").click(function(ae){ae.stopPropagation()});if(ac.words!=undefined){if(ac.words.length>0&&o.length>0&&(t=="all"||t=="bottom")){i.append("<h4>"+o+"</h4>");aa=true}var Z=[];jQuery.each(ac.words,function(af,ai){if((t=="all"||t=="bottom")){if(ai.overlayImage!=undefined){i.append('<img class="unibox-vis" src="'+p+ai.overlayImage+'" style="background-image: url(\''+p+ai.image+"');background-size: 75%;background-repeat: no-repeat;background-position: center;\">")}else{if(ai.image!=undefined){i.append('<img class="unibox-vis" src="'+p+ai.image+'">')}}}var ah=e.find("#unibox-invisible");ah.css("padding",u.css("padding"));ah.html(ad.replace(new RegExp(ai.name,"gi"),"<span>"+ai.name+"</span>"));if((t=="all"||t=="top")&&jQuery.inArray(ai.image,P)==-1){var ag=e.find("#unibox-invisible span")[0];if(ag!=undefined&&ai.name.length>0&&ai.image!=undefined){var ae=jQuery(ag).position().left;visImage=jQuery('<div class="unibox-ivf"><img src="'+p+ai.image+'" alt="'+ai.name+'"></div>');visImage.css("left",k().left+ae-10);visImage.css("top",k().top-u.outerHeight()+H);e.append(visImage);setTimeout(function(){e.find(".unibox-ivf").find("img").addClass("l")},10);Z.push(ai.image)}}else{if(jQuery.inArray(ai.image,P)>-1){Z.push(ai.image)}}});P=Z}jQuery("img").on("error",function(){if(J){jQuery(this).attr("src",J)}else{jQuery(this).hide()}});h();if(T!=undefined&&!aa){aa=true;X=true;i.append(T)}if(aa){if(i.is(":visible")){i.addClass("uniboxActive");i.css("left",k().left);i.css("top",k().top)}else{i.slideDown(s,function(){i.addClass("uniboxActive");i.css("left",k().left);i.css("top",k().top)})}if(D&&!X){i.append(D)}}else{M()}}function k(){return{left:u.offset().left-e.offset().left,top:u.offset().top-e.offset().top+u.outerHeight()}}function G(){var Y=e.find(".unibox-ivf img").map(function(){return jQuery(this).attr("src")}).get();for(var X=0;X<Y.length;X++){if(jQuery.inArray(Y[X].replace(p,""),P)==-1){e.find('.unibox-ivf:has(img[src*="'+Y[X]+'"])').remove()}}}function q(){P=[];e.find(".unibox-ivf").remove()}function L(X){if(u.val().length<=1){q()}if(O!=undefined){O.call(this,X,u.val())}if(X.keyCode!=37&&X.keyCode!=38&&X.keyCode!=39&&X.keyCode!=40&&X.keyCode!=13){G();return}if(X.keyCode==38&&B>0){B--}else{if(X.keyCode==40){B++}else{if(X.keyCode==38&&B<=0){B=((B!=-1)?B-1:B)+l.length}else{if((X.keyCode==37||X.keyCode==39)&&B>-1){B=B%l.length;var ab=jQuery(l[B]);var ae=ab.closest(".unibox-suggest-cluster");var Z;if(X.keyCode==37){Z=ae.prev()}else{if(X.keyCode==39){Z=ae.next()}}if(Z.hasClass("unibox-suggest-cluster")){var af=Z.find("div.unibox-selectable")[0];B=jQuery("#unibox-suggest-box div.unibox-selectable").index(af)}}}}}if(l.length>0&&B>-1){B=B%l.length;jQuery(l).removeClass("active");var ac=jQuery(l[B]);ac.addClass("active")}if(X.keyCode==13){X.preventDefault();X.stopPropagation();if(v!=undefined){var aa=u.val();var Y=undefined;if(B!=-1){aa=e.find(".unibox-selectable.active .uniboxSearchContent:first").text();u.val(aa);try{Y=jQuery(e.find(".unibox-selectable.active")[0]).find("a").attr("href")}catch(ad){}if(v!=undefined){v.call(this,aa,Y)}}}else{if(B!=-1){window.location.href=jQuery(e.find(".unibox-selectable.active")[0]).find("a").attr("href")}}return false}if(B>-1){X.preventDefault()}}function F(X){if(C==18){C=X.keyCode;return}C=X.keyCode;if(((X.keyCode==37||X.keyCode==39)&&B>-1)||X.keyCode==38||X.keyCode==40||X.keyCode==13||X.keyCode==9){return}var Y=u.val();if(C==46&&Y.length==0){q()}if(Y.length>=m&&f!=""){A=Y;jQuery.ajax({usedQuery:Y,url:f+encodeURIComponent(Y),dataType:"json",success:function(Z){if(this.usedQuery==A){W(Z)}}})}}function h(){var Y=jQuery("#unibox-suggest-box");var X=Y.css("border-width").replace("px","");Y.css("min-width",u.outerWidth()-2*X);if(w==undefined){Y.css("max-width",u.outerWidth()-2*X)}else{Y.css("max-width",w-2*X)}Y.css("left",k().left);Y.css("top",k().top)}return{updateSuggests:function(X){W(X)},updateSuggestUrl:function(X){f=X},hideSuggestBox:function(){M()},setIvfImagePath:function(X){p=X;if(p.charAt(p.length-1)!="/"){p+="/"}},changeInstantVisualFeedbackState:function(X){t=X},render:function(){h()},getText:function(){return u.val()},init:function(ak,am){u=ak;e=am.searchBoxContainer;R=am.highlight;r=am.extraHtml;g=am.lineCallback;f=am.suggestUrl;p=am.ivfImagePath;H=am.ivfImageOffset;J=am.missingErrorImage;a=am.throttleTime;s=am.animationSpeed;m=am.minChars;x=am.enterCallback;v=am.enterCallbackResult;O=am.typeCallback;d=am.focusCallback;c=am.blurCallback;E=am.placeholder;t=am.instantVisualFeedback;o=am.queryVisualizationHeadline;b=am.showDeleteAllButton;Q=am.showImagesSuggestions;N=am.suggestOrder;j=am.suggestSelectionOrder;w=am.maxWidth;T=am.noSuggests;U=am.emptyQuerySuggests;D=am.showMoreResults;V=am.disableEventPropagationHtml;u.attr("autocomplete","off");i=jQuery('<div id="unibox-suggest-box"></div>');e.prepend(i);var ai=e.css("position");if(ai!="absolute"){e.css("position","relative")}var ad=i.css("border-width").replace("px","");i.css("min-width",u.outerWidth()-2*ad);i.css("max-width",am.maxWidth-2*ad);u.keydown(L);u.keydown(I(F,a));u.keyup(M);u.focus(function(an){an=an||window.event;an.stopPropagation();if(jQuery(this).val().length>0){F({keyCode:-1})}else{if(U!=undefined){W(U)}}if(d!==undefined){d.call(this,an,jQuery(this).val())}});i.mouseenter(function(){i.find(".unibox-selectable.active").removeClass("active")});jQuery("html").click(function(an){if(i.hasClass("uniboxActive")){z(an)}});u.keydown(function(ao){ao=ao||window.event;var an=ao.keyCode||ao.which;if(an==9){z(ao)}});u.focusout(function(an){an=an||window.event;setTimeout(function(){if(jQuery(document.activeElement).parents("#unibox-suggest-box").length===0){z(an)}},10)});if(V){u.click(function(an){an.stopPropagation()});i.click(function(an){an.stopPropagation()})}var Y=u.attr("placeholder");E=Y&&Y.length>0?Y:E;if(E&&E.length>0){var af=document.createElement("input");if(!("placeholder" in af)){u.focus(function(){var an=jQuery(this).attr("placeholder");if((an)&&(an.length>0)&&(an!="")&&jQuery(this).val()==an){jQuery(this).val("").removeClass("hasPlaceholder")}}).blur(function(){var an=jQuery(this).attr("placeholder");if((an)&&(an.length>0)&&(an!="")&&(jQuery(this).val()==""||jQuery(this).val()==an)){jQuery(this).val(an).addClass("hasPlaceholder")}});u.val(E)}u.attr("placeholder",E)}var al=jQuery('<div id="unibox-invisible">&nbsp;<span>&nbsp;</span></div>');e.append(al);if(b){var aj=jQuery('<div id="unibox-dab-holder"><div id="unibox-dab"></div></div>');e.append(aj);jQuery(aj).mousedown(function(an){(an||window.event).stopPropagation();u.val("");u.focus();return false});u.focus(function(){if(u.val().length>0){aj.show()}else{aj.hide()}}).blur(function(){aj.hide()}).keydown(function(){if(jQuery(this).val().length>0){jQuery(aj).show()}});var ah=parseInt(u.css("paddingTop").replace("px","").trim());var ag=u.outerHeight();var ae=parseInt(u.css("borderTopWidth").replace("px","").trim());var ab=u.css("boxShadow").match(/\d{1,3}px/g);var aa=(ab&&ab.length>2)?parseInt(ab[2].replace("px","").trim()):0;aj.height(ag-(2*ae)-aa-ah);var X=parseInt(u.css("paddingRight").replace("px","").trim());X=(X>25)?X:25;u.css("paddingRight",X);var ac=ae+aa+(u.offset().top-u.parent().offset().top-u.parent().scrollTop());var Z=Math.abs(u[0].getBoundingClientRect().left-u.parent()[0].getBoundingClientRect().left)+u.outerWidth()-aj.outerWidth()-ae-X;aj.css("top",ac);aj.css("left",Z)}if(t=="none"){jQuery("#unibox-invisible").css("display","none")}}}};(function(a){a.fn.unibox=function(b){var c=this.map(function(e,h){h=a(h);var f=a.extend({suggestUrl:"",ivfImagePath:"",ivfImageOffset:-80,missingErrorImage:undefined,queryVisualizationHeadline:"",highlight:true,throttleTime:50,animationSpeed:300,instantVisualFeedback:"all",enterCallback:undefined,enterCallbackResult:undefined,typeCallback:undefined,focusCallback:undefined,blurCallback:undefined,placeholder:undefined,extraHtml:undefined,lineCallback:undefined,noSuggests:undefined,emptyQuerySuggests:undefined,minChars:3,maxWidth:h.outerWidth(),showDeleteAllButton:false,suggestOrder:[],suggestSelectionOrder:[]},b);if(f.searchBoxContainerSelector==undefined){f.searchBoxContainer=h.parent()}else{f.searchBoxContainer=a(f.searchBoxContainerSelector)}var g=new UniBox();g.init(h,f);return g});var d=a.makeArray(c);if(d.length==1){return d[0]}return d}}(jQuery));