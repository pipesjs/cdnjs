/*! leaflet-realtime - v2.0.0 - 2017-05-04 */


!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(b.L||(b.L={})).Realtime=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";L.Realtime=L.GeoJSON.extend({options:{start:!0,interval:6e4,getFeatureId:function(a){return a.properties.id},updateFeature:function(a,b){if(b&&"Point"===a.geometry.type){var c=a.geometry.coordinates;return b.setLatLng([c[1],c[0]]),b}},logErrors:!0,cache:!1},initialize:function(a,b){L.GeoJSON.prototype.initialize.call(this,void 0,b),this._src="function"==typeof a?a:L.bind(function(b,c){var d="string"==typeof a||a instanceof String,e=d?a:a.url;void 0!==this._url&&(a.url=this._url);var e=this.options.cache?e:this._bustCache(e);fetch(e).then(function(a){return a.json()}).then(b).catch(c)},this),this._features={},this._featureLayers={},this._requestCount=0,this.options.start&&this.start()},start:function(){return this._timer||(this._timer=setInterval(L.bind(this.update,this),this.options.interval),this.update()),this},stop:function(){return this._timer&&(clearTimeout(this._timer),delete this._timer),this},isRunning:function(){return this._timer},setUrl:function(a){this._url=a,this.update()},update:function(a){var b,c,d=++this._requestCount,e=L.bind(function(a){return L.bind(function(){if(d===this._requestCount)return a.apply(this,arguments)},this)},this);return a?this._onNewData(!1,a):(b=L.bind(function(a){this._onNewData(!0,a)},this),c=L.bind(this._onError,this),this._src(e(b),e(c))),this},remove:function(a){var b,c,d,e=L.Util.isArray(a)?a:a.features?a.features:[a],f={};for(b=0,c=e.length;b<c;b++)d=this.options.getFeatureId(e[b]),this.removeLayer(this._featureLayers[d]),f[d]=this._features[d],delete this._features[d],delete this._featureLayers[d];return this.fire("update",{features:this._features,enter:{},update:{},exit:f}),this},getLayer:function(a){return this._featureLayers[a]},getFeature:function(a){return this._features[a]},_onNewData:function(a,b){var c,d,e,f=[],g={},h={},i={},j={},k=L.bind(function(a){var b=L.Util.isArray(a)?a:a.features;if(b)for(c=0,d=b.length;c<d;c++)e=b[c],(e.geometries||e.geometry||e.features||e.coordinates)&&k(e);else{var i=this.options;if(!i.filter||i.filter(a)){var l=L.GeoJSON.asFeature(a),m=i.getFeatureId(l),n=this._featureLayers[m],o=this.options.updateFeature(l,n);if(!o){if(!(o=L.GeoJSON.geometryToLayer(a,i)))return;o.defaultOptions=o.options,o.feature=l,i.onEachFeature&&i.onEachFeature(a,o)}o.feature=l,this.resetStyle(o),n?(h[m]=a,n!=o&&(f.push(n),this.addLayer(o))):(g[m]=a,this.addLayer(o)),this._featureLayers[m]=o,this._features[m]=j[m]=l}}},this);for(k(b),a&&(i=this._removeUnknown(j)),c=0;c<f.length;c++)this.removeLayer(f[c]);this.fire("update",{features:this._features,enter:g,update:h,exit:i})},_onError:function(a,b){this.options.logErrors&&console.warn(a,b),this.fire("error",{error:a,message:b})},_removeUnknown:function(a){var b,c={};for(b in this._featureLayers)a[b]||(this.removeLayer(this._featureLayers[b]),c[b]=this._features[b],delete this._featureLayers[b],delete this._features[b]);return c},_bustCache:function(a){return a+L.Util.getParamString({_:(new Date).getTime()},a)}}),L.realtime=function(a,b){return new L.Realtime(a,b)},b.exports=L.Realtime},{}]},{},[1])(1)});