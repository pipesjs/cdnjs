!function(e){function t(e){var t=document.createElement("canvas"),a=t.getContext("2d"),n=e.width,o=e.height;t.width=n,t.height=o,a.drawImage(e,0,0);for(var r=a.getImageData(0,0,n,o),i=0;i<r.height;i++)for(var l=0;l<r.width;l++){var g=4*i*r.width+4*l,d=(r.data[g]+r.data[g+1]+r.data[g+2])/3;r.data[g]=d,r.data[g+1]=d,r.data[g+2]=d}return a.putImageData(r,0,0,0,0,r.width,r.height),t.toDataURL()}e.mbBgndGallery={name:"mb.bgndGallery",author:"Matteo Bicocchi",version:"1.6.2",defaults:{containment:"body",images:[],shuffle:!1,controls:null,effect:{enter:{left:0,opacity:0},exit:{left:0,opacity:0},enterTiming:"ease-in",exitTiming:"ease-in"},timer:4e3,raster:!1,effTimer:3e3,folderPath:!1,autoStart:!0,grayScale:!1,activateKeyboard:!0,preserveTop:!1,preserveWidth:!1,onStart:function(){},onChange:function(e){},onPause:function(){},onPlay:function(e){},onNext:function(e){},onPrev:function(e){}},clear:!1,buildGallery:function(t){var a={};e.extend(a,e.mbBgndGallery.defaults,t),a.galleryID=(new Date).getTime();var n=e(a.containment).get(0);n.opt=a,n.opt.onStart&&n.opt.onStart(),a.gallery=e("<div/>").attr({id:"bgndGallery_"+n.opt.galleryID}).addClass("mbBgndGallery");var o="body"==a.containment?"fixed":"absolute";a.gallery.css({position:o,top:0,let:0,width:"100%",height:"100%",overflow:"hidden"});var r=n.opt.containment;if("body"!=r&&""!=e(r).text().trim()){var i=e("<div/>").css({position:"absolute",minHeight:"100%",minWidth:"100%",zIndex:3});e(r).wrapInner(i),"static"==e(r).css("position")&&e(r).css("position","relative")}if(a.raster){var l=e("<div/>").css({position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"url("+a.raster+")",zIndex:1});a.gallery.append(l)}e(r).prepend(a.gallery),n.opt.folderPath&&0==n.opt.images.length&&(a.images=jQuery.loadFromSystem(n.opt.folderPath));var g=a.images;a.shuffle&&(g=e.shuffle(g));var d=g.length,p=0;e.mbBgndGallery.preload(g[0],n),e(a.gallery).bind("imageLoaded_"+a.galleryID,function(){return p++,p==d?void e(a.gallery).unbind("imageLoaded_"+a.galleryID):void e.mbBgndGallery.preload(g[p],n)}),a.imageCounter=0,e.mbBgndGallery.changePhoto(g[a.imageCounter],n),a.autoStart||(a.paused=!0,e(a.gallery).trigger("paused")),e(a.gallery).bind("imageReady_"+a.galleryID,function(){a.paused||e.mbBgndGallery.play(n)}),e(window).on("resize",function(){var t=e("#bgndGallery_"+n.opt.galleryID+" img");e.mbBgndGallery.checkSize(t,n)});var s=n.opt.controls;if(s){var c=e(a.controls).find(".counter");c.html(a.imageCounter+1+" / "+a.images.length),e.mbBgndGallery.buildControls(s,n),e(a.containment).bind("paused",function(){e(a.controls).find(".play").show(),e(a.controls).find(".pause").hide()}),e(a.containment).bind("play",function(){e(a.controls).find(".play").hide(),e(a.controls).find(".pause").show()})}},normalizeCss:function(t){var a=jQuery.extend(!0,{},t),n="",o="transitionEnd";e.browser.webkit?(n="-webkit-",o="webkitTransitionEnd"):e.browser.mozilla?(n="-moz-",o="transitionend"):e.browser.opera?(n="-o-",o="oTransitionEnd"):e.browser.msie&&(n="-ms-",o="msTransitionEnd");for(var r in a)"transform"===r&&(a[n+"transform"]=a[r],delete a[r]),"transform-origin"===r&&(a[n+"transform-origin"]=t[r],delete a[r]);return a},preload:function(t,a){if(e.mbBgndGallery.clear)return void e(a.opt.gallery).remove();e("<img/>").load(function(){e(a.opt.gallery).trigger("imageLoaded_"+a.opt.galleryID)}).attr("src",t)},checkSize:function(t,a){if(!e.mbBgndGallery.changing)return e.mbBgndGallery.clear?void e(a.opt.gallery).remove():t.each(function(){var t=e(this),n=t.attr("w"),o=t.attr("h"),r="body"==a.opt.containment?window:a.opt.containment,i=n/o,l=e(r).width()/e(r).height();i>=l?(t.css("height","100%"),t.css("width","auto")):(t.css("width","100%"),t.css("height","auto")),t.css("margin-left",(e(r).width()-t.width())/2),a.opt.preserveTop||t.css("margin-top",(e(r).height()-t.height())/2),a.opt.preserveWidth&&t.css({width:"100%",height:"auto",left:0,marginLeft:0})})},changePhoto:function(t,a){if(e.mbBgndGallery.clear)return void e(a.opt.gallery).remove();e.mbBgndGallery.changing=!0,a.opt.onChange&&a.opt.onChange(a.opt.imageCounter);var n=e("<img/>").hide().load(function(){var t=e(this),n=e("<div/>").css({position:"absolute",top:-5e3});n.append(t),e("body").append(n),t.attr("w",t.width()),t.attr("h",t.height()),n.remove(),e("#bgndGallery_"+a.opt.galleryID+" img").CSSAnimate(a.opt.effect.exit,a.opt.effTimer,0,a.opt.effect.exitTiming,function(){var t=e("#bgndGallery_"+a.opt.galleryID+" img").not(":first");setTimeout(function(){t.remove()},3e3)}),t.css({position:"absolute"}),e("#bgndGallery_"+a.opt.galleryID).prepend(t),e.mbBgndGallery.changing=!1,e.mbBgndGallery.checkSize(t,a),t.css(e.mbBgndGallery.normalizeCss(a.opt.effect.enter)).show().CSSAnimate({top:0,left:0,opacity:1,transform:"scale(1) rotate(0deg)"},a.opt.effTimer,0,a.opt.effect.enterTiming,function(){e(a.opt.gallery).trigger("imageReady_"+a.opt.galleryID)})}).attr("src",t);a.opt.grayScale&&n.greyScale();var o=e(a.opt.controls).find(".counter");o.html(a.opt.imageCounter+1+" / "+a.opt.images.length)},play:function(t){return e.mbBgndGallery.clear?void e(t.opt.gallery).remove():(t.opt.onPlay&&t.opt.onPlay(t.opt),t.opt.changing=setTimeout(function(){t.opt.paused||(t.opt.onNext&&t.opt.onNext(t.opt),t.opt.imageCounter>=t.opt.images.length-1&&(t.opt.imageCounter=-1),t.opt.imageCounter++,e.mbBgndGallery.changePhoto(t.opt.images[t.opt.imageCounter],e(t.opt.containment).get(0)))},t.opt.paused?0:t.opt.timer),void e(t.opt.gallery).trigger("play"))},pause:function(t){return e.mbBgndGallery.clear?void e(t.opt.gallery).remove():(clearTimeout(t.opt.changing),t.opt.paused=!0,e(t.opt.gallery).trigger("paused"),void(t.opt.onPause&&t.opt.onPause()))},next:function(t){return e.mbBgndGallery.clear?void e(t.opt.gallery).remove():(t.opt.onNext&&t.opt.onNext(t.opt),e.mbBgndGallery.pause(t),clearTimeout(t.opt.changing),t.opt.imageCounter==t.opt.images.length-1&&(t.opt.imageCounter=-1),t.opt.imageCounter++,void e.mbBgndGallery.changePhoto(t.opt.images[t.opt.imageCounter],t))},prev:function(t){return e.mbBgndGallery.clear?void e(t.opt.gallery).remove():(t.opt.onPrev&&t.opt.onPrev(t.opt),e.mbBgndGallery.pause(t),clearTimeout(t.opt.changing),0==t.opt.imageCounter&&(t.opt.imageCounter=t.opt.images.length),t.opt.imageCounter--,void e.mbBgndGallery.changePhoto(t.opt.images[t.opt.imageCounter],t))},loader:{show:function(){},hide:function(){}},keyboard:function(t){e(document).bind("keydown.bgndGallery",function(a){switch(a.keyCode){case 32:t.opt.paused?(e.mbBgndGallery.play(t),t.opt.paused=!1):(t.opt.paused=!0,e.mbBgndGallery.pause(t)),a.preventDefault();break;case 39:e.mbBgndGallery.next(t),a.preventDefault();break;case 37:e.mbBgndGallery.prev(t),a.preventDefault()}})},buildControls:function(t,a){var n=e(t).find(".pause"),o=e(t).find(".play"),r=e(t).find(".next"),i=e(t).find(".prev");a.opt.autoStart&&o.hide(),n.bind("click",function(){e.mbBgndGallery.pause(a),e(this).hide(),o.show()}),o.bind("click",function(){a.opt.paused&&(clearTimeout(a.opt.changing),e.mbBgndGallery.play(a),a.opt.paused=!1)}),r.bind("click",function(){e.mbBgndGallery.next(a),n.hide(),o.show()}),i.bind("click",function(){e.mbBgndGallery.prev(a),n.hide(),o.show()}),a.opt.activateKeyboard&&e.mbBgndGallery.keyboard(a)},changeGallery:function(t,a){e(t.gallery).fadeOut(),e.mbBgndGallery.pause(t),t.opt.images=a;var n=t.opt.images,o=n.length,r=0;e.mbBgndGallery.preload(n[0],t),e(t.opt.gallery).bind("imageLoaded_"+t.opt.galleryID,function(){return r++,r==o?(e(t.opt.gallery).unbind("imageLoaded_"+t.opt.galleryID),e(t.gallery).fadeIn(),e.mbBgndGallery.play(t),void(t.opt.paused=!1)):void e.mbBgndGallery.preload(n[r],t)}),t.opt.imageCounter=0}},jQuery.loadFromSystem=function(t,a){if(t){a||(a=["jpg","jpeg","png"]);var n=[];return e.ajax({url:t,async:!1,success:function(o){var r=e(o),i=r.find("[href]");i.each(function(){for(var o in a)e(this).attr("href").indexOf(a[o])>=0&&n.push(t+e(this).attr("href"))}),r.remove()}}),n}},e.fn.greyScale=function(){return this.each(function(){e.browser.msie&&e.browser.version<9?this.style.filter="progid:DXImageTransform.Microsoft.BasicImage(grayScale=1)":this.src=t(this)})},e.shuffle=function(e){for(var t=e.slice(),a=t.length,n=a;n--;){var o=parseInt(Math.random()*a),r=t[n];t[n]=t[o],t[o]=r}return t}}(jQuery);