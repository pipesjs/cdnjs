!function(t){document.flickr=new Object,t.mbFlickr={name:"mb.flickr",author:"Matteo Bicocchi",version:"1.0",flickr_api_key:"",flickr_user_name:"",defaults:{flickr_user_id:"",flickr_photoset_id:"",page:1,per_page:20,onStart:function(){},callback:function(){}},loadFlickrPhotos:function(e){var i=t(this).get(0);if(i.defaults={},t.extend(i.defaults,t.mbFlickr.defaults,e),document.flickr.photoset=i.defaults.flickr_photoset_id,"undefined"!=typeof i.isInit&&i.isInit==i.defaults.flickr_photoset_id)return void(i.defaults.callback&&i.defaults.callback(i));i.defaults.onStart&&i.defaults.onStart();var o=i.defaults.flickr_photoset_id;t.mbFlickr.defaults.flickr_user_id||t.mbFlickr.getFlickrNSID(t.mbFlickr.flickr_api_key,t.mbFlickr.flickr_user_name),o?t(i).mb_getFlickrSet(i.defaults.page,function(){t(i).mb_getFlickrPhotoDATA(),t(i).mb_getFlickrPhotoINFO()}):t(i).mb_getFlickrPhotos(i.defaults.page,function(){t(i).mb_getFlickrPhotoDATA(),t(i).mb_getFlickrPhotoINFO()})},getFlickrNSID:function(e,i){t.getJSON("http://api.flickr.com/services/rest/?method=flickr.urls.lookupUser&api_key="+e+"&url=http%3A%2F%2Fwww.flickr.com%2Fphotos%2F"+i+"%2F&format=json&rnd="+new Date+"&jsoncallback=?",function(e){"fail"!=e.stat&&(t.mbFlickr.defaults.flickr_user_id=e.user.id)})},getFlickrSet:function(e,i){e||(e=1);var o=t(this).get(0),s=o.defaults.per_page,c=t.mbFlickr.flickr_api_key,r=o.defaults.flickr_photoset_id;t.getJSON("http://api.flickr.com/services/rest/?method=flickr.photosets.getPhotos&api_key="+c+"&photoset_id="+r+"&extras=url_sq,url_t,url_s,url_m,url_o&per_page="+s+"&page="+e+"&format=json&rnd="+(new Date).getTime()+"&jsoncallback=?",function(t){return"fail"==t.stat?void alert(t.message):(o.photos=t.photoset.photo,o.pages=t.photoset.pages,o.page=t.photoset.page,void(i&&i()))})},getFlickrPhotos:function(e,i){e||(e=1);var o=t(this).get(0),s=o.defaults.per_page;"all"==s&&(s=100);var c=t.mbFlickr.flickr_api_key,r=t.mbFlickr.defaults.flickr_user_id;t.getJSON("http://api.flickr.com/services/rest/?method=flickr.people.getPublicPhotos&api_key="+c+"&user_id="+r+"&per_page="+s+"&page="+e+"&format=json&jsoncallback=?",function(t){o.photos=t.photos.photo,o.pages=t.photos.pages,o.page=t.photos.page,i&&i()})},getFlickrPhotoDATA:function(){var e=t(this).get(0),i=t.mbFlickr.flickr_api_key;document.flickr.total=e.photos.length,t(e.photos).each(function(o){t.getJSON("http://api.flickr.com/services/rest/?method=flickr.photos.getSizes&api_key="+i+"&photo_id="+this.id+"&secret="+this.secret+"&format=json&rnd="+new Date+"&jsoncallback=?",function(t){e.photos[o].square=t.sizes.size[0].source,e.photos[o].squareWidth=t.sizes.size[0].width,e.photos[o].squareHeight=t.sizes.size[0].height,e.photos[o].thumb=t.sizes.size[1].source,e.photos[o].thumbWidth=t.sizes.size[1].width,e.photos[o].thumbHeght=t.sizes.size[1].height,e.photos[o].small=t.sizes.size[2].source,e.photos[o].smallWidth=t.sizes.size[2].width,e.photos[o].smallHeigt=t.sizes.size[2].height,e.photos[o].medium=t.sizes.size[3].source,e.photos[o].mediumWidth=t.sizes.size[3].width,e.photos[o].mediumHeight=t.sizes.size[3].height,e.photos[o].source=t.sizes.size[t.sizes.size.length-1].source,e.photos[o].sourceWidth=t.sizes.size[t.sizes.size.length-1].width,e.photos[o].sourceHeight=t.sizes.size[t.sizes.size.length-1].height,e.photos[o].url=t.sizes.size[t.sizes.size.length-1].url,document.flickr.loaded=o+1,o==e.photos.length-1&&setTimeout(function(){e.defaults.callback&&e.defaults.callback(e),e.isInit=e.defaults.flickr_photoset_id},3e3)})})},getFlickrPhotoINFO:function(){var e=t(this).get(0),i=t.mbFlickr.flickr_api_key;t(e.photos).each(function(o){t.getJSON("http://api.flickr.com/services/rest/?method=flickr.photos.getInfo&api_key="+i+"&photo_id="+this.id+"&secret="+this.secret+"&format=json&rnd="+(new Date).getMilliseconds()+"&jsoncallback=?",function(t){e.photos[o].description=void 0==t.photo.description._content?"":t.photo.description._content})})}},t.fn.mb_getFlickrSet=t.mbFlickr.getFlickrSet,t.fn.mb_getFlickrPhotos=t.mbFlickr.getFlickrPhotos,t.fn.mb_getFlickrPhotoDATA=t.mbFlickr.getFlickrPhotoDATA,t.fn.mb_getFlickrPhotoINFO=t.mbFlickr.getFlickrPhotoINFO,t.fn.mb_loadFlickrPhotos=t.mbFlickr.loadFlickrPhotos}(jQuery);