function mbBgndGallery(e){return jQuery.mbBgndGallery.buildGallery(e)}var nAgt=navigator.userAgent;if(!jQuery.browser){jQuery.browser={},jQuery.browser.mozilla=!1,jQuery.browser.webkit=!1,jQuery.browser.opera=!1,jQuery.browser.safari=!1,jQuery.browser.chrome=!1,jQuery.browser.msie=!1,jQuery.browser.ua=nAgt,jQuery.browser.name=navigator.appName,jQuery.browser.fullVersion=""+parseFloat(navigator.appVersion),jQuery.browser.majorVersion=parseInt(navigator.appVersion,10);var nameOffset,verOffset,ix;if(-1!=(verOffset=nAgt.indexOf("Opera")))jQuery.browser.opera=!0,jQuery.browser.name="Opera",jQuery.browser.fullVersion=nAgt.substring(verOffset+6),-1!=(verOffset=nAgt.indexOf("Version"))&&(jQuery.browser.fullVersion=nAgt.substring(verOffset+8));else if(-1!=(verOffset=nAgt.indexOf("MSIE")))jQuery.browser.msie=!0,jQuery.browser.name="Microsoft Internet Explorer",jQuery.browser.fullVersion=nAgt.substring(verOffset+5);else if(-1!=nAgt.indexOf("Trident")){jQuery.browser.msie=!0,jQuery.browser.name="Microsoft Internet Explorer";var start=nAgt.indexOf("rv:")+3,end=start+4;jQuery.browser.fullVersion=nAgt.substring(start,end)}else-1!=(verOffset=nAgt.indexOf("Chrome"))?(jQuery.browser.webkit=!0,jQuery.browser.chrome=!0,jQuery.browser.name="Chrome",jQuery.browser.fullVersion=nAgt.substring(verOffset+7)):-1!=(verOffset=nAgt.indexOf("Safari"))?(jQuery.browser.webkit=!0,jQuery.browser.safari=!0,jQuery.browser.name="Safari",jQuery.browser.fullVersion=nAgt.substring(verOffset+7),-1!=(verOffset=nAgt.indexOf("Version"))&&(jQuery.browser.fullVersion=nAgt.substring(verOffset+8))):-1!=(verOffset=nAgt.indexOf("AppleWebkit"))?(jQuery.browser.webkit=!0,jQuery.browser.name="Safari",jQuery.browser.fullVersion=nAgt.substring(verOffset+7),-1!=(verOffset=nAgt.indexOf("Version"))&&(jQuery.browser.fullVersion=nAgt.substring(verOffset+8))):-1!=(verOffset=nAgt.indexOf("Firefox"))?(jQuery.browser.mozilla=!0,jQuery.browser.name="Firefox",jQuery.browser.fullVersion=nAgt.substring(verOffset+8)):(nameOffset=nAgt.lastIndexOf(" ")+1)<(verOffset=nAgt.lastIndexOf("/"))&&(jQuery.browser.name=nAgt.substring(nameOffset,verOffset),jQuery.browser.fullVersion=nAgt.substring(verOffset+1),jQuery.browser.name.toLowerCase()==jQuery.browser.name.toUpperCase()&&(jQuery.browser.name=navigator.appName));-1!=(ix=jQuery.browser.fullVersion.indexOf(";"))&&(jQuery.browser.fullVersion=jQuery.browser.fullVersion.substring(0,ix)),-1!=(ix=jQuery.browser.fullVersion.indexOf(" "))&&(jQuery.browser.fullVersion=jQuery.browser.fullVersion.substring(0,ix)),jQuery.browser.majorVersion=parseInt(""+jQuery.browser.fullVersion,10),isNaN(jQuery.browser.majorVersion)&&(jQuery.browser.fullVersion=""+parseFloat(navigator.appVersion),jQuery.browser.majorVersion=parseInt(navigator.appVersion,10)),jQuery.browser.version=jQuery.browser.majorVersion}jQuery.browser.android=/Android/i.test(nAgt),jQuery.browser.blackberry=/BlackBerry/i.test(nAgt),jQuery.browser.ios=/iPhone|iPad|iPod/i.test(nAgt),jQuery.browser.operaMobile=/Opera Mini/i.test(nAgt),jQuery.browser.windowsMobile=/IEMobile/i.test(nAgt),jQuery.browser.mobile=jQuery.browser.android||jQuery.browser.blackberry||jQuery.browser.ios||jQuery.browser.windowsMobile||jQuery.browser.operaMobile,jQuery.fn.CSSAnimate=function(e,t,r,o,n){function a(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}function i(e,t){return"string"!=typeof e||e.match(/^[\-0-9\.]+$/)?""+e+t:e}return jQuery.support.transition=function(){var e=(document.body||document.documentElement).style;return void 0!==e.transition||void 0!==e.WebkitTransition||void 0!==e.MozTransition||void 0!==e.MsTransition||void 0!==e.OTransition}(),this.each(function(){var s=this,l=jQuery(this);s.id=s.id||"CSSA_"+(new Date).getTime();var u=u||{type:"noEvent"};if(s.CSSAIsRunning&&s.eventType==u.type)s.CSSqueue=function(){l.CSSAnimate(e,t,r,o,n)};else if(s.CSSqueue=null,s.eventType=u.type,0!==l.length&&e){if(s.CSSAIsRunning=!0,"function"==typeof t&&(n=t,t=jQuery.fx.speeds._default),"function"==typeof r&&(n=r,r=0),"function"==typeof o&&(n=o,o="cubic-bezier(0.65,0.03,0.36,0.72)"),"string"==typeof t)for(var g in jQuery.fx.speeds){if(t==g){t=jQuery.fx.speeds[g];break}t=jQuery.fx.speeds._default}if(t||(t=jQuery.fx.speeds._default),jQuery.support.transition){u={default:"ease",in:"ease-in",out:"ease-out","in-out":"ease-in-out",snap:"cubic-bezier(0,1,.5,1)",easeOutCubic:"cubic-bezier(.215,.61,.355,1)",easeInOutCubic:"cubic-bezier(.645,.045,.355,1)",easeInCirc:"cubic-bezier(.6,.04,.98,.335)",easeOutCirc:"cubic-bezier(.075,.82,.165,1)",easeInOutCirc:"cubic-bezier(.785,.135,.15,.86)",easeInExpo:"cubic-bezier(.95,.05,.795,.035)",easeOutExpo:"cubic-bezier(.19,1,.22,1)",easeInOutExpo:"cubic-bezier(1,0,0,1)",easeInQuad:"cubic-bezier(.55,.085,.68,.53)",easeOutQuad:"cubic-bezier(.25,.46,.45,.94)",easeInOutQuad:"cubic-bezier(.455,.03,.515,.955)",easeInQuart:"cubic-bezier(.895,.03,.685,.22)",easeOutQuart:"cubic-bezier(.165,.84,.44,1)",easeInOutQuart:"cubic-bezier(.77,0,.175,1)",easeInQuint:"cubic-bezier(.755,.05,.855,.06)",easeOutQuint:"cubic-bezier(.23,1,.32,1)",easeInOutQuint:"cubic-bezier(.86,0,.07,1)",easeInSine:"cubic-bezier(.47,0,.745,.715)",easeOutSine:"cubic-bezier(.39,.575,.565,1)",easeInOutSine:"cubic-bezier(.445,.05,.55,.95)",easeInBack:"cubic-bezier(.6,-.28,.735,.045)",easeOutBack:"cubic-bezier(.175, .885,.32,1.275)",easeInOutBack:"cubic-bezier(.68,-.55,.265,1.55)"},u[o]&&(o=u[o]);var d="",f="transitionEnd";jQuery.browser.webkit?(d="-webkit-",f="webkitTransitionEnd"):jQuery.browser.mozilla?(d="-moz-",f="transitionend"):jQuery.browser.opera?(d="-o-",f="otransitionend"):jQuery.browser.msie&&(d="-ms-",f="msTransitionEnd"),u=[];for(p in e)g=p,"transform"===g&&(g=d+"transform",e[g]=e[p],delete e[p]),"filter"===g&&(g=d+"filter",e[g]=e[p],delete e[p]),"transform-origin"!==g&&"origin"!==g||(g=d+"transform-origin",e[g]=e[p],delete e[p]),"x"===g&&(g=d+"transform",e[g]=e[g]||"",e[g]+=" translateX("+i(e[p],"px")+")",delete e[p]),"y"===g&&(g=d+"transform",e[g]=e[g]||"",e[g]+=" translateY("+i(e[p],"px")+")",delete e[p]),"z"===g&&(g=d+"transform",e[g]=e[g]||"",e[g]+=" translateZ("+i(e[p],"px")+")",delete e[p]),"rotate"===g&&(g=d+"transform",e[g]=e[g]||"",e[g]+=" rotate("+i(e[p],"deg")+")",delete e[p]),"rotateX"===g&&(g=d+"transform",e[g]=e[g]||"",e[g]+=" rotateX("+i(e[p],"deg")+")",delete e[p]),"rotateY"===g&&(g=d+"transform",e[g]=e[g]||"",e[g]+=" rotateY("+i(e[p],"deg")+")",delete e[p]),"rotateZ"===g&&(g=d+"transform",e[g]=e[g]||"",e[g]+=" rotateZ("+i(e[p],"deg")+")",delete e[p]),"scale"===g&&(g=d+"transform",e[g]=e[g]||"",e[g]+=" scale("+i(e[p],"")+")",delete e[p]),"scaleX"===g&&(g=d+"transform",e[g]=e[g]||"",e[g]+=" scaleX("+i(e[p],"")+")",delete e[p]),"scaleY"===g&&(g=d+"transform",e[g]=e[g]||"",e[g]+=" scaleY("+i(e[p],"")+")",delete e[p]),"scaleZ"===g&&(g=d+"transform",e[g]=e[g]||"",e[g]+=" scaleZ("+i(e[p],"")+")",delete e[p]),"skew"===g&&(g=d+"transform",e[g]=e[g]||"",e[g]+=" skew("+i(e[p],"deg")+")",delete e[p]),"skewX"===g&&(g=d+"transform",e[g]=e[g]||"",e[g]+=" skewX("+i(e[p],"deg")+")",delete e[p]),"skewY"===g&&(g=d+"transform",e[g]=e[g]||"",e[g]+=" skewY("+i(e[p],"deg")+")",delete e[p]),"perspective"===g&&(g=d+"transform",e[g]=e[g]||"",e[g]+=" perspective("+i(e[p],"px")+")",delete e[p]),0>u.indexOf(g)&&u.push(a(g));var p=u.join(","),c=function(){l.off(f+"."+s.id),clearTimeout(s.timeout),l.css(d+"transition",""),"function"==typeof n&&n(l),s.called=!0,s.CSSAIsRunning=!1,"function"==typeof s.CSSqueue&&(s.CSSqueue(),s.CSSqueue=null)},m={};$.extend(m,e),m[d+"transition-property"]=p,m[d+"transition-duration"]=t+"ms",m[d+"transition-delay"]=r+"ms",m[d+"transition-style"]="preserve-3d",m[d+"transition-timing-function"]=o,setTimeout(function(){l.one(f+"."+s.id,c),l.css(m)},1),s.timeout=setTimeout(function(){l.called||!n?(l.called=!1,s.CSSAIsRunning=!1):(l.css(d+"transition",""),n(l),s.CSSAIsRunning=!1,"function"==typeof s.CSSqueue&&(s.CSSqueue(),s.CSSqueue=null))},t+r+100)}else{for(var p in e)"transform"===p&&delete e[p],"filter"===p&&delete e[p],"transform-origin"===p&&delete e[p],"auto"===e[p]&&delete e[p];n&&"string"!=typeof n||(n="linear"),l.animate(e,t,n)}}})},$.fn.css3=function(e){return alert("SSS"),this.each(function(){$(this).CSSAnimate(e,1,0,null)})},function(e){function t(e){var t=document.createElement("canvas"),r=t.getContext("2d"),o=e.width,n=e.height;t.width=o,t.height=n,r.drawImage(e,0,0);for(var a=r.getImageData(0,0,o,n),i=0;i<a.height;i++)for(var s=0;s<a.width;s++){var l=4*i*a.width+4*s,u=(a.data[l]+a.data[l+1]+a.data[l+2])/3;a.data[l]=u,a.data[l+1]=u,a.data[l+2]=u}return r.putImageData(a,0,0,0,0,a.width,a.height),t.toDataURL()}e.mbBgndGallery={name:"mb.bgndGallery",author:"Matteo Bicocchi",version:"1.8.9",defaults:{containment:"body",images:[],shuffle:!1,controls:null,effect:"fade",filter:null,timer:4e3,effTimer:3e3,raster:!1,folderPath:!1,autoStart:!0,grayScale:!1,activateKeyboard:!0,preserveTop:!1,preserveWidth:!1,placeHolder:"",thumbs:{folderPath:"",placeholder:""},onStart:function(){},onChange:function(e,t){},onPause:function(e){},onPlay:function(e){},onNext:function(e){},onPrev:function(e){}},filters:{gray:{moz:"url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg'><filter id='grayscale'><feColorMatrix type='matrix' values='0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0'/></filter></svg>#grayscale\")",webkit:"grayscale(100%)",msie:"gray"},halfGray:{moz:"url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg'><filter id='grayscale'><feColorMatrix type='saturate' values='0.5'/></filter></svg>#grayscale\")",webkit:"grayscale(50%)",msie:"gray alpha(opacity=50)"}},clear:!1,buildGallery:function(t){var r={};e.extend(r,e.mbBgndGallery.defaults,t),r.galleryID=(new Date).getTime();var o=e(r.containment).get(0);o.opt=r,e.mbBgndGallery.el=o,o.opt.onStart&&o.opt.onStart(),o.opt.gallery=e("<div/>").attr({id:"bgndGallery_"+o.opt.galleryID}).addClass("mbBgndGallery");var n="body"==o.opt.containment?"fixed":"absolute";o.opt.gallery.css({position:n,top:0,let:0,width:"100%",height:"100%",overflow:"hidden"});var a=o.opt.containment;if("body"!=a&&""!=e(a).text().trim()){var i=e("<div/>").css({position:"absolute",minHeight:"100%",minWidth:"100%",zIndex:3});e(a).wrapInner(i),"static"==e(a).css("position")&&e(a).css("position","relative")}if(r.raster){var s=e("<div/>").css({position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"url("+r.raster+")",zIndex:1});r.gallery.append(s)}e(a).prepend(r.gallery),o.opt.folderPath&&0==o.opt.images.length&&(o.opt.images=e.loadFromSystem(o.opt.folderPath)),o.opt.shuffle&&(o.opt.images=e.shuffle(o.opt.images));var l=o.opt.images.length,u=0;e.mbBgndGallery.preload(o.opt.images[0],o),o.opt.gallery.on("imageLoaded."+o.opt.galleryID,function(){return u++,u==l?void o.opt.gallery.off("imageLoaded."+o.opt.galleryID):void e.mbBgndGallery.preload(o.opt.images[u],o)}),o.opt.imageCounter=0,e.mbBgndGallery.changePhoto(o.opt.images[o.opt.imageCounter],o),r.autoStart||(o.opt.paused=!0,e(o.opt.gallery).trigger("paused")),o.opt.gallery.on("imageReady."+o.opt.galleryID,function(){o.opt.paused||(clearTimeout(o.opt.changing),e.mbBgndGallery.play(o))}),e(window).on("resize",function(){var t=e("img",o.opt.gallery);e.mbBgndGallery.checkSize(t,o)});var g=o.opt.controls;if(g){$(g).addClass("controls");var d=e(o.opt.controls).find(".counter");d.html(o.opt.imageCounter+1+" / "+o.opt.images.length),e.mbBgndGallery.buildControls(g,o),e(o.opt.containment).on("paused",function(){e(o.opt.controls).find(".play").show(),e(o.opt.controls).find(".pause").hide()}),e(o.opt.containment).on("play",function(){e(o.opt.controls).find(".play").hide(),e(o.opt.controls).find(".pause").show()})}return e.mbBgndGallery.buildThumbs(o),e(o)},normalizeCss:function(t){function r(e,t){return"string"!=typeof e||e.match(/^[\-0-9\.]+$/)?""+e+t:e}var o=e.extend(!0,{},t),n="",a="transitionEnd";e.browser.webkit?(n="-webkit-",a="webkitTransitionEnd"):e.browser.mozilla?(n="-moz-",a="transitionend"):e.browser.opera?(n="-o-",a="oTransitionEnd"):e.browser.msie&&(n="-ms-",a="msTransitionEnd");for(var i in o){"transform"===i&&(o[n+"transform"]=o[i],delete o[i]),"transform-origin"===i&&(o[n+"transform-origin"]=t[i],delete o[i]),"filter"===i&&(o[n+"filter"]=t[i],delete o[i]);var s="";"x"===i&&(s=n+"transform",o[s]=o[s]||"",o[s]+=" translateX("+r(t[i],"px")+")",delete o[i]),"y"===i&&(s=n+"transform",o[s]=o[s]||"",o[s]+=" translateY("+r(t[i],"px")+")",delete o[i]),"z"===i&&(s=n+"transform",o[s]=o[s]||"",o[s]+=" translateZ("+r(t[i],"px")+")",delete o[i]),"rotate"===i&&(s=n+"transform",o[s]=o[s]||"",o[s]+=" rotate("+r(t[i],"deg")+")",delete o[i]),"rotateX"===i&&(s=n+"transform",o[s]=o[s]||"",o[s]+=" rotateX("+r(t[i],"deg")+")",delete o[i]),"rotateY"===i&&(s=n+"transform",o[s]=o[s]||"",o[s]+=" rotateY("+r(t[i],"deg")+")",delete o[i]),"rotateZ"===i&&(s=n+"transform",o[s]=o[s]||"",o[s]+=" rotateZ("+r(t[i],"deg")+")",delete o[i]),"scale"===i&&(s=n+"transform",o[s]=o[s]||"",o[s]+=" scale("+r(t[i],"")+")",delete o[i]),"scaleX"===i&&(s=n+"transform",o[s]=o[s]||"",o[s]+=" scaleX("+r(t[i],"")+")",delete o[i]),"scaleY"===i&&(s=n+"transform",o[s]=o[s]||"",o[s]+=" scaleY("+r(t[i],"")+")",delete o[i]),"scaleZ"===i&&(s=n+"transform",o[s]=o[s]||"",o[s]+=" scaleZ("+r(t[i],"")+")",delete o[i]),"skew"===i&&(s=n+"transform",o[s]=o[s]||"",o[s]+=" skew("+r(t[i],"deg")+")",delete o[i]),"skewX"===i&&(s=n+"transform",o[s]=o[s]||"",o[s]+=" skewX("+r(t[i],"deg")+")",delete o[i]),"skewY"===i&&(s=n+"transform",o[s]=o[s]||"",o[s]+=" skewY("+r(t[i],"deg")+")",delete o[i]),"perspective"===i&&(s=n+"transform",o[s]=o[s]||"",o[s]+=" perspective("+r(t[i],"px")+")",delete o[i])}return o},preload:function(t,r){if(e.mbBgndGallery.clear)return void r.opt.gallery.remove();e("<img/>").load(function(){r.opt.gallery.trigger("imageLoaded."+r.opt.galleryID)}).attr("src",t)},checkSize:function(t,r){if(t&&!e.mbBgndGallery.changing)return e.mbBgndGallery.clear?void r.opt.gallery.remove():t.each(function(){var t=e(this),o=t.attr("w"),n=t.attr("h"),a="body"==r.opt.containment?window:r.opt.containment,i=o/n,s=e(a).width()/e(a).height();i>=s?(t.css("height","100%"),t.css("width","auto")):(t.css("width","100%"),t.css("height","auto")),t.css("margin-left",(e(a).width()-t.width())/2),r.opt.preserveTop||t.css("margin-top",(e(a).height()-t.height())/2),r.opt.preserveWidth&&t.css({width:"100%",height:"auto",left:0,marginLeft:0})})},changePhoto:function(t,r){if(e.mbBgndGallery.clear)return void r.opt.gallery.remove();e.mbBgndGallery.buildThumbs(r),r.opt.thumbs.folderPath.trim().length>0&&r.opt.thumbs.placeholder.trim().length>0&&(e(".sel",e(r.opt.thumbs.placeholder)).removeClass("sel"),e("#mbBgImg_"+r.opt.imageCounter).addClass("sel")),e.mbBgndGallery.changing=!0,r.opt.onChange&&r.opt.onChange(r.opt,r.opt.imageCounter);var o=e("<img/>").hide().load(function(){var t=e(this),o=e("<div/>").css({position:"absolute",top:-5e3});o.append(t),e("body").append(o),t.attr("w",t.width()),t.attr("h",t.height()),o.remove(),r.opt.effect="object"==typeof r.opt.effect?r.opt.effect:e.mbBgndGallery.effects[r.opt.effect],e("img",r.opt.gallery).CSSAnimate(r.opt.effect.exit,r.opt.effTimer,0,r.opt.effect.exitTiming,function(e){e.length&&e.remove()}),t.css({position:"absolute"}),r.opt.gallery.append(t),e.mbBgndGallery.changing=!1,e.mbBgndGallery.checkSize(t,r);var n={top:0,left:0,opacity:1,x:0,y:0,scale:1,rotate:0,skew:0,filter:" blur(0)"};n=e.mbBgndGallery.normalizeCss(n),t.css(e.mbBgndGallery.normalizeCss(r.opt.effect.enter)).show().CSSAnimate(n,r.opt.effTimer,0,r.opt.effect.enterTiming,function(){r.opt.gallery.trigger("imageReady."+r.opt.galleryID)})}).attr("src",t);o.error(function(){var t=e(this);t.attr("src",r.opt.placeHolder)}),r.opt.grayScale&&o.greyScale(r);var n=e(r.opt.controls).find(".counter");n.html(r.opt.imageCounter+1+" / "+r.opt.images.length)},play:function(t){t||(t=this.get(0)),clearTimeout(t.opt.changing);var r=e("img",t.opt.gallery).not(":last");return r.remove(),e.mbBgndGallery.clear?void t.opt.gallery.remove():(t.opt.onPlay&&t.opt.onPlay(t.opt),t.opt.changing=setTimeout(function(){t.opt.paused||(t.opt.onNext&&t.opt.onNext(t.opt),t.opt.imageCounter>=t.opt.images.length-1&&(t.opt.imageCounter=-1),t.opt.imageCounter++,e.mbBgndGallery.changePhoto(t.opt.images[t.opt.imageCounter],e(t.opt.containment).get(0)))},t.opt.paused?0:t.opt.timer),void t.opt.gallery.trigger("play"))},pause:function(t){return t||(t=this.get(0)),e.mbBgndGallery.clear?void t.opt.gallery.remove():(clearTimeout(t.opt.changing),t.opt.paused=!0,t.opt.gallery.trigger("paused"),void(t.opt.onPause&&t.opt.onPause(t.opt)))},next:function(t){return t||(t=this.get(0)),e.mbBgndGallery.clear?void t.opt.gallery.remove():(t.opt.onNext&&t.opt.onNext(t.opt),e.mbBgndGallery.pause(t),t.opt.imageCounter==t.opt.images.length-1&&(t.opt.imageCounter=-1),t.opt.imageCounter++,e.mbBgndGallery.changePhoto(t.opt.images[t.opt.imageCounter],t),void clearTimeout(t.opt.changing))},prev:function(t){return t||(t=this.get(0)),e.mbBgndGallery.clear?void t.opt.gallery.remove():(t.opt.onPrev&&t.opt.onPrev(t.opt),e.mbBgndGallery.pause(t),clearTimeout(t.opt.changing),0==t.opt.imageCounter&&(t.opt.imageCounter=t.opt.images.length),t.opt.imageCounter--,void e.mbBgndGallery.changePhoto(t.opt.images[t.opt.imageCounter],t))},loader:{show:function(){},hide:function(){}},keyboard:function(t){e(document).on("keydown.bgndGallery",function(r){switch(r.keyCode){case 32:t.opt.paused?(e.mbBgndGallery.play(t),t.opt.paused=!1):(t.opt.paused=!0,e.mbBgndGallery.pause(t)),r.preventDefault();break;case 39:e.mbBgndGallery.next(t),r.preventDefault();break;case 37:e.mbBgndGallery.prev(t),r.preventDefault()}})},buildControls:function(t,r){var o=e(t).find(".pause"),n=e(t).find(".play"),a=e(t).find(".next"),i=e(t).find(".prev"),s=e(t).find(".fullscreen");(e.browser.msie||e.browser.opera||"ontouchstart"in window)&&s.remove(),r.opt.autoStart&&n.hide(),o.on("click",function(){e.mbBgndGallery.pause(r),e(this).hide(),n.show()}),n.on("click",function(){r.opt.paused&&(clearTimeout(r.opt.changing),e.mbBgndGallery.play(r),r.opt.paused=!1)}),a.on("click",function(){e.mbBgndGallery.next(r),o.hide(),n.show()}),i.on("click",function(){e.mbBgndGallery.prev(r),o.hide(),n.show()}),s.on("click",function(){e.mbBgndGallery.runFullscreen(r)}),r.opt.activateKeyboard&&e.mbBgndGallery.keyboard(r)},changeGallery:function(t){var r=this;"object"==typeof r&&(t=r,r=this.get(0)),clearTimeout(r.opt.changing),r.opt.gallery.off("imageLoaded."+r.opt.galleryID),e.mbBgndGallery.pause(r),r.opt.gallery.fadeOut(),r.opt.images=t,r.opt.imageCounter=-1;var o=r.opt.images,n=o.length,a=0;e.mbBgndGallery.preload(o[a],r),r.opt.gallery.on("imageLoaded."+r.opt.galleryID,function(){return a==n?(r.opt.gallery.off("imageLoaded."+r.opt.galleryID),r.opt.gallery.fadeIn(),e.mbBgndGallery.play(r),void(r.opt.paused=!1)):(e.mbBgndGallery.preload(o[a],r),void a++)}),r.opt.thumbs.folderPath.trim().length>0&&r.opt.thumbs.placeholder.trim().length>0&&e.mbBgndGallery.buildThumbs(r)},changeEffect:function(t){e.mbBgndGallery.el.opt.effect=t},runFullscreen:function(t){function r(e,t){for(var r,o,n=["webkit","moz","ms","o",""],a=0;a<n.length&&!e[r];){if(r=t,""==n[a]&&(r=r.substr(0,1).toLowerCase()+r.substr(1)),r=n[a]+r,o=typeof e[r],"undefined"!=o)return n=[n[a]],"function"==o?e[r]():e[r];a++}}function o(e){r(e,"RequestFullScreen")}function n(){(r(document,"FullScreen")||r(document,"IsFullScreen"))&&r(document,"CancelFullScreen")}t||(t=this.get(0));var a=e.browser.mozilla?"mozfullscreenchange":e.browser.webkit?"webkitfullscreenchange":"fullscreenchange";if(e(document).off(a),e(document).on(a,function(){var o=r(document,"IsFullScreen")||r(document,"FullScreen");if(!o){t.isFullscreen=!1,e(".fullScreen_controls").remove(),e(t.opt.containment).is("body")||e(t.opt.containment).css({width:t.width,height:t.height,top:t.top,left:t.left,position:t.position}),t.opt.gallery.css({background:"transparent"});var n=e("#bgndGallery_"+t.opt.galleryID+" img:first")}e.mbBgndGallery.checkSize(n,t)}),t.isFullscreen)n();else{t.isFullscreen=!0,e(t.opt.containment).is("body")||(t.width=e(t.opt.containment).css("width"),t.height=e(t.opt.containment).css("height"),t.top=e(t.opt.containment).css("top"),t.left=e(t.opt.containment).css("left"),t.position=e(t.opt.containment).css("position"));var i=e(t.opt.controls).clone(!0).addClass("fullScreen_controls").css({position:"absolute",zIndex:1e3,bottom:20,right:20});i.find(".fullscreen").html("exit"),t.opt.gallery.append(i).css({background:"#000"}),e(t.opt.containment).CSSAnimate({width:"100%",height:"100%",top:0,left:0,position:"absolute"}),o(t.opt.gallery.get(0))}},buildThumbs:function(t){function r(e){return e.split("/").pop()}if(0!=t.opt.thumbs.folderPath.trim().length||0!=t.opt.thumbs.placeholder.trim().length){e(t.opt.thumbs.placeholder).addClass("thumbnailsContainer");var o=e(t.opt.thumbs.placeholder).children().length||0;if(o!=t.opt.images.length){e(t.opt.thumbs.placeholder).empty();for(var n=0;n<t.opt.images.length;n++){var a=t.opt.thumbs.folderPath+r(t.opt.images[n]),i=e("<img/>").attr({src:a,id:"mbBgImg_"+n}).click(function(){t.opt.imageCounter=e(this).attr("i")-1,e.mbBgndGallery.next(t),t.opt.paused=!0}).attr("i",n).css({opacity:0}).on("load",function(){$(this).fadeTo(1e3,1)});e(t.opt.thumbs.placeholder).append(i)}t.opt.thumbs.folderPath.trim().length>0&&t.opt.thumbs.placeholder.trim().length>0&&(e(".sel",e(t.opt.thumbs.placeholder)).removeClass("sel"),e("#mbBgImg_"+t.opt.imageCounter).addClass("sel"))}}},addImages:function(t,r,o){var n=this.get(0);for(var a in t)n.opt.images.push(t[a]);o&&(n.opt.images=e.shuffle(n.opt.images)),r&&(n.opt.imageCounter=n.opt.images.indexOf(t[0])),e.mbBgndGallery.changePhoto(n.opt.images[n.opt.imageCounter],n),e.mbBgndGallery.buildThumbs(n)},removeImages:function(t){var r=this.get(0);for(var o in t){var n=r.opt.images.indexOf(t[o]);n>-1&&r.opt.images.splice(n,1)}e.mbBgndGallery.changePhoto(r.opt.images[r.opt.imageCounter],r),e.mbBgndGallery.buildThumbs(r)},applyFilter:function(t){var r=e.mbBgndGallery.filters[t],o=this.get(0);e.browser.msie&&e.browser.version<9?o.style.filter=r.msie:e.browser.webkit?o.style["-webkit-filter"]=r.webkit:o.style.filter=r.moz}},e.fn.addImages=e.mbBgndGallery.addImages,e.fn.mbBgndGalleryPlay=e.mbBgndGallery.play,e.fn.mbBgndGalleryPause=e.mbBgndGallery.pause,e.fn.mbBgndGalleryPrev=e.mbBgndGallery.prev,e.fn.mbBgndGalleryNext=e.mbBgndGallery.next,e.fn.changeGallery=e.mbBgndGallery.changeGallery,e.fn.applyFilter=e.mbBgndGallery.applyFilter,e.loadFromSystem=function(t,r){if(t){r||(r=["jpg","jpeg","png"]);var o=[];return e.ajax({url:t,async:!1,success:function(n){var a=e(n),i=a.find("[href]");i.each(function(){for(var n in r)e(this).attr("href").indexOf(r[n])>=0&&o.push(t+e(this).attr("href")),o=e.unique(o)}),a.remove()}}),0!=o.length&&o}},e.fn.greyScale=function(r){return this.each(function(){e.browser.msie&&e.browser.version<9?this.style.filter="progid:DXImageTransform.Microsoft.BasicImage(grayScale=1)":e.browser.webkit?r.opt.gallery.css("-webkit-filter","grayscale(1) sepia(.4)"):this.src=t(this)})},e.shuffle=function(e){for(var t=e.slice(),r=t.length,o=r;o--;){var n=parseInt(Math.random()*r),a=t[o];t[o]=t[n],t[n]=a}return t}}(jQuery);