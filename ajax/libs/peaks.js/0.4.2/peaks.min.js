!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.peaks=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){
var Kinetic={};!function(){Kinetic.version="4.5.5",Kinetic.Filters={},Kinetic.Node=function(t){this._init(t)},Kinetic.Shape=function(t){this.__init(t)},Kinetic.Container=function(t){this.__init(t)},Kinetic.Stage=function(t){this.___init(t)},Kinetic.Layer=function(t){this.___init(t)},Kinetic.Group=function(t){this.___init(t)},Kinetic.Global={stages:[],idCounter:0,ids:{},names:{},shapes:{},listenClickTap:!1,inDblClickWindow:!1,dblClickWindow:400,isDragging:function(){var t=Kinetic.DD;return t?t.isDragging:!1},isDragReady:function(){var t=Kinetic.DD;return t?!!t.node:!1},_addId:function(t,e){void 0!==e&&(this.ids[e]=t)},_removeId:function(t){void 0!==t&&delete this.ids[t]},_addName:function(t,e){void 0!==e&&(void 0===this.names[e]&&(this.names[e]=[]),this.names[e].push(t))},_removeName:function(t,e){if(void 0!==t){var i=this.names[t];if(void 0!==i){for(var n=0;n<i.length;n++){var a=i[n];a._id===e&&i.splice(n,1)}0===i.length&&delete this.names[t]}}}}}(),function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):t.returnExports=e()}(this,function(){return Kinetic}),function(){Kinetic.Collection=function(){var t=[].slice.call(arguments),e=t.length,i=0;for(this.length=e;e>i;i++)this[i]=t[i];return this},Kinetic.Collection.prototype=[],Kinetic.Collection.prototype.each=function(t){for(var e=0;e<this.length;e++)t(this[e],e)},Kinetic.Collection.prototype.toArray=function(){var t,e=[],i=this.length;for(t=0;i>t;t++)e.push(this[t]);return e},Kinetic.Collection.toCollection=function(t){var e,i=new Kinetic.Collection,n=t.length;for(e=0;n>e;e++)i.push(t[e]);return i},Kinetic.Collection.mapMethods=function(t){var e,i=t.length;for(e=0;i>e;e++)!function(e){var i=t[e];Kinetic.Collection.prototype[i]=function(){var t,e=this.length;for(args=[].slice.call(arguments),t=0;e>t;t++)this[t][i].apply(this[t],args)}}(e)}}(),function(){Kinetic.Transform=function(){this.m=[1,0,0,1,0,0]},Kinetic.Transform.prototype={translate:function(t,e){this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e},scale:function(t,e){this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e},rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.m[0]*e+this.m[2]*i,a=this.m[1]*e+this.m[3]*i,r=this.m[0]*-i+this.m[2]*e,s=this.m[1]*-i+this.m[3]*e;this.m[0]=n,this.m[1]=a,this.m[2]=r,this.m[3]=s},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},skew:function(t,e){var i=this.m[0]+this.m[2]*e,n=this.m[1]+this.m[3]*e,a=this.m[2]+this.m[0]*t,r=this.m[3]+this.m[1]*t;this.m[0]=i,this.m[1]=n,this.m[2]=a,this.m[3]=r},multiply:function(t){var e=this.m[0]*t.m[0]+this.m[2]*t.m[1],i=this.m[1]*t.m[0]+this.m[3]*t.m[1],n=this.m[0]*t.m[2]+this.m[2]*t.m[3],a=this.m[1]*t.m[2]+this.m[3]*t.m[3],r=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],s=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=a,this.m[4]=r,this.m[5]=s},invert:function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,i=-this.m[1]*t,n=-this.m[2]*t,a=this.m[0]*t,r=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),s=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=a,this.m[4]=r,this.m[5]=s},getMatrix:function(){return this.m}}}(),function(){var t="canvas",e="2d",i="[object Array]",n="[object Number]",a="[object String]",r=Math.PI/180,s=180/Math.PI,o="#",h="",c="0",l="Kinetic warning: ",d="Kinetic error: ",u="rgb(",g={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},f=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;Kinetic.Util={_isElement:function(t){return!(!t||1!=t.nodeType)},_isFunction:function(t){return!!(t&&t.constructor&&t.call&&t.apply)},_isObject:function(t){return!!t&&t.constructor==Object},_isArray:function(t){return Object.prototype.toString.call(t)==i},_isNumber:function(t){return Object.prototype.toString.call(t)==n},_isString:function(t){return Object.prototype.toString.call(t)==a},_hasMethods:function(t){var e,i=[];for(e in t)this._isFunction(t[e])&&i.push(e);return i.length>0},_isInDocument:function(t){for(;t=t.parentNode;)if(t==document)return!0;return!1},_getXY:function(t){if(this._isNumber(t))return{x:t,y:t};if(this._isArray(t)){if(1===t.length){var e=t[0];if(this._isNumber(e))return{x:e,y:e};if(this._isArray(e))return{x:e[0],y:e[1]};if(this._isObject(e))return e}else if(t.length>=2)return{x:t[0],y:t[1]}}else if(this._isObject(t))return t;return null},_getSize:function(t){if(this._isNumber(t))return{width:t,height:t};if(this._isArray(t))if(1===t.length){var e=t[0];if(this._isNumber(e))return{width:e,height:e};if(this._isArray(e)){if(e.length>=4)return{width:e[2],height:e[3]};if(e.length>=2)return{width:e[0],height:e[1]}}else if(this._isObject(e))return e}else{if(t.length>=4)return{width:t[2],height:t[3]};if(t.length>=2)return{width:t[0],height:t[1]}}else if(this._isObject(t))return t;return null},_getPoints:function(t){var e,i,n=[];if(void 0===t)return[];if(i=t.length,this._isArray(t[0])){for(e=0;i>e;e++)n.push({x:t[e][0],y:t[e][1]});return n}if(this._isObject(t[0]))return t;for(e=0;i>e;e+=2)n.push({x:t[e],y:t[e+1]});return n},_getImage:function(i,n){var a,r,s,o;i?this._isElement(i)?n(i):this._isString(i)?(a=new Image,a.onload=function(){n(a)},a.src=i):i.data?(r=document.createElement(t),r.width=i.width,r.height=i.height,s=r.getContext(e),s.putImageData(i,0,0),o=r.toDataURL(),a=new Image,a.onload=function(){n(a)},a.src=o):n(null):n(null)},_rgbToHex:function(t,e,i){return((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)},_hexToRgb:function(t){t=t.replace(o,h);var e=parseInt(t,16);return{r:255&e>>16,g:255&e>>8,b:255&e}},getRandomColor:function(){for(var t=(16777215*Math.random()<<0).toString(16);t.length<6;)t=c+t;return o+t},getRGB:function(t){var e;return t in g?(e=g[t],{r:e[0],g:e[1],b:e[2]}):t[0]===o?this._hexToRgb(t.substring(1)):t.substr(0,4)===u?(e=f.exec(t.replace(/ /g,"")),{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}):{r:0,g:0,b:0}},_merge:function(t,e){var i=this._clone(e);for(var n in t)i[n]=this._isObject(t[n])?this._merge(t[n],i[n]):t[n];return i},_clone:function(t){var e={};for(var i in t)e[i]=this._isObject(t[i])?this._clone(t[i]):t[i];return e},_degToRad:function(t){return t*r},_radToDeg:function(t){return t*s},_capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},error:function(t){throw new Error(d+t)},warn:function(t){window.console&&console.warn&&console.warn(l+t)},extend:function(t,e){for(var i in e.prototype)i in t.prototype||(t.prototype[i]=e.prototype[i])},addMethods:function(t,e){var i;for(i in e)t.prototype[i]=e[i]},_getControlPoints:function(t,e,i,n){var a=t.x,r=t.y,s=e.x,o=e.y,h=i.x,c=i.y,l=Math.sqrt(Math.pow(s-a,2)+Math.pow(o-r,2)),d=Math.sqrt(Math.pow(h-s,2)+Math.pow(c-o,2)),u=n*l/(l+d),g=n*d/(l+d),f=s-u*(h-a),p=o-u*(c-r),v=s+g*(h-a),m=o+g*(c-r);return[{x:f,y:p},{x:v,y:m}]},_expandPoints:function(t,e){var i,n,a=t.length,r=[];for(i=1;a-1>i;i++)n=Kinetic.Util._getControlPoints(t[i-1],t[i],t[i+1],e),r.push(n[0]),r.push(t[i]),r.push(n[1]);return r},_removeLastLetter:function(t){return t.substring(0,t.length-1)}}}(),function(){var t=document.createElement("canvas"),e=t.getContext("2d"),i=window.devicePixelRatio||1,n=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,a=i/n;Kinetic.Canvas=function(t){this.init(t)},Kinetic.Canvas.prototype={init:function(t){t=t||{};var e=t.width||0,i=t.height||0,n=t.pixelRatio||a,r=t.contextType||"2d";this.pixelRatio=n,this.element=document.createElement("canvas"),this.element.style.padding=0,this.element.style.margin=0,this.element.style.border=0,this.element.style.background="transparent",this.element.style.position="absolute",this.element.style.top=0,this.element.style.left=0,this.context=this.element.getContext(r),this.setSize(e,i)},getElement:function(){return this.element},getContext:function(){return this.context},setWidth:function(t){this.width=this.element.width=t*this.pixelRatio,this.element.style.width=t+"px"},setHeight:function(t){this.height=this.element.height=t*this.pixelRatio,this.element.style.height=t+"px"},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(t,e){this.setWidth(t),this.setHeight(e)},clear:function(){var t=this.getContext();this.getElement(),t.clearRect(0,0,this.getWidth(),this.getHeight())},toDataURL:function(t,e){try{return this.element.toDataURL(t,e)}catch(i){try{return this.element.toDataURL()}catch(n){return Kinetic.Util.warn("Unable to get data URL. "+n.message),""}}},fill:function(t){t.getFillEnabled()&&this._fill(t)},stroke:function(t){t.getStrokeEnabled()&&this._stroke(t)},fillStroke:function(t){var e=t.getFillEnabled();e&&this._fill(t),t.getStrokeEnabled()&&this._stroke(t,t.hasShadow()&&t.hasFill()&&e)},applyShadow:function(t,e){var i=this.context;i.save(),this._applyShadow(t),e(),i.restore(),e()},_applyLineCap:function(t){var e=t.getLineCap();e&&(this.context.lineCap=e)},_applyOpacity:function(t){var e=t.getAbsoluteOpacity();1!==e&&(this.context.globalAlpha=e)},_applyLineJoin:function(t){var e=t.getLineJoin();e&&(this.context.lineJoin=e)},_applyAncestorTransforms:function(t){var e,i,n=this.context;t._eachAncestorReverse(function(t){e=t.getTransform(!0),i=e.getMatrix(),n.transform(i[0],i[1],i[2],i[3],i[4],i[5])},!0)},_clip:function(t){var e=this.getContext();e.save(),this._applyAncestorTransforms(t),e.beginPath(),t.getClipFunc()(this),e.clip(),e.setTransform(1,0,0,1,0,0)}},Kinetic.SceneCanvas=function(t){Kinetic.Canvas.call(this,t)},Kinetic.SceneCanvas.prototype={setWidth:function(t){var e=this.pixelRatio;Kinetic.Canvas.prototype.setWidth.call(this,t),this.context.scale(e,e)},setHeight:function(t){var e=this.pixelRatio;Kinetic.Canvas.prototype.setHeight.call(this,t),this.context.scale(e,e)},_fillColor:function(t){var e=this.context,i=t.getFill();e.fillStyle=i,t._fillFunc(e)},_fillPattern:function(t){var e=this.context,i=t.getFillPatternImage(),n=t.getFillPatternX(),a=t.getFillPatternY(),r=t.getFillPatternScale(),s=t.getFillPatternRotation(),o=t.getFillPatternOffset(),h=t.getFillPatternRepeat();(n||a)&&e.translate(n||0,a||0),s&&e.rotate(s),r&&e.scale(r.x,r.y),o&&e.translate(-1*o.x,-1*o.y),e.fillStyle=e.createPattern(i,h||"repeat"),e.fill()},_fillLinearGradient:function(t){var e=this.context,i=t.getFillLinearGradientStartPoint(),n=t.getFillLinearGradientEndPoint(),a=t.getFillLinearGradientColorStops(),r=e.createLinearGradient(i.x,i.y,n.x,n.y);if(a){for(var s=0;s<a.length;s+=2)r.addColorStop(a[s],a[s+1]);e.fillStyle=r,e.fill()}},_fillRadialGradient:function(t){for(var e=this.context,i=t.getFillRadialGradientStartPoint(),n=t.getFillRadialGradientEndPoint(),a=t.getFillRadialGradientStartRadius(),r=t.getFillRadialGradientEndRadius(),s=t.getFillRadialGradientColorStops(),o=e.createRadialGradient(i.x,i.y,a,n.x,n.y,r),h=0;h<s.length;h+=2)o.addColorStop(s[h],s[h+1]);e.fillStyle=o,e.fill()},_fill:function(t,e){var i=this.context,n=t.getFill(),a=t.getFillPatternImage(),r=t.getFillLinearGradientColorStops(),s=t.getFillRadialGradientColorStops(),o=t.getFillPriority();i.save(),!e&&t.hasShadow()&&this._applyShadow(t),n&&"color"===o?this._fillColor(t):a&&"pattern"===o?this._fillPattern(t):r&&"linear-gradient"===o?this._fillLinearGradient(t):s&&"radial-gradient"===o?this._fillRadialGradient(t):n?this._fillColor(t):a?this._fillPattern(t):r?this._fillLinearGradient(t):s&&this._fillRadialGradient(t),i.restore(),!e&&t.hasShadow()&&this._fill(t,!0)},_stroke:function(t,e){var i=this.context,n=t.getStroke(),a=t.getStrokeWidth(),r=t.getDashArray();(n||a)&&(i.save(),t.getStrokeScaleEnabled()||i.setTransform(1,0,0,1,0,0),this._applyLineCap(t),r&&t.getDashArrayEnabled()&&(i.setLineDash?i.setLineDash(r):"mozDash"in i?i.mozDash=r:"webkitLineDash"in i&&(i.webkitLineDash=r)),!e&&t.hasShadow()&&this._applyShadow(t),i.lineWidth=a||2,i.strokeStyle=n||"black",t._strokeFunc(i),i.restore(),!e&&t.hasShadow()&&this._stroke(t,!0))},_applyShadow:function(t){var e=this.context;if(t.hasShadow()&&t.getShadowEnabled()){var i=t.getAbsoluteOpacity(),n=t.getShadowColor()||"black",a=t.getShadowBlur()||5,r=t.getShadowOffset()||{x:0,y:0};t.getShadowOpacity()&&(e.globalAlpha=t.getShadowOpacity()*i),e.shadowColor=n,e.shadowBlur=a,e.shadowOffsetX=r.x,e.shadowOffsetY=r.y}}},Kinetic.Util.extend(Kinetic.SceneCanvas,Kinetic.Canvas),Kinetic.HitCanvas=function(t){Kinetic.Canvas.call(this,t)},Kinetic.HitCanvas.prototype={_fill:function(t){var e=this.context;e.save(),e.fillStyle=t.colorKey,t._fillFuncHit(e),e.restore()},_stroke:function(t){var e=this.context,i=t.getStroke(),n=t.getStrokeWidth();(i||n)&&(this._applyLineCap(t),e.save(),e.lineWidth=n||2,e.strokeStyle=t.colorKey,t._strokeFuncHit(e),e.restore())}},Kinetic.Util.extend(Kinetic.HitCanvas,Kinetic.Canvas)}(),function(){var e="add",i=" ",n="",a=".",r="get",s="set",o="Shape",h="Stage",c="X",l="Y",d="kinetic",u="before",g="Change",f="id",p="name",v="mouseenter",m="mouseleave",K="Deg",_="RGB",y="r",S="g",x="b",C="R",w="G",b="B",P="#",T="children";Kinetic.Util.addMethods(Kinetic.Node,{_init:function(t){this._id=Kinetic.Global.idCounter++,this.eventListeners={},this.attrs={},this.setAttrs(t)},on:function(t,e){var r,s,o,h,c,l=t.split(i),d=l.length;for(r=0;d>r;r++)s=l[r],o=s.split(a),h=o[0],c=o[1]||n,this.eventListeners[h]||(this.eventListeners[h]=[]),this.eventListeners[h].push({name:c,handler:e});return this},off:function(e){var n,r,s,o,h,c=e.split(i),l=c.length;for(n=0;l>n;n++)if(r=c[n],s=r.split(a),o=s[0],h=s[1],o)this.eventListeners[o]&&this._off(o,h);else for(t in this.eventListeners)this._off(t,h);return this},remove:function(){var t=this.getParent();return t&&t.children&&(t.children.splice(this.index,1),t._setChildrenIndices(),delete this.parent),this},destroy:function(){var t=Kinetic.Global;t._removeId(this.getId()),t._removeName(this.getName(),this._id),this.remove()},getAttr:function(t){var e=r+Kinetic.Util._capitalize(t);return Kinetic.Util._isFunction(this[e])?this[e]():this.attrs[t]},setAttr:function(){var t=Array.prototype.slice.call(arguments),e=t[0],i=s+Kinetic.Util._capitalize(e),n=this[i];return t.shift(),Kinetic.Util._isFunction(n)?n.apply(this,t):this.attrs[e]=t[0],this},getAttrs:function(){return this.attrs||{}},setAttrs:function(t){var e,i;if(t)for(e in t)e===T||(i=s+Kinetic.Util._capitalize(e),Kinetic.Util._isFunction(this[i])?this[i](t[e]):this._setAttr(e,t[e]));return this},getVisible:function(){var t=this.attrs.visible,e=this.getParent();return void 0===t&&(t=!0),t&&e&&!e.getVisible()?!1:t},show:function(){return this.setVisible(!0),this},hide:function(){return this.setVisible(!1),this},getZIndex:function(){return this.index||0},getAbsoluteZIndex:function(){function t(h){for(e=[],i=h.length,n=0;i>n;n++)a=h[n],c++,a.nodeType!==o&&(e=e.concat(a.getChildren().toArray())),a._id===s._id&&(n=i);e.length>0&&e[0].getLevel()<=r&&t(e)}var e,i,n,a,r=this.getLevel(),s=(this.getStage(),this),c=0;return s.nodeType!==h&&t(s.getStage().getChildren()),c},getLevel:function(){for(var t=0,e=this.parent;e;)t++,e=e.parent;return t},setPosition:function(){var t=Kinetic.Util._getXY([].slice.call(arguments));return this.setX(t.x),this.setY(t.y),this},getPosition:function(){return{x:this.getX(),y:this.getY()}},getAbsolutePosition:function(){var t=this.getAbsoluteTransform(),e=this.getOffset();return t.translate(e.x,e.y),t.getTranslation()},setAbsolutePosition:function(){var t,e=Kinetic.Util._getXY([].slice.call(arguments)),i=this._clearTransform();return this.attrs.x=i.x,this.attrs.y=i.y,delete i.x,delete i.y,t=this.getAbsoluteTransform(),t.invert(),t.translate(e.x,e.y),e={x:this.attrs.x+t.getTranslation().x,y:this.attrs.y+t.getTranslation().y},this.setPosition(e.x,e.y),this._setTransform(i),this},move:function(){var t=Kinetic.Util._getXY([].slice.call(arguments)),e=this.getX(),i=this.getY();return void 0!==t.x&&(e+=t.x),void 0!==t.y&&(i+=t.y),this.setPosition(e,i),this},_eachAncestorReverse:function(t,e){var i,n,a=[],r=this.getParent();for(e&&a.unshift(this);r;)a.unshift(r),r=r.parent;for(i=a.length,n=0;i>n;n++)t(a[n])},rotate:function(t){return this.setRotation(this.getRotation()+t),this},rotateDeg:function(t){return this.setRotation(this.getRotation()+Kinetic.Util._degToRad(t)),this},moveToTop:function(){var t=this.index;return this.parent.children.splice(t,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0},moveUp:function(){var t=this.index,e=this.parent.getChildren().length;return e-1>t?(this.parent.children.splice(t,1),this.parent.children.splice(t+1,0,this),this.parent._setChildrenIndices(),!0):!1},moveDown:function(){var t=this.index;return t>0?(this.parent.children.splice(t,1),this.parent.children.splice(t-1,0,this),this.parent._setChildrenIndices(),!0):!1},moveToBottom:function(){var t=this.index;return t>0?(this.parent.children.splice(t,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1},setZIndex:function(t){var e=this.index;return this.parent.children.splice(e,1),this.parent.children.splice(t,0,this),this.parent._setChildrenIndices(),this},getAbsoluteOpacity:function(){var t=this.getOpacity();return this.getParent()&&(t*=this.getParent().getAbsoluteOpacity()),t},moveTo:function(t){return Kinetic.Node.prototype.remove.call(this),t.add(this),this},toObject:function(){var t,e,i=Kinetic.Util,n={},a=this.getAttrs();n.attrs={};for(t in a)e=a[t],i._isFunction(e)||i._isElement(e)||i._isObject(e)&&i._hasMethods(e)||(n.attrs[t]=e);return n.className=this.getClassName(),n},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){return this.getParent().getLayer()},getStage:function(){return this.getParent()?this.getParent().getStage():void 0},fire:function(t,e,i){return i?this._fireAndBubble(t,e||{}):this._fire(t,e||{}),this},getAbsoluteTransform:function(){var t,e=new Kinetic.Transform;return this._eachAncestorReverse(function(i){t=i.getTransform(),e.multiply(t)},!0),e},_getAndCacheTransform:function(){var t=new Kinetic.Transform,e=this.getX(),i=this.getY(),n=this.getRotation(),a=this.getScaleX(),r=this.getScaleY(),s=this.getSkewX(),o=this.getSkewY(),h=this.getOffsetX(),c=this.getOffsetY();return(0!==e||0!==i)&&t.translate(e,i),0!==n&&t.rotate(n),(0!==s||0!==o)&&t.skew(s,o),(1!==a||1!==r)&&t.scale(a,r),(0!==h||0!==c)&&t.translate(-1*h,-1*c),this.cachedTransform=t,t},getTransform:function(t){var e=this.cachedTransform;return t&&e?e:this._getAndCacheTransform()},clone:function(t){var e,i,n,a,r,s=this.getClassName(),o=new Kinetic[s](this.attrs);for(e in this.eventListeners)for(i=this.eventListeners[e],n=i.length,a=0;n>a;a++)r=i[a],r.name.indexOf(d)<0&&(o.eventListeners[e]||(o.eventListeners[e]=[]),o.eventListeners[e].push(r));return o.setAttrs(t),o},toDataURL:function(t){t=t||{};var e=t.mimeType||null,i=t.quality||null,n=this.getStage(),a=t.x||0,r=t.y||0,s=new Kinetic.SceneCanvas({width:t.width||n.getWidth(),height:t.height||n.getHeight(),pixelRatio:1}),o=s.getContext();return o.save(),(a||r)&&o.translate(-1*a,-1*r),this.drawScene(s),o.restore(),s.toDataURL(e,i)},toImage:function(t){Kinetic.Util._getImage(this.toDataURL(t),function(e){t.callback(e)})},setSize:function(){var t=Kinetic.Util._getSize(Array.prototype.slice.call(arguments));return this.setWidth(t.width),this.setHeight(t.height),this},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},getClassName:function(){return this.className||this.nodeType},getType:function(){return this.nodeType},_get:function(t){return this.nodeType===t?[this]:[]},_off:function(t,e){var i,n,a=this.eventListeners[t];for(i=0;i<a.length;i++)if(n=a[i].name,!("kinetic"===n&&"kinetic"!==e||e&&n!==e)){if(a.splice(i,1),0===a.length){delete this.eventListeners[t];break}i--}},_clearTransform:function(){var t={x:this.getX(),y:this.getY(),rotation:this.getRotation(),scaleX:this.getScaleX(),scaleY:this.getScaleY(),offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),skewX:this.getSkewX(),skewY:this.getSkewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,t},_setTransform:function(t){var e;for(e in t)this.attrs[e]=t[e];this.cachedTransform=null},_fireBeforeChangeEvent:function(t,e,i){this._fire(u+Kinetic.Util._capitalize(t)+g,{oldVal:e,newVal:i})},_fireChangeEvent:function(t,e,i){this._fire(t+g,{oldVal:e,newVal:i})},setId:function(t){var e=this.getId(),i=(this.getStage(),Kinetic.Global);return i._removeId(e),i._addId(this,t),this._setAttr(f,t),this},setName:function(t){var e=this.getName(),i=(this.getStage(),Kinetic.Global);return i._removeName(e,this._id),i._addName(this,t),this._setAttr(p,t),this},_setAttr:function(t,e){var i;void 0!==e&&(i=this.attrs[t],this._fireBeforeChangeEvent(t,i,e),this.attrs[t]=e,this._fireChangeEvent(t,i,e))},_fireAndBubble:function(t,e,i){e&&this.nodeType===o&&(e.targetNode=this),this.getStage(),this.eventListeners;var n=!0;t===v&&i&&this._id===i._id?n=!1:t===m&&i&&this._id===i._id&&(n=!1),n&&(this._fire(t,e),e&&!e.cancelBubble&&this.parent&&(i&&i.parent?this._fireAndBubble.call(this.parent,t,e,i.parent):this._fireAndBubble.call(this.parent,t,e)))},_fire:function(t,e){var i,n,a=this.eventListeners[t];if(a)for(i=a.length,n=0;i>n;n++)a[n].handler.call(this,e)},draw:function(){return this.drawScene(),this.drawHit(),this},shouldDrawHit:function(){return this.isVisible()&&this.isListening()&&!Kinetic.Global.isDragging()},isDraggable:function(){return!1}}),Kinetic.Node.addGetterSetter=function(t,e,i,n){this.addGetter(t,e,i),this.addSetter(t,e,n)},Kinetic.Node.addPointGetterSetter=function(t,e,i,n){this.addPointGetter(t,e),this.addPointSetter(t,e),this.addGetter(t,e+c,i),this.addGetter(t,e+l,i),this.addSetter(t,e+c,n),this.addSetter(t,e+l,n)},Kinetic.Node.addPointsGetterSetter=function(t,e){this.addPointsGetter(t,e),this.addPointsSetter(t,e),this.addPointAdder(t,e)},Kinetic.Node.addRotationGetterSetter=function(t,e,i,n){this.addRotationGetter(t,e,i),this.addRotationSetter(t,e,n)},Kinetic.Node.addColorGetterSetter=function(t,e){this.addGetter(t,e),this.addSetter(t,e),this.addColorRGBGetter(t,e),this.addColorComponentGetter(t,e,y),this.addColorComponentGetter(t,e,S),this.addColorComponentGetter(t,e,x),this.addColorRGBSetter(t,e),this.addColorComponentSetter(t,e,y),this.addColorComponentSetter(t,e,S),this.addColorComponentSetter(t,e,x)},Kinetic.Node.addColorRGBGetter=function(t,e){var i=r+Kinetic.Util._capitalize(e)+_;t.prototype[i]=function(){return Kinetic.Util.getRGB(this.attrs[e])}},Kinetic.Node.addColorComponentGetter=function(t,e,i){var n=r+Kinetic.Util._capitalize(e),a=n+Kinetic.Util._capitalize(i);t.prototype[a]=function(){return this[n+_]()[i]}},Kinetic.Node.addPointsGetter=function(t,e){var i=r+Kinetic.Util._capitalize(e);t.prototype[i]=function(){var t=this.attrs[e];return void 0===t?[]:t}},Kinetic.Node.addGetter=function(t,e,i){var n=r+Kinetic.Util._capitalize(e);t.prototype[n]=function(){var t=this.attrs[e];return void 0===t?i:t}},Kinetic.Node.addPointGetter=function(t,e){var i=r+Kinetic.Util._capitalize(e);t.prototype[i]=function(){var t=this;return{x:t[i+c](),y:t[i+l]()}}},Kinetic.Node.addRotationGetter=function(t,e,i){var n=r+Kinetic.Util._capitalize(e);t.prototype[n]=function(){var t=this.attrs[e];return void 0===t&&(t=i),t},t.prototype[n+K]=function(){var t=this.attrs[e];return void 0===t&&(t=i),Kinetic.Util._radToDeg(t)}},Kinetic.Node.addColorRGBSetter=function(t,e){var i=s+Kinetic.Util._capitalize(e)+_;t.prototype[i]=function(t){var i=t&&void 0!==t.r?0|t.r:this.getAttr(e+C),n=t&&void 0!==t.g?0|t.g:this.getAttr(e+w),a=t&&void 0!==t.b?0|t.b:this.getAttr(e+b);this._setAttr(e,P+Kinetic.Util._rgbToHex(i,n,a))}},Kinetic.Node.addColorComponentSetter=function(t,e,i){var n=s+Kinetic.Util._capitalize(e),a=n+Kinetic.Util._capitalize(i);t.prototype[a]=function(t){var e={};e[i]=t,this[n+_](e)}},Kinetic.Node.addPointsSetter=function(t,e){var i=s+Kinetic.Util._capitalize(e);t.prototype[i]=function(t){var e=Kinetic.Util._getPoints(t);this._setAttr("points",e)}},Kinetic.Node.addSetter=function(t,e,i){var n=s+Kinetic.Util._capitalize(e);t.prototype[n]=function(t){this._setAttr(e,t),i&&(this.cachedTransform=null)}},Kinetic.Node.addPointSetter=function(t,e){var i=s+Kinetic.Util._capitalize(e);t.prototype[i]=function(){var t=Kinetic.Util._getXY([].slice.call(arguments)),n=this.attrs[e],a=0,r=0;t&&(a=t.x,r=t.y,this._fireBeforeChangeEvent(e,n,t),void 0!==a&&this[i+c](a),void 0!==r&&this[i+l](r),this._fireChangeEvent(e,n,t))}},Kinetic.Node.addRotationSetter=function(t,e,i){var n=s+Kinetic.Util._capitalize(e);t.prototype[n]=function(t){this._setAttr(e,t),i&&(this.cachedTransform=null)},t.prototype[n+K]=function(t){this._setAttr(e,Kinetic.Util._degToRad(t)),i&&(this.cachedTransform=null)}},Kinetic.Node.addPointAdder=function(t,i){var n=e+Kinetic.Util._removeLastLetter(Kinetic.Util._capitalize(i));t.prototype[n]=function(){var t=Kinetic.Util._getXY([].slice.call(arguments)),e=this.attrs[i];t&&(this._fireBeforeChangeEvent(i,e,t),this.attrs[i].push(t),this._fireChangeEvent(i,e,t))}},Kinetic.Node.create=function(t,e){return this._createNode(JSON.parse(t),e)},Kinetic.Node._createNode=function(t,e){var i,n,a,r=Kinetic.Node.prototype.getClassName.call(t),s=t.children;if(e&&(t.attrs.container=e),i=new Kinetic[r](t.attrs),s)for(n=s.length,a=0;n>a;a++)i.add(this._createNode(s[a]));return i},Kinetic.Node.addGetterSetter(Kinetic.Node,"x",0,!0),Kinetic.Node.addGetterSetter(Kinetic.Node,"y",0,!0),Kinetic.Node.addGetterSetter(Kinetic.Node,"opacity",1),Kinetic.Node.addGetter(Kinetic.Node,"name"),Kinetic.Node.addGetter(Kinetic.Node,"id"),Kinetic.Node.addRotationGetterSetter(Kinetic.Node,"rotation",0,!0),Kinetic.Node.addPointGetterSetter(Kinetic.Node,"scale",1,!0),Kinetic.Node.addPointGetterSetter(Kinetic.Node,"skew",0,!0),Kinetic.Node.addPointGetterSetter(Kinetic.Node,"offset",0,!0),Kinetic.Node.addSetter(Kinetic.Node,"width"),Kinetic.Node.addSetter(Kinetic.Node,"height"),Kinetic.Node.addGetterSetter(Kinetic.Node,"listening",!0),Kinetic.Node.addSetter(Kinetic.Node,"visible"),Kinetic.Node.prototype.isListening=Kinetic.Node.prototype.getListening,Kinetic.Node.prototype.isVisible=Kinetic.Node.prototype.getVisible,Kinetic.Collection.mapMethods(["on","off","remove","destroy","show","hide","move","rotate","moveToTop","moveUp","moveDown","moveToBottom","moveTo","fire","draw"])}(),function(){function t(t){window.setTimeout(t,1e3/60)}var e=500;Kinetic.Animation=function(t,e){this.func=t,this.setLayers(e),this.id=Kinetic.Animation.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:(new Date).getTime()}},Kinetic.Animation.prototype={setLayers:function(t){var e=[];e=t?t.length>0?t:[t]:[],this.layers=e},getLayers:function(){return this.layers},addLayer:function(t){var e,i,n=this.layers;if(n){for(e=n.length,i=0;e>i;i++)if(n[i]._id===t._id)return!1}else this.layers=[];return this.layers.push(t),!0},isRunning:function(){for(var t=Kinetic.Animation,e=t.animations,i=0;i<e.length;i++)if(e[i].id===this.id)return!0;return!1},start:function(){this.stop(),this.frame.timeDiff=0,this.frame.lastTime=(new Date).getTime(),Kinetic.Animation._addAnimation(this)},stop:function(){Kinetic.Animation._removeAnimation(this)},_updateFrameObject:function(t){this.frame.timeDiff=t-this.frame.lastTime,this.frame.lastTime=t,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}},Kinetic.Animation.animations=[],Kinetic.Animation.animIdCounter=0,Kinetic.Animation.animRunning=!1,Kinetic.Animation._addAnimation=function(t){this.animations.push(t),this._handleAnimation()},Kinetic.Animation._removeAnimation=function(t){for(var e=t.id,i=this.animations,n=i.length,a=0;n>a;a++)if(i[a].id===e){this.animations.splice(a,1);break}},Kinetic.Animation._runFrames=function(){var t,e,i,n,a,r,s,o,h={},c=this.animations;for(n=0;n<c.length;n++){for(t=c[n],e=t.layers,i=t.func,t._updateFrameObject((new Date).getTime()),r=e.length,a=0;r>a;a++)s=e[a],void 0!==s._id&&(h[s._id]=s);i&&i.call(t,t.frame)}for(o in h)h[o].draw()},Kinetic.Animation._animationLoop=function(){var t=this;this.animations.length>0?(this._runFrames(),Kinetic.Animation.requestAnimFrame(function(){t._animationLoop()})):this.animRunning=!1},Kinetic.Animation._handleAnimation=function(){var t=this;this.animRunning||(this.animRunning=!0,t._animationLoop())},RAF=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||t}(),Kinetic.Animation.requestAnimFrame=function(e){var i=Kinetic.DD&&Kinetic.DD.isDragging?t:RAF;i(e)};var i=Kinetic.Node.prototype.moveTo;Kinetic.Node.prototype.moveTo=function(t){i.call(this,t)},Kinetic.Layer.prototype.batchDraw=function(){var t=this;this.batchAnim||(this.batchAnim=new Kinetic.Animation(function(){t.lastBatchDrawTime&&(new Date).getTime()-t.lastBatchDrawTime>e&&t.batchAnim.stop()},this)),this.lastBatchDrawTime=(new Date).getTime(),this.batchAnim.isRunning()||(this.draw(),this.batchAnim.start())},Kinetic.Stage.prototype.batchDraw=function(){this.getChildren().each(function(t){t.batchDraw()})}}(),function(){var t={node:1,duration:1,easing:1,onFinish:1,yoyo:1},e=1,i=2,n=3,a=0;Kinetic.Tween=function(e){var i,n=this,s=e.node,o=s._id,h=e.duration||1,c=e.easing||Kinetic.Easings.Linear,l=!!e.yoyo;this.node=s,this._id=a++,this.anim=new Kinetic.Animation(function(){n.tween.onEnterFrame()},s.getLayer()||s.getLayers()),this.tween=new r(i,function(t){n._tweenFunc(t)},c,0,1,1e3*h,l),this._addListeners(),Kinetic.Tween.attrs[o]||(Kinetic.Tween.attrs[o]={}),Kinetic.Tween.attrs[o][this._id]||(Kinetic.Tween.attrs[o][this._id]={}),Kinetic.Tween.tweens[o]||(Kinetic.Tween.tweens[o]={});for(i in e)void 0===t[i]&&this._addAttr(i,e[i]);this.reset(),this.onFinish=e.onFinish,this.onReset=e.onReset},Kinetic.Tween.attrs={},Kinetic.Tween.tweens={},Kinetic.Tween.prototype={_addAttr:function(t,e){var i,n,a,r,s,o,h,c=this.node,l=c._id;if(a=Kinetic.Tween.tweens[l][t],a&&delete Kinetic.Tween.attrs[l][a][t],i=c.getAttr(t),Kinetic.Util._isArray(e))for(e=Kinetic.Util._getPoints(e),n=[],s=e.length,r=0;s>r;r++)o=i[r],h=e[r],n.push({x:h.x-o.x,y:h.y-o.y});else n=e-i;Kinetic.Tween.attrs[l][this._id][t]={start:i,diff:n},Kinetic.Tween.tweens[l][t]=this._id},_tweenFunc:function(t){var e,i,n,a,r,s,o,h,c,l=this.node,d=Kinetic.Tween.attrs[l._id][this._id];for(e in d){if(i=d[e],n=i.start,a=i.diff,Kinetic.Util._isArray(n))for(r=[],o=n.length,s=0;o>s;s++)h=n[s],c=a[s],r.push({x:h.x+c.x*t,y:h.y+c.y*t});else r=n+a*t;l.setAttr(e,r)}},_addListeners:function(){var t=this;this.tween.onPlay=function(){t.anim.start()},this.tween.onReverse=function(){t.anim.start()},this.tween.onPause=function(){t.anim.stop()},this.tween.onFinish=function(){t.onFinish&&t.onFinish()},this.tween.onReset=function(){t.onReset&&t.onReset()}},play:function(){return this.tween.play(),this},reverse:function(){return this.tween.reverse(),this},reset:function(){var t=this.node;return this.tween.reset(),(t.getLayer()||t.getLayers()).draw(),this},seek:function(t){var e=this.node;return this.tween.seek(1e3*t),(e.getLayer()||e.getLayers()).draw(),this},pause:function(){return this.tween.pause(),this},finish:function(){var t=this.node;return this.tween.finish(),(t.getLayer()||t.getLayers()).draw(),this},destroy:function(){var t,e=this.node._id,i=this._id,n=Kinetic.Tween.tweens[e];this.pause();for(t in n)delete Kinetic.Tween.tweens[e][t];delete Kinetic.Tween.attrs[e][i]}};var r=function(t,e,i,n,a,r,s){this.prop=t,this.propFunc=e,this.begin=n,this._pos=n,this.duration=r,this._change=0,this.prevPos=0,this.yoyo=s,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=i,this._change=a-this.begin,this.pause()
};r.prototype={fire:function(t){var e=this[t];e&&e()},setTime:function(t){t>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():0>t?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=t,this.update())},getTime:function(){return this._time},setPosition:function(t){this.prevPos=this._pos,this.propFunc(t),this._pos=t},getPosition:function(t){return void 0===t&&(t=this._time),this.func(t,this.begin,this._change,this.duration)},play:function(){this.state=i,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")},reverse:function(){this.state=n,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")},seek:function(t){this.pause(),this._time=t,this.update(),this.fire("onSeek")},reset:function(){this.pause(),this._time=0,this.update(),this.fire("onReset")},finish:function(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")},update:function(){this.setPosition(this.getPosition(this._time))},onEnterFrame:function(){var t=this.getTimer()-this._startTime;this.state===i?this.setTime(t):this.state===n&&this.setTime(this.duration-t)},pause:function(){this.state=e,this.fire("onPause")},getTimer:function(){return(new Date).getTime()}},Kinetic.Easings={BackEaseIn:function(t,e,i,n){var a=1.70158;return i*(t/=n)*t*((a+1)*t-a)+e},BackEaseOut:function(t,e,i,n){var a=1.70158;return i*((t=t/n-1)*t*((a+1)*t+a)+1)+e},BackEaseInOut:function(t,e,i,n){var a=1.70158;return(t/=n/2)<1?i/2*t*t*(((a*=1.525)+1)*t-a)+e:i/2*((t-=2)*t*(((a*=1.525)+1)*t+a)+2)+e},ElasticEaseIn:function(t,e,i,n,a,r){var s=0;return 0===t?e:1==(t/=n)?e+i:(r||(r=.3*n),!a||a<Math.abs(i)?(a=i,s=r/4):s=r/(2*Math.PI)*Math.asin(i/a),-(a*Math.pow(2,10*(t-=1))*Math.sin(2*(t*n-s)*Math.PI/r))+e)},ElasticEaseOut:function(t,e,i,n,a,r){var s=0;return 0===t?e:1==(t/=n)?e+i:(r||(r=.3*n),!a||a<Math.abs(i)?(a=i,s=r/4):s=r/(2*Math.PI)*Math.asin(i/a),a*Math.pow(2,-10*t)*Math.sin(2*(t*n-s)*Math.PI/r)+i+e)},ElasticEaseInOut:function(t,e,i,n,a,r){var s=0;return 0===t?e:2==(t/=n/2)?e+i:(r||(r=.3*n*1.5),!a||a<Math.abs(i)?(a=i,s=r/4):s=r/(2*Math.PI)*Math.asin(i/a),1>t?-.5*a*Math.pow(2,10*(t-=1))*Math.sin(2*(t*n-s)*Math.PI/r)+e:.5*a*Math.pow(2,-10*(t-=1))*Math.sin(2*(t*n-s)*Math.PI/r)+i+e)},BounceEaseOut:function(t,e,i,n){return(t/=n)<1/2.75?7.5625*i*t*t+e:2/2.75>t?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},BounceEaseIn:function(t,e,i,n){return i-Kinetic.Easings.BounceEaseOut(n-t,0,i,n)+e},BounceEaseInOut:function(t,e,i,n){return n/2>t?.5*Kinetic.Easings.BounceEaseIn(2*t,0,i,n)+e:.5*Kinetic.Easings.BounceEaseOut(2*t-n,0,i,n)+.5*i+e},EaseIn:function(t,e,i,n){return i*(t/=n)*t+e},EaseOut:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},EaseInOut:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},StrongEaseIn:function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},StrongEaseOut:function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},StrongEaseInOut:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},Linear:function(t,e,i,n){return i*t/n+e}}}(),function(){Kinetic.DD={anim:new Kinetic.Animation,isDragging:!1,offset:{x:0,y:0},node:null,_drag:function(t){var e=Kinetic.DD,i=e.node;if(i){var n=i.getStage().getPointerPosition(),a=i.getDragBoundFunc(),r={x:n.x-e.offset.x,y:n.y-e.offset.y};void 0!==a&&(r=a.call(i,r,t)),i.setAbsolutePosition(r),e.isDragging||(e.isDragging=!0,i.fire("dragstart",t,!0)),i.fire("dragmove",t,!0)}},_endDragBefore:function(t){var e,i,n=Kinetic.DD,a=Kinetic.Global,r=n.node;r&&(e=r.nodeType,i=r.getLayer(),n.anim.stop(),n.isDragging&&(n.isDragging=!1,a.listenClickTap=!1,t&&(t.dragEndNode=r)),delete n.node,(i||r).draw())},_endDragAfter:function(t){t=t||{};var e=t.dragEndNode;t&&e&&e.fire("dragend",t,!0)}},Kinetic.Node.prototype.startDrag=function(){var t=Kinetic.DD,e=this.getStage(),i=this.getLayer(),n=e.getPointerPosition(),a=(this.getTransform().getTranslation(),this.getAbsolutePosition());n&&(t.node&&t.node.stopDrag(),t.node=this,t.offset.x=n.x-a.x,t.offset.y=n.y-a.y,t.anim.setLayers(i||this.getLayers()),t.anim.start())},Kinetic.Node.prototype.stopDrag=function(){var t=Kinetic.DD,e={};t._endDragBefore(e),t._endDragAfter(e)},Kinetic.Node.prototype.setDraggable=function(t){this._setAttr("draggable",t),this._dragChange()};var t=Kinetic.Node.prototype.destroy;Kinetic.Node.prototype.destroy=function(){var e=Kinetic.DD;e.node&&e.node._id===this._id&&this.stopDrag(),t.call(this)},Kinetic.Node.prototype.isDragging=function(){var t=Kinetic.DD;return t.node&&t.node._id===this._id&&t.isDragging},Kinetic.Node.prototype._listenDrag=function(){this._dragCleanup();var t=this;this.on("mousedown.kinetic touchstart.kinetic",function(e){Kinetic.DD.node||t.startDrag(e)})},Kinetic.Node.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var t=this.getStage(),e=Kinetic.DD;t&&e.node&&e.node._id===this._id&&e.node.stopDrag()}},Kinetic.Node.prototype._dragCleanup=function(){this.off("mousedown.kinetic"),this.off("touchstart.kinetic")},Kinetic.Node.addGetterSetter(Kinetic.Node,"dragBoundFunc"),Kinetic.Node.addGetter(Kinetic.Node,"draggable",!1),Kinetic.Node.prototype.isDraggable=Kinetic.Node.prototype.getDraggable;var e=document.getElementsByTagName("html")[0];e.addEventListener("mouseup",Kinetic.DD._endDragBefore,!0),e.addEventListener("touchend",Kinetic.DD._endDragBefore,!0),e.addEventListener("mouseup",Kinetic.DD._endDragAfter,!1),e.addEventListener("touchend",Kinetic.DD._endDragAfter,!1)}(),function(){Kinetic.Util.addMethods(Kinetic.Container,{__init:function(t){this.children=new Kinetic.Collection,Kinetic.Node.call(this,t)},getChildren:function(){return this.children},hasChildren:function(){return this.getChildren().length>0},removeChildren:function(){for(var t,e=this.children;e.length>0;)t=e[0],t.hasChildren()&&t.removeChildren(),t.remove();return this},destroyChildren:function(){for(var t=this.children;t.length>0;)t[0].destroy();return this},add:function(t){var e=(Kinetic.Global,this.children);return this._validateAdd(t),t.index=e.length,t.parent=this,e.push(t),this._fire("add",{child:t}),this},destroy:function(){this.hasChildren()&&this.destroyChildren(),Kinetic.Node.prototype.destroy.call(this)},get:function(t){var e,i,n,a,r,s,o,h=[],c=t.replace(/ /g,"").split(","),l=c.length;for(e=0;l>e;e++)if(n=c[e],"#"===n.charAt(0))r=this._getNodeById(n.slice(1)),r&&h.push(r);else if("."===n.charAt(0))a=this._getNodesByName(n.slice(1)),h=h.concat(a);else for(s=this.getChildren(),o=s.length,i=0;o>i;i++)h=h.concat(s[i]._get(n));return Kinetic.Collection.toCollection(h)},_getNodeById:function(t){var e=(this.getStage(),Kinetic.Global),i=e.ids[t];return void 0!==i&&this.isAncestorOf(i)?i:null},_getNodesByName:function(t){var e=Kinetic.Global,i=e.names[t]||[];return this._getDescendants(i)},_get:function(t){for(var e=Kinetic.Node.prototype._get.call(this,t),i=this.getChildren(),n=i.length,a=0;n>a;a++)e=e.concat(i[a]._get(t));return e},toObject:function(){var t=Kinetic.Node.prototype.toObject.call(this);t.children=[];for(var e=this.getChildren(),i=e.length,n=0;i>n;n++){var a=e[n];t.children.push(a.toObject())}return t},_getDescendants:function(t){for(var e=[],i=t.length,n=0;i>n;n++){var a=t[n];this.isAncestorOf(a)&&e.push(a)}return e},isAncestorOf:function(t){for(var e=t.getParent();e;){if(e._id===this._id)return!0;e=e.getParent()}return!1},clone:function(t){var e=Kinetic.Node.prototype.clone.call(this,t);return this.getChildren().each(function(t){e.add(t.clone())}),e},getAllIntersections:function(){for(var t=Kinetic.Util._getXY(Array.prototype.slice.call(arguments)),e=[],i=this.get("Shape"),n=i.length,a=0;n>a;a++){var r=i[a];r.isVisible()&&r.intersects(t)&&e.push(r)}return e},_setChildrenIndices:function(){for(var t=this.children,e=t.length,i=0;e>i;i++)t[i].index=i},drawScene:function(t){var e,i,n,a=this.getLayer(),r=!!this.getClipFunc();if(!t&&a&&(t=a.getCanvas()),this.isVisible()){for(r&&t._clip(this),e=this.children,n=e.length,i=0;n>i;i++)e[i].drawScene(t);r&&t.getContext().restore()}return this},drawHit:function(){var t,e=!!this.getClipFunc()&&"Stage"!==this.nodeType,i=0,n=0,a=[];if(this.shouldDrawHit()){for(e&&(t=this.getLayer().hitCanvas,t._clip(this)),a=this.children,n=a.length,i=0;n>i;i++)a[i].drawHit();e&&t.getContext().restore()}return this}}),Kinetic.Util.extend(Kinetic.Container,Kinetic.Node),Kinetic.Node.addGetterSetter(Kinetic.Container,"clipFunc")}(),function(){function t(t){t.fill()}function e(t){t.stroke()}function i(t){t.fill()}function n(t){t.stroke()}var a="beforeDraw",r="draw";Kinetic.Util.addMethods(Kinetic.Shape,{__init:function(a){this.nodeType="Shape",this._fillFunc=t,this._strokeFunc=e,this._fillFuncHit=i,this._strokeFuncHit=n;for(var r,s=Kinetic.Global.shapes;r=Kinetic.Util.getRandomColor(),!r||r in s;);this.colorKey=r,s[r]=this,Kinetic.Node.call(this,a),this._setDrawFuncs()},hasChildren:function(){return!1},getChildren:function(){return[]},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return 0!==this.getShadowOpacity()&&!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffsetX()||this.getShadowOffsetY())},hasFill:function(){return!!(this.getFill()||this.getFillPatternImage()||this.getFillLinearGradientColorStops()||this.getFillRadialGradientColorStops())},_get:function(t){return this.className===t||this.nodeType===t?[this]:[]},intersects:function(){var t=Kinetic.Util._getXY(Array.prototype.slice.call(arguments)),e=this.getStage(),i=e.hitCanvas;i.clear(),this.drawScene(i);var n=i.context.getImageData(0|t.x,0|t.y,1,1).data;return n[3]>0},enableFill:function(){return this._setAttr("fillEnabled",!0),this},disableFill:function(){return this._setAttr("fillEnabled",!1),this},enableStroke:function(){return this._setAttr("strokeEnabled",!0),this},disableStroke:function(){return this._setAttr("strokeEnabled",!1),this},enableStrokeScale:function(){return this._setAttr("strokeScaleEnabled",!0),this},disableStrokeScale:function(){return this._setAttr("strokeScaleEnabled",!1),this},enableShadow:function(){return this._setAttr("shadowEnabled",!0),this},disableShadow:function(){return this._setAttr("shadowEnabled",!1),this},enableDashArray:function(){return this._setAttr("dashArrayEnabled",!0),this},disableDashArray:function(){return this._setAttr("dashArrayEnabled",!1),this},destroy:function(){return Kinetic.Node.prototype.destroy.call(this),delete Kinetic.Global.shapes[this.colorKey],this},drawScene:function(t){t=t||this.getLayer().getCanvas();var e=this.getDrawFunc(),i=t.getContext();return e&&this.isVisible()&&(i.save(),t._applyOpacity(this),t._applyLineJoin(this),t._applyAncestorTransforms(this),this._fireBeforeDrawEvents(),e.call(this,t),this._fireDrawEvents(),i.restore()),this},_fireBeforeDrawEvents:function(){this._fireAndBubble(a,{node:this})},_fireDrawEvents:function(){this._fireAndBubble(r,{node:this})},drawHit:function(){var t=this.getAttrs(),e=t.drawHitFunc||t.drawFunc,i=this.getLayer().hitCanvas,n=i.getContext();return e&&this.shouldDrawHit()&&(n.save(),i._applyLineJoin(this),i._applyAncestorTransforms(this),e.call(this,i),n.restore()),this},_setDrawFuncs:function(){!this.attrs.drawFunc&&this.drawFunc&&this.setDrawFunc(this.drawFunc),!this.attrs.drawHitFunc&&this.drawHitFunc&&this.setDrawHitFunc(this.drawHitFunc)}}),Kinetic.Util.extend(Kinetic.Shape,Kinetic.Node),Kinetic.Node.addColorGetterSetter(Kinetic.Shape,"stroke"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"lineJoin"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"lineCap"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"strokeWidth"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"drawFunc"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"drawHitFunc"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"dashArray"),Kinetic.Node.addColorGetterSetter(Kinetic.Shape,"shadowColor"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"shadowBlur"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"shadowOpacity"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillPatternImage"),Kinetic.Node.addColorGetterSetter(Kinetic.Shape,"fill"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillPatternX"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillPatternY"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillLinearGradientColorStops"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartRadius"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndRadius"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillRadialGradientColorStops"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillPatternRepeat"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillEnabled",!0),Kinetic.Node.addGetterSetter(Kinetic.Shape,"strokeEnabled",!0),Kinetic.Node.addGetterSetter(Kinetic.Shape,"shadowEnabled",!0),Kinetic.Node.addGetterSetter(Kinetic.Shape,"dashArrayEnabled",!0),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillPriority","color"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"strokeScaleEnabled",!0),Kinetic.Node.addPointGetterSetter(Kinetic.Shape,"fillPatternOffset",0),Kinetic.Node.addPointGetterSetter(Kinetic.Shape,"fillPatternScale",1),Kinetic.Node.addPointGetterSetter(Kinetic.Shape,"fillLinearGradientStartPoint",0),Kinetic.Node.addPointGetterSetter(Kinetic.Shape,"fillLinearGradientEndPoint",0),Kinetic.Node.addPointGetterSetter(Kinetic.Shape,"fillRadialGradientStartPoint",0),Kinetic.Node.addPointGetterSetter(Kinetic.Shape,"fillRadialGradientEndPoint",0),Kinetic.Node.addPointGetterSetter(Kinetic.Shape,"shadowOffset",0),Kinetic.Node.addRotationGetterSetter(Kinetic.Shape,"fillPatternRotation",0)}(),function(){function t(t,e){t.content.addEventListener(e,function(i){t[C+e](i)},!1)}var e="Stage",i="string",n="px",a="mouseout",r="mouseleave",s="mouseover",o="mouseenter",h="mousemove",c="mousedown",l="mouseup",d="click",u="dblclick",g="touchstart",f="touchend",p="tap",v="dbltap",m="touchmove",K="div",_="relative",y="inline-block",S="kineticjs-content",x=" ",C="_",w="container",b="",P=[c,h,l,a,g,m,f,s],T=P.length;Kinetic.Util.addMethods(Kinetic.Stage,{___init:function(t){Kinetic.Container.call(this,t),this.nodeType=e,this._id=Kinetic.Global.idCounter++,this._buildDOM(),this._bindContentEvents(),Kinetic.Global.stages.push(this)},_validateAdd:function(t){"Layer"!==t.getType()&&Kinetic.Util.error("You may only add layers to the stage.")},setContainer:function(t){return typeof t===i&&(t=document.getElementById(t)),this._setAttr(w,t),this},draw:function(){return Kinetic.Node.prototype.draw.call(this),this},setHeight:function(t){return Kinetic.Node.prototype.setHeight.call(this,t),this._resizeDOM(),this},setWidth:function(t){return Kinetic.Node.prototype.setWidth.call(this,t),this._resizeDOM(),this},clear:function(){var t,e=this.children,i=e.length;for(t=0;i>t;t++)e[t].clear();return this},destroy:function(){var t=this.content;Kinetic.Container.prototype.destroy.call(this),t&&Kinetic.Util._isInDocument(t)&&this.getContainer().removeChild(t)},getMousePosition:function(){return this.mousePos},getTouchPosition:function(){return this.touchPos},getPointerPosition:function(){return this.getTouchPosition()||this.getMousePosition()},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(t){function e(a){var r=h[a],c=r.toDataURL(),l=new Image;l.onload=function(){o.drawImage(l,0,0),a<h.length-1?e(a+1):t.callback(s.toDataURL(i,n))},l.src=c}t=t||{};var i=t.mimeType||null,n=t.quality||null,a=t.x||0,r=t.y||0,s=new Kinetic.SceneCanvas({width:t.width||this.getWidth(),height:t.height||this.getHeight(),pixelRatio:1}),o=s.getContext(),h=this.children;(a||r)&&o.translate(-1*a,-1*r),e(0)},toImage:function(t){var e=t.callback;t.callback=function(t){Kinetic.Util._getImage(t,function(t){e(t)})},this.toDataURL(t)},getIntersection:function(){var t,e,i=Kinetic.Util._getXY(Array.prototype.slice.call(arguments)),n=this.getChildren(),a=n.length,r=a-1;for(t=r;t>=0;t--)if(e=n[t].getIntersection(i))return e;return null},_resizeDOM:function(){if(this.content){var t,e,i=this.getWidth(),a=this.getHeight(),r=this.getChildren(),s=r.length;for(this.content.style.width=i+n,this.content.style.height=a+n,this.bufferCanvas.setSize(i,a,1),this.hitCanvas.setSize(i,a),t=0;s>t;t++)e=r[t],e.getCanvas().setSize(i,a),e.hitCanvas.setSize(i,a),e.draw()}},add:function(t){return Kinetic.Container.prototype.add.call(this,t),t.canvas.setSize(this.attrs.width,this.attrs.height),t.hitCanvas.setSize(this.attrs.width,this.attrs.height),t.draw(),this.content.appendChild(t.canvas.element),this},getParent:function(){return null},getLayer:function(){return null},getLayers:function(){return this.getChildren()},_setPointerPosition:function(t){t||(t=window.event),this._setMousePosition(t),this._setTouchPosition(t)},_bindContentEvents:function(){var e;for(e=0;T>e;e++)t(this,P[e])},_mouseover:function(t){this._fire(s,t)},_mouseout:function(t){this._setPointerPosition(t);var e=Kinetic.Global,i=this.targetShape;i&&!e.isDragging()&&(i._fireAndBubble(a,t),i._fireAndBubble(r,t),this.targetShape=null),this.mousePos=void 0,this._fire(a,t)},_mousemove:function(t){this._setPointerPosition(t);var e,i=Kinetic.Global,n=Kinetic.DD,c=this.getIntersection(this.getPointerPosition());c?(e=c.shape,e&&(i.isDragging()||255!==c.pixel[3]||this.targetShape&&this.targetShape._id===e._id?e._fireAndBubble(h,t):(e._fireAndBubble(s,t,this.targetShape),e._fireAndBubble(o,t,this.targetShape),this.targetShape&&(this.targetShape._fireAndBubble(a,t,e),this.targetShape._fireAndBubble(r,t,e)),this.targetShape=e))):(this._fire(h,t),this.targetShape&&!i.isDragging()&&(this.targetShape._fireAndBubble(a,t),this.targetShape._fireAndBubble(r,t),this.targetShape=null)),n&&n._drag(t),t.preventDefault&&t.preventDefault()},_mousedown:function(t){this._setPointerPosition(t);var e=Kinetic.Global,i=this.getIntersection(this.getPointerPosition()),n=i&&i.shape?i.shape:this;e.listenClickTap=!0,this.clickStartShape=n,n._fireAndBubble(c,t),t.preventDefault&&t.preventDefault()},_mouseup:function(t){this._setPointerPosition(t);var e=Kinetic.Global,i=this.getIntersection(this.getPointerPosition()),n=i&&i.shape?i.shape:this;n._fireAndBubble(l,t),e.listenClickTap&&n._id===this.clickStartShape._id&&(n._fireAndBubble(d,t),e.inDblClickWindow?(n._fireAndBubble(u,t),e.inDblClickWindow=!1):e.inDblClickWindow=!0,setTimeout(function(){e.inDblClickWindow=!1},e.dblClickWindow)),e.listenClickTap=!1,t.preventDefault&&t.preventDefault()},_touchstart:function(t){this._setPointerPosition(t);var e=Kinetic.Global,i=this.getIntersection(this.getPointerPosition()),n=i&&i.shape?i.shape:this;e.listenClickTap=!0,this.tapStartShape=n,n._fireAndBubble(g,t),n.isListening()&&t.preventDefault&&t.preventDefault()},_touchend:function(t){this._setPointerPosition(t);var e=Kinetic.Global,i=this.getIntersection(this.getPointerPosition()),n=i&&i.shape?i.shape:this;n._fireAndBubble(f,t),e.listenClickTap&&n._id===this.tapStartShape._id&&(n._fireAndBubble(p,t),e.inDblClickWindow?(n._fireAndBubble(v,t),e.inDblClickWindow=!1):e.inDblClickWindow=!0,setTimeout(function(){e.inDblClickWindow=!1},e.dblClickWindow)),e.listenClickTap=!1,n.isListening()&&t.preventDefault&&t.preventDefault()},_touchmove:function(t){this._setPointerPosition(t);var e=Kinetic.DD,i=this.getIntersection(this.getPointerPosition()),n=i&&i.shape?i.shape:this;n._fireAndBubble(m,t),e&&e._drag(t),n.isListening()&&t.preventDefault&&t.preventDefault()},_setMousePosition:function(t){var e=t.clientX-this._getContentPosition().left,i=t.clientY-this._getContentPosition().top;this.mousePos={x:e,y:i}},_setTouchPosition:function(t){var e,i,n;void 0!==t.touches&&1===t.touches.length&&(e=t.touches[0],i=e.clientX-this._getContentPosition().left,n=e.clientY-this._getContentPosition().top,this.touchPos={x:i,y:n})},_getContentPosition:function(){var t=this.content.getBoundingClientRect();return{top:t.top,left:t.left}},_buildDOM:function(){var t=this.getContainer();t.innerHTML=b,this.content=document.createElement(K),this.content.style.position=_,this.content.style.display=y,this.content.className=S,t.appendChild(this.content),this.bufferCanvas=new Kinetic.SceneCanvas,this.hitCanvas=new Kinetic.HitCanvas,this._resizeDOM()},_onContent:function(t,e){var i,n,a=t.split(x),r=a.length;for(i=0;r>i;i++)n=a[i],this.content.addEventListener(n,e,!1)}}),Kinetic.Util.extend(Kinetic.Stage,Kinetic.Container),Kinetic.Node.addGetter(Kinetic.Stage,"container")}(),function(){var t="#";Kinetic.Util.addMethods(Kinetic.Layer,{___init:function(t){this.nodeType="Layer",this.canvas=new Kinetic.SceneCanvas,this.hitCanvas=new Kinetic.HitCanvas,Kinetic.Container.call(this,t)},_validateAdd:function(t){var e=t.getType();"Group"!==e&&"Shape"!==e&&Kinetic.Util.error("You may only add groups and shapes to a layer.")},getIntersection:function(){var e,i,n,a=Kinetic.Util._getXY(Array.prototype.slice.call(arguments));if(this.isVisible()&&this.isListening()){if(e=this.hitCanvas.context.getImageData(0|a.x,0|a.y,1,1).data,255===e[3])return i=Kinetic.Util._rgbToHex(e[0],e[1],e[2]),n=Kinetic.Global.shapes[t+i],{shape:n,pixel:e};if(e[0]>0||e[1]>0||e[2]>0||e[3]>0)return{pixel:e}}return null},drawScene:function(t){return t=t||this.getCanvas(),this.getClearBeforeDraw()&&t.clear(),Kinetic.Container.prototype.drawScene.call(this,t),this},drawHit:function(){var t=this.getLayer();return t&&t.getClearBeforeDraw()&&t.getHitCanvas().clear(),Kinetic.Container.prototype.drawHit.call(this),this},getCanvas:function(){return this.canvas},getHitCanvas:function(){return this.hitCanvas},getContext:function(){return this.getCanvas().getContext()},clear:function(){return this.getCanvas().clear(),this},setVisible:function(t){return Kinetic.Node.prototype.setVisible.call(this,t),t?(this.getCanvas().element.style.display="block",this.hitCanvas.element.style.display="block"):(this.getCanvas().element.style.display="none",this.hitCanvas.element.style.display="none"),this},setZIndex:function(t){Kinetic.Node.prototype.setZIndex.call(this,t);var e=this.getStage();return e&&(e.content.removeChild(this.getCanvas().element),t<e.getChildren().length-1?e.content.insertBefore(this.getCanvas().element,e.getChildren()[t+1].getCanvas().element):e.content.appendChild(this.getCanvas().element)),this},moveToTop:function(){Kinetic.Node.prototype.moveToTop.call(this);var t=this.getStage();t&&(t.content.removeChild(this.getCanvas().element),t.content.appendChild(this.getCanvas().element))},moveUp:function(){if(Kinetic.Node.prototype.moveUp.call(this)){var t=this.getStage();t&&(t.content.removeChild(this.getCanvas().element),this.index<t.getChildren().length-1?t.content.insertBefore(this.getCanvas().element,t.getChildren()[this.index+1].getCanvas().element):t.content.appendChild(this.getCanvas().element))}},moveDown:function(){if(Kinetic.Node.prototype.moveDown.call(this)){var t=this.getStage();if(t){var e=t.getChildren();t.content.removeChild(this.getCanvas().element),t.content.insertBefore(this.getCanvas().element,e[this.index+1].getCanvas().element)}}},moveToBottom:function(){if(Kinetic.Node.prototype.moveToBottom.call(this)){var t=this.getStage();if(t){var e=t.getChildren();t.content.removeChild(this.getCanvas().element),t.content.insertBefore(this.getCanvas().element,e[1].getCanvas().element)}}},getLayer:function(){return this},remove:function(){var t=this.getStage(),e=this.getCanvas(),i=e.element;return Kinetic.Node.prototype.remove.call(this),t&&e&&Kinetic.Util._isInDocument(i)&&t.content.removeChild(i),this}}),Kinetic.Util.extend(Kinetic.Layer,Kinetic.Container),Kinetic.Node.addGetterSetter(Kinetic.Layer,"clearBeforeDraw",!0)}(),function(){Kinetic.Util.addMethods(Kinetic.Group,{___init:function(t){this.nodeType="Group",Kinetic.Container.call(this,t)},_validateAdd:function(t){var e=t.getType();"Group"!==e&&"Shape"!==e&&Kinetic.Util.error("You may only add groups and shapes to groups.")}}),Kinetic.Util.extend(Kinetic.Group,Kinetic.Container)}(),function(){Kinetic.Rect=function(t){this.___init(t)},Kinetic.Rect.prototype={___init:function(t){Kinetic.Shape.call(this,t),this.className="Rect"},drawFunc:function(t){var e=t.getContext(),i=this.getCornerRadius(),n=this.getWidth(),a=this.getHeight();e.beginPath(),i?(e.moveTo(i,0),e.lineTo(n-i,0),e.arc(n-i,i,i,3*Math.PI/2,0,!1),e.lineTo(n,a-i),e.arc(n-i,a-i,i,0,Math.PI/2,!1),e.lineTo(i,a),e.arc(i,a-i,i,Math.PI/2,Math.PI,!1),e.lineTo(0,i),e.arc(i,i,i,Math.PI,3*Math.PI/2,!1)):e.rect(0,0,n,a),e.closePath(),t.fillStroke(this)}},Kinetic.Util.extend(Kinetic.Rect,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.Rect,"cornerRadius",0)}(),function(){var t=2*Math.PI-1e-4,e="Circle";Kinetic.Circle=function(t){this.___init(t)},Kinetic.Circle.prototype={___init:function(t){Kinetic.Shape.call(this,t),this.className=e},drawFunc:function(e){var i=e.getContext();i.beginPath(),i.arc(0,0,this.getRadius(),0,t,!1),i.closePath(),e.fillStroke(this)},getWidth:function(){return 2*this.getRadius()},getHeight:function(){return 2*this.getRadius()},setWidth:function(t){Kinetic.Node.prototype.setWidth.call(this,t),this.setRadius(t/2)},setHeight:function(t){Kinetic.Node.prototype.setHeight.call(this,t),this.setRadius(t/2)}},Kinetic.Util.extend(Kinetic.Circle,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.Circle,"radius",0)}(),function(){var t=2*Math.PI-1e-4,e="Ellipse";Kinetic.Ellipse=function(t){this.___init(t)},Kinetic.Ellipse.prototype={___init:function(t){Kinetic.Shape.call(this,t),this.className=e},drawFunc:function(e){var i=e.getContext(),n=this.getRadius();i.beginPath(),i.save(),n.x!==n.y&&i.scale(1,n.y/n.x),i.arc(0,0,n.x,0,t,!1),i.restore(),i.closePath(),e.fillStroke(this)},getWidth:function(){return 2*this.getRadius().x},getHeight:function(){return 2*this.getRadius().y},setWidth:function(t){Kinetic.Node.prototype.setWidth.call(this,t),this.setRadius({x:t/2})},setHeight:function(t){Kinetic.Node.prototype.setHeight.call(this,t),this.setRadius({y:t/2})}},Kinetic.Util.extend(Kinetic.Ellipse,Kinetic.Shape),Kinetic.Node.addPointGetterSetter(Kinetic.Ellipse,"radius",0)}(),function(){Kinetic.Wedge=function(t){this.___init(t)},Kinetic.Wedge.prototype={___init:function(t){Kinetic.Shape.call(this,t),this.className="Wedge"},drawFunc:function(t){var e=t.getContext();e.beginPath(),e.arc(0,0,this.getRadius(),0,this.getAngle(),this.getClockwise()),e.lineTo(0,0),e.closePath(),t.fillStroke(this)}},Kinetic.Util.extend(Kinetic.Wedge,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.Wedge,"radius",0),Kinetic.Node.addRotationGetterSetter(Kinetic.Wedge,"angle",0),Kinetic.Node.addGetterSetter(Kinetic.Wedge,"clockwise",!1)}(),function(){var t="Image",e="crop",i="set";Kinetic.Image=function(t){this.___init(t)},Kinetic.Image.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className=t},drawFunc:function(t){var e,i,n,a,r,s,o=this.getWidth(),h=this.getHeight(),c=this,l=t.getContext(),d=this.getCrop();this.getFilter()&&this._applyFilter&&(this.applyFilter(),this._applyFilter=!1),s=this.filterCanvas?this.filterCanvas.getElement():this.getImage(),l.beginPath(),l.rect(0,0,o,h),l.closePath(),t.fillStroke(this),s&&(d?(i=d.x||0,n=d.y||0,a=d.width||0,r=d.height||0,e=[s,i,n,a,r,0,0,o,h]):e=[s,0,0,o,h],this.hasShadow()?t.applyShadow(this,function(){c._drawImage(l,e)}):this._drawImage(l,e))},drawHitFunc:function(t){var e=this.getWidth(),i=this.getHeight(),n=this.imageHitRegion,a=t.getContext();n?(a.drawImage(n,0,0,e,i),a.beginPath(),a.rect(0,0,e,i),a.closePath(),t.stroke(this)):(a.beginPath(),a.rect(0,0,e,i),a.closePath(),t.fillStroke(this))},applyFilter:function(){var t,e,i,n=this.getImage(),a=this.getWidth(),r=this.getHeight(),s=this.getFilter();t=this.filterCanvas?this.filterCanvas:this.filterCanvas=new Kinetic.SceneCanvas({width:a,height:r}),e=t.getContext();try{this._drawImage(e,[n,0,0,a,r]),i=e.getImageData(0,0,t.getWidth(),t.getHeight()),s.call(this,i),e.putImageData(i,0,0)}catch(o){this.clearFilter(),Kinetic.Util.warn("Unable to apply filter. "+o.message)}},clearFilter:function(){this.filterCanvas=null,this._applyFilter=!1},setCrop:function(){var t=[].slice.call(arguments),i=Kinetic.Util._getXY(t),n=Kinetic.Util._getSize(t),a=Kinetic.Util._merge(i,n);this._setAttr(e,Kinetic.Util._merge(a,this.getCrop()))},createImageHitRegion:function(t){var e,i,n,a,r,s=this,o=this.getWidth(),h=this.getHeight(),c=new Kinetic.Canvas({width:o,height:h}),l=c.getContext(),d=this.getImage();l.drawImage(d,0,0);try{for(e=l.getImageData(0,0,o,h),i=e.data,n=Kinetic.Util._hexToRgb(this.colorKey),a=0,r=i.length;r>a;a+=4)i[a+3]>0&&(i[a]=n.r,i[a+1]=n.g,i[a+2]=n.b);Kinetic.Util._getImage(e,function(e){s.imageHitRegion=e,t&&t()})}catch(u){Kinetic.Util.warn("Unable to create image hit region. "+u.message)}},clearImageHitRegion:function(){delete this.imageHitRegion},getWidth:function(){var t=this.getImage();return this.attrs.width||(t?t.width:0)},getHeight:function(){var t=this.getImage();return this.attrs.height||(t?t.height:0)},_drawImage:function(t,e){5===e.length?t.drawImage(e[0],e[1],e[2],e[3],e[4]):9===e.length&&t.drawImage(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}},Kinetic.Util.extend(Kinetic.Image,Kinetic.Shape),Kinetic.Node.addFilterGetterSetter=function(t,e,i){this.addGetter(t,e,i),this.addFilterSetter(t,e)},Kinetic.Node.addFilterSetter=function(t,e){var n=i+Kinetic.Util._capitalize(e);t.prototype[n]=function(t){this._setAttr(e,t),this._applyFilter=!0}},Kinetic.Node.addGetterSetter(Kinetic.Image,"image"),Kinetic.Node.addGetter(Kinetic.Image,"crop"),Kinetic.Node.addFilterGetterSetter(Kinetic.Image,"filter")}(),function(){Kinetic.Polygon=function(t){this.___init(t)},Kinetic.Polygon.prototype={___init:function(t){Kinetic.Shape.call(this,t),this.className="Polygon"},drawFunc:function(t){var e=t.getContext(),i=this.getPoints(),n=i.length;e.beginPath(),e.moveTo(i[0].x,i[0].y);for(var a=1;n>a;a++)e.lineTo(i[a].x,i[a].y);e.closePath(),t.fillStroke(this)}},Kinetic.Util.extend(Kinetic.Polygon,Kinetic.Shape),Kinetic.Node.addPointsGetterSetter(Kinetic.Polygon,"points")}(),function(){function t(t){t.fillText(this.partialText,0,0)}function e(t){t.strokeText(this.partialText,0,0)}var i="auto",n="Calibri",a="canvas",r="center",s="Change.kinetic",o="2d",h="-",c="",l="left",d="text",u="Text",g="middle",f="normal",p="px ",v=" ",m="right",K="word",_="char",y="none",S=["fontFamily","fontSize","fontStyle","padding","align","lineHeight","text","width","height","wrap"],x=S.length,C=document.createElement(a).getContext(o);Kinetic.Text=function(t){this.___init(t)},Kinetic.Text.prototype={___init:function(n){var a=this;void 0===n.width&&(n.width=i),void 0===n.height&&(n.height=i),Kinetic.Shape.call(this,n),this._fillFunc=t,this._strokeFunc=e,this.className=u;for(var r=0;x>r;r++)this.on(S[r]+s,a._setTextData);this._setTextData()},drawFunc:function(t){var e=t.getContext(),i=this.getPadding(),n=(this.getFontStyle(),this.getFontSize(),this.getFontFamily(),this.getTextHeight()),a=this.getLineHeight()*n,s=this.textArr,o=s.length,h=this.getWidth();e.font=this._getContextFont(),e.textBaseline=g,e.textAlign=l,e.save(),e.translate(i,0),e.translate(0,i+n/2);for(var c=0;o>c;c++){var d=s[c],u=d.text,f=d.width;e.save(),this.getAlign()===m?e.translate(h-f-2*i,0):this.getAlign()===r&&e.translate((h-f-2*i)/2,0),this.partialText=u,t.fillStroke(this),e.restore(),e.translate(0,a)}e.restore()},drawHitFunc:function(t){var e=t.getContext(),i=this.getWidth(),n=this.getHeight();e.beginPath(),e.rect(0,0,i,n),e.closePath(),t.fillStroke(this)},setText:function(t){var e=Kinetic.Util._isString(t)?t:t.toString();this._setAttr(d,e)},getWidth:function(){return this.attrs.width===i?this.getTextWidth()+2*this.getPadding():this.attrs.width},getHeight:function(){return this.attrs.height===i?this.getTextHeight()*this.textArr.length*this.getLineHeight()+2*this.getPadding():this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(t){var e,i=C,n=this.getFontSize();return i.save(),i.font=this._getContextFont(),e=i.measureText(t),i.restore(),{width:e.width,height:parseInt(n,10)}
},_getContextFont:function(){return this.getFontStyle()+v+this.getFontSize()+p+this.getFontFamily()},_addTextLine:function(t,e){return this.textArr.push({text:t,width:e})},_getTextWidth:function(t){return C.measureText(t).width},_setTextData:function(){var t=this.getText().split("\n"),e=+this.getFontSize(),n=0,a=this.getLineHeight()*e,r=this.attrs.width,s=this.attrs.height,o=r!==i,c=s!==i,l=this.getPadding(),d=r-2*l,u=s-2*l,g=0,f=this.getWrap(),m=f!==y,K=f!==_&&m;this.textArr=[],C.save(),C.font=this.getFontStyle()+v+e+p+this.getFontFamily();for(var S=0,x=t.length;x>S;++S){var w=t[S],b=this._getTextWidth(w);if(o&&b>d)for(;w.length>0;){for(var P=0,T=w.length,N="",A=0;T>P;){var D=P+T>>>1,L=w.slice(0,D+1),G=this._getTextWidth(L);d>=G?(P=D+1,N=L,A=G):T=D}if(!N)break;if(K){var F=Math.max(N.lastIndexOf(v),N.lastIndexOf(h))+1;F>0&&(P=F,N=N.slice(0,P),A=this._getTextWidth(N))}if(this._addTextLine(N,A),g+=a,!m||c&&g+a>u)break;if(w=w.slice(P),w.length>0&&(b=this._getTextWidth(w),d>=b)){this._addTextLine(w,b),g+=a;break}}else this._addTextLine(w,b),g+=a,n=Math.max(n,b);if(c&&g+a>u)break}C.restore(),this.textHeight=e,this.textWidth=n}},Kinetic.Util.extend(Kinetic.Text,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.Text,"fontFamily",n),Kinetic.Node.addGetterSetter(Kinetic.Text,"fontSize",12),Kinetic.Node.addGetterSetter(Kinetic.Text,"fontStyle",f),Kinetic.Node.addGetterSetter(Kinetic.Text,"padding",0),Kinetic.Node.addGetterSetter(Kinetic.Text,"align",l),Kinetic.Node.addGetterSetter(Kinetic.Text,"lineHeight",1),Kinetic.Node.addGetterSetter(Kinetic.Text,"wrap",K),Kinetic.Node.addGetter(Kinetic.Text,d,c),Kinetic.Node.addSetter(Kinetic.Text,"width"),Kinetic.Node.addSetter(Kinetic.Text,"height")}(),function(){Kinetic.Line=function(t){this.___init(t)},Kinetic.Line.prototype={___init:function(t){Kinetic.Shape.call(this,t),this.className="Line"},drawFunc:function(t){var e,i,n=this.getPoints(),a=n.length,r=t.getContext();for(r.beginPath(),r.moveTo(n[0].x,n[0].y),e=1;a>e;e++)i=n[e],r.lineTo(i.x,i.y);t.stroke(this)}},Kinetic.Util.extend(Kinetic.Line,Kinetic.Shape),Kinetic.Node.addPointsGetterSetter(Kinetic.Line,"points")}(),function(){Kinetic.Spline=function(t){this.___init(t)},Kinetic.Spline.prototype={___init:function(t){var e=this;Kinetic.Shape.call(this,t),this.className="Spline",this.on("pointsChange.kinetic tensionChange.kinetic",function(){e._setAllPoints()}),this._setAllPoints()},drawFunc:function(t){var e,i,n,a,r=this.getPoints(),s=r.length,o=t.getContext(),h=this.getTension();if(o.beginPath(),o.moveTo(r[0].x,r[0].y),0!==h&&s>2){for(e=this.allPoints,i=e.length,n=2,o.quadraticCurveTo(e[0].x,e[0].y,e[1].x,e[1].y);i-1>n;)o.bezierCurveTo(e[n].x,e[n++].y,e[n].x,e[n++].y,e[n].x,e[n++].y);o.quadraticCurveTo(e[i-1].x,e[i-1].y,r[s-1].x,r[s-1].y)}else for(n=1;s>n;n++)a=r[n],o.lineTo(a.x,a.y);t.stroke(this)},_setAllPoints:function(){this.allPoints=Kinetic.Util._expandPoints(this.getPoints(),this.getTension())}},Kinetic.Util.extend(Kinetic.Spline,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.Spline,"tension",1),Kinetic.Node.addPointsGetterSetter(Kinetic.Spline,"points")}(),function(){Kinetic.Blob=function(t){this.___init(t)},Kinetic.Blob.prototype={___init:function(t){var e=this;Kinetic.Shape.call(this,t),this.className="Blob",this.on("pointsChange.kinetic tensionChange.kinetic",function(){e._setAllPoints()}),this._setAllPoints()},drawFunc:function(t){var e,i,n,a,r=this.getPoints(),s=r.length,o=t.getContext(),h=this.getTension();if(o.beginPath(),o.moveTo(r[0].x,r[0].y),0!==h&&s>2)for(e=this.allPoints,i=e.length,n=0;i-1>n;)o.bezierCurveTo(e[n].x,e[n++].y,e[n].x,e[n++].y,e[n].x,e[n++].y);else for(n=1;s>n;n++)a=r[n],o.lineTo(a.x,a.y);o.closePath(),t.fillStroke(this)},_setAllPoints:function(){var t=this.getPoints(),e=t.length,i=this.getTension(),n=Kinetic.Util,a=n._getControlPoints(t[e-1],t[0],t[1],i),r=n._getControlPoints(t[e-2],t[e-1],t[0],i);this.allPoints=Kinetic.Util._expandPoints(this.getPoints(),this.getTension()),this.allPoints.unshift(a[1]),this.allPoints.push(r[0]),this.allPoints.push(t[e-1]),this.allPoints.push(r[1]),this.allPoints.push(a[0]),this.allPoints.push(t[0])}},Kinetic.Util.extend(Kinetic.Blob,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.Blob,"tension",1),Kinetic.Node.addPointsGetterSetter(Kinetic.Blob,"points")}(),function(){Kinetic.Sprite=function(t){this.___init(t)},Kinetic.Sprite.prototype={___init:function(t){Kinetic.Shape.call(this,t),this.className="Sprite",this.anim=new Kinetic.Animation;var e=this;this.on("animationChange.kinetic",function(){e.setIndex(0)})},drawFunc:function(t){var e=this.getAnimation(),i=this.getIndex(),n=this.getAnimations()[e][i],a=t.getContext(),r=this.getImage();r&&a.drawImage(r,n.x,n.y,n.width,n.height,0,0,n.width,n.height)},drawHitFunc:function(t){var e=this.getAnimation(),i=this.getIndex(),n=this.getAnimations()[e][i],a=t.getContext();a.beginPath(),a.rect(0,0,n.width,n.height),a.closePath(),t.fill(this)},start:function(){var t=this,e=this.getLayer();this.anim.setLayers(e),this.interval=setInterval(function(){var e=t.getIndex();t._updateIndex(),t.afterFrameFunc&&e===t.afterFrameIndex&&(t.afterFrameFunc(),delete t.afterFrameFunc,delete t.afterFrameIndex)},1e3/this.getFrameRate()),this.anim.start()},stop:function(){this.anim.stop(),clearInterval(this.interval)},afterFrame:function(t,e){this.afterFrameIndex=t,this.afterFrameFunc=e},_updateIndex:function(){var t=this.getIndex(),e=this.getAnimation(),i=this.getAnimations(),n=i[e],a=n.length;this.setIndex(a-1>t?t+1:0)}},Kinetic.Util.extend(Kinetic.Sprite,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.Sprite,"animation"),Kinetic.Node.addGetterSetter(Kinetic.Sprite,"animations"),Kinetic.Node.addGetterSetter(Kinetic.Sprite,"image"),Kinetic.Node.addGetterSetter(Kinetic.Sprite,"index",0),Kinetic.Node.addGetterSetter(Kinetic.Sprite,"frameRate",17)}(),function(){Kinetic.Path=function(t){this.___init(t)},Kinetic.Path.prototype={___init:function(t){this.dataArray=[];var e=this;Kinetic.Shape.call(this,t),this.className="Path",this.dataArray=Kinetic.Path.parsePathData(this.getData()),this.on("dataChange.kinetic",function(){e.dataArray=Kinetic.Path.parsePathData(this.getData())})},drawFunc:function(t){var e=this.dataArray,i=t.getContext();i.beginPath();for(var n=0;n<e.length;n++){var a=e[n].command,r=e[n].points;switch(a){case"L":i.lineTo(r[0],r[1]);break;case"M":i.moveTo(r[0],r[1]);break;case"C":i.bezierCurveTo(r[0],r[1],r[2],r[3],r[4],r[5]);break;case"Q":i.quadraticCurveTo(r[0],r[1],r[2],r[3]);break;case"A":var s=r[0],o=r[1],h=r[2],c=r[3],l=r[4],d=r[5],u=r[6],g=r[7],f=h>c?h:c,p=h>c?1:h/c,v=h>c?c/h:1;i.translate(s,o),i.rotate(u),i.scale(p,v),i.arc(0,0,f,l,l+d,1-g),i.scale(1/p,1/v),i.rotate(-u),i.translate(-s,-o);break;case"z":i.closePath()}}t.fillStroke(this)}},Kinetic.Util.extend(Kinetic.Path,Kinetic.Shape),Kinetic.Path.getLineLength=function(t,e,i,n){return Math.sqrt((i-t)*(i-t)+(n-e)*(n-e))},Kinetic.Path.getPointOnLine=function(t,e,i,n,a,r,s){void 0===r&&(r=e),void 0===s&&(s=i);var o=(a-i)/(n-e+1e-8),h=Math.sqrt(t*t/(1+o*o));e>n&&(h*=-1);var c,l=o*h;if((s-i)/(r-e+1e-8)===o)c={x:r+h,y:s+l};else{var d,u,g=this.getLineLength(e,i,n,a);if(1e-8>g)return void 0;var f=(r-e)*(n-e)+(s-i)*(a-i);f/=g*g,d=e+f*(n-e),u=i+f*(a-i);var p=this.getLineLength(r,s,d,u),v=Math.sqrt(t*t-p*p);h=Math.sqrt(v*v/(1+o*o)),e>n&&(h*=-1),l=o*h,c={x:d+h,y:u+l}}return c},Kinetic.Path.getPointOnCubicBezier=function(t,e,i,n,a,r,s,o,h){function c(t){return t*t*t}function l(t){return 3*t*t*(1-t)}function d(t){return 3*t*(1-t)*(1-t)}function u(t){return(1-t)*(1-t)*(1-t)}var g=o*c(t)+r*l(t)+n*d(t)+e*u(t),f=h*c(t)+s*l(t)+a*d(t)+i*u(t);return{x:g,y:f}},Kinetic.Path.getPointOnQuadraticBezier=function(t,e,i,n,a,r,s){function o(t){return t*t}function h(t){return 2*t*(1-t)}function c(t){return(1-t)*(1-t)}var l=r*o(t)+n*h(t)+e*c(t),d=s*o(t)+a*h(t)+i*c(t);return{x:l,y:d}},Kinetic.Path.getPointOnEllipticalArc=function(t,e,i,n,a,r){var s=Math.cos(r),o=Math.sin(r),h={x:i*Math.cos(a),y:n*Math.sin(a)};return{x:t+(h.x*s-h.y*o),y:e+(h.x*o+h.y*s)}},Kinetic.Path.parsePathData=function(t){if(!t)return[];var e=t,i=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];e=e.replace(new RegExp(" ","g"),",");for(var n=0;n<i.length;n++)e=e.replace(new RegExp(i[n],"g"),"|"+i[n]);var a=e.split("|"),r=[],s=0,o=0;for(n=1;n<a.length;n++){var h=a[n],c=h.charAt(0);h=h.slice(1),h=h.replace(new RegExp(",-","g"),"-"),h=h.replace(new RegExp("-","g"),",-"),h=h.replace(new RegExp("e,-","g"),"e-");var l=h.split(",");l.length>0&&""===l[0]&&l.shift();for(var d=0;d<l.length;d++)l[d]=parseFloat(l[d]);for(;l.length>0&&!isNaN(l[0]);){var u,g,f,p,v,m,K,_,y,S,x=null,C=[],w=s,b=o;switch(c){case"l":s+=l.shift(),o+=l.shift(),x="L",C.push(s,o);break;case"L":s=l.shift(),o=l.shift(),C.push(s,o);break;case"m":s+=l.shift(),o+=l.shift(),x="M",C.push(s,o),c="l";break;case"M":s=l.shift(),o=l.shift(),x="M",C.push(s,o),c="L";break;case"h":s+=l.shift(),x="L",C.push(s,o);break;case"H":s=l.shift(),x="L",C.push(s,o);break;case"v":o+=l.shift(),x="L",C.push(s,o);break;case"V":o=l.shift(),x="L",C.push(s,o);break;case"C":C.push(l.shift(),l.shift(),l.shift(),l.shift()),s=l.shift(),o=l.shift(),C.push(s,o);break;case"c":C.push(s+l.shift(),o+l.shift(),s+l.shift(),o+l.shift()),s+=l.shift(),o+=l.shift(),x="C",C.push(s,o);break;case"S":g=s,f=o,u=r[r.length-1],"C"===u.command&&(g=s+(s-u.points[2]),f=o+(o-u.points[3])),C.push(g,f,l.shift(),l.shift()),s=l.shift(),o=l.shift(),x="C",C.push(s,o);break;case"s":g=s,f=o,u=r[r.length-1],"C"===u.command&&(g=s+(s-u.points[2]),f=o+(o-u.points[3])),C.push(g,f,s+l.shift(),o+l.shift()),s+=l.shift(),o+=l.shift(),x="C",C.push(s,o);break;case"Q":C.push(l.shift(),l.shift()),s=l.shift(),o=l.shift(),C.push(s,o);break;case"q":C.push(s+l.shift(),o+l.shift()),s+=l.shift(),o+=l.shift(),x="Q",C.push(s,o);break;case"T":g=s,f=o,u=r[r.length-1],"Q"===u.command&&(g=s+(s-u.points[0]),f=o+(o-u.points[1])),s=l.shift(),o=l.shift(),x="Q",C.push(g,f,s,o);break;case"t":g=s,f=o,u=r[r.length-1],"Q"===u.command&&(g=s+(s-u.points[0]),f=o+(o-u.points[1])),s+=l.shift(),o+=l.shift(),x="Q",C.push(g,f,s,o);break;case"A":p=l.shift(),v=l.shift(),m=l.shift(),K=l.shift(),_=l.shift(),y=s,S=o,s=l.shift(),o=l.shift(),x="A",C=this.convertEndpointToCenterParameterization(y,S,s,o,K,_,p,v,m);break;case"a":p=l.shift(),v=l.shift(),m=l.shift(),K=l.shift(),_=l.shift(),y=s,S=o,s+=l.shift(),o+=l.shift(),x="A",C=this.convertEndpointToCenterParameterization(y,S,s,o,K,_,p,v,m)}r.push({command:x||c,points:C,start:{x:w,y:b},pathLength:this.calcLength(w,b,x||c,C)})}("z"===c||"Z"===c)&&r.push({command:"z",points:[],start:void 0,pathLength:0})}return r},Kinetic.Path.calcLength=function(e,i,n,a){var r,s,o,h=Kinetic.Path;switch(n){case"L":return h.getLineLength(e,i,a[0],a[1]);case"C":for(r=0,s=h.getPointOnCubicBezier(0,e,i,a[0],a[1],a[2],a[3],a[4],a[5]),t=.01;1>=t;t+=.01)o=h.getPointOnCubicBezier(t,e,i,a[0],a[1],a[2],a[3],a[4],a[5]),r+=h.getLineLength(s.x,s.y,o.x,o.y),s=o;return r;case"Q":for(r=0,s=h.getPointOnQuadraticBezier(0,e,i,a[0],a[1],a[2],a[3]),t=.01;1>=t;t+=.01)o=h.getPointOnQuadraticBezier(t,e,i,a[0],a[1],a[2],a[3]),r+=h.getLineLength(s.x,s.y,o.x,o.y),s=o;return r;case"A":r=0;var c=a[4],l=a[5],d=a[4]+l,u=Math.PI/180;if(Math.abs(c-d)<u&&(u=Math.abs(c-d)),s=h.getPointOnEllipticalArc(a[0],a[1],a[2],a[3],c,0),0>l)for(t=c-u;t>d;t-=u)o=h.getPointOnEllipticalArc(a[0],a[1],a[2],a[3],t,0),r+=h.getLineLength(s.x,s.y,o.x,o.y),s=o;else for(t=c+u;d>t;t+=u)o=h.getPointOnEllipticalArc(a[0],a[1],a[2],a[3],t,0),r+=h.getLineLength(s.x,s.y,o.x,o.y),s=o;return o=h.getPointOnEllipticalArc(a[0],a[1],a[2],a[3],d,0),r+=h.getLineLength(s.x,s.y,o.x,o.y)}return 0},Kinetic.Path.convertEndpointToCenterParameterization=function(t,e,i,n,a,r,s,o,h){var c=h*(Math.PI/180),l=Math.cos(c)*(t-i)/2+Math.sin(c)*(e-n)/2,d=-1*Math.sin(c)*(t-i)/2+Math.cos(c)*(e-n)/2,u=l*l/(s*s)+d*d/(o*o);u>1&&(s*=Math.sqrt(u),o*=Math.sqrt(u));var g=Math.sqrt((s*s*o*o-s*s*d*d-o*o*l*l)/(s*s*d*d+o*o*l*l));a==r&&(g*=-1),isNaN(g)&&(g=0);var f=g*s*d/o,p=g*-o*l/s,v=(t+i)/2+Math.cos(c)*f-Math.sin(c)*p,m=(e+n)/2+Math.sin(c)*f+Math.cos(c)*p,K=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])},_=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(K(t)*K(e))},y=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(_(t,e))},S=y([1,0],[(l-f)/s,(d-p)/o]),x=[(l-f)/s,(d-p)/o],C=[(-1*l-f)/s,(-1*d-p)/o],w=y(x,C);return _(x,C)<=-1&&(w=Math.PI),_(x,C)>=1&&(w=0),0===r&&w>0&&(w-=2*Math.PI),1==r&&0>w&&(w+=2*Math.PI),[v,m,s,o,S,w,c,r]},Kinetic.Node.addGetterSetter(Kinetic.Path,"data")}(),function(){function t(t){t.fillText(this.partialText,0,0)}function e(t){t.strokeText(this.partialText,0,0)}var i="",n="Calibri",a="normal";Kinetic.TextPath=function(t){this.___init(t)},Kinetic.TextPath.prototype={___init:function(i){var n=this;this.dummyCanvas=document.createElement("canvas"),this.dataArray=[],Kinetic.Shape.call(this,i),this._fillFunc=t,this._strokeFunc=e,this.className="TextPath",this.dataArray=Kinetic.Path.parsePathData(this.attrs.data),this.on("dataChange.kinetic",function(){n.dataArray=Kinetic.Path.parsePathData(this.attrs.data)}),this.on("textChange.kinetic textStroke.kinetic textStrokeWidth.kinetic",n._setTextData),n._setTextData()},drawFunc:function(t){var e=(this.charArr,t.getContext());e.font=this._getContextFont(),e.textBaseline="middle",e.textAlign="left",e.save();for(var i=this.glyphInfo,n=0;n<i.length;n++){e.save();var a=i[n].p0;i[n].p1,parseFloat(this.attrs.fontSize),e.translate(a.x,a.y),e.rotate(i[n].rotation),this.partialText=i[n].text,t.fillStroke(this),e.restore()}e.restore()},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},setText:function(t){Kinetic.Text.prototype.setText.call(this,t)},_getTextSize:function(t){var e=this.dummyCanvas,i=e.getContext("2d");i.save(),i.font=this._getContextFont();var n=i.measureText(t);return i.restore(),{width:n.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var t=this,e=this._getTextSize(this.attrs.text);this.textWidth=e.width,this.textHeight=e.height,this.glyphInfo=[];for(var i,n,a,r=this.attrs.text.split(""),s=-1,o=0,h=function(){o=0;for(var e=t.dataArray,n=s+1;n<e.length;n++){if(e[n].pathLength>0)return s=n,e[n];"M"==e[n].command&&(i={x:e[n].points[0],y:e[n].points[1]})}return{}},c=function(e){var r=t._getTextSize(e).width,s=0,c=0;for(n=void 0;Math.abs(r-s)/r>.01&&25>c;){c++;for(var l=s;void 0===a;)a=h(),a&&l+a.pathLength<r&&(l+=a.pathLength,a=void 0);if(a==={}||void 0===i)return void 0;var d=!1;switch(a.command){case"L":Kinetic.Path.getLineLength(i.x,i.y,a.points[0],a.points[1])>r?n=Kinetic.Path.getPointOnLine(r,i.x,i.y,a.points[0],a.points[1],i.x,i.y):a=void 0;break;case"A":var u=a.points[4],g=a.points[5],f=a.points[4]+g;0===o?o=u+1e-8:r>s?o+=Math.PI/180*g/Math.abs(g):o-=Math.PI/360*g/Math.abs(g),Math.abs(o)>Math.abs(f)&&(o=f,d=!0),n=Kinetic.Path.getPointOnEllipticalArc(a.points[0],a.points[1],a.points[2],a.points[3],o,a.points[6]);break;case"C":0===o?o=r>a.pathLength?1e-8:r/a.pathLength:r>s?o+=(r-s)/a.pathLength:o-=(s-r)/a.pathLength,o>1&&(o=1,d=!0),n=Kinetic.Path.getPointOnCubicBezier(o,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3],a.points[4],a.points[5]);break;case"Q":0===o?o=r/a.pathLength:r>s?o+=(r-s)/a.pathLength:o-=(s-r)/a.pathLength,o>1&&(o=1,d=!0),n=Kinetic.Path.getPointOnQuadraticBezier(o,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3])}void 0!==n&&(s=Kinetic.Path.getLineLength(i.x,i.y,n.x,n.y)),d&&(d=!1,a=void 0)}},l=0;l<r.length&&(c(r[l]),void 0!==i&&void 0!==n);l++){var d=Kinetic.Path.getLineLength(i.x,i.y,n.x,n.y),u=0,g=Kinetic.Path.getPointOnLine(u+d/2,i.x,i.y,n.x,n.y),f=Math.atan2(n.y-i.y,n.x-i.x);this.glyphInfo.push({transposeX:g.x,transposeY:g.y,text:r[l],rotation:f,p0:i,p1:n}),i=n}}},Kinetic.TextPath.prototype._getContextFont=Kinetic.Text.prototype._getContextFont,Kinetic.Util.extend(Kinetic.TextPath,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.TextPath,"fontFamily",n),Kinetic.Node.addGetterSetter(Kinetic.TextPath,"fontSize",12),Kinetic.Node.addGetterSetter(Kinetic.TextPath,"fontStyle",a),Kinetic.Node.addGetter(Kinetic.TextPath,"text",i)}(),function(){Kinetic.RegularPolygon=function(t){this.___init(t)},Kinetic.RegularPolygon.prototype={___init:function(t){Kinetic.Shape.call(this,t),this.className="RegularPolygon"},drawFunc:function(t){var e,i,n,a=t.getContext(),r=this.attrs.sides,s=this.attrs.radius;for(a.beginPath(),a.moveTo(0,0-s),e=1;r>e;e++)i=s*Math.sin(2*e*Math.PI/r),n=-1*s*Math.cos(2*e*Math.PI/r),a.lineTo(i,n);a.closePath(),t.fillStroke(this)}},Kinetic.Util.extend(Kinetic.RegularPolygon,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.RegularPolygon,"radius",0),Kinetic.Node.addGetterSetter(Kinetic.RegularPolygon,"sides",0)}(),function(){Kinetic.Star=function(t){this.___init(t)},Kinetic.Star.prototype={___init:function(t){Kinetic.Shape.call(this,t),this.className="Star"},drawFunc:function(t){var e=t.getContext(),i=this.attrs.innerRadius,n=this.attrs.outerRadius,a=this.attrs.numPoints;e.beginPath(),e.moveTo(0,0-this.attrs.outerRadius);for(var r=1;2*a>r;r++){var s=0===r%2?n:i,o=s*Math.sin(r*Math.PI/a),h=-1*s*Math.cos(r*Math.PI/a);e.lineTo(o,h)}e.closePath(),t.fillStroke(this)}},Kinetic.Util.extend(Kinetic.Star,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.Star,"numPoints",0),Kinetic.Node.addGetterSetter(Kinetic.Star,"innerRadius",0),Kinetic.Node.addGetterSetter(Kinetic.Star,"outerRadius",0)}(),function(){var t=["fontFamily","fontSize","fontStyle","padding","lineHeight","text"],e="Change.kinetic",i="none",n="up",a="right",r="down",s="left",o="Label",h=t.length;Kinetic.Label=function(t){this.____init(t)},Kinetic.Label.prototype={____init:function(t){var e=this;this.className=o,Kinetic.Group.call(this,t),this.on("add.kinetic",function(t){e._addListeners(t.child),e._sync()})},getText:function(){return this.get("Text")[0]},getTag:function(){return this.get("Tag")[0]},_addListeners:function(i){var n,a=this,r=function(){a._sync()};for(n=0;h>n;n++)i.on(t[n]+e,r)},getWidth:function(){return this.getText().getWidth()},getHeight:function(){return this.getText().getHeight()},_sync:function(){var t,e,i,o,h,c,l=this.getText(),d=this.getTag();if(l&&d){switch(t=l.getWidth(),e=l.getHeight(),i=d.getPointerDirection(),o=d.getPointerWidth(),pointerHeight=d.getPointerHeight(),h=0,c=0,i){case n:h=t/2,c=-1*pointerHeight;break;case a:h=t+o,c=e/2;break;case r:h=t/2,c=e+pointerHeight;break;case s:h=-1*o,c=e/2}d.setAttrs({x:-1*h,y:-1*c,width:t,height:e}),l.setAttrs({x:-1*h,y:-1*c})}}},Kinetic.Util.extend(Kinetic.Label,Kinetic.Group),Kinetic.Tag=function(t){this.___init(t)},Kinetic.Tag.prototype={___init:function(t){Kinetic.Shape.call(this,t),this.className="Tag"},drawFunc:function(t){var e=t.getContext(),i=this.getWidth(),o=this.getHeight(),h=this.getPointerDirection(),c=this.getPointerWidth(),l=this.getPointerHeight();this.getCornerRadius(),e.beginPath(),e.moveTo(0,0),h===n&&(e.lineTo((i-c)/2,0),e.lineTo(i/2,-1*l),e.lineTo((i+c)/2,0)),e.lineTo(i,0),h===a&&(e.lineTo(i,(o-l)/2),e.lineTo(i+c,o/2),e.lineTo(i,(o+l)/2)),e.lineTo(i,o),h===r&&(e.lineTo((i+c)/2,o),e.lineTo(i/2,o+l),e.lineTo((i-c)/2,o)),e.lineTo(0,o),h===s&&(e.lineTo(0,(o+l)/2),e.lineTo(-1*c,o/2),e.lineTo(0,(o-l)/2)),e.closePath(),t.fillStroke(this)}},Kinetic.Util.extend(Kinetic.Tag,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.Tag,"pointerDirection",i),Kinetic.Node.addGetterSetter(Kinetic.Tag,"pointerWidth",0),Kinetic.Node.addGetterSetter(Kinetic.Tag,"pointerHeight",0),Kinetic.Node.addGetterSetter(Kinetic.Tag,"cornerRadius",0)}(),function(){Kinetic.Filters.Grayscale=function(t){for(var e=t.data,i=0;i<e.length;i+=4){var n=.34*e[i]+.5*e[i+1]+.16*e[i+2];e[i]=n,e[i+1]=n,e[i+2]=n}}}(),function(){Kinetic.Filters.Brighten=function(t){for(var e=this.getFilterBrightness(),i=t.data,n=0;n<i.length;n+=4)i[n]+=e,i[n+1]+=e,i[n+2]+=e},Kinetic.Node.addFilterGetterSetter(Kinetic.Image,"filterBrightness",0)}(),function(){Kinetic.Filters.Invert=function(t){for(var e=t.data,i=0;i<e.length;i+=4)e[i]=255-e[i],e[i+1]=255-e[i+1],e[i+2]=255-e[i+2]}}(),function(){function t(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function e(e,a){var r,s,o,h,c,l,d,u,g,f,p,v,m,K,_,y,S,x,C,w,b,P,T,N,A=e.data,D=e.width,L=e.height,G=a+a+1,F=D-1,k=L-1,R=a+1,I=R*(R+1)/2,M=new t,U=null,E=M,B=null,H=null,O=i[a],W=n[a];for(o=1;G>o;o++)E=E.next=new t,o==R&&(U=E);for(E.next=M,d=l=0,s=0;L>s;s++){for(y=S=x=C=u=g=f=p=0,v=R*(w=A[l]),m=R*(b=A[l+1]),K=R*(P=A[l+2]),_=R*(T=A[l+3]),u+=I*w,g+=I*b,f+=I*P,p+=I*T,E=M,o=0;R>o;o++)E.r=w,E.g=b,E.b=P,E.a=T,E=E.next;for(o=1;R>o;o++)h=l+((o>F?F:o)<<2),u+=(E.r=w=A[h])*(N=R-o),g+=(E.g=b=A[h+1])*N,f+=(E.b=P=A[h+2])*N,p+=(E.a=T=A[h+3])*N,y+=w,S+=b,x+=P,C+=T,E=E.next;for(B=M,H=U,r=0;D>r;r++)A[l+3]=T=p*O>>W,0!==T?(T=255/T,A[l]=(u*O>>W)*T,A[l+1]=(g*O>>W)*T,A[l+2]=(f*O>>W)*T):A[l]=A[l+1]=A[l+2]=0,u-=v,g-=m,f-=K,p-=_,v-=B.r,m-=B.g,K-=B.b,_-=B.a,h=d+((h=r+a+1)<F?h:F)<<2,y+=B.r=A[h],S+=B.g=A[h+1],x+=B.b=A[h+2],C+=B.a=A[h+3],u+=y,g+=S,f+=x,p+=C,B=B.next,v+=w=H.r,m+=b=H.g,K+=P=H.b,_+=T=H.a,y-=w,S-=b,x-=P,C-=T,H=H.next,l+=4;d+=D}for(r=0;D>r;r++){for(S=x=C=y=g=f=p=u=0,l=r<<2,v=R*(w=A[l]),m=R*(b=A[l+1]),K=R*(P=A[l+2]),_=R*(T=A[l+3]),u+=I*w,g+=I*b,f+=I*P,p+=I*T,E=M,o=0;R>o;o++)E.r=w,E.g=b,E.b=P,E.a=T,E=E.next;for(c=D,o=1;a>=o;o++)l=c+r<<2,u+=(E.r=w=A[l])*(N=R-o),g+=(E.g=b=A[l+1])*N,f+=(E.b=P=A[l+2])*N,p+=(E.a=T=A[l+3])*N,y+=w,S+=b,x+=P,C+=T,E=E.next,k>o&&(c+=D);for(l=r,B=M,H=U,s=0;L>s;s++)h=l<<2,A[h+3]=T=p*O>>W,T>0?(T=255/T,A[h]=(u*O>>W)*T,A[h+1]=(g*O>>W)*T,A[h+2]=(f*O>>W)*T):A[h]=A[h+1]=A[h+2]=0,u-=v,g-=m,f-=K,p-=_,v-=B.r,m-=B.g,K-=B.b,_-=B.a,h=r+((h=s+R)<k?h:k)*D<<2,u+=y+=B.r=A[h],g+=S+=B.g=A[h+1],f+=x+=B.b=A[h+2],p+=C+=B.a=A[h+3],B=B.next,v+=w=H.r,m+=b=H.g,K+=P=H.b,_+=T=H.a,y-=w,S-=b,x-=P,C-=T,H=H.next,l+=D}}var i=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],n=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];Kinetic.Filters.Blur=function(t){var i=0|this.getFilterRadius();i>0&&e(t,i)},Kinetic.Node.addFilterGetterSetter(Kinetic.Image,"filterRadius",0)}(),function(){function t(t,e,i){var n=4*(i*t.width+e),a=[];return a.push(t.data[n++],t.data[n++],t.data[n++],t.data[n++]),a}function e(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}function i(t){for(var e=[0,0,0],i=0;i<t.length;i++)e[0]+=t[i][0],e[1]+=t[i][1],e[2]+=t[i][2];return e[0]/=t.length,e[1]/=t.length,e[2]/=t.length,e}function n(n,a){var r=t(n,0,0),s=t(n,n.width-1,0),o=t(n,0,n.height-1),h=t(n,n.width-1,n.height-1),c=a||10;if(e(r,s)<c&&e(s,h)<c&&e(h,o)<c&&e(o,r)<c){for(var l=i([s,r,h,o]),d=[],u=0;u<n.width*n.height;u++){var g=e(l,[n.data[4*u],n.data[4*u+1],n.data[4*u+2]]);d[u]=c>g?0:255}return d}}function a(t,e){for(var i=0;i<t.width*t.height;i++)t.data[4*i+3]=e[i]}function r(t,e,i){for(var n=[1,1,1,1,0,1,1,1,1],a=Math.round(Math.sqrt(n.length)),r=Math.floor(a/2),s=[],o=0;i>o;o++)for(var h=0;e>h;h++){for(var c=o*e+h,l=0,d=0;a>d;d++)for(var u=0;a>u;u++){var g=o+d-r,f=h+u-r;if(g>=0&&i>g&&f>=0&&e>f){var p=g*e+f,v=n[d*a+u];l+=t[p]*v}}s[c]=2040===l?255:0}return s}function s(t,e,i){for(var n=[1,1,1,1,1,1,1,1,1],a=Math.round(Math.sqrt(n.length)),r=Math.floor(a/2),s=[],o=0;i>o;o++)for(var h=0;e>h;h++){for(var c=o*e+h,l=0,d=0;a>d;d++)for(var u=0;a>u;u++){var g=o+d-r,f=h+u-r;if(g>=0&&i>g&&f>=0&&e>f){var p=g*e+f,v=n[d*a+u];l+=t[p]*v}}s[c]=l>=1020?255:0}return s}function o(t,e,i){for(var n=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],a=Math.round(Math.sqrt(n.length)),r=Math.floor(a/2),s=[],o=0;i>o;o++)for(var h=0;e>h;h++){for(var c=o*e+h,l=0,d=0;a>d;d++)for(var u=0;a>u;u++){var g=o+d-r,f=h+u-r;if(g>=0&&i>g&&f>=0&&e>f){var p=g*e+f,v=n[d*a+u];l+=t[p]*v}}s[c]=l}return s}Kinetic.Filters.Mask=function(t){var e=this.getFilterThreshold(),i=n(t,e);return i&&(i=r(i,t.width,t.height),i=s(i,t.width,t.height),i=o(i,t.width,t.height),a(t,i)),t},Kinetic.Node.addFilterGetterSetter(Kinetic.Image,"filterThreshold",0)}();
//# sourceMappingURL=peaks.min.map
},{}],2:[function(_dereq_,module,exports){
!function(){function e(){this._events={},this._conf&&t.call(this,this._conf)}function t(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners&&(this._events.maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),this.wildcard&&(this.listenerTree={}))}function s(e){this._events={},this.newListener=!1,t.call(this,e)}function i(e,t,s,n){if(!s)return[];var r,l,o,h,a,f,c,u=[],_=t.length,p=t[n],v=t[n+1];if(n===_&&s._listeners){if("function"==typeof s._listeners)return e&&e.push(s._listeners),[s];for(r=0,l=s._listeners.length;l>r;r++)e&&e.push(s._listeners[r]);return[s]}if("*"===p||"**"===p||s[p]){if("*"===p){for(o in s)"_listeners"!==o&&s.hasOwnProperty(o)&&(u=u.concat(i(e,t,s[o],n+1)));return u}if("**"===p){c=n+1===_||n+2===_&&"*"===v,c&&s._listeners&&(u=u.concat(i(e,t,s,_)));for(o in s)"_listeners"!==o&&s.hasOwnProperty(o)&&("*"===o||"**"===o?(s[o]._listeners&&!c&&(u=u.concat(i(e,t,s[o],_))),u=u.concat(i(e,t,s[o],n))):u=u.concat(o===v?i(e,t,s[o],n+2):i(e,t,s[o],n)));return u}u=u.concat(i(e,t,s[p],n+1))}if(h=s["*"],h&&i(e,t,h,n+1),a=s["**"])if(_>n){a._listeners&&i(e,t,a,_);for(o in a)"_listeners"!==o&&a.hasOwnProperty(o)&&(o===v?i(e,t,a[o],n+2):o===p?i(e,t,a[o],n+1):(f={},f[o]=a[o],i(e,t,{"**":f},n+1)))}else a._listeners?i(e,t,a,_):a["*"]&&a["*"]._listeners&&i(e,t,a["*"],_);return u}function n(e,t){e="string"==typeof e?e.split(this.delimiter):e.slice();for(var s=0,i=e.length;i>s+1;s++)if("**"===e[s]&&"**"===e[s+1])return;for(var n=this.listenerTree,o=e.shift();o;){if(n[o]||(n[o]={}),n=n[o],0===e.length){if(n._listeners){if("function"==typeof n._listeners)n._listeners=[n._listeners,t];else if(r(n._listeners)&&(n._listeners.push(t),!n._listeners.warned)){var h=l;"undefined"!=typeof this._events.maxListeners&&(h=this._events.maxListeners),h>0&&n._listeners.length>h&&(n._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",n._listeners.length),console.trace())}}else n._listeners=t;return!0}o=e.shift()}return!0}var r=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},l=10;s.prototype.delimiter=".",s.prototype.setMaxListeners=function(t){this._events||e.call(this),this._events.maxListeners=t,this._conf||(this._conf={}),this._conf.maxListeners=t},s.prototype.event="",s.prototype.once=function(e,t){return this.many(e,1,t),this},s.prototype.many=function(e,t,s){function i(){0===--t&&n.off(e,i),s.apply(this,arguments)}var n=this;if("function"!=typeof s)throw new Error("many only accepts instances of Function");return i._origin=s,this.on(e,i),n},s.prototype.emit=function(){this._events||e.call(this);var t=arguments[0];if("newListener"===t&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var s=arguments.length,n=new Array(s-1),r=1;s>r;r++)n[r-1]=arguments[r];for(r=0,s=this._all.length;s>r;r++)this.event=t,this._all[r].apply(this,n)}if("error"===t&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var l;if(this.wildcard){l=[];var o="string"==typeof t?t.split(this.delimiter):t.slice();i.call(this,l,o,this.listenerTree,0)}else l=this._events[t];if("function"==typeof l){if(this.event=t,1===arguments.length)l.call(this);else if(arguments.length>1)switch(arguments.length){case 2:l.call(this,arguments[1]);break;case 3:l.call(this,arguments[1],arguments[2]);break;default:for(var s=arguments.length,n=new Array(s-1),r=1;s>r;r++)n[r-1]=arguments[r];l.apply(this,n)}return!0}if(l){for(var s=arguments.length,n=new Array(s-1),r=1;s>r;r++)n[r-1]=arguments[r];for(var h=l.slice(),r=0,s=h.length;s>r;r++)this.event=t,h[r].apply(this,n);return h.length>0||!!this._all}return!!this._all},s.prototype.on=function(t,s){if("function"==typeof t)return this.onAny(t),this;if("function"!=typeof s)throw new Error("on only accepts instances of Function");if(this._events||e.call(this),this.emit("newListener",t,s),this.wildcard)return n.call(this,t,s),this;if(this._events[t]){if("function"==typeof this._events[t])this._events[t]=[this._events[t],s];else if(r(this._events[t])&&(this._events[t].push(s),!this._events[t].warned)){var i=l;"undefined"!=typeof this._events.maxListeners&&(i=this._events.maxListeners),i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),console.trace())}}else this._events[t]=s;return this},s.prototype.onAny=function(e){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),this._all.push(e),this},s.prototype.addListener=s.prototype.on,s.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var s,n=[];if(this.wildcard){var l="string"==typeof e?e.split(this.delimiter):e.slice();n=i.call(this,null,l,this.listenerTree,0)}else{if(!this._events[e])return this;s=this._events[e],n.push({_listeners:s})}for(var o=0;o<n.length;o++){var h=n[o];if(s=h._listeners,r(s)){for(var a=-1,f=0,c=s.length;c>f;f++)if(s[f]===t||s[f].listener&&s[f].listener===t||s[f]._origin&&s[f]._origin===t){a=f;break}if(0>a)continue;return this.wildcard?h._listeners.splice(a,1):this._events[e].splice(a,1),0===s.length&&(this.wildcard?delete h._listeners:delete this._events[e]),this}(s===t||s.listener&&s.listener===t||s._origin&&s._origin===t)&&(this.wildcard?delete h._listeners:delete this._events[e])}return this},s.prototype.offAny=function(e){var t,s=0,i=0;if(e&&this._all&&this._all.length>0){for(t=this._all,s=0,i=t.length;i>s;s++)if(e===t[s])return t.splice(s,1),this}else this._all=[];return this},s.prototype.removeListener=s.prototype.off,s.prototype.removeAllListeners=function(t){if(0===arguments.length)return!this._events||e.call(this),this;if(this.wildcard)for(var s="string"==typeof t?t.split(this.delimiter):t.slice(),n=i.call(this,null,s,this.listenerTree,0),r=0;r<n.length;r++){var l=n[r];l._listeners=null}else{if(!this._events[t])return this;this._events[t]=null}return this},s.prototype.listeners=function(t){if(this.wildcard){var s=[],n="string"==typeof t?t.split(this.delimiter):t.slice();return i.call(this,s,n,this.listenerTree,0),s}return this._events||e.call(this),this._events[t]||(this._events[t]=[]),r(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]},s.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define(function(){return s}):"object"==typeof exports?exports.EventEmitter2=s:window.EventEmitter2=s}();
//# sourceMappingURL=peaks.min.map
},{}],3:[function(_dereq_,module,exports){
"use strict";var WaveformDataArrayBufferAdapter=module.exports=function(t){this.data=t};WaveformDataArrayBufferAdapter.isCompatible=function(t){return t&&"object"==typeof t&&"byteLength"in t},WaveformDataArrayBufferAdapter.fromResponseData=function(t){return new WaveformDataArrayBufferAdapter(new DataView(t))},WaveformDataArrayBufferAdapter.prototype={get version(){return this.data.getInt32(0,!0)},get is_8_bit(){return!!this.data.getUint32(4,!0)},get is_16_bit(){return!this.is_8_bit},get sample_rate(){return this.data.getInt32(8,!0)},get scale(){return this.data.getInt32(12,!0)},get length(){return this.data.getUint32(16,!0)},at:function(t){return Math.round(this.data.getInt8(20+t))}};
//# sourceMappingURL=peaks.min.map
},{}],4:[function(_dereq_,module,exports){
"use strict";module.exports={arraybuffer:_dereq_("./arraybuffer.js"),object:_dereq_("./object.js")};
//# sourceMappingURL=peaks.min.map
},{"./arraybuffer.js":3,"./object.js":5}],5:[function(_dereq_,module,exports){
"use strict";var WaveformDataObjectAdapter=module.exports=function(t){this.data=t};WaveformDataObjectAdapter.isCompatible=function(t){return t&&"object"==typeof t&&"sample_rate"in t||"string"==typeof t&&"sample_rate"in JSON.parse(t)},WaveformDataObjectAdapter.fromResponseData=function(t){return new WaveformDataObjectAdapter("string"==typeof t?JSON.parse(t):t)},WaveformDataObjectAdapter.prototype={get version(){return this.data.version||1},get is_8_bit(){return 8===this.data.bits},get is_16_bit(){return!this.is_8_bit},get sample_rate(){return this.data.sample_rate},get scale(){return this.data.samples_per_pixel},get length(){return this.data.length},at:function(t){return Math.round(this.data.data[t])}};
//# sourceMappingURL=peaks.min.map
},{}],6:[function(_dereq_,module,exports){
"use strict";function fromAudioObjectBuilder(e,t){var a=fromAudioObjectBuilder.getAudioContext(),r=512,o=127;a.decodeAudioData(e,function(e){var a,n,i=Math.floor(e.length/r),u=20,d=new DataView(new ArrayBuffer(u+2*i)),f=1/0,s=-1/0,l=r,c=e.length;d.setInt32(0,1,!0),d.setUint32(4,1,!0),d.setInt32(8,e.sampleRate,!0),d.setInt32(12,r,!0),d.setInt32(16,i,!0),a=e.getChannelData(0),n=e.getChannelData(0);for(var m=0;c>m;m++){var v=(a[m]+n[m])/2*o;f>v&&(f=v),v>s&&(s=v),0===--l&&(d.setInt8(u++,Math.floor(f)),d.setInt8(u++,Math.floor(s)),f=1/0,s=-1/0,l=r)}t(new WaveformData(d.buffer,WaveformData.adapters.arraybuffer))})}var WaveformData=_dereq_("../core.js");WaveformData.adapters=_dereq_("../adapters"),fromAudioObjectBuilder.getAudioContext=function(){var e=window.AudioContext||window.webkitAudioContext;return new e},module.exports=fromAudioObjectBuilder;
//# sourceMappingURL=peaks.min.map
},{"../adapters":4,"../core.js":7}],7:[function(_dereq_,module,exports){
"use strict";var WaveformDataSegment=_dereq_("./segment.js"),WaveformDataPoint=_dereq_("./point.js"),WaveformData=module.exports=function(t,e){this.adapter=e.fromResponseData(t),this.segments={},this.points={},this.offset(0,this.adapter.length)};WaveformData.create=function(t){var e=null,a=null;if(t&&"object"==typeof t&&("responseText"in t||"response"in t)&&(a="responseType"in t?t.response:t.responseText||t.response),Object.keys(WaveformData.adapters).some(function(n){return WaveformData.adapters[n].isCompatible(a||t)?(e=WaveformData.adapters[n],!0):void 0}),null===e)throw new TypeError("Could not detect a WaveformData adapter from the input.");return new WaveformData(a||t,e)},WaveformData.prototype={offset:function(t,e){var a=this.adapter.length;if(0>e)throw new RangeError("End point must be non-negative.");if(t>=e)throw new RangeError("We can't end prior to the starting point.");if(0>t)throw new RangeError("Start point must be non-negative.");if(t>=a)throw new RangeError("Start point must be within range.");e>a&&(e=a),this.offset_start=t,this.offset_end=e,this.offset_length=e-t},set_segment:function(t,e,a){return a=a||"default",this.segments[a]=new WaveformDataSegment(this,t,e),this.segments[a]},set_point:function(t,e){return e=e||"default",this.points[e]=new WaveformDataPoint(this,t),this.points[e]},remove_point:function(t){this.points[t]&&delete this.points[t]},resample:function(t){"number"==typeof t&&(t={width:t}),t.input_index="number"==typeof t.input_index?t.input_index:null,t.output_index="number"==typeof t.output_index?t.output_index:null,t.scale="number"==typeof t.scale?t.scale:null,t.width="number"==typeof t.width?t.width:null;var e=Boolean(t.input_index)||Boolean(t.output_index);if(null!==t.input_index&&t.input_index>=0==!1)throw new RangeError("options.input_index should be a positive integer value. ["+t.input_index+"]");if(null!==t.output_index&&t.output_index>=0==!1)throw new RangeError("options.output_index should be a positive integer value. ["+t.output_index+"]");if(null!==t.width&&t.width>0==!1)throw new RangeError("options.width should be a strictly positive integer value. ["+t.width+"]");if(null!==t.scale&&t.scale>0==!1)throw new RangeError("options.scale should be a strictly positive integer value. ["+t.scale+"]");if(!t.scale&&!t.width)throw new RangeError("You should provide either a resampling scale or a width in pixel the data should fit in.");var a=["width","scale","output_index","input_index"].reduce(function(e,a){return e+(null===t[a]?0:1)},0);if(e&&4!==a)throw new Error("Some partial resampling options are missing. You provided "+a+" of them over 4.");var n=[],r=t.scale||Math.floor(this.duration*this.adapter.sample_rate/t.width),i=this.adapter.scale,o=2,s=this.adapter.length,u=t.input_index||0,p=t.output_index||0,h=s?this.min_sample(u):0,f=s?this.max_sample(u):0,l=-128,d=127;if(i>r)throw new Error("Zoom level "+r+" too low, minimum: "+i);for(var m,c,_,g,w,v=function(t){return Math.floor(t*r)},b=function(t,e){n.push(t,e)};s>u;){for(;Math.floor(v(p)/i)<=u;)p&&b(h,f),w=u,p++,m=v(p),c=v(p-1),m!==c&&(h=d,f=l);for(m=v(p),_=Math.floor(m/i),_>s&&(_=s);_>u;)g=this.min_sample(u),h>g&&(h=g),g=this.max_sample(u),g>f&&(f=g),u++;if(e&&n.length/o>=t.width)break}return e?n.length/o>t.width&&u!==w&&b(h,f):u!==w&&b(h,f),new WaveformData({version:this.adapter.version,samples_per_pixel:r,length:n.length/o,data:n,sample_rate:this.adapter.sample_rate},WaveformData.adapters.object)},get min(){return this.offsetValues(this.offset_start,this.offset_length,0)},get max(){return this.offsetValues(this.offset_start,this.offset_length,1)},offsetValues:function(t,e,a){var n=this.adapter,r=[];a+=2*t;for(var i=0;e>i;i++)r.push(n.at(2*i+a));return r},get duration(){return this.adapter.length*this.adapter.scale/this.adapter.sample_rate},get offset_duration(){return this.offset_length*this.adapter.scale/this.adapter.sample_rate},get pixels_per_second(){return this.adapter.sample_rate/this.adapter.scale},get seconds_per_pixel(){return this.adapter.scale/this.adapter.sample_rate},at:function(t){return this.adapter.at(t)},at_time:function(t){return Math.floor(t*this.adapter.sample_rate/this.adapter.scale)},time:function(t){return t*this.seconds_per_pixel},in_offset:function(t){return t>=this.offset_start&&t<this.offset_end},min_sample:function(t){return this.adapter.at(2*t)},max_sample:function(t){return this.adapter.at(2*t+1)}},WaveformData.adapters={},WaveformData.adapter=function(t){this.data=t};
//# sourceMappingURL=peaks.min.map
},{"./point.js":8,"./segment.js":9}],8:[function(_dereq_,module,exports){
"use strict";var WaveformDataPoint=module.exports=function(t,e){this.context=t,this.timeStamp=e};WaveformDataPoint.prototype={get visible(){return this.context.in_offset(this.timeStamp)}};
//# sourceMappingURL=peaks.min.map
},{}],9:[function(_dereq_,module,exports){
"use strict";var WaveformDataSegment=module.exports=function(t,e,s){this.context=t,this.start=e,this.end=s};WaveformDataSegment.prototype={get offset_start(){return this.start<this.context.offset_start&&this.end>this.context.offset_start?this.context.offset_start:this.start>=this.context.offset_start&&this.start<this.context.offset_end?this.start:null},get offset_end(){return this.end>this.context.offset_start&&this.end<=this.context.offset_end?this.end:this.end>this.context.offset_end&&this.start<this.context.offset_end?this.context.offset_end:null},get offset_length(){return this.offset_end-this.offset_start},get length(){return this.end-this.start},get visible(){return this.context.in_offset(this.start)||this.context.in_offset(this.end)||this.context.offset_start>this.start&&this.context.offset_start<this.end},get min(){return this.visible?this.context.offsetValues(this.offset_start,this.offset_length,0):[]},get max(){return this.visible?this.context.offsetValues(this.offset_start,this.offset_length,1):[]}};
//# sourceMappingURL=peaks.min.map
},{}],10:[function(_dereq_,module,exports){
"use strict";var WaveformData=_dereq_("./lib/core");WaveformData.adapters=_dereq_("./lib/adapters"),WaveformData.builders={webaudio:_dereq_("./lib/builders/webaudio.js")},module.exports=WaveformData;
//# sourceMappingURL=peaks.min.map
},{"./lib/adapters":4,"./lib/builders/webaudio.js":6,"./lib/core":7}],11:[function(_dereq_,module,exports){
function Peaks(e){this.options={zoomLevels:[512,1024,2048,4096],dataUri:null,dataUriDefaultFormat:"json",keyboard:!1,nudgeIncrement:.01,inMarkerColor:"#a0a0a0",outMarkerColor:"#a0a0a0",zoomWaveformColor:"rgba(0, 225, 128, 1)",overviewWaveformColor:"rgba(0,0,0,0.2)",randomizeSegmentColor:!0,height:200,segmentColor:"rgba(255, 161, 39, 1)",playheadColor:"rgba(0, 0, 0, 1)",template:['<div class="waveform">','<div class="zoom-container"></div>','<div class="overview-container"></div>',"</div>"].join(""),pointMarkerColor:"#FF0000",pointDblClickHandler:null,pointDragEndHandler:null},this.container=e,this.currentZoomLevel=0}var EventEmitter=_dereq_("EventEmitter"),AudioPlayer=_dereq_("peaks/player/player"),Waveform=_dereq_("peaks/waveform/waveform.core"),mixins=_dereq_("peaks/waveform/waveform.mixins"),keyboard=_dereq_("peaks/player/player.keyboard"),buildUi=function(e){return{player:e.querySelector(".waveform"),zoom:e.querySelector(".zoom-container"),overview:e.querySelector(".overview-container")}},extend=function(e,o){for(var t in o)e[t]=o[t];return e};Peaks.init=function(e){if(e=e||{},e.audioElement&&(e.mediaElement=e.audioElement,console&&"function"==typeof console.log&&console.log("`audioElement` option is deprecated. Please use `mediaElement` instead.")),!e.mediaElement)throw new Error("Please provide an audio element.");if(!(e.mediaElement instanceof HTMLMediaElement))throw new TypeError("[Peaks.init] The mediaElement option should be an HTMLMediaElement.");if(!e.container)throw new Error("Please provide a container object.");if(e.container.clientWidth>0==!1)throw new TypeError("Please ensure that the container has a width.");var o=new Peaks(e.container);if(extend(o.options,e),extend(o.options,{segmentInMarker:mixins.defaultInMarker(o.options),segmentOutMarker:mixins.defaultOutMarker(o.options),segmentLabelDraw:mixins.defaultSegmentLabelDraw(o.options),pointMarker:mixins.defaultPointMarker(o.options)}),"string"==typeof o.options.template)o.container.innerHTML=o.options.template;else{if(!(o.options.template instanceof HTMLElement))throw new TypeError("Please ensure you provide an HTML string or a DOM template as `template` instance option. Provided: "+o.options.template);o.container.appendChild(o.options.template)}return o.options.keyboard&&keyboard.init(o),o.player=new AudioPlayer(o),o.player.init(o.options.mediaElement),o.waveform=new Waveform(o),o.waveform.init(buildUi(o.container)),o.on("waveformOverviewReady",function(){o.waveform.openZoomView(),o.options.segments&&o.segments.addSegment(o.options.segments),o.options.points&&o.points.addPoint(o.options.points)}),o},Peaks.prototype=Object.create(EventEmitter.prototype,{segments:{get:function(){function e(e,t,n,r,i){var a=arguments[0];if("number"==typeof a&&(a=[{startTime:e,endTime:t,editable:n,color:r,labelText:i}]),!Array.isArray(a))throw new TypeError("[Peaks.segments.addSegment] Unrecognized segment parameters.");a.forEach(function(e){o.waveform.segments.createSegment(e.startTime,e.endTime,e.editable,e.color,e.labelText)}),o.waveform.segments.render()}var o=this;return{addSegment:e,add:e,remove:function(e){var t=o.waveform.segments.remove(e);if(null===t)throw new RangeError("Unable to find the requested segment"+String(e));return o.waveform.segments.updateSegments(),o.waveform.segments.segments.splice(t,1).pop()},removeByTime:function(e,t){t="number"==typeof t?t:0;var n;n=t>0?function(o){return o.startTime===e&&o.endTime===t}:function(o){return o.startTime===e};var r=o.waveform.segments.segments.filter(n).map(function(e,t){return o.waveform.segments.remove(e),t}).sort(function(e,o){return o-e}).map(function(e){return o.waveform.segments.segments.splice(e,1),e});return o.waveform.segments.updateSegments(),r.length},removeAll:function(){o.waveform.segments.segments.forEach(function(e){o.waveform.segments.remove(e)}),o.waveform.segments.segments=[],o.waveform.segments.updateSegments()},getSegments:function(){return o.waveform.segments.segments}}}},points:{get:function(){var e=this;return{add:function(o,t,n,r){var i=arguments[0];if("number"==typeof i&&(i=[{timestamp:o,editable:t,color:n,labelText:r}]),!Array.isArray(i))throw new TypeError("[Peaks.points.addPoint] Unrecognized point parameters.");i.forEach(e.waveform.points.createPoint.bind(e.waveform.points)),e.waveform.points.render()},getPoints:function(){return e.waveform.points.points},removeByTime:function(o){var t=e.waveform.points.points.filter(function(e){return e.timestamp===o}).map(function(o,t){return e.waveform.points.remove(o),t}).sort(function(e,o){return o-e}).map(function(o){return e.waveform.points.points.splice(o,1),o});return e.waveform.points.render(),t.length}}}},time:{get:function(){var e=this;return{setCurrentTime:function(o){return e.player.seekBySeconds(o)},getCurrentTime:function(){return e.player.getTime()}}}},zoom:{get:function(){var e=this;return{zoomIn:function(){e.zoom.setZoom(e.currentZoomLevel-1)},zoomOut:function(){e.zoom.setZoom(e.currentZoomLevel+1)},setZoom:function(o){o>=e.options.zoomLevels.length&&(o=e.options.zoomLevels.length-1),0>o&&(o=0);var t=e.currentZoomLevel;e.currentZoomLevel=o,e.emit("zoom.update",e.options.zoomLevels[o],e.options.zoomLevels[t])},getZoom:function(){return e.currentZoomLevel},overview:function(){e.emit("zoom.update",e.waveform.waveformOverview.data.adapter.scale,e.options.zoomLevels[e.currentZoomLevel])},reset:function(){e.emit("zoom.update",e.options.zoomLevels[e.currentZoomLevel],e.waveform.waveformOverview.data.adapter.scale)}}}}}),module.exports=Peaks;
//# sourceMappingURL=peaks.min.map
},{"EventEmitter":2,"peaks/player/player":16,"peaks/player/player.keyboard":17,"peaks/waveform/waveform.core":21,"peaks/waveform/waveform.mixins":22}],12:[function(_dereq_,module,exports){
"use strict";function BaseShape(){console.log("BaseShape")}function noop(){}function throwUndefined(){throw new Error("You should extend this method in your parent class.")}BaseShape.prototype={createShape:throwUndefined,update:noop},module.exports=BaseShape;
//# sourceMappingURL=peaks.min.map
},{}],13:[function(_dereq_,module,exports){
var BaseShape=_dereq_("peaks/markers/shapes/base"),mixins=_dereq_("peaks/waveform/waveform.mixins"),Kinetic=_dereq_("Kinetic"),WaveShape=Object.create(BaseShape.prototype);WaveShape.createShape=function(e,a){var t=new Kinetic.Shape({fill:e.color,strokeWidth:0,opacity:1});return t.setDrawFunc(WaveShape.drawFunc.bind(t,a,e.id)),t},WaveShape.drawFunc=function(e,a,t){var i=e.data;if(void 0!==i.segments[a]){var r=i.segments[a],s=r.offset_length,n=r.offset_start-i.offset_start,o=t.getContext(),p=mixins.interpolateHeight(e.height);mixins.drawWaveform(o,r.min,r.max,n,s,p),t.fillStroke(this)}},module.exports=WaveShape;
//# sourceMappingURL=peaks.min.map
},{"Kinetic":1,"peaks/markers/shapes/base":12,"peaks/waveform/waveform.mixins":22}],14:[function(_dereq_,module,exports){
var mixins=_dereq_("peaks/waveform/waveform.mixins"),Kinetic=_dereq_("Kinetic");module.exports=function(e){function i(i){var t=new Kinetic.Group,n=new Kinetic.Group,m=[t,n];return i.editable=Boolean(i.editable),m.forEach(function(t,a){var n=r.views[a];i.editable&&(t.marker=new e.options.pointMarker(!0,t,i,o,e.options.pointDblClickHandler,e.options.pointDragEndHandler),t.add(t.marker)),n.pointLayer.add(t)}),i.zoom=t,i.zoom.view=a.waveformZoomView,i.overview=n,i.overview.view=a.waveformOverview,i}function t(e){a.waveformOverview.data.set_point(a.waveformOverview.data.at_time(e.timestamp),e.id),a.waveformZoomView.data.set_point(a.waveformZoomView.data.at_time(e.timestamp),e.id);var i=a.waveformOverview.data.at_time(e.timestamp);e.editable&&(e.overview.marker&&e.overview.marker.show().setX(i-e.overview.marker.getWidth()),e.overview.marker.label.setText(mixins.niceTime(e.timestamp,!1)));var t=a.waveformZoomView.data.at_time(e.timestamp),o=a.waveformZoomView.frameOffset;if(o>t&&(zoomStartOffset=o),a.waveformZoomView.data.points[e.id].visible){var r=t-o;e.zoom.show(),e.editable&&(e.zoom.marker&&e.zoom.marker.show().setX(r-e.zoom.marker.getWidth()),e.zoom.marker.label.setText(mixins.niceTime(e.timestamp,!1)))}else e.zoom.hide()}function o(e,i){if(e.marker.getX()>0){var o=e.view.frameOffset+e.marker.getX()+e.marker.getWidth();i.timestamp=e.view.data.time(o)}t(i),r.render()}var r=this,a=e.waveform;r.points=[],r.views=[a.waveformZoomView,a.waveformOverview].map(function(e){return e.pointLayer||(e.pointLayer=new Kinetic.Layer,e.stage.add(e.pointLayer),e.pointLayer.moveToTop()),e}),this.init=function(){e.on("waveform_zoom_displaying",r.updatePoints.bind(r)),e.emit("points.ready")},this.updatePoints=function(){r.points.forEach(t),r.render()},this.createPoint=function(e){if(e.timestamp>=0==!1)throw new RangeError("[waveform.points.createPoint] timestamp should be a >=0 value");e.id="point"+r.points.length,e=i(e),t(e),r.points.push(e)},this.remove=function(e){var i=null;return this.points.some(function(t,o){return t===e?(i=o,!0):void 0}),"number"==typeof i&&(e.overview.destroy(),e.zoom.destroy()),i},this.render=function(){r.views.forEach(function(e){e.pointLayer.draw()})}};
//# sourceMappingURL=peaks.min.map
},{"Kinetic":1,"peaks/waveform/waveform.mixins":22}],15:[function(_dereq_,module,exports){
var Kinetic=_dereq_("Kinetic"),mixins=_dereq_("peaks/waveform/waveform.mixins"),SegmentShape=_dereq_("peaks/markers/shapes/wave");module.exports=function(e){var r=this;r.segments=[],r.views=[e.waveform.waveformZoomView,e.waveform.waveformOverview].map(function(e){return e.segmentLayer||(e.segmentLayer=new Kinetic.Layer,e.stage.add(e.segmentLayer),e.segmentLayer.moveToTop()),e});var a=function(a,t,m,n,v,s){var w={id:a,startTime:t,endTime:m,labelText:s||"",color:v||o(),editable:n},f=new Kinetic.Group,d=new Kinetic.Group,h=[f,d],u=function(){this.parent.label.show(),this.parent.view.segmentLayer.draw()},g=function(){this.parent.label.hide(),this.parent.view.segmentLayer.draw()};return h.forEach(function(a,t){var o=r.views[t];if(a.waveformShape=SegmentShape.createShape(w,o),a.waveformShape.on("mouseenter",u),a.waveformShape.on("mouseleave",g),a.add(a.waveformShape),a.label=new e.options.segmentLabelDraw(a,w),a.add(a.label.hide()),n){var m=!0;a===d&&(m=!1),a.inMarker=new e.options.segmentInMarker(m,a,w,i),a.add(a.inMarker),a.outMarker=new e.options.segmentOutMarker(m,a,w,i),a.add(a.outMarker)}o.segmentLayer.add(a)}),w.zoom=f,w.zoom.view=e.waveform.waveformZoomView,w.overview=d,w.overview.view=e.waveform.waveformOverview,w},t=function(r){e.waveform.waveformOverview.data.set_segment(e.waveform.waveformOverview.data.at_time(r.startTime),e.waveform.waveformOverview.data.at_time(r.endTime),r.id),e.waveform.waveformZoomView.data.set_segment(e.waveform.waveformZoomView.data.at_time(r.startTime),e.waveform.waveformZoomView.data.at_time(r.endTime),r.id);var a=e.waveform.waveformOverview.data.at_time(r.startTime),t=e.waveform.waveformOverview.data.at_time(r.endTime);r.overview.setWidth(t-a),r.editable&&(r.overview.inMarker&&r.overview.inMarker.show().setX(a-r.overview.inMarker.getWidth()),r.overview.outMarker&&r.overview.outMarker.show().setX(t),r.overview.inMarker.label.setText(mixins.niceTime(r.startTime,!1)),r.overview.outMarker.label.setText(mixins.niceTime(r.endTime,!1))),SegmentShape.update.call(r.overview.waveformShape,e.waveform.waveformOverview,r.id),r.overview.view.segmentLayer.draw();var i=e.waveform.waveformZoomView.data.at_time(r.startTime),o=e.waveform.waveformZoomView.data.at_time(r.endTime),m=e.waveform.waveformZoomView.frameOffset,n=e.waveform.waveformZoomView.frameOffset+e.waveform.waveformZoomView.width;if(m>i&&(i=m),o>n&&(o=n),e.waveform.waveformZoomView.data.segments[r.id].visible){var v=i-m,s=o-m;r.zoom.show(),SegmentShape.update.call(r.zoom.waveformShape,e.waveform.waveformZoomView,r.id),r.editable&&(r.zoom.inMarker&&r.zoom.inMarker.show().setX(v-r.zoom.inMarker.getWidth()),r.zoom.outMarker&&r.zoom.outMarker.show().setX(s),r.zoom.inMarker.label.setText(mixins.niceTime(r.startTime,!1)),r.zoom.outMarker.label.setText(mixins.niceTime(r.endTime,!1)))}else r.zoom.hide()},i=function(e,r){if(e.inMarker.getX()>0){var a=e.view.frameOffset+e.inMarker.getX()+e.inMarker.getWidth();r.startTime=e.view.data.time(a)}if(e.outMarker.getX()<e.view.width){var i=e.view.frameOffset+e.outMarker.getX();r.endTime=e.view.data.time(i)}t(r)},o=function(){var r;if(e.options.randomizeSegmentColor){var a=function(){return Math.floor(255*Math.random())};r="rgba("+a()+", "+a()+", "+a()+", 1)"}else r=e.options.segmentColor;return r};this.init=function(){e.on("waveform_zoom_displaying",this.updateSegments.bind(this)),e.emit("segments.ready")},this.updateSegments=function(){this.segments.forEach(t),this.render()},this.createSegment=function(e,i,o,m,n){var v="segment"+r.segments.length;if(e>=0==!1)throw new TypeError("[waveform.segments.createSegment] startTime should be a positive value");if(i>0==!1)throw new TypeError("[waveform.segments.createSegment] endTime should be a positive value");if(i>e==!1)throw new RangeError("[waveform.segments.createSegment] endTime should be higher than startTime");var s=a(v,e,i,o,m,n);return t(s),r.segments.push(s),s},this.remove=function(e){var r=null;return this.segments.some(function(a,t){return a===e?(r=t,!0):void 0}),"number"==typeof r&&(e=this.segments[r],e.overview.destroy(),e.zoom.destroy()),r},this.render=function(){this.views.forEach(function(e){e.segmentLayer.draw()})}};
//# sourceMappingURL=peaks.min.map
},{"Kinetic":1,"peaks/markers/shapes/wave":13,"peaks/waveform/waveform.mixins":22}],16:[function(_dereq_,module,exports){
var mixins=_dereq_("peaks/waveform/waveform.mixins"),radio=function(e){var t={timeFromPercentage:function(e,t){return e*(t/100)}};return{init:function(t){var i=this;this.player=t,this.duration=this.player.duration,4===this.player.readyState&&e.emit("player_load",i),this.player.addEventListener("timeupdate",function(){e.emit("player_time_update",i.getTime())}),this.player.addEventListener("play",function(){e.emit("player_play",i.getTime())}),this.player.addEventListener("pause",function(){e.emit("player_pause",i.getTime())}),this.player.addEventListener("seeked",function(){e.emit("waveform_seek",i.getTime())})},setSource:function(e){this.player.setAttribute("src",e)},getSource:function(){return this.player.src},play:function(){this.player.play(),e.emit("radio_play",this.getTime())},pause:function(){this.player.pause(),e.emit("radio_pause",this.getTime())},getTime:function(){return this.player.currentTime},getTimeFromPercentage:function(e){return mixins.niceTime(this.duration*e/100,!1)},getSecsFromPercentage:function(e){return Math.floor(this.duration*e/100)},getDuration:function(){return this.duration},getPercentage:function(){return this.getPercentageFromSeconds(this.player.currentTime)},getPercentageFromSeconds:function(e){var t=e/this.duration*100;return Math.round(100*t)/100},seek:function(e){this.player.currentTime=t.timeFromPercentage(this.duration,e)},seekBySeconds:function(e){this.player.currentTime=e}}};module.exports=radio;
//# sourceMappingURL=peaks.min.map
},{"peaks/waveform/waveform.mixins":22}],17:[function(_dereq_,module,exports){
"use strict";function handleKeyEventGenerator(e){return function(t){var n=t.keyCode,r=t.type;if(-1===["OBJECT","TEXTAREA","INPUT","SELECT","OPTION"].indexOf(t.target.nodeName))if([SPACE,TAB,LEFT_ARROW,RIGHT_ARROW].indexOf(t.type)>-1&&t.preventDefault(),"keydown"===r||"keypress"===r)switch(n){case SPACE:e.emit("kybrd_space");break;case TAB:e.emit("kybrd_tab")}else if("keyup"===r)switch(n){case LEFT_ARROW:e.emit(t.shiftKey?"kybrd_shift_left":"kybrd_left");break;case RIGHT_ARROW:e.emit(e.shiftKey?"kybrd_shift_right":"kybrd_right")}}}var SPACE=32,TAB=9,LEFT_ARROW=37,RIGHT_ARROW=39;module.exports={init:function(e){document.addEventListener("keydown",handleKeyEventGenerator(e)),document.addEventListener("keypress",handleKeyEventGenerator(e)),document.addEventListener("keyup",handleKeyEventGenerator(e))}};
//# sourceMappingURL=peaks.min.map
},{}],18:[function(_dereq_,module,exports){
function WaveformOverview(e,t,a){var i=this;i.peaks=a,i.options=a.options,i.data=e,i.width=t.clientWidth,i.height=t.clientHeight||i.options.height,i.frameOffset=0,i.seeking=!1,i.stage=new Kinetic.Stage({container:t,width:i.width,height:i.height}),i.waveformLayer=new Kinetic.Layer,i.background=new Kinetic.Rect({x:0,y:0,width:i.width,height:i.height}),i.waveformLayer.add(i.background),i.createWaveform(),i.createRefWaveform(),i.createUi(),i.stage.add(i.waveformLayer);var r=function(){i.stage.off("mousemove mouseup"),i.seeking=!1};i.stage.on("mousedown",function(e){if(e.targetNode&&!e.targetNode.attrs.draggable&&!e.targetNode.parent.attrs.draggable)if("mousedown"==e.type){i.seeking=!0;var t=i.refWaveformRect.getWidth();i.updateRefWaveform(i.data.time(e.layerX),i.data.time(e.layerX+t)),a.emit("overview_user_seek",i.data.time(e.layerX),e.layerX),i.stage.on("mousemove",function(e){i.updateRefWaveform(i.data.time(e.layerX),i.data.time(e.layerX+t)),a.emit("overview_user_seek",i.data.time(e.layerX),e.layerX)}),i.stage.on("mouseup",r)}else r()}),a.on("player_time_update",function(e){i.seeking||(i.playheadPixel=i.data.at_time(e),i.updateUi(i.playheadPixel))}),a.on("overview_user_seek",function(e,t){i.playheadPixel=t,i.updateUi(i.playheadPixel),i.options.mediaElement.currentTime=e}),a.on("waveform_zoom_displaying",function(e,t){i.updateRefWaveform(e,t)}),a.on("resizeEndOverview",function(e,t){i.width=e,i.data=t,i.stage.setWidth(i.width),a.emit("overview_resized")})}var WaveformAxis=_dereq_("peaks/waveform/waveform.axis"),mixins=_dereq_("peaks/waveform/waveform.mixins"),Kinetic=_dereq_("Kinetic");WaveformOverview.prototype.createWaveform=function(){var e=this;this.waveformShape=new Kinetic.Shape({fill:e.options.overviewWaveformColor,strokeWidth:0}),this.waveformShape.setDrawFunc(mixins.waveformDrawFunction.bind(this.waveformShape,e)),this.waveformLayer.add(this.waveformShape),this.stage.add(this.waveformLayer)},WaveformOverview.prototype.createRefWaveform=function(){this.refLayer=new Kinetic.Layer,this.refWaveformRect=new Kinetic.Rect({x:0,y:11,width:0,stroke:"grey",strokeWidth:1,height:this.height-22,fill:"grey",opacity:.3,cornerRadius:2}),this.refLayer.add(this.refWaveformRect),this.stage.add(this.refLayer)},WaveformOverview.prototype.createUi=function(){var e=this;this.playheadLine=new Kinetic.Line({points:e._getPlayheadPoints(0),stroke:e.options.playheadColor,strokeWidth:1}),e.uiLayer=new Kinetic.Layer,e.axis=new WaveformAxis(e),this.uiLayer.add(this.playheadLine),this.stage.add(this.uiLayer)},WaveformOverview.prototype.updateRefWaveform=function(e,t){var a=this,i=a.data.at_time(e),r=a.data.at_time(t);a.data.set_segment(i,r,"zoom"),mixins.waveformRectDrawFunction.call(this,a.data),a.refWaveformRect.setWidth(a.data.at_time(t)-a.data.at_time(e)),a.refLayer.draw()},WaveformOverview.prototype.updateUi=function(e){var t=this;t.playheadLine.setAttr("points",t._getPlayheadPoints(e)),t.uiLayer.setZIndex(100),t.uiLayer.draw()},WaveformOverview.prototype._getPlayheadPoints=function(e){var t=this;return[{x:e+.5,y:0},{x:e+.5,y:t.height}]},module.exports=WaveformOverview;
//# sourceMappingURL=peaks.min.map
},{"Kinetic":1,"peaks/waveform/waveform.axis":20,"peaks/waveform/waveform.mixins":22}],19:[function(_dereq_,module,exports){
function WaveformZoomView(e,a,t){var o=this;o.cur_scale=0,o.peaks=t,o.options=t.options,o.rootData=e,o.playing=!1,o.seeking=!1,o.intermediateData=null,o.data=o.rootData.resample({scale:o.options.zoomLevels[t.zoom.getZoom()]}),o.playheadPixel=o.data.at_time(o.options.mediaElement.currentTime),o.pixelLength=o.data.adapter.length,o.frameOffset=0,o.width=a.clientWidth,o.height=a.clientHeight||o.options.height,o.stage=new Kinetic.Stage({container:a,width:o.width,height:o.height}),o.zoomWaveformLayer=new Kinetic.Layer,o.uiLayer=new Kinetic.Layer,o.background=new Kinetic.Rect({x:0,y:0,width:o.width,height:o.height}),o.zoomWaveformLayer.add(o.background),o.axis=new WaveformAxis(o),o.createZoomWaveform(),o.createUi(),o.stage.on("mousedown",function(e){if(e.targetNode&&!e.targetNode.attrs.draggable&&!e.targetNode.parent.attrs.draggable&&"mousedown"===e.type){var a,t,i=e.layerX;o.seeking=!0,o.stage.on("mousemove",function(e){o.seeking=!1,a=e.layerX>i?i-e.layerX:1*(i-e.layerX),i=e.layerX,t=o.frameOffset+a,t=0>t?0:t>o.pixelLength-o.width?o.pixelLength-o.width:t,o.updateZoomWaveform(t)}),o.stage.on("mouseup",function(){o.seeking&&o.peaks.emit("zoomview_user_seek",o.data.time(o.frameOffset+i),o.frameOffset+i),o.stage.off("mousemove mouseup"),o.seeking=!1})}});var i=function(e){var a=o.data.at_time(e);o.seekFrame(a),o.playing&&o.playFrom(e,a)};o.peaks.on("player_time_update",function(e){o.seeking||o.playing||o.seekFrame(o.data.at_time(e))}),o.peaks.on("zoomview_user_seek",function(e,a){o.options.mediaElement.currentTime=e,o.syncPlayhead(a),o.playing&&o.playFrom(e,o.data.at_time(e))}),o.peaks.on("waveform_seek",i),o.peaks.on("overview_user_seek",i),o.peaks.on("player_play",function(e){o.playing=!0,o.playFrom(e,o.data.at_time(e))}),o.peaks.on("player_pause",function(e){o.playing=!1,o.playheadLineAnimation&&o.playheadLineAnimation.stop(),o.syncPlayhead(o.data.at_time(e))}),o.peaks.on("zoom.update",function(e,a){o.playing||e!==a&&(o.data=o.rootData.resample({scale:e}),o.startZoomAnimation(e,a))}),o.peaks.on("window_resized",function(e,a){o.width=e,o.data=a,o.stage.setWidth(o.width),o.updateZoomWaveform(o.frameOffset),o.peaks.emit("zoomview_resized")});var r=function(e){var a=o.options.mediaElement.currentTime;a+=o.options.nudgeIncrement*e,o.seekFrame(o.data.at_time(a))};o.peaks.on("kybrd_left",r.bind(o,-1)),o.peaks.on("kybrd_right",r.bind(o,1)),o.peaks.on("kybrd_shift_left",r.bind(o,-10)),o.peaks.on("kybrd_shift_right",r.bind(o,10))}var WaveformAxis=_dereq_("peaks/waveform/waveform.axis"),mixins=_dereq_("peaks/waveform/waveform.mixins"),Kinetic=_dereq_("Kinetic");WaveformZoomView.prototype.createZoomWaveform=function(){var e=this;e.zoomWaveformShape=new Kinetic.Shape({fill:e.options.zoomWaveformColor,strokeWidth:0}),e.zoomWaveformShape.setDrawFunc(mixins.waveformDrawFunction.bind(e.zoomWaveformShape,e)),e.zoomWaveformLayer.add(e.zoomWaveformShape),e.stage.add(e.zoomWaveformLayer),e.peaks.emit("waveform_zoom_displaying",0*e.data.seconds_per_pixel,e.width*e.data.seconds_per_pixel)},WaveformZoomView.prototype.createUi=function(){var e=this;e.zoomPlayheadLine=new Kinetic.Line({points:[{x:0,y:0},{x:0,y:e.height}],stroke:e.options.playheadColor,strokeWidth:1}),e.zoomPlayheadText=new Kinetic.Text({x:2,y:12,text:"00:00:00",fontSize:11,fontFamily:"sans-serif",fill:"#aaa",align:"right"}),e.zoomPlayheadGroup=new Kinetic.Group({x:0,y:0}).add(e.zoomPlayheadLine).add(e.zoomPlayheadText),e.uiLayer.add(e.zoomPlayheadGroup),e.stage.add(e.uiLayer)},WaveformZoomView.prototype.updateZoomWaveform=function(e){var a=this;a.frameOffset=e,a.pixelLength=a.data.adapter.length,a.data.offset(e,e+a.width);var t=a.playheadPixel>=e&&a.playheadPixel<=e+a.width;if(t){var o=a.playheadPixel-e;a.zoomPlayheadGroup.show().setAttr("x",o+.5),a.zoomPlayheadText.setText(mixins.niceTime(a.data.time(a.playheadPixel),!1))}else a.zoomPlayheadGroup.hide();a.uiLayer.draw(),a.zoomWaveformLayer.draw(),a.peaks.emit("waveform_zoom_displaying",e*a.data.seconds_per_pixel,(e+a.width)*a.data.seconds_per_pixel),a.peaks.emit("waveform_zoom_displaying_finished",e*a.data.seconds_per_pixel,(e+a.width)*a.data.seconds_per_pixel)},WaveformZoomView.prototype.playFrom=function(e,a){var t=this;t.playheadLineAnimation&&t.playheadLineAnimation.stop();var o=0,i=t.data.pixels_per_second;t.playheadLineAnimation=new Kinetic.Animation(function(e){var r=e.time,n=r/1e3,m=Math.round(a-t.frameOffset+i*(n-o));t.syncPlayhead(t.frameOffset+m)},t.uiLayer),t.playheadLineAnimation.start()},WaveformZoomView.prototype.newFrame=function(e){var a=e+this.width;return a<this.data.adapter.length?(this.frameOffset=a,this.updateZoomWaveform(a),!0):!1},WaveformZoomView.prototype.syncPlayhead=function(e){var a=this,t=e>=a.frameOffset&&e<=a.frameOffset+a.width;if(a.playheadPixel=e,t){var o=a.playheadPixel-a.frameOffset;a.zoomPlayheadGroup.show().setAttr("x",o+.5),a.zoomPlayheadText.setText(mixins.niceTime(a.data.time(a.playheadPixel),!1))}else a.zoomPlayheadGroup.hide()},WaveformZoomView.prototype.seekFrame=function(e){var a=this,t=a.data.adapter.length-a.width;a.data.in_offset(e)||(a.frameOffset=e>a.width&&t>e?e-Math.round(a.width/2):e>=t?t:0),a.syncPlayhead(e),a.updateZoomWaveform(a.frameOffset)},WaveformZoomView.prototype.startZoomAnimation=function(e,a){var t,o,i,r=this,n=r.peaks.time.getCurrentTime(),m=[],s=30;r.segmentLayer&&r.segmentLayer.setVisible(!1),e>a&&(s=15);for(var d=0;s>d;d++){var p=Math.round(a+(d+1)*(e-a)/s),f=r.width*p/r.rootData.adapter.sample_rate;if(n>=0&&0+f/2>=n)t=0,o=0;else if(n<=r.rootData.duration&&n>=r.rootData.duration-f/2)i=r.rootData.duration-f,t=i*r.rootData.adapter.sample_rate/a,o=i*r.rootData.adapter.sample_rate/p;else{var l=n*r.rootData.adapter.sample_rate/a;t=l-r.width/2;var h=n*r.rootData.adapter.sample_rate/p;o=h-r.width/2}var y=r.rootData.resample({scale:p,input_index:Math.floor(t),output_index:Math.floor(o),width:r.width});m.push(y),a=p}r.runZoomAnimation(m)},WaveformZoomView.prototype.runZoomAnimation=function(e){var a=this;if(a.intermediateData=null,e.length){var t=e.shift();a.intermediateData=t,a.zoomWaveformLayer.draw(),Kinetic.Animation.requestAnimFrame(function(){a.runZoomAnimation(e)})}else a.segmentLayer.setVisible(!0),a.seekFrame(a.data.at_time(a.currentTime))},module.exports=WaveformZoomView;
//# sourceMappingURL=peaks.min.map
},{"Kinetic":1,"peaks/waveform/waveform.axis":20,"peaks/waveform/waveform.mixins":22}],20:[function(_dereq_,module,exports){
function roundUpToNearest(e,i){var t=e%i;return 0===t?e:e+i-t}function WaveformAxis(e){this.view=e,this.axisShape=new Kinetic.Shape({fill:"rgba(38, 255, 161, 1)",strokeWidth:0,opacity:1}),this.axisShape.setDrawFunc(this.axisDrawFunction.bind(this,e)),this.view.uiLayer.add(this.axisShape)}var mixins=_dereq_("peaks/waveform/waveform.mixins"),Kinetic=_dereq_("Kinetic");WaveformAxis.prototype.getAxisLabelScale=function(){for(var e,i=1,t=[1,2,5,10,20,30],a=60,s=0;;){e=i*t[s];var r=this.view.data.at_time(e);if(!(a>r))break;++s==t.length&&(i*=60,s=0)}return e},WaveformAxis.prototype.axisDrawFunction=function(e,i){var t=e.data.time(e.frameOffset),a=10,s=this.getAxisLabelScale(),r=roundUpToNearest(t,s),o=r-t,n=this.view.data.at_time(o),h=i.getContext();h.strokeStyle="#ccc",h.lineWidth=1,h.font="11px sans-serif",h.fillStyle="#aaa",h.textAlign="left",h.textBaseline="bottom";for(var v,f=r;v=n+this.view.data.at_time(f-r),!(v>=this.view.width);){h.beginPath(),h.moveTo(v+.5,0),h.lineTo(v+.5,0+a),h.moveTo(v+.5,this.view.height),h.lineTo(v+.5,this.view.height-a),h.stroke();var x=mixins.niceTime(f,!0),l=h.measureText(x).width,m=v-l/2,c=this.view.height-1-a;m>=0&&h.fillText(x,m,c),f+=s}},module.exports=WaveformAxis;
//# sourceMappingURL=peaks.min.map
},{"Kinetic":1,"peaks/waveform/waveform.mixins":22}],21:[function(_dereq_,module,exports){
var WaveformData=_dereq_("waveform-data"),WaveformOverview=_dereq_("peaks/views/waveform.overview"),WaveformZoomView=_dereq_("peaks/views/waveform.zoomview"),WaveformSegments=_dereq_("peaks/markers/waveform.segments"),WaveformPoints=_dereq_("peaks/markers/waveform.points"),isXhr2="withCredentials"in new XMLHttpRequest;module.exports=function(e){return{init:function(i){this.ui=i;var t=this;t.getRemoteData(e.options)},getRemoteData:function(e){var i=this,t=new XMLHttpRequest,r=null,a=null,o=null;if(e.dataUri){if("string"==typeof e.dataUri){var n={};n[e.dataUriDefaultFormat||"json"]=e.dataUri,e.dataUri=n}"object"==typeof e.dataUri&&["ArrayBuffer","JSON"].some(function(i){return window[i]?(a=i.toLowerCase(),r=e.dataUri[a],Boolean(r)):void 0})}if(!e.dataUri&&WaveformData.builders.webaudio.getAudioContext()&&(a="arraybuffer",r=e.mediaElement.currentSrc||e.mediaElement.src,o="webaudio"),!r&&!a)throw new Error("Unable to determine a compatible dataUri format for this browser.");if(t.open("GET",r,!0),isXhr2)try{t.responseType=a}catch(m){}t.onload=function(e){4===this.readyState&&200===this.status&&(o?WaveformData.builders[o](e.target.response,i.handleRemoteData.bind(i)):i.handleRemoteData(e.target,t))},t.send()},handleRemoteData:function(i){this.origWaveformData=i instanceof WaveformData?i:WaveformData.create(i);var t=this.origWaveformData.resample(this.ui.player.clientWidth);this.waveformOverview=new WaveformOverview(t,this.ui.overview,e),e.emit("waveformOverviewReady"),this.bindResize()},openZoomView:function(){var i=this;i.waveformZoomView=new WaveformZoomView(i.origWaveformData,i.ui.zoom,e),i.segments=new WaveformSegments(e),i.segments.init(),i.points=new WaveformPoints(e),i.points.init(),e.emit("waveformZoomReady")},bindResize:function(){var i=this;window.addEventListener("resize",function(){i.ui.overview.hidden=!0,i.ui.zoom.hidden=!0,i.resizeTimeoutId&&clearTimeout(i.resizeTimeoutId),i.resizeTimeoutId=setTimeout(function(){var t=i.ui.player.clientWidth,r=i.origWaveformData.resample(t);e.emit("resizeEndOverview",t,r),e.emit("window_resized",t,i.origWaveformData)},500)}),e.on("overview_resized",function(){i.ui.overview.removeAttribute("hidden")}),e.on("zoomview_resized",function(){i.ui.zoom.removeAttribute("hidden")})}}};
//# sourceMappingURL=peaks.min.map
},{"peaks/markers/waveform.points":14,"peaks/markers/waveform.segments":15,"peaks/views/waveform.overview":18,"peaks/views/waveform.zoomview":19,"waveform-data":10}],22:[function(_dereq_,module,exports){
function createPointHandle(e,t){return function(n,r,o,i,a,u){var f=0,l=.5,c=e/2-10.5,s=e/2+9.5,d=e,h=9.75,g=[[l,f],[l,c],[h,c],[h,s],[l,s],[l,d]],v=new Kinetic.Group({draggable:n,dragBoundFunc:function(e){return{x:e.x,y:this.getAbsolutePosition().y}}}).on("dragmove",function(){i(r,o)});a&&v.on("dblclick",function(){a(o)}),u&&v.on("dragend",function(){u(o)});var m=-24,w=new Kinetic.Text({x:m,y:e/2-5,text:"",fontSize:10,fontFamily:"sans-serif",fill:"#000",textAlign:"center"});w.hide(),v.label=w,v.add(w);var x=new Kinetic.Polygon({points:g,fill:t,stroke:t,strokeWidth:1}).on("mouseover",function(){w.show(),w.setX(m-w.getWidth()),r.view.pointLayer.draw()}).on("mouseout",function(){w.hide(),r.view.pointLayer.draw()});return v.add(x),v}}function drawWaveform(e,t,n,r,o,i){e.beginPath(),t.forEach(function(t,n){e.lineTo(r+n+.5,i(t)+.5)}),n.reverse().forEach(function(t,n){e.lineTo(r+(o-n)+.5,i(t)+.5)}),e.closePath()}function interpolateHeightGenerator(e){var t=256;return function(n){return e-(n+128)*e/t}}var Kinetic=_dereq_("Kinetic"),createHandle=function(e,t,n){return function(r,o,i,a){var u=0,f=.5,l=e/2-10.5,c=e/2+9.5,s=e,d=n?-19.5:19.5,h=[[f,u],[f,l],[d,l],[d,c],[f,c],[f,s]],g=new Kinetic.Group({draggable:r,dragBoundFunc:function(e){var t;return n?(t=o.outMarker.getX()-o.outMarker.getWidth(),e.x>t&&(e.x=t)):(t=o.inMarker.getX()+o.inMarker.getWidth(),e.x<t&&(e.x=t)),{x:e.x,y:this.getAbsolutePosition().y}}}).on("dragmove",function(){a(o,i)}),v=n?-24:24,m=new Kinetic.Text({x:v,y:e/2-5,text:"",fontSize:10,fontFamily:"sans-serif",fill:"#000",textAlign:"center"});m.hide(),g.label=m,g.add(m);var w=new Kinetic.Polygon({points:h,fill:t,stroke:t,strokeWidth:1}).on("mouseover",function(){m.show(),n&&m.setX(v-m.getWidth()),o.view.segmentLayer.draw()}).on("mouseout",function(){m.hide(),o.view.segmentLayer.draw()});return g.add(w),g}};module.exports={interpolateHeight:interpolateHeightGenerator,drawWaveform:drawWaveform,waveformDrawFunction:function(e,t){var n=e.intermediateData||e.data,r=interpolateHeightGenerator(e.height),o=n.offset_length,i=t.getContext();drawWaveform(i,n.min,n.max,0,o,r),t.fillStroke(this)},waveformOverviewMarkerDrawFunction:function(e,t,n){t.waveformShape.setPoints([e,0,e,n.height])},waveformRectDrawFunction:function(e){void 0!==e.segments.zoom&&this.refWaveformRect.setAttrs({x:e.segments.zoom.offset_start-e.offset_start,width:e.segments.zoom.offset_length})},niceTime:function(e,t){var n,r,o,i,a=[];n=Math.floor(e%1*100),r=Math.floor(e),o=Math.floor(r/60),i=Math.floor(o/60),i>0&&a.push(i),a.push(o%60),a.push(r%60);for(var u=0;u<a.length;u++){var f=a[u];a[u]=10>f?"0"+f:f}return a=a.join(":"),t||(10>n&&(n="0"+n),a+="."+n),a},defaultInMarker:function(e){return createHandle(e.height,e.outMarkerColor,!0)},defaultOutMarker:function(e){return createHandle(e.height,e.outMarkerColor,!1)},defaultPointMarker:function(e){return createPointHandle(e.height,e.pointMarkerColor)},defaultSegmentLabelDraw:function(){return function(e,t){return new Kinetic.Text({x:12,y:12,text:t.labelText,fontSize:12,fontFamily:"Arial, sans-serif",fill:"#000",textAlign:"center"})}}};
//# sourceMappingURL=peaks.min.map
},{"Kinetic":1}]},{},[11])

(11)
});

//# sourceMappingURL=peaks.min.map