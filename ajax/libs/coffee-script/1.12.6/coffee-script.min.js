(function(){var e,n,r,t,o,i,a,u,l,s,c,f,p,m,h,d,g,x,y,S,v={}.hasOwnProperty;if(a=require("fs"),y=require("vm"),h=require("path"),e=require("./lexer").Lexer,m=require("./parser").parser,l=require("./helpers"),n=require("./sourcemap"),p=require("../../package.json"),exports.VERSION=p.version,exports.FILE_EXTENSIONS=[".coffee",".litcoffee",".coffee.md"],exports.helpers=l,r=function(e){switch(!1){case"function"!=typeof Buffer:return new Buffer(e).toString("base64");case"function"!=typeof btoa:return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,n){return String.fromCharCode("0x"+n)}));default:throw new Error("Unable to base64 encode inline sourcemap.")}},S=function(e){return function(n,r){var t;null==r&&(r={});try{return e.call(this,n,r)}catch(e){if(t=e,"string"!=typeof n)throw t;throw l.updateSyntaxError(t,n,r.filename)}}},x={},g={},exports.compile=t=S(function(e,t){var o,i,a,u,s,c,p,h,d,y,S,v,E,N,b,I,T,q,_;if(l.merge,a=l.extend,t=a({},t),p=t.sourceMap||t.inlineMap||null==t.filename,u=t.filename||"<anonymous>",x[u]=e,p&&(E=new n),q=f.tokenize(e,t),t.referencedVars=function(){var e,n,r;for(r=[],e=0,n=q.length;e<n;e++)"IDENTIFIER"===(T=q[e])[0]&&r.push(T[1]);return r}(),null==t.bare||!0!==t.bare)for(h=0,S=q.length;h<S;h++)if(T=q[h],"IMPORT"===(b=T[0])||"EXPORT"===b){t.bare=!0;break}for(c=m.parse(q).compileToFragments(t),i=0,t.header&&(i+=1),t.shiftLine&&(i+=1),o=0,y="",d=0,v=c.length;d<v;d++)s=c[d],p&&(s.locationData&&!/^[;\s]*$/.test(s.code)&&E.add([s.locationData.first_line,s.locationData.first_column],[i,o],{noReplace:!0}),i+=N=l.count(s.code,"\n"),N?o=s.code.length-(s.code.lastIndexOf("\n")+1):o+=s.code.length),y+=s.code;return t.header&&(y="// "+("Generated by CoffeeScript "+this.VERSION)+"\n"+y),p&&(_=E.generate(t,e),g[u]=E),t.inlineMap&&(y=y+"\n"+("//# sourceMappingURL=data:application/json;base64,"+r(JSON.stringify(_)))+"\n"+("//# sourceURL="+(null!=(I=t.filename)?I:"coffeescript"))),t.sourceMap?{js:y,sourceMap:E,v3SourceMap:JSON.stringify(_,null,2)}:y}),exports.tokens=S(function(e,n){return f.tokenize(e,n)}),exports.nodes=S(function(e,n){return"string"==typeof e?m.parse(f.tokenize(e,n)):m.parse(e)}),exports.run=function(e,n){var r,o,i,u;return null==n&&(n={}),i=require.main,i.filename=process.argv[1]=n.filename?a.realpathSync(n.filename):"<anonymous>",i.moduleCache&&(i.moduleCache={}),o=null!=n.filename?h.dirname(a.realpathSync(n.filename)):a.realpathSync("."),i.paths=require("module")._nodeModulePaths(o),l.isCoffee(i.filename)&&!require.extensions||(e=null!=(u=(r=t(e,n)).js)?u:r),i._compile(e,i.filename)},exports.eval=function(e,n){var r,o,i,a,u,l,s,c,f,p,m,d,g,x,S,E,N;if(null==n&&(n={}),e=e.trim()){if(a=null!=(d=y.Script.createContext)?d:y.createContext,l=null!=(g=y.isContext)?g:function(e){return n.sandbox instanceof a().constructor},a){if(null!=n.sandbox){if(l(n.sandbox))E=n.sandbox;else{E=a(),x=n.sandbox;for(c in x)v.call(x,c)&&(N=x[c],E[c]=N)}E.global=E.root=E.GLOBAL=E}else E=global;if(E.__filename=n.filename||"eval",E.__dirname=h.dirname(E.__filename),E===global&&!E.module&&!E.require){for(r=require("module"),E.module=o=new r(n.modulename||"eval"),E.require=i=function(e){return r._load(e,o,!0)},o.filename=E.__filename,u=0,f=(S=Object.getOwnPropertyNames(require)).length;u<f;u++)"paths"!==(m=S[u])&&"arguments"!==m&&"caller"!==m&&(i[m]=require[m]);i.paths=o.paths=r._nodeModulePaths(process.cwd()),i.resolve=function(e){return r._resolveFilename(e,o)}}}p={};for(c in n)v.call(n,c)&&(N=n[c],p[c]=N);return p.bare=!0,s=t(e,p),E===global?y.runInThisContext(s):y.runInContext(s,E)}},exports.register=function(){return require("./register")},require.extensions)for(o=function(e){var n;return null!=(n=require.extensions)[e]?n[e]:n[e]=function(){throw new Error("Use CoffeeScript.register() or require the coffee-script/register module to require "+e+" files.")}},s=0,c=(d=this.FILE_EXTENSIONS).length;s<c;s++)o(d[s]);exports._compileFile=function(e,n,r){var o,i,u,s;null==n&&(n=!1),null==r&&(r=!1),u=a.readFileSync(e,"utf8"),s=65279===u.charCodeAt(0)?u.substring(1):u;try{o=t(s,{filename:e,sourceMap:n,inlineMap:r,sourceFiles:[e],literate:l.isLiterate(e)})}catch(n){throw i=n,l.updateSyntaxError(i,s,e)}return o},f=new e,m.lexer={lex:function(){var e,n;return n=m.tokens[this.pos++],n?(e=n[0],this.yytext=n[1],this.yylloc=n[2],m.errorToken=n.origin||n,this.yylineno=this.yylloc.first_line):e="",e},setInput:function(e){return m.tokens=e,this.pos=0},upcomingInput:function(){return""}},m.yy=require("./nodes"),m.yy.parseError=function(e,n){var r,t,o,i,a;return n.token,i=m.errorToken,a=m.tokens,t=i[0],o=i[1],r=i[2],o=function(){switch(!1){case i!==a[a.length-1]:return"end of input";case"INDENT"!==t&&"OUTDENT"!==t:return"indentation";case"IDENTIFIER"!==t&&"NUMBER"!==t&&"INFINITY"!==t&&"STRING"!==t&&"STRING_START"!==t&&"REGEX"!==t&&"REGEX_START"!==t:return t.replace(/_START$/,"").toLowerCase();default:return l.nameWhitespaceCharacter(o)}}(),l.throwSyntaxError("unexpected "+o,r)},i=function(e,n){var r,t,o,i,a,u,l,s,c,f,p,m;return i=void 0,o="",e.isNative()?o="native":(e.isEval()?(i=e.getScriptNameOrSourceURL())||(o=e.getEvalOrigin()+", "):i=e.getFileName(),i||(i="<anonymous>"),o=(f=n(i,s=e.getLineNumber(),t=e.getColumnNumber()))?i+":"+f[0]+":"+f[1]:i+":"+s+":"+t),a=e.getFunctionName(),u=e.isConstructor(),l=!(e.isToplevel()||u),l?(c=e.getMethodName(),m=e.getTypeName(),a?(p=r="",m&&a.indexOf(m)&&(p=m+"."),c&&a.indexOf("."+c)!==a.length-c.length-1&&(r=" [as "+c+"]"),""+p+a+r+" ("+o+")"):m+"."+(c||"<anonymous>")+" ("+o+")"):u?"new "+(a||"<anonymous>")+" ("+o+")":a?a+" ("+o+")":o},u=function(e){return null!=g[e]?g[e]:null!=g["<anonymous>"]?g["<anonymous>"]:null!=x[e]?t(x[e],{filename:e,sourceMap:!0,literate:l.isLiterate(e)}).sourceMap:null},Error.prepareStackTrace=function(e,n){var r,t,o;return o=function(e,n,r){var t,o;return null!=(o=u(e))&&(t=o.sourceLocation([n-1,r-1])),null!=t?[t[0]+1,t[1]+1]:null},t=function(){var e,t,a;for(a=[],e=0,t=n.length;e<t&&(r=n[e]).getFunction()!==exports.run;e++)a.push("    at "+i(r,o));return a}(),e.toString()+"\n"+t.join("\n")+"\n"}}).call(this);