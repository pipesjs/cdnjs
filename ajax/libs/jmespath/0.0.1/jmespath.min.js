!function(t){"use strict";function e(t){return null!==t&&"[object Array]"===toString.call(t)}function r(t){return null!==t&&"[object Object]"===toString.call(t)}function i(t,n){if(t===n)return!0;var s=toString.call(t);if(s!==toString.call(n))return!1;if(e(t)===!0){if(t.length!==n.length)return!1;for(var a=0;a<t.length;a++)if(i(t[a],n[a])===!1)return!1;return!0}if(r(t)===!0){var o={};for(var u in t)if(hasOwnProperty.call(t,u)){if(i(t[u],n[u])===!1)return!1;o[u]=!0}for(var h in n)if(hasOwnProperty.call(n,h)&&o[h]!==!0)return!1;return!0}return!1}function n(t){if(""===t||t===!1||null===t)return!0;if(e(t)&&0===t.length)return!0;if(r(t)){var i;for(i in t)return!1;return!0}return!1}function s(t){for(var e=Object.keys(t),r=[],i=0;i<e.length;i++)r.push(t[e[i]]);return r}function a(t,e){var r={};for(var i in t)r[i]=t[i];for(var n in e)r[n]=e[n];return r}function o(){}function u(){this.bindingPower={EOF:0,UnquotedIdentifier:0,QuotedIdentifier:0,Rbracket:0,Rparen:0,Comma:0,Rbrace:0,Number:0,Current:0,Expref:0,Pipe:1,EQ:2,GT:2,LT:2,GTE:2,LTE:2,NE:2,Or:5,Flatten:6,Star:20,Dot:40,Lbrace:50,Filter:50,Lbracket:50,Lparen:60}}function h(){}function c(t){var e=new u;return e.parse(t)}function l(t){var e=new o;return e.tokenize(t)}function d(t,e){var r=new u,i=r.parse(e),n=new h;return n.search(i,t)}var f={".":"Dot","*":"Star",",":"Comma",":":"Colon","{":"Lbrace","}":"Rbrace","]":"Rbracket","(":"Lparen",")":"Rparen","@":"Current","&":"Expref"},p={a:!0,b:!0,c:!0,d:!0,e:!0,f:!0,g:!0,h:!0,i:!0,j:!0,k:!0,l:!0,m:!0,n:!0,o:!0,p:!0,q:!0,r:!0,s:!0,t:!0,u:!0,v:!0,w:!0,x:!0,y:!0,z:!0,A:!0,B:!0,C:!0,D:!0,E:!0,F:!0,G:!0,H:!0,I:!0,J:!0,K:!0,L:!0,M:!0,N:!0,O:!0,P:!0,Q:!0,R:!0,S:!0,T:!0,U:!0,V:!0,W:!0,X:!0,Y:!0,Z:!0,_:!0},v={"<":!0,">":!0,"=":!0,"!":!0},k={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0,"-":!0},y=a(p,k),m={" ":!0,"\t":!0,"\n":!0};o.prototype={tokenize:function(t){var e=[];this.current=0;for(var r,i,n;this.current<t.length;)if(void 0!==p[t[this.current]])r=this.current,i=this.consumeUnquotedIdentifier(t),e.push({type:"UnquotedIdentifier",value:i,start:r});else if(void 0!==f[t[this.current]])e.push({type:f[t[this.current]],value:t[this.current],start:this.current}),this.current++;else if(void 0!==k[t[this.current]])n=this.consumeNumber(t),e.push(n);else if("["===t[this.current])n=this.consumeLBracket(t),e.push(n);else if('"'===t[this.current])r=this.current,i=this.consumeQuotedIdentifier(t),e.push({type:"QuotedIdentifier",value:i,start:r});else if("`"===t[this.current]){r=this.current;var s=this.consumeLiteral(t);e.push({type:"Literal",value:s,start:r})}else if(void 0!==v[t[this.current]])e.push(this.consumeOperator(t));else if(void 0!==m[t[this.current]])this.current++;else{if("|"!==t[this.current]){var a=new Error("Unknown character:"+t[this.current]);throw a.name="LexerError",a}r=this.current,this.current++,"|"===t[this.current]?(this.current++,e.push({type:"Or",value:"||",start:r})):e.push({type:"Pipe",value:"|",start:r})}return e},consumeUnquotedIdentifier:function(t){var e=this.current;for(this.current++;void 0!==y[t[this.current]];)this.current++;return t.slice(e,this.current)},consumeQuotedIdentifier:function(t){var e=this.current;this.current++;for(var r=t.length;'"'!==t[this.current]&&this.current<r;){var i=this.current;"\\"!==t[i]||"\\"!==t[i+1]&&'"'!==t[i+1]?i++:i+=2,this.current=i}return this.current++,JSON.parse(t.slice(e,this.current))},consumeNumber:function(t){var e=this.current;this.current++;for(var r=t.length;void 0!==k[t[this.current]]&&this.current<r;)this.current++;var i=parseInt(t.slice(e,this.current));return{type:"Number",value:i,start:e}},consumeLBracket:function(t){var e=this.current;return this.current++,"?"===t[this.current]?(this.current++,{type:"Filter",value:"[?",start:e}):"]"===t[this.current]?(this.current++,{type:"Flatten",value:"[]",start:e}):{type:"Lbracket",value:"[",start:e}},consumeOperator:function(t){var e=this.current,r=t[e];if(this.current++,"!"===r){if("="===t[this.current])return this.current++,{type:"NE",value:"!=",start:e}}else{if("<"===r)return"="===t[this.current]?(this.current++,{type:"LTE",value:"<=",start:e}):{type:"LT",value:"<",start:e};if(">"===r)return"="===t[this.current]?(this.current++,{type:"GTE",value:">=",start:e}):{type:"GT",value:">",start:e};if("="===r&&"="===t[this.current])return this.current++,{type:"EQ",value:"==",start:e}}},consumeLiteral:function(t){this.current++;for(var e,r=this.current,i=t.length;"`"!==t[this.current]&&this.current<i;){var n=this.current;"\\"!==t[n]||"\\"!==t[n+1]&&"`"!==t[n+1]?n++:n+=2,this.current=n}var s=t.slice(r,this.current).trim();return s=s.replace("\\`","`"),e=this.looksLikeJSON(s)?JSON.parse(s):JSON.parse('"'+s+'"'),this.current++,e},looksLikeJSON:function(t){var e='[{"',r=["true","false","null"],i="-0123456789";if(""===t)return!1;if(e.indexOf(t[0])>=0)return!0;if(r.indexOf(t)>=0)return!0;if(!(i.indexOf(t[0])>=0))return!1;try{return JSON.parse(t),!0}catch(t){return!1}}},u.prototype={parse:function(t){this.loadTokens(t),this.index=0;var e=this.expression(0);if("EOF"!==this.lookahead(0)){var r=this.lookaheadToken(0),i=new Error("Unexpected token type: "+r.type+", value: "+r.value);throw i.name="ParserError",i}return e},loadTokens:function(t){var e=new o,r=e.tokenize(t);r.push({type:"EOF",value:"",start:t.length}),this.tokens=r},expression:function(t){var e=this.lookaheadToken(0);this.advance();for(var r="nud"+e.type,i=this[r]||this.errorToken,n=i.call(this,e),s=this.lookahead(0);t<this.bindingPower[s];){var a=this["led"+s];void 0===a&&this.errorToken(this.lookaheadToken(0)),this.advance(),n=a.call(this,n),s=this.lookahead(0)}return n},lookahead:function(t){return this.tokens[this.index+t].type},lookaheadToken:function(t){return this.tokens[this.index+t]},advance:function(){this.index++},match:function(t){if(this.lookahead(0)!==t){var e=this.lookaheadToken(0),r=new Error("Expected "+t+", got: "+e.type);throw r.name="ParserError",r}this.advance()},errorToken:function(t){var e=new Error("Invalid token ("+t.type+'): "'+t.value+'"');throw e.name="ParserError",e},nudLiteral:function(t){return{type:"Literal",value:t.value}},nudUnquotedIdentifier:function(t){return{type:"Field",name:t.value}},nudQuotedIdentifier:function(t){var e={type:"Field",name:t.value};if("Lparen"===this.lookahead(0))throw new Error("Quoted identifier not allowed for function names.");return e},ledOr:function(t){var e=this.expression(this.bindingPower.Or);return{type:"OrExpression",children:[t,e]}},ledPipe:function(t){var e=this.expression(this.bindingPower.Pipe);return{type:"Pipe",children:[t,e]}},nudStar:function(){var t={type:"Identity"},e=null;return e="Rbracket"===this.lookahead(0)?{type:"Identity"}:this.parseProjectionRHS(this.bindingPower.Star),{type:"ValueProjection",children:[t,e]}},nudLbracket:function(){if("Number"===this.lookahead(0)){var t={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match("Rbracket"),t}if("Star"===this.lookahead(0)&&"Rbracket"===this.lookahead(1)){this.advance(),this.advance();var e=this.parseProjectionRHS(this.bindingPower.Star);return{type:"Projection",children:[{type:"Identity"},e]}}return this.parseMultiselectList()},nudLbrace:function(){return this.parseMultiselectHash()},ledDot:function(t){var e,r=this.bindingPower.Dot;return"Star"!==this.lookahead(0)?(e=this.parseDotRHS(r),{type:"Subexpression",children:[t,e]}):(this.advance(),e=this.parseProjectionRHS(r),{type:"ValueProjection",children:[t,e]})},nudFilter:function(){return this.ledFilter({type:"Identity"})},ledFilter:function(t){var e,r=this.expression(0);return this.match("Rbracket"),e="Flatten"===this.lookahead(0)?{type:"Identity"}:this.parseProjectionRHS(this.bindingPower.Filter),{type:"FilterProjection",children:[t,e,r]}},ledEQ:function(t){return this.parseComparator(t,"EQ")},ledNE:function(t){return this.parseComparator(t,"NE")},ledGT:function(t){return this.parseComparator(t,"GT")},ledGTE:function(t){return this.parseComparator(t,"GTE")},ledLT:function(t){return this.parseComparator(t,"LT")},ledLTE:function(t){return this.parseComparator(t,"LTE")},parseComparator:function(t,e){var r=this.expression(this.bindingPower[e]);return{type:"Comparator",name:e,children:[t,r]}},ledLbracket:function(t){var e,r=this.lookaheadToken(0);return"Number"===r.type?(this.match("Number"),e={type:"Index",value:r.value},this.match("Rbracket"),{type:"IndexExpression",children:[t,e]}):(this.match("Star"),this.match("Rbracket"),e=this.parseProjectionRHS(this.bindingPower.Star),{type:"Projection",children:[t,e]})},nudFlatten:function(){var t={type:"Flatten",children:[{type:"Identity"}]},e=this.parseProjectionRHS(this.bindingPower.Flatten);return{type:"Projection",children:[t,e]}},ledFlatten:function(t){var e={type:"Flatten",children:[t]},r=this.parseProjectionRHS(this.bindingPower.Flatten);return{type:"Projection",children:[e,r]}},parseDotRHS:function(t){var e=this.lookahead(0),r=["UnquotedIdentifier","QuotedIdentifier","Star"];return r.indexOf(e)>=0?this.expression(t):"Lbracket"===e?(this.match("Lbracket"),this.parseMultiselectList()):"Lbrace"===e?(this.match("Lbrace"),this.parseMultiselectHash()):void 0},parseProjectionRHS:function(t){var e;if(this.bindingPower[this.lookahead(0)]<10)e={type:"Identity"};else if("Lbracket"===this.lookahead(0))e=this.expression(t);else if("Filter"===this.lookahead(0))e=this.expression(t);else{if("Dot"!==this.lookahead(0)){var r=this.lookaheadToken(0),i=new Error("Sytanx error, unexpected token: "+r.value+"("+r.type+")");throw i.name="ParserError",i}this.match("Dot"),e=this.parseDotRHS(t)}return e},parseMultiselectList:function(){for(var t=[];"Rbracket"!==this.lookahead(0);){var e=this.expression(0);if(t.push(e),"Comma"===this.lookahead(0)&&(this.match("Comma"),"Rbracket"===this.lookahead(0)))throw new Error("Unexpected token Rbracket")}return this.match("Rbracket"),{type:"MultiSelectList",children:t}},parseMultiselectHash:function(){for(var t,e,r,i,n=[],s=["UnquotedIdentifier","QuotedIdentifier"];;){if(t=this.lookaheadToken(0),s.indexOf(t.type)<0)throw new Error("Expecting an identifier token, got: "+t.type);if(e=t.value,this.advance(),this.match("Colon"),r=this.expression(0),i={type:"KeyValuePair",name:e,value:r},n.push(i),"Comma"===this.lookahead(0))this.match("Comma");else if("Rbrace"===this.lookahead(0)){this.match("Rbrace");break}}return{type:"MultiSelectHash",children:n}}},h.prototype={search:function(t,e){return this.visit(t,e)},visit:function(t,e){var r=this["visit"+t.type];if(void 0===r)throw new Error("Unknown node type: "+t.type);return r.call(this,t,e)},visitField:function(t,e){if(null===e)return null;if(r(e)){var i=e[t.name];return void 0===i?null:i}return null},visitSubexpression:function(t,e){for(var r=this.visit(t.children[0],e),i=1;i<t.children.length;i++)if(r=this.visit(t.children[1],r),null===r)return null;return r},visitIndexExpression:function(t,e){var r=this.visit(t.children[0],e),i=this.visit(t.children[1],r);return i},visitIndex:function(t,r){if(!e(r))return null;var i=t.value;i<0&&(i=r.length+i);var n=r[i];return void 0===n&&(n=null),n},visitProjection:function(t,r){var i=this.visit(t.children[0],r);if(!e(i))return null;for(var n=[],s=0;s<i.length;s++){var a=this.visit(t.children[1],i[s]);null!==a&&n.push(a)}return n},visitValueProjection:function(t,e){var i=this.visit(t.children[0],e);if(!r(i))return null;for(var n=[],a=s(i),o=0;o<a.length;o++){var u=this.visit(t.children[1],a[o]);null!==u&&n.push(u)}return n},visitFilterProjection:function(t,r){var i=this.visit(t.children[0],r);if(!e(i))return null;for(var n,s,a=[],o=[],u=0;u<i.length;u++)n=this.visit(t.children[2],i[u]),n===!0&&a.push(i[u]);for(var h=0;h<a.length;h++)s=this.visit(t.children[1],a[h]),null!==s&&o.push(s);return o},visitComparator:function(t,e){var r,n=this.visit(t.children[0],e),s=this.visit(t.children[1],e);switch(t.name){case"EQ":r=i(n,s);break;case"NE":r=!i(n,s);break;case"GT":r=n>s;break;case"GTE":r=n>=s;break;case"LT":r=n<s;break;case"LTE":r=n<=s;break;default:throw new Error("Unknown comparator: "+t.name)}return r},visitFlatten:function(t,r){var i=this.visit(t.children[0],r);if(!e(i))return null;for(var n=[],s=0;s<i.length;s++){var a=i[s];e(a)?n.push.apply(n,a):n.push(a)}return n},visitIdentity:function(t,e){return e},visitMultiSelectList:function(t,e){if(null===e)return null;for(var r=[],i=0;i<t.children.length;i++)r.push(this.visit(t.children[i],e));return r},visitMultiSelectHash:function(t,e){if(null===e)return null;for(var r,i={},n=0;n<t.children.length;n++)r=t.children[n],i[r.name]=this.visit(r.value,e);return i},visitOrExpression:function(t,e){var r=this.visit(t.children[0],e);return n(r)&&(r=this.visit(t.children[1],e)),r},visitLiteral:function(t){return t.value},visitPipe:function(t,e){var r=this.visit(t.children[0],e);return this.visit(t.children[1],r)}},t.tokenize=l,t.compile=c,t.search=d,t.Parser=u,t.strictDeepEqual=i}("undefined"==typeof exports?this.jmespath={}:exports);
//# sourceMappingURL=jmespath.min.js.map