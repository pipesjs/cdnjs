!function(t){"use strict";function e(t){return null!==t&&"[object Array]"===toString.call(t)}function r(t){return null!==t&&"[object Object]"===toString.call(t)}function n(t,i){if(t===i)return!0;var a=toString.call(t);if(a!==toString.call(i))return!1;if(e(t)===!0){if(t.length!==i.length)return!1;for(var s=0;s<t.length;s++)if(n(t[s],i[s])===!1)return!1;return!0}if(r(t)===!0){var u={};for(var o in t)if(hasOwnProperty.call(t,o)){if(n(t[o],i[o])===!1)return!1;u[o]=!0}for(var c in i)if(hasOwnProperty.call(i,c)&&u[c]!==!0)return!1;return!0}return!1}function i(t){if(""===t||t===!1||null===t)return!0;if(e(t)&&0===t.length)return!0;if(r(t)){var n;for(n in t)return!1;return!0}return!1}function a(t){for(var e=Object.keys(t),r=[],n=0;n<e.length;n++)r.push(t[e[n]]);return r}function s(t,e){var r={};for(var n in t)r[n]=t[n];for(var i in e)r[i]=e[i];return r}function u(){}function o(){this.bindingPower={EOF:0,UnquotedIdentifier:0,QuotedIdentifier:0,Rbracket:0,Rparen:0,Comma:0,Rbrace:0,Number:0,Current:0,Expref:0,Pipe:1,EQ:2,GT:2,LT:2,GTE:2,LTE:2,NE:2,Or:5,Flatten:6,Star:20,Dot:40,Lbrace:50,Filter:50,Lbracket:55,Lparen:60}}function c(t){this.runtime=t}function h(t){this.interpreter=t,this.functionTable={abs:{func:this.functionAbs,signature:[{types:["number"]}]},avg:{func:this.functionAvg,signature:[{types:["array-number"]}]},ceil:{func:this.functionCeil,signature:[{types:["number"]}]},contains:{func:this.functionContains,signature:[{types:["string","array"]},{types:["any"]}]},floor:{func:this.functionFloor,signature:[{types:["number"]}]},length:{func:this.functionLength,signature:[{types:["string","array","object"]}]},max:{func:this.functionMax,signature:[{types:["array-number"]}]},max_by:{func:this.functionMaxBy,signature:[{types:["array"]},{types:["expref"]}]},sum:{func:this.functionSum,signature:[{types:["array-number"]}]},min:{func:this.functionMin,signature:[{types:["array-number"]}]},min_by:{func:this.functionMinBy,signature:[{types:["array"]},{types:["expref"]}]},type:{func:this.functionType,signature:[{types:["any"]}]},keys:{func:this.functionKeys,signature:[{types:["object"]}]},values:{func:this.functionValues,signature:[{types:["object"]}]},sort:{func:this.functionSort,signature:[{types:["array-string","array-number"]}]},sort_by:{func:this.functionSortBy,signature:[{types:["array"]},{types:["expref"]}]},join:{func:this.functionJoin,signature:[{types:["string"]},{types:["array-string"]}]},to_string:{func:this.functionToString,signature:[{types:["any"]}]},to_number:{func:this.functionToNumber,signature:[{types:["any"]}]},not_null:{func:this.functionNotNull,signature:[{types:["any"],variadic:!0}]}}}function l(t){var e=new o,r=e.parse(t);return r}function f(t){var e=new u;return e.tokenize(t)}function p(t,e){var r=new o,n=new h,i=new c(n);n.interpreter=i;var a=r.parse(e);return i.search(a,t)}var d={".":"Dot","*":"Star",",":"Comma",":":"Colon","{":"Lbrace","}":"Rbrace","]":"Rbracket","(":"Lparen",")":"Rparen","@":"Current","&":"Expref"},v={a:!0,b:!0,c:!0,d:!0,e:!0,f:!0,g:!0,h:!0,i:!0,j:!0,k:!0,l:!0,m:!0,n:!0,o:!0,p:!0,q:!0,r:!0,s:!0,t:!0,u:!0,v:!0,w:!0,x:!0,y:!0,z:!0,A:!0,B:!0,C:!0,D:!0,E:!0,F:!0,G:!0,H:!0,I:!0,J:!0,K:!0,L:!0,M:!0,N:!0,O:!0,P:!0,Q:!0,R:!0,S:!0,T:!0,U:!0,V:!0,W:!0,X:!0,Y:!0,Z:!0,_:!0},y={"<":!0,">":!0,"=":!0,"!":!0},m={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0,"-":!0},g=s(v,m),b={" ":!0,"\t":!0,"\n":!0};u.prototype={tokenize:function(t){var e=[];this.current=0;for(var r,n,i;this.current<t.length;)if(void 0!==v[t[this.current]])r=this.current,n=this.consumeUnquotedIdentifier(t),e.push({type:"UnquotedIdentifier",value:n,start:r});else if(void 0!==d[t[this.current]])e.push({type:d[t[this.current]],value:t[this.current],start:this.current}),this.current++;else if(void 0!==m[t[this.current]])i=this.consumeNumber(t),e.push(i);else if("["===t[this.current])i=this.consumeLBracket(t),e.push(i);else if('"'===t[this.current])r=this.current,n=this.consumeQuotedIdentifier(t),e.push({type:"QuotedIdentifier",value:n,start:r});else if("`"===t[this.current]){r=this.current;var a=this.consumeLiteral(t);e.push({type:"Literal",value:a,start:r})}else if(void 0!==y[t[this.current]])e.push(this.consumeOperator(t));else if(void 0!==b[t[this.current]])this.current++;else{if("|"!==t[this.current]){var s=new Error("Unknown character:"+t[this.current]);throw s.name="LexerError",s}r=this.current,this.current++,"|"===t[this.current]?(this.current++,e.push({type:"Or",value:"||",start:r})):e.push({type:"Pipe",value:"|",start:r})}return e},consumeUnquotedIdentifier:function(t){var e=this.current;for(this.current++;void 0!==g[t[this.current]];)this.current++;return t.slice(e,this.current)},consumeQuotedIdentifier:function(t){var e=this.current;this.current++;for(var r=t.length;'"'!==t[this.current]&&this.current<r;){var n=this.current;"\\"!==t[n]||"\\"!==t[n+1]&&'"'!==t[n+1]?n++:n+=2,this.current=n}return this.current++,JSON.parse(t.slice(e,this.current))},consumeNumber:function(t){var e=this.current;this.current++;for(var r=t.length;void 0!==m[t[this.current]]&&this.current<r;)this.current++;var n=parseInt(t.slice(e,this.current));return{type:"Number",value:n,start:e}},consumeLBracket:function(t){var e=this.current;return this.current++,"?"===t[this.current]?(this.current++,{type:"Filter",value:"[?",start:e}):"]"===t[this.current]?(this.current++,{type:"Flatten",value:"[]",start:e}):{type:"Lbracket",value:"[",start:e}},consumeOperator:function(t){var e=this.current,r=t[e];if(this.current++,"!"===r){if("="===t[this.current])return this.current++,{type:"NE",value:"!=",start:e}}else{if("<"===r)return"="===t[this.current]?(this.current++,{type:"LTE",value:"<=",start:e}):{type:"LT",value:"<",start:e};if(">"===r)return"="===t[this.current]?(this.current++,{type:"GTE",value:">=",start:e}):{type:"GT",value:">",start:e};if("="===r&&"="===t[this.current])return this.current++,{type:"EQ",value:"==",start:e}}},consumeLiteral:function(t){this.current++;for(var e,r=this.current,n=t.length;"`"!==t[this.current]&&this.current<n;){var i=this.current;"\\"!==t[i]||"\\"!==t[i+1]&&"`"!==t[i+1]?i++:i+=2,this.current=i}var a=t.slice(r,this.current).trimLeft();return a=a.replace("\\`","`"),e=this.looksLikeJSON(a)?JSON.parse(a):JSON.parse('"'+a+'"'),this.current++,e},looksLikeJSON:function(t){var e='[{"',r=["true","false","null"],n="-0123456789";if(""===t)return!1;if(e.indexOf(t[0])>=0)return!0;if(r.indexOf(t)>=0)return!0;if(!(n.indexOf(t[0])>=0))return!1;try{return JSON.parse(t),!0}catch(t){return!1}}},o.prototype={parse:function(t){this.loadTokens(t),this.index=0;var e=this.expression(0);if("EOF"!==this.lookahead(0)){var r=this.lookaheadToken(0),n=new Error("Unexpected token type: "+r.type+", value: "+r.value);throw n.name="ParserError",n}return e},loadTokens:function(t){var e=new u,r=e.tokenize(t);r.push({type:"EOF",value:"",start:t.length}),this.tokens=r},expression:function(t){var e=this.lookaheadToken(0);this.advance();for(var r="nud"+e.type,n=this[r]||this.errorToken,i=n.call(this,e),a=this.lookahead(0);t<this.bindingPower[a];){var s=this["led"+a];void 0===s&&this.errorToken(this.lookaheadToken(0)),this.advance(),i=s.call(this,i),a=this.lookahead(0)}return i},lookahead:function(t){return this.tokens[this.index+t].type},lookaheadToken:function(t){return this.tokens[this.index+t]},advance:function(){this.index++},match:function(t){if(this.lookahead(0)!==t){var e=this.lookaheadToken(0),r=new Error("Expected "+t+", got: "+e.type);throw r.name="ParserError",r}this.advance()},errorToken:function(t){var e=new Error("Invalid token ("+t.type+'): "'+t.value+'"');throw e.name="ParserError",e},nudLiteral:function(t){return{type:"Literal",value:t.value}},nudUnquotedIdentifier:function(t){return{type:"Field",name:t.value}},nudExpref:function(){var t=this.expression(this.bindingPower.Expref);return{type:"ExpressionReference",children:[t]}},nudQuotedIdentifier:function(t){var e={type:"Field",name:t.value};if("Lparen"===this.lookahead(0))throw new Error("Quoted identifier not allowed for function names.");return e},ledOr:function(t){var e=this.expression(this.bindingPower.Or);return{type:"OrExpression",children:[t,e]}},ledPipe:function(t){var e=this.expression(this.bindingPower.Pipe);return{type:"Pipe",children:[t,e]}},nudStar:function(){var t={type:"Identity"},e=null;return e="Rbracket"===this.lookahead(0)?{type:"Identity"}:this.parseProjectionRHS(this.bindingPower.Star),{type:"ValueProjection",children:[t,e]}},nudLbracket:function(){if("Number"===this.lookahead(0)){var t={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match("Rbracket"),t}if("Star"===this.lookahead(0)&&"Rbracket"===this.lookahead(1)){this.advance(),this.advance();var e=this.parseProjectionRHS(this.bindingPower.Star);return{type:"Projection",children:[{type:"Identity"},e]}}return this.parseMultiselectList()},nudLbrace:function(){return this.parseMultiselectHash()},ledDot:function(t){var e,r=this.bindingPower.Dot;return"Star"!==this.lookahead(0)?(e=this.parseDotRHS(r),{type:"Subexpression",children:[t,e]}):(this.advance(),e=this.parseProjectionRHS(r),{type:"ValueProjection",children:[t,e]})},nudFilter:function(){return this.ledFilter({type:"Identity"})},ledFilter:function(t){var e,r=this.expression(0);return this.match("Rbracket"),e="Flatten"===this.lookahead(0)?{type:"Identity"}:this.parseProjectionRHS(this.bindingPower.Filter),{type:"FilterProjection",children:[t,e,r]}},ledEQ:function(t){return this.parseComparator(t,"EQ")},ledNE:function(t){return this.parseComparator(t,"NE")},ledGT:function(t){return this.parseComparator(t,"GT")},ledGTE:function(t){return this.parseComparator(t,"GTE")},ledLT:function(t){return this.parseComparator(t,"LT")},ledLTE:function(t){return this.parseComparator(t,"LTE")},parseComparator:function(t,e){var r=this.expression(this.bindingPower[e]);return{type:"Comparator",name:e,children:[t,r]}},ledLbracket:function(t){var e,r=this.lookaheadToken(0);return"Number"===r.type?(this.match("Number"),e={type:"Index",value:r.value},this.match("Rbracket"),{type:"IndexExpression",children:[t,e]}):(this.match("Star"),this.match("Rbracket"),e=this.parseProjectionRHS(this.bindingPower.Star),{type:"Projection",children:[t,e]})},nudFlatten:function(){var t={type:"Flatten",children:[{type:"Identity"}]},e=this.parseProjectionRHS(this.bindingPower.Flatten);return{type:"Projection",children:[t,e]}},ledFlatten:function(t){var e={type:"Flatten",children:[t]},r=this.parseProjectionRHS(this.bindingPower.Flatten);return{type:"Projection",children:[e,r]}},ledLparen:function(t){for(var e,r,n=t.name,i=[];"Rparen"!==this.lookahead(0);)"Current"===this.lookahead(0)?(e={type:"Current"},this.advance()):e=this.expression(0),"Comma"===this.lookahead(0)&&this.match("Comma"),i.push(e);return this.match("Rparen"),r={type:"Function",name:n,children:i}},parseDotRHS:function(t){var e=this.lookahead(0),r=["UnquotedIdentifier","QuotedIdentifier","Star"];return r.indexOf(e)>=0?this.expression(t):"Lbracket"===e?(this.match("Lbracket"),this.parseMultiselectList()):"Lbrace"===e?(this.match("Lbrace"),this.parseMultiselectHash()):void 0},parseProjectionRHS:function(t){var e;if(this.bindingPower[this.lookahead(0)]<10)e={type:"Identity"};else if("Lbracket"===this.lookahead(0))e=this.expression(t);else if("Filter"===this.lookahead(0))e=this.expression(t);else{if("Dot"!==this.lookahead(0)){var r=this.lookaheadToken(0),n=new Error("Sytanx error, unexpected token: "+r.value+"("+r.type+")");throw n.name="ParserError",n}this.match("Dot"),e=this.parseDotRHS(t)}return e},parseMultiselectList:function(){for(var t=[];"Rbracket"!==this.lookahead(0);){var e=this.expression(0);if(t.push(e),"Comma"===this.lookahead(0)&&(this.match("Comma"),"Rbracket"===this.lookahead(0)))throw new Error("Unexpected token Rbracket")}return this.match("Rbracket"),{type:"MultiSelectList",children:t}},parseMultiselectHash:function(){for(var t,e,r,n,i=[],a=["UnquotedIdentifier","QuotedIdentifier"];;){if(t=this.lookaheadToken(0),a.indexOf(t.type)<0)throw new Error("Expecting an identifier token, got: "+t.type);if(e=t.value,this.advance(),this.match("Colon"),r=this.expression(0),n={type:"KeyValuePair",name:e,value:r},i.push(n),"Comma"===this.lookahead(0))this.match("Comma");else if("Rbrace"===this.lookahead(0)){this.match("Rbrace");break}}return{type:"MultiSelectHash",children:i}}},c.prototype={search:function(t,e){return this.visit(t,e)},visit:function(t,e){var r=this["visit"+t.type];if(void 0===r)throw new Error("Unknown node type: "+t.type);return r.call(this,t,e)},visitField:function(t,e){if(null===e)return null;if(r(e)){var n=e[t.name];return void 0===n?null:n}return null},visitSubexpression:function(t,e){for(var r=this.visit(t.children[0],e),n=1;n<t.children.length;n++)if(r=this.visit(t.children[1],r),null===r)return null;return r},visitIndexExpression:function(t,e){var r=this.visit(t.children[0],e),n=this.visit(t.children[1],r);return n},visitIndex:function(t,r){if(!e(r))return null;var n=t.value;n<0&&(n=r.length+n);var i=r[n];return void 0===i&&(i=null),i},visitProjection:function(t,r){var n=this.visit(t.children[0],r);if(!e(n))return null;for(var i=[],a=0;a<n.length;a++){var s=this.visit(t.children[1],n[a]);null!==s&&i.push(s)}return i},visitValueProjection:function(t,e){var n=this.visit(t.children[0],e);if(!r(n))return null;for(var i=[],s=a(n),u=0;u<s.length;u++){var o=this.visit(t.children[1],s[u]);null!==o&&i.push(o)}return i},visitFilterProjection:function(t,r){var n=this.visit(t.children[0],r);if(!e(n))return null;for(var i,a,s=[],u=[],o=0;o<n.length;o++)i=this.visit(t.children[2],n[o]),i===!0&&s.push(n[o]);for(var c=0;c<s.length;c++)a=this.visit(t.children[1],s[c]),null!==a&&u.push(a);return u},visitComparator:function(t,e){var r,i=this.visit(t.children[0],e),a=this.visit(t.children[1],e);switch(t.name){case"EQ":r=n(i,a);break;case"NE":r=!n(i,a);break;case"GT":r=i>a;break;case"GTE":r=i>=a;break;case"LT":r=i<a;break;case"LTE":r=i<=a;break;default:throw new Error("Unknown comparator: "+t.name)}return r},visitFlatten:function(t,r){var n=this.visit(t.children[0],r);if(!e(n))return null;for(var i=[],a=0;a<n.length;a++){var s=n[a];e(s)?i.push.apply(i,s):i.push(s)}return i},visitIdentity:function(t,e){return e},visitMultiSelectList:function(t,e){if(null===e)return null;for(var r=[],n=0;n<t.children.length;n++)r.push(this.visit(t.children[n],e));return r},visitMultiSelectHash:function(t,e){if(null===e)return null;for(var r,n={},i=0;i<t.children.length;i++)r=t.children[i],n[r.name]=this.visit(r.value,e);return n},visitOrExpression:function(t,e){var r=this.visit(t.children[0],e);return i(r)&&(r=this.visit(t.children[1],e)),r},visitLiteral:function(t){return t.value},visitPipe:function(t,e){var r=this.visit(t.children[0],e);return this.visit(t.children[1],r)},visitCurrent:function(t,e){return e},visitFunction:function(t,e){for(var r=[],n=0;n<t.children.length;n++)r.push(this.visit(t.children[n],e));return this.runtime.callFunction(t.name,r)},visitExpressionReference:function(t){var e=t.children[0];return e.jmespathType="Expref",e}},h.prototype={callFunction:function(t,e){var r=this.functionTable[t];if(void 0===r)throw new Error("Unknown function: "+t+"()");return this.validateArgs(t,e,r.signature),r.func.call(this,e)},validateArgs:function(t,e,r){var n;if(r[r.length-1].variadic){if(e.length<r.length)throw n=1===r.length?" argument":" arguments",new Error("ArgumentError: "+t+"() takes at least"+r.length+n+" but received "+e.length)}else if(e.length!==r.length)throw n=1===r.length?" argument":" arguments",new Error("ArgumentError: "+t+"() takes "+r.length+n+" but received "+e.length);for(var i,a,s,u=0;u<r.length;u++){s=!1,i=r[u].types,a=this.getTypeName(e[u]);for(var o=0;o<i.length;o++)if(this.typeMatches(a,i[o],e[u])){s=!0;break}if(!s)throw new Error("TypeError: "+t+"() expected argument "+(u+1)+" to be type "+i+" but received type "+a+" instead.")}},typeMatches:function(t,e,r){if("any"===e)return!0;if(0!==e.indexOf("array"))return t===e;if("array"===e)return 0===t.indexOf("array");if(0===t.indexOf("array")){for(var n=e.split("-")[1],i=0;i<r.length;i++)if(!this.typeMatches(this.getTypeName(r[i]),n,r[i]))return!1;return!0}},getTypeName:function(t){switch(toString.call(t)){case"[object String]":return"string";case"[object Number]":return"number";case"[object Array]":return"array";case"[object Boolean]":return"boolean";case"[object Null]":return"null";case"[object Object]":return"Expref"===t.jmespathType?"expref":"object"}},functionAbs:function(t){return Math.abs(t[0])},functionCeil:function(t){return Math.ceil(t[0])},functionAvg:function(t){for(var e=0,r=t[0],n=0;n<r.length;n++)e+=r[n];return e/r.length},functionContains:function(t){return t[0].indexOf(t[1])>=0},functionFloor:function(t){return Math.floor(t[0])},functionLength:function(t){return r(t[0])?Object.keys(t[0]).length:t[0].length},functionMax:function(t){return t[0].length>0?Math.max.apply(Math,t[0]):null},functionMin:function(t){return t[0].length>0?Math.min.apply(Math,t[0]):null},functionSum:function(t){for(var e=0,r=t[0],n=0;n<r.length;n++)e+=r[n];return e},functionType:function(t){return this.getTypeName(t[0])},functionKeys:function(t){return Object.keys(t[0])},functionValues:function(t){for(var e=t[0],r=Object.keys(e),n=[],i=0;i<r.length;i++)n.push(e[r[i]]);return n},functionJoin:function(t){var e=t[0],r=t[1];return r.join(e)},functionToString:function(t){return"string"===this.getTypeName(t[0])?t[0]:JSON.stringify(t[0])},functionToNumber:function(t){var e,r=this.getTypeName(t[0]);return"number"===r?t[0]:"string"!==r||(e=+t[0],isNaN(e))?null:e},functionNotNull:function(t){for(var e=0;e<t.length;e++)if("null"!==this.getTypeName(t[e]))return t[e];return null},functionSort:function(t){var e=t[0].slice(0);return e.sort(),e},functionSortBy:function(t){var e=t[0].slice(0);if(!e)return e;var r=this.interpreter,n=t[1],i=this.getTypeName(r.visit(n,e[0]));if(["number","string"].indexOf(i)<0)throw new Error("TypeError");var a=this;return e.sort(function(t,e){var s=r.visit(n,t),u=r.visit(n,e);if(a.getTypeName(s)!==i)throw new Error("TypeError: expected "+i+", received "+a.getTypeName(s));if(a.getTypeName(u)!==i)throw new Error("TypeError: expected "+i+", received "+a.getTypeName(u));return s>u?1:s<u?-1:0}),e},functionMaxBy:function(t){for(var e,r,n=t[1],i=t[0],a=this.createKeyFunction(n,["number"]),s=-(1/0),u=0;u<i.length;u++)r=a(i[u]),r>s&&(s=r,e=i[u]);return e},functionMinBy:function(t){for(var e,r,n=t[1],i=t[0],a=this.createKeyFunction(n,["number"]),s=1/0,u=0;u<i.length;u++)r=a(i[u]),r<s&&(s=r,e=i[u]);return e},createKeyFunction:function(t,e){var r=this,n=this.interpreter,i=function(i){var a=n.visit(t,i);if(e.indexOf(r.getTypeName(a))<0){var s="TypeError: expected one of "+e+", received "+r.getTypeName(a);throw new Error(s)}return a};return i}},t.tokenize=f,t.compile=l,t.search=p,t.Parser=o,t.strictDeepEqual=n}("undefined"==typeof exports?this.jmespath={}:exports);
//# sourceMappingURL=jmespath.min.js.map