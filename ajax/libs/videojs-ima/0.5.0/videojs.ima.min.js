!function(e){"use strict";var t=function(e){var t,i,s;for(i=1;i<arguments.length;i++){t=arguments[i];for(s in t)t.hasOwnProperty(s)&&(e[s]=t[s])}return e},i={debug:!1,timeout:5e3,prerollTimeout:100,adLabel:"Advertisement",showControlsForJSAds:!0},s=function(e,t){this.ima=new n(this,e,t)},n=function(e,s,n){this.player=e;var a=function(e,t){e.id=this.controlPrefix+t,e.className=this.controlPrefix+t+" "+t}.bind(this),d=function(e){return new RegExp("\\b"+e+"\\b","gi")},r=function(e,t){return d(t).test(e.className)?e:e.className=e.className.trim()+" "+t},h=function(e,t){var i=d(t);return i.test(e.className)?e.className=e.className.trim().replace(i,""):e},o=function(){this.vjsControls=this.player.getChild("controlBar"),this.adContainerDiv=this.vjsControls.el().parentNode.appendChild(document.createElement("div")),a(this.adContainerDiv,"ima-ad-container"),this.adContainerDiv.style.position="absolute",this.adContainerDiv.style.zIndex=1111,this.adContainerDiv.addEventListener("mouseenter",f,!1),this.adContainerDiv.addEventListener("mouseleave",A,!1),l(),this.adDisplayContainer=new google.ima.AdDisplayContainer(this.adContainerDiv,this.contentPlayer)}.bind(this),l=function(){this.controlsDiv=document.createElement("div"),a(this.controlsDiv,"ima-controls-div"),this.controlsDiv.style.width="100%",this.countdownDiv=document.createElement("div"),a(this.countdownDiv,"ima-countdown-div"),this.countdownDiv.innerHTML=this.settings.adLabel,this.countdownDiv.style.display=this.showCountdown?"block":"none",this.seekBarDiv=document.createElement("div"),a(this.seekBarDiv,"ima-seek-bar-div"),this.seekBarDiv.style.width="100%",this.progressDiv=document.createElement("div"),a(this.progressDiv,"ima-progress-div"),this.playPauseDiv=document.createElement("div"),a(this.playPauseDiv,"ima-play-pause-div"),r(this.playPauseDiv,"ima-playing"),this.playPauseDiv.addEventListener("click",C,!1),this.muteDiv=document.createElement("div"),a(this.muteDiv,"ima-mute-div"),r(this.muteDiv,"ima-non-muted"),this.muteDiv.addEventListener("click",L,!1),this.sliderDiv=document.createElement("div"),a(this.sliderDiv,"ima-slider-div"),this.sliderDiv.addEventListener("mousedown",E,!1),this.sliderLevelDiv=document.createElement("div"),a(this.sliderLevelDiv,"ima-slider-level-div"),this.fullscreenDiv=document.createElement("div"),a(this.fullscreenDiv,"ima-fullscreen-div"),r(this.fullscreenDiv,"ima-non-fullscreen"),this.fullscreenDiv.addEventListener("click",T,!1),this.adContainerDiv.appendChild(this.controlsDiv),this.controlsDiv.appendChild(this.countdownDiv),this.controlsDiv.appendChild(this.seekBarDiv),this.controlsDiv.appendChild(this.playPauseDiv),this.controlsDiv.appendChild(this.muteDiv),this.controlsDiv.appendChild(this.sliderDiv),this.controlsDiv.appendChild(this.fullscreenDiv),this.seekBarDiv.appendChild(this.progressDiv),this.sliderDiv.appendChild(this.sliderLevelDiv)}.bind(this);this.initializeAdDisplayContainer=function(){this.adDisplayContainerInitialized=!0,this.adDisplayContainer.initialize()}.bind(this),this.requestAds=function(){this.adDisplayContainerInitialized||this.adDisplayContainer.initialize();var e=new google.ima.AdsRequest;this.settings.adTagUrl?e.adTagUrl=this.settings.adTagUrl:e.adsResponse=this.settings.adsResponse,this.settings.forceNonLinearFullSlot&&(e.forceNonLinearFullSlot=!0),e.linearAdSlotWidth=this.getPlayerWidth(),e.linearAdSlotHeight=this.getPlayerHeight(),e.nonLinearAdSlotWidth=this.settings.nonLinearWidth||this.getPlayerWidth(),e.nonLinearAdSlotHeight=this.settings.nonLinearHeight||this.getPlayerHeight()/3,this.adsLoader.requestAds(e)}.bind(this);var u=function(e){if(this.adsManager=e.getAdsManager(this.contentPlayheadTracker,this.adsRenderingSettings),this.adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,g),this.adsManager.addEventListener(google.ima.AdEvent.Type.AD_BREAK_READY,v),this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,this.onContentPauseRequested_),this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,this.onContentResumeRequested_),this.adsManager.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,m),this.adsManager.addEventListener(google.ima.AdEvent.Type.LOADED,p),this.adsManager.addEventListener(google.ima.AdEvent.Type.STARTED,y),this.adsManager.addEventListener(google.ima.AdEvent.Type.CLICK,C),this.adsManager.addEventListener(google.ima.AdEvent.Type.COMPLETE,this.onAdComplete_),this.adsManager.addEventListener(google.ima.AdEvent.Type.SKIPPED,this.onAdComplete_),!this.autoPlayAdBreaks)try{var t=this.getPlayerWidth(),i=this.getPlayerHeight();this.adsManagerDimensions.width=t,this.adsManagerDimensions.height=i,this.adsManager.init(t,i,google.ima.ViewMode.NORMAL),this.adsManager.setVolume(this.player.muted()?0:this.player.volume())}catch(e){g(e)}this.player.trigger("adsready")}.bind(this);this.start=function(){window.console.log("WARNING: player.ima.start is deprecated. Use player.ima.startFromReadyCallback instead.")},this.startFromReadyCallback=function(){if(this.autoPlayAdBreaks)try{this.adsManager.init(this.getPlayerWidth(),this.getPlayerHeight(),google.ima.ViewMode.NORMAL),this.adsManager.setVolume(this.player.muted()?0:this.player.volume()),this.adsManager.start()}catch(e){this.onAdError_(e)}}.bind(this);var c=function(e){window.console.log("AdsLoader error: "+e.getError()),this.adContainerDiv.style.display="none",this.adsManager&&this.adsManager.destroy(),this.player.trigger({type:"adserror",data:{AdError:e.getError(),AdErrorEvent:e}})}.bind(this),g=function(e){window.console.log("Ad error: "+e.getError()),this.vjsControls.show(),this.adsManager.destroy(),this.adContainerDiv.style.display="none",this.player.trigger({type:"adserror",data:{AdError:e.getError(),AdErrorEvent:e}})}.bind(this),v=function(e){this.adBreakReadyListener(e)}.bind(this);this.playAdBreak=function(){this.autoPlayAdBreaks||this.adsManager.start()}.bind(this),this.onContentPauseRequested_=function(e){this.adsActive=!0,this.adPlaying=!0,this.player.off("ended",this.localContentEndedListener),-1!=e.getAd().getAdPodInfo().getPodIndex()&&this.player.ads.startLinearAdMode(),this.adContainerDiv.style.display="block","application/javascript"!==e.getAd().getContentType()||this.settings.showControlsForJSAds?this.controlsDiv.style.display="block":this.controlsDiv.style.display="none",this.vjsControls.hide(),this.player.pause()}.bind(this),this.onContentResumeRequested_=function(e){this.adsActive=!1,this.adPlaying=!1,this.player.on("ended",this.localContentEndedListener),(null==this.currentAd||this.currentAd.isLinear())&&(this.adContainerDiv.style.display="none"),this.vjsControls.show(),this.currentAd?this.contentComplete||-1==this.currentAd.getAdPodInfo().getPodIndex()||this.player.ads.endLinearAdMode():this.player.ads.endLinearAdMode(),this.countdownDiv.innerHTML=""}.bind(this);var m=function(e){if(this.allAdsCompleted=!0,1==this.contentComplete)for(var t in this.contentAndAdsEndedListeners)this.contentAndAdsEndedListeners[t]()}.bind(this),p=function(e){e.getAd().isLinear()||this.player.play()}.bind(this),y=function(e){this.currentAd=e.getAd(),this.currentAd.isLinear()?(this.adTrackingTimer=setInterval(D,250),h(this.adContainerDiv,"bumpable-ima-ad-container")):r(this.adContainerDiv,"bumpable-ima-ad-container")}.bind(this);this.onAdComplete_=function(e){this.currentAd.isLinear()&&clearInterval(this.adTrackingTimer)}.bind(this);var D=function(){var e=this.adsManager.getRemainingTime(),t=this.currentAd.getDuration(),i=t-e;i=i>0?i:0;var s,n=!1,a=0;this.currentAd.getAdPodInfo()&&(n=!0,s=this.currentAd.getAdPodInfo().getAdPosition(),a=this.currentAd.getAdPodInfo().getTotalAds());var d=Math.floor(e/60),r=Math.floor(e%60);r.toString().length<2&&(r="0"+r);var h=": ";n&&a>1&&(h=" ("+s+" of "+a+"): "),this.countdownDiv.innerHTML=this.settings.adLabel+h+d+":"+r;var o=i/t,l=100*o;this.progressDiv.style.width=l+"%"}.bind(this);this.getPlayerWidth=function(){return parseInt(getComputedStyle(this.player.el()).width,10)||this.player.width()}.bind(this),this.getPlayerHeight=function(){return parseInt(getComputedStyle(this.player.el()).height,10)||this.player.height()}.bind(this);var A=function(){this.controlsDiv.style.height="14px",this.playPauseDiv.style.display="none",this.muteDiv.style.display="none",this.sliderDiv.style.display="none",this.fullscreenDiv.style.display="none"}.bind(this),f=function(){this.controlsDiv.style.height="37px",this.playPauseDiv.style.display="block",this.muteDiv.style.display="block",this.sliderDiv.style.display="block",this.fullscreenDiv.style.display="block"}.bind(this),C=function(){this.adPlaying?(r(this.playPauseDiv,"ima-paused"),h(this.playPauseDiv,"ima-playing"),this.adsManager.pause(),this.adPlaying=!1):(r(this.playPauseDiv,"ima-playing"),h(this.playPauseDiv,"ima-paused"),this.adsManager.resume(),this.adPlaying=!0)}.bind(this),L=function(){this.adMuted?(r(this.muteDiv,"ima-non-muted"),h(this.muteDiv,"ima-muted"),this.adsManager.setVolume(1),this.player.muted(!1),this.adMuted=!1,this.sliderLevelDiv.style.width=100*this.player.volume()+"%"):(r(this.muteDiv,"ima-muted"),h(this.muteDiv,"ima-non-muted"),this.adsManager.setVolume(0),this.player.muted(!0),this.adMuted=!0,this.sliderLevelDiv.style.width="0%")}.bind(this),E=function(){document.addEventListener("mouseup",P,!1),document.addEventListener("mousemove",M,!1)},M=function(e){k(e)},P=function(e){k(e),document.removeEventListener("mousemove",M),document.removeEventListener("mouseup",P)},k=function(e){var t=(e.clientX-this.sliderDiv.getBoundingClientRect().left)/this.sliderDiv.offsetWidth;t*=100,t=Math.min(Math.max(t,0),100),this.sliderLevelDiv.style.width=t+"%",this.player.volume(t/100),this.adsManager.setVolume(t/100),0==this.player.volume()?(r(this.muteDiv,"ima-muted"),h(this.muteDiv,"ima-non-muted"),this.player.muted(!0),this.adMuted=!0):(r(this.muteDiv,"ima-non-muted"),h(this.muteDiv,"ima-muted"),this.player.muted(!1),this.adMuted=!1)}.bind(this),T=function(){this.player.isFullscreen()?this.player.exitFullscreen():this.player.requestFullscreen()}.bind(this),b=function(){this.player.isFullscreen()?(r(this.fullscreenDiv,"ima-fullscreen"),h(this.fullscreenDiv,"ima-non-fullscreen"),this.adsManager&&this.adsManager.resize(window.screen.width,window.screen.height,google.ima.ViewMode.FULLSCREEN)):(r(this.fullscreenDiv,"ima-non-fullscreen"),h(this.fullscreenDiv,"ima-fullscreen"),this.adsManager&&this.adsManager.resize(this.getPlayerWidth(),this.getPlayerHeight(),google.ima.ViewMode.NORMAL))}.bind(this),w=function(){var e=this.player.muted()?0:this.player.volume();this.adsManager&&this.adsManager.setVolume(e),0==this.newVolume?(this.adMuted=!0,r(this.muteDiv,"ima-muted"),h(this.muteDiv,"ima-non-muted"),this.sliderLevelDiv.style.width="0%"):(this.adMuted=!1,r(this.muteDiv,"ima-non-muted"),h(this.muteDiv,"ima-muted"),this.sliderLevelDiv.style.width=100*e+"%")}.bind(this),R=function(){this.player.off("loadedmetadata",R),this.player.currentTime(0)}.bind(this),I=function(){this.player.off("loadedmetadata",I),this.player.currentTime(0),this.player.play()}.bind(this),S=function(){this.adsActive=!1,this.adPlaying=!1,this.player.on("ended",this.localContentEndedListener),this.currentAd&&this.currentAd.isLinear()&&(this.adContainerDiv.style.display="none"),this.vjsControls.show(),this.player.ads.endLinearAdMode(),this.adTrackingTimer&&clearInterval(this.adTrackingTimer),this.adsManager&&(this.adsManager.destroy(),this.adsManager=null),this.adsLoader&&!this.contentComplete&&this.adsLoader.contentComplete(),this.contentComplete=!1,this.allAdsCompleted=!1}.bind(this);this.addEventListener=function(e,t){this.adsManager&&this.adsManager.addEventListener(e,t)}.bind(this),this.getAdsManager=function(){return this.adsManager}.bind(this),this.setContent=function(e,t,i){window.console.log("WARNING: player.ima.setContent is deprecated. Use player.ima.setContentWithAdTag instead."),this.setContentWithAdTag(e,t,i)}.bind(this),this.setContentWithAdTag=function(e,t,i){S(),this.settings.adTagUrl=t||this.settings.adTagUrl,N(e,i)}.bind(this),this.setContentWithAdsResponse=function(e,t,i){S(),this.settings.adsResponse=t||this.settings.adsResponse,N(e,i)}.bind(this);var N=function(e,t){this.player.currentSrc()&&(this.player.currentTime(0),this.player.pause()),e&&this.player.src(e),t?this.player.on("loadedmetadata",I):this.player.on("loadedmetadata",R)}.bind(this);this.addContentEndedListener=function(e){this.contentEndedListeners.push(e)}.bind(this),this.addContentAndAdsEndedListener=function(e){this.contentAndAdsEndedListeners.push(e)}.bind(this),this.setAdBreakReadyListener=function(e){this.adBreakReadyListener=e}.bind(this),this.pauseAd=function(){this.adsActive&&this.adPlaying&&(r(this.playPauseDiv,"ima-paused"),h(this.playPauseDiv,"ima-playing"),this.adsManager.pause(),this.adPlaying=!1)}.bind(this),this.resumeAd=function(){this.adsActive&&!this.adPlaying&&(r(this.playPauseDiv,"ima-playing"),h(this.playPauseDiv,"ima-paused"),this.adsManager.resume(),this.adPlaying=!0)}.bind(this);var B=function(){this.updateTimeIntervalHandle=setInterval(H,this.seekCheckInterval),this.seekCheckIntervalHandle=setInterval(_,this.seekCheckInterval),this.resizeCheckIntervalHandle=setInterval(V,this.resizeCheckInterval)}.bind(this),H=function(){this.contentPlayheadTracker.seeking||(this.contentPlayheadTracker.currentTime=this.player.currentTime())}.bind(this),_=function(){var e=this.player.currentTime(),t=1e3*(e-this.contentPlayheadTracker.previousTime);Math.abs(t)>this.seekCheckInterval+this.seekThreshold?this.contentPlayheadTracker.seeking=!0:this.contentPlayheadTracker.seeking=!1,this.contentPlayheadTracker.previousTime=this.player.currentTime()}.bind(this),V=function(){var e=this.getPlayerWidth(),t=this.getPlayerHeight();!this.adsManager||e==this.adsManagerDimensions.width&&t==this.adsManagerDimensions.height||(this.adsManagerDimensions.width=e,this.adsManagerDimensions.height=t,this.adsManager.resize(e,t,google.ima.ViewMode.NORMAL))}.bind(this);if(this.setShowCountdown=function(e){this.showCountdown=e,this.countdownDiv.style.display=this.showCountdown?"block":"none"}.bind(this),this.VERSION="0.2.0",this.settings,this.controlPrefix,this.contentPlayer,this.showCountdown,this.autoPlayAdBreaks,this.vjsControls,this.adContainerDiv,this.controlsDiv,this.countdownDiv,this.seekBarDiv,this.progressDiv,this.playPauseDiv,this.muteDiv,this.sliderDiv,this.sliderLevelDiv,this.fullscreenDiv,this.adDisplayContainer,this.adDisplayContainerInitialized=!1,this.adsLoader,this.adsManager,this.adsRenderingSettings=null,this.adTagUrl,this.adsResponse,this.currentAd,this.contentTrackingTimer,this.adTrackingTimer,this.adsActive=!1,this.adPlaying=!1,this.adMuted=!1,this.contentComplete=!1,this.allAdsCompleted=!1,this.updateTimeIntervalHandle,this.seekCheckIntervalHandle,this.seekCheckInterval=1e3,this.resizeCheckIntervalHandle,this.resizeCheckInterval=250,this.seekThreshold=100,this.contentPlayheadTracker={currentTime:0,previousTime:0,seeking:!1,duration:0},this.adPlayheadTracker={currentTime:0,duration:0,isPod:!1,adPosition:0,totalAds:0},this.adsManagerDimensions={width:0,height:0},this.contentEndedListeners=[],this.contentAndAdsEndedListeners=[],this.adBreakReadyListener=void 0,this.localContentEndedListener=function(){this.adsLoader&&!this.contentComplete&&(this.adsLoader.contentComplete(),this.contentComplete=!0);for(var e in this.contentEndedListeners)this.contentEndedListeners[e]();if(this.allAdsCompleted)for(var e in this.contentAndAdsEndedListeners)this.contentAndAdsEndedListeners[e]();clearInterval(this.updateTimeIntervalHandle),clearInterval(this.seekCheckIntervalHandle),clearInterval(this.resizeCheckIntervalHandle),this.player.el()&&this.player.one("play",B)}.bind(this),this.playerDisposedListener=function(){this.contentEndedListeners,this.contentAndAdsEndedListeners=[],this.contentComplete=!0,this.player.off("ended",this.localContentEndedListener);var e=[this.updateTimeIntervalHandle,this.seekCheckIntervalHandle,this.adTrackingTimer,this.resizeCheckIntervalHandle];for(var t in e){var i=e[t];i&&clearInterval(i)}this.adsManager&&(this.adsManager.destroy(),this.adsManager=null)}.bind(this),this.settings=t({},i,s||{}),!this.settings.id)return void window.console.log("Error: must provide id of video.js div");this.controlPrefix=this.settings.id+"_"||"",this.contentPlayer=document.getElementById(this.settings.id+"_html5_api"),this.showCountdown=!0,0==this.settings.showCountdown&&(this.showCountdown=!1),this.autoPlayAdBreaks=!0,0==this.settings.autoPlayAdBreaks&&(this.autoPlayAdBreaks=!1),e.one("play",B),e.on("ended",this.localContentEndedListener),e.on("dispose",this.playerDisposedListener);var W={debug:this.settings.debug,timeout:this.settings.timeout,prerollTimeout:this.settings.prerollTimeout},z=t({},W,s.contribAdsSettings||{});if(e.ads(z),this.adsRenderingSettings=new google.ima.AdsRenderingSettings,this.adsRenderingSettings.restoreCustomPlaybackStateOnAdBreakComplete=!0,this.settings.adsRenderingSettings)for(var O in this.settings.adsRenderingSettings)this.adsRenderingSettings[O]=this.settings.adsRenderingSettings[O];this.settings.locale&&google.ima.settings.setLocale(this.settings.locale),o(),this.adsLoader=new google.ima.AdsLoader(this.adDisplayContainer),this.adsLoader.getSettings().setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),0==this.settings.vpaidAllowed&&this.adsLoader.getSettings().setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.DISABLED),this.settings.vpaidMode&&this.adsLoader.getSettings().setVpaidMode(this.settings.vpaidMode),this.settings.locale&&this.adsLoader.getSettings().setLocale(this.settings.locale),this.settings.numRedirects&&this.adsLoader.getSettings().setNumRedirects(this.settings.numRedirects),this.adsLoader.getSettings().setPlayerType("videojs-ima"),this.adsLoader.getSettings().setPlayerVersion(this.VERSION),this.adsLoader.getSettings().setAutoPlayAdBreaks(this.autoPlayAdBreaks),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,u,!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,c,!1),n||(n=this.startFromReadyCallback),e.on("readyforpreroll",n),e.ready(function(){e.on("fullscreenchange",b),e.on("volumechange",w)})};e.plugin("ima",s)}(window.videojs);