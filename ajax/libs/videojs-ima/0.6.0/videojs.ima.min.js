!function(t){if("function"==typeof define&&define.amd)define(["video.js","videojs-contrib-ads"],function(e){t(window,document,e)});else if("object"==typeof exports&&"object"==typeof module){var e=require("video.js");require("videojs-contrib-ads"),t(window,document,e)}else t(window,document,videojs)}(function(t,e,i){"use strict";var s=function(t){var e,i,s;for(i=1;i<arguments.length;i++){e=arguments[i];for(s in e)e.hasOwnProperty(s)&&(t[s]=e[s])}return t},n={debug:!1,timeout:5e3,prerollTimeout:100,adLabel:"Advertisement",showControlsForJSAds:!0},a=function(t,e){this.ima=new d(this,t,e)},d=function(i,a,d){this.player=i;var r=function(t,e){t.id=this.controlPrefix+e,t.className=this.controlPrefix+e+" "+e}.bind(this),h=function(t){return new RegExp("(^|[^A-Za-z-])"+t+"((?![A-Za-z-])|$)","gi")},o=function(t,e){return h(e).test(t.className)?t:t.className=t.className.trim()+" "+e},l=function(t,e){var i=h(e);return i.test(t.className)?t.className=t.className.trim().replace(i,""):t},c=function(){this.vjsControls=this.player.getChild("controlBar"),this.adContainerDiv=this.vjsControls.el().parentNode.appendChild(e.createElement("div")),r(this.adContainerDiv,"ima-ad-container"),this.adContainerDiv.style.position="absolute",this.adContainerDiv.style.zIndex=1111,this.adContainerDiv.addEventListener("mouseenter",L,!1),this.adContainerDiv.addEventListener("mouseleave",C,!1),u(),this.adDisplayContainer=new google.ima.AdDisplayContainer(this.adContainerDiv,this.contentPlayer)}.bind(this),u=function(){this.controlsDiv=e.createElement("div"),r(this.controlsDiv,"ima-controls-div"),this.controlsDiv.style.width="100%",this.countdownDiv=e.createElement("div"),r(this.countdownDiv,"ima-countdown-div"),this.countdownDiv.innerHTML=this.settings.adLabel,this.countdownDiv.style.display=this.showCountdown?"block":"none",this.seekBarDiv=e.createElement("div"),r(this.seekBarDiv,"ima-seek-bar-div"),this.seekBarDiv.style.width="100%",this.progressDiv=e.createElement("div"),r(this.progressDiv,"ima-progress-div"),this.playPauseDiv=e.createElement("div"),r(this.playPauseDiv,"ima-play-pause-div"),o(this.playPauseDiv,"ima-playing"),this.playPauseDiv.addEventListener("click",T,!1),this.muteDiv=e.createElement("div"),r(this.muteDiv,"ima-mute-div"),o(this.muteDiv,"ima-non-muted"),this.muteDiv.addEventListener("click",P,!1),this.sliderDiv=e.createElement("div"),r(this.sliderDiv,"ima-slider-div"),this.sliderDiv.addEventListener("mousedown",k,!1),this.sliderLevelDiv=e.createElement("div"),r(this.sliderLevelDiv,"ima-slider-level-div"),this.fullscreenDiv=e.createElement("div"),r(this.fullscreenDiv,"ima-fullscreen-div"),o(this.fullscreenDiv,"ima-non-fullscreen"),this.fullscreenDiv.addEventListener("click",S,!1),this.adContainerDiv.appendChild(this.controlsDiv),this.controlsDiv.appendChild(this.countdownDiv),this.controlsDiv.appendChild(this.seekBarDiv),this.controlsDiv.appendChild(this.playPauseDiv),this.controlsDiv.appendChild(this.muteDiv),this.controlsDiv.appendChild(this.sliderDiv),this.controlsDiv.appendChild(this.fullscreenDiv),this.seekBarDiv.appendChild(this.progressDiv),this.sliderDiv.appendChild(this.sliderLevelDiv)}.bind(this);this.initializeAdDisplayContainer=function(){this.adDisplayContainerInitialized=!0,this.adDisplayContainer.initialize()}.bind(this),this.requestAds=function(){this.adDisplayContainerInitialized||this.adDisplayContainer.initialize();var t=new google.ima.AdsRequest;this.settings.adTagUrl?t.adTagUrl=this.settings.adTagUrl:t.adsResponse=this.settings.adsResponse,this.settings.forceNonLinearFullSlot&&(t.forceNonLinearFullSlot=!0),t.linearAdSlotWidth=this.getPlayerWidth(),t.linearAdSlotHeight=this.getPlayerHeight(),t.nonLinearAdSlotWidth=this.settings.nonLinearWidth||this.getPlayerWidth(),t.nonLinearAdSlotHeight=this.settings.nonLinearHeight||this.getPlayerHeight()/3,t.setAdWillAutoPlay(this.settings.adWillAutoPlay),this.adsLoader.requestAds(t)}.bind(this);var g=function(t){if(this.adsManager=t.getAdsManager(this.contentPlayheadTracker,this.adsRenderingSettings),this.adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,m),this.adsManager.addEventListener(google.ima.AdEvent.Type.AD_BREAK_READY,y),this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,this.onContentPauseRequested_),this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,this.onContentResumeRequested_),this.adsManager.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,p),this.adsManager.addEventListener(google.ima.AdEvent.Type.LOADED,D),this.adsManager.addEventListener(google.ima.AdEvent.Type.STARTED,A),this.adsManager.addEventListener(google.ima.AdEvent.Type.CLICK,T),this.adsManager.addEventListener(google.ima.AdEvent.Type.COMPLETE,this.onAdComplete_),this.adsManager.addEventListener(google.ima.AdEvent.Type.SKIPPED,this.onAdComplete_),!this.autoPlayAdBreaks)try{var e=this.getPlayerWidth(),i=this.getPlayerHeight();this.adsManagerDimensions.width=e,this.adsManagerDimensions.height=i,this.adsManager.init(e,i,google.ima.ViewMode.NORMAL),this.adsManager.setVolume(this.player.muted()?0:this.player.volume())}catch(t){m(t)}this.player.trigger("adsready")}.bind(this);this.start=function(){t.console.log("WARNING: player.ima.start is deprecated. Use player.ima.startFromReadyCallback instead.")},this.startFromReadyCallback=function(){if(this.autoPlayAdBreaks)try{this.adsManager.init(this.getPlayerWidth(),this.getPlayerHeight(),google.ima.ViewMode.NORMAL),this.adsManager.setVolume(this.player.muted()?0:this.player.volume()),this.adsManager.start()}catch(t){m(t)}}.bind(this);var v=function(e){t.console.log("AdsLoader error: "+e.getError()),this.adContainerDiv.style.display="none",this.adsManager&&this.adsManager.destroy(),this.player.trigger({type:"adserror",data:{AdError:e.getError(),AdErrorEvent:e}})}.bind(this),m=function(e){var i=void 0!==e.getError?e.getError():e.stack;t.console.log("Ad error: "+i),this.vjsControls.show(),this.adsManager.destroy(),this.adContainerDiv.style.display="none",this.player.trigger({type:"adserror",data:{AdError:i,AdErrorEvent:e}})}.bind(this),y=function(t){this.adBreakReadyListener(t)}.bind(this);this.playAdBreak=function(){this.autoPlayAdBreaks||this.adsManager.start()}.bind(this),this.onContentPauseRequested_=function(t){this.adsActive=!0,this.adPlaying=!0,this.contentSource=this.player.currentSrc(),this.player.off("ended",this.localContentEndedListener),t.getAd().getAdPodInfo().getPodIndex()!=-1&&this.player.ads.startLinearAdMode(),this.adContainerDiv.style.display="block";var e=t.getAd().getContentType();"application/javascript"!==e||this.settings.showControlsForJSAds?this.controlsDiv.style.display="block":this.controlsDiv.style.display="none",this.vjsControls.hide(),M(),this.player.pause()}.bind(this),this.onContentResumeRequested_=function(t){this.adsActive=!1,this.adPlaying=!1,this.player.on("ended",this.localContentEndedListener),(null==this.currentAd||this.currentAd.isLinear())&&(this.adContainerDiv.style.display="none"),this.vjsControls.show(),this.currentAd?this.contentComplete||this.currentAd.getAdPodInfo().getPodIndex()==-1||this.player.ads.endLinearAdMode():this.player.ads.endLinearAdMode(),this.controlsDiv.style.display="none",this.countdownDiv.innerHTML=""}.bind(this);var p=function(t){if(this.allAdsCompleted=!0,this.adContainerDiv.style.display="none",1==this.contentComplete){this.contentPlayer.src!=this.contentSource&&this.player.src(this.contentSource);for(var e in this.contentAndAdsEndedListeners)this.contentAndAdsEndedListeners[e]()}}.bind(this),D=function(t){t.getAd().isLinear()||this.player.play()}.bind(this),A=function(t){this.currentAd=t.getAd(),this.currentAd.isLinear()?(this.adTrackingTimer=setInterval(f,250),l(this.adContainerDiv,"bumpable-ima-ad-container")):o(this.adContainerDiv,"bumpable-ima-ad-container"),this.adContainerDiv.style.display="block"}.bind(this);this.onAdComplete_=function(t){this.currentAd.isLinear()&&clearInterval(this.adTrackingTimer)}.bind(this);var f=function(){var t=this.adsManager.getRemainingTime(),e=this.currentAd.getDuration(),i=e-t;i=i>0?i:0;var s,n=!1,a=0;this.currentAd.getAdPodInfo()&&(n=!0,s=this.currentAd.getAdPodInfo().getAdPosition(),a=this.currentAd.getAdPodInfo().getTotalAds());var d=Math.floor(t/60),r=Math.floor(t%60);r.toString().length<2&&(r="0"+r);var h=": ";n&&a>1&&(h=" ("+s+" of "+a+"): "),this.countdownDiv.innerHTML=this.settings.adLabel+h+d+":"+r;var o=i/e,l=100*o;this.progressDiv.style.width=l+"%"}.bind(this);this.getPlayerWidth=function(){var t=getComputedStyle(this.player.el())||{};return parseInt(t.width,10)||this.player.width()}.bind(this),this.getPlayerHeight=function(){var t=getComputedStyle(this.player.el())||{};return parseInt(t.height,10)||this.player.height()}.bind(this);var C=function(){this.controlsDiv.style.height="14px",this.playPauseDiv.style.display="none",this.muteDiv.style.display="none",this.sliderDiv.style.display="none",this.fullscreenDiv.style.display="none"}.bind(this),L=function(){this.controlsDiv.style.height="37px",this.playPauseDiv.style.display="block",this.muteDiv.style.display="block",this.sliderDiv.style.display="block",this.fullscreenDiv.style.display="block"}.bind(this),E=function(){o(this.playPauseDiv,"ima-paused"),l(this.playPauseDiv,"ima-playing")}.bind(this),M=function(){o(this.playPauseDiv,"ima-playing"),l(this.playPauseDiv,"ima-paused")}.bind(this),T=function(){this.adPlaying?(E(),this.adsManager.pause(),this.adPlaying=!1):(M(),this.adsManager.resume(),this.adPlaying=!0)}.bind(this),P=function(){this.adMuted?(o(this.muteDiv,"ima-non-muted"),l(this.muteDiv,"ima-muted"),this.adsManager.setVolume(1),this.player.muted(!1),this.adMuted=!1,this.sliderLevelDiv.style.width=100*this.player.volume()+"%"):(o(this.muteDiv,"ima-muted"),l(this.muteDiv,"ima-non-muted"),this.adsManager.setVolume(0),this.player.muted(!0),this.adMuted=!0,this.sliderLevelDiv.style.width="0%")}.bind(this),k=function(){e.addEventListener("mouseup",w,!1),e.addEventListener("mousemove",b,!1)},b=function(t){R(t)},w=function(t){R(t),e.removeEventListener("mousemove",b),e.removeEventListener("mouseup",w)},R=function(t){var e=(t.clientX-this.sliderDiv.getBoundingClientRect().left)/this.sliderDiv.offsetWidth;e*=100,e=Math.min(Math.max(e,0),100),this.sliderLevelDiv.style.width=e+"%",this.player.volume(e/100),this.adsManager.setVolume(e/100),0==this.player.volume()?(o(this.muteDiv,"ima-muted"),l(this.muteDiv,"ima-non-muted"),this.player.muted(!0),this.adMuted=!0):(o(this.muteDiv,"ima-non-muted"),l(this.muteDiv,"ima-muted"),this.player.muted(!1),this.adMuted=!1)}.bind(this),S=function(){this.player.isFullscreen()?this.player.exitFullscreen():this.player.requestFullscreen()}.bind(this),I=function(){this.player.isFullscreen()?(o(this.fullscreenDiv,"ima-fullscreen"),l(this.fullscreenDiv,"ima-non-fullscreen"),this.adsManager&&this.adsManager.resize(t.screen.width,t.screen.height,google.ima.ViewMode.FULLSCREEN)):(o(this.fullscreenDiv,"ima-non-fullscreen"),l(this.fullscreenDiv,"ima-fullscreen"),this.adsManager&&this.adsManager.resize(this.getPlayerWidth(),this.getPlayerHeight(),google.ima.ViewMode.NORMAL))}.bind(this),N=function(){var t=this.player.muted()?0:this.player.volume();this.adsManager&&this.adsManager.setVolume(t),0==t?(this.adMuted=!0,o(this.muteDiv,"ima-muted"),l(this.muteDiv,"ima-non-muted"),this.sliderLevelDiv.style.width="0%"):(this.adMuted=!1,o(this.muteDiv,"ima-non-muted"),l(this.muteDiv,"ima-muted"),this.sliderLevelDiv.style.width=100*t+"%")}.bind(this),B=function(){this.player.off("loadedmetadata",B),this.player.currentTime(0)}.bind(this),H=function(){this.player.off("loadedmetadata",H),this.player.currentTime(0),this.player.play()}.bind(this),_=function(){this.adsActive=!1,this.adPlaying=!1,this.player.on("ended",this.localContentEndedListener),this.vjsControls.show(),this.player.ads.endLinearAdMode(),this.adTrackingTimer&&clearInterval(this.adTrackingTimer),this.contentPlayheadTracker.currentTime=0,this.adsManager&&(this.adsManager.destroy(),this.adsManager=null),this.adsLoader&&!this.contentComplete&&this.adsLoader.contentComplete(),this.contentComplete=!1,this.allAdsCompleted=!1}.bind(this);this.addEventListener=function(t,e){this.adsManager&&this.adsManager.addEventListener(t,e)}.bind(this),this.getAdsManager=function(){return this.adsManager}.bind(this),this.setContent=function(e,i,s){t.console.log("WARNING: player.ima.setContent is deprecated. Use player.ima.setContentWithAdTag instead."),this.setContentWithAdTag(e,i,s)}.bind(this),this.setContentWithAdTag=function(t,e,i){_(),this.settings.adTagUrl=e?e:this.settings.adTagUrl,W(t,i)}.bind(this),this.setContentWithAdsResponse=function(t,e,i){_(),this.settings.adsResponse=e?e:this.settings.adsResponse,W(t,i)}.bind(this),this.changeAdTag=function(t){_(),this.settings.adTagUrl=t}.bind(this);var W=function(t,e){this.player.currentSrc()&&(this.player.currentTime(0),this.player.pause()),t&&this.player.src(t),e?this.player.on("loadedmetadata",H):this.player.on("loadedmetadata",B)}.bind(this);this.addContentEndedListener=function(t){this.contentEndedListeners.push(t)}.bind(this),this.addContentAndAdsEndedListener=function(t){this.contentAndAdsEndedListeners.push(t)}.bind(this),this.setAdBreakReadyListener=function(t){this.adBreakReadyListener=t}.bind(this),this.pauseAd=function(){this.adsActive&&this.adPlaying&&(E(),this.adsManager.pause(),this.adPlaying=!1)}.bind(this),this.resumeAd=function(){this.adsActive&&!this.adPlaying&&(M(),this.adsManager.resume(),this.adPlaying=!0)}.bind(this);var V=function(){this.updateTimeIntervalHandle=setInterval(z,this.seekCheckInterval),this.seekCheckIntervalHandle=setInterval(j,this.seekCheckInterval),this.resizeCheckIntervalHandle=setInterval(O,this.resizeCheckInterval)}.bind(this),z=function(){this.contentPlayheadTracker.seeking||(this.contentPlayheadTracker.currentTime=this.player.currentTime())}.bind(this),j=function(){var t=this.player.currentTime(),e=1e3*(t-this.contentPlayheadTracker.previousTime);Math.abs(e)>this.seekCheckInterval+this.seekThreshold?this.contentPlayheadTracker.seeking=!0:this.contentPlayheadTracker.seeking=!1,this.contentPlayheadTracker.previousTime=this.player.currentTime()}.bind(this),O=function(){var t=this.getPlayerWidth(),e=this.getPlayerHeight();!this.adsManager||t==this.adsManagerDimensions.width&&e==this.adsManagerDimensions.height||(this.adsManagerDimensions.width=t,this.adsManagerDimensions.height=e,this.adsManager.resize(t,e,google.ima.ViewMode.NORMAL))}.bind(this);if(this.setShowCountdown=function(t){this.showCountdown=t,this.countdownDiv.style.display=this.showCountdown?"block":"none"}.bind(this),this.VERSION="0.2.0",this.settings,this.controlPrefix,this.contentPlayer,this.showCountdown,this.autoPlayAdBreaks,this.vjsControls,this.adContainerDiv,this.controlsDiv,this.countdownDiv,this.seekBarDiv,this.progressDiv,this.playPauseDiv,this.muteDiv,this.sliderDiv,this.sliderLevelDiv,this.fullscreenDiv,this.adDisplayContainer,this.adDisplayContainerInitialized=!1,this.adsLoader,this.adsManager,this.adsRenderingSettings=null,this.adTagUrl,this.adsResponse,this.currentAd,this.contentTrackingTimer,this.adTrackingTimer,this.adsActive=!1,this.adPlaying=!1,this.adMuted=!1,this.contentComplete=!1,this.allAdsCompleted=!1,this.updateTimeIntervalHandle,this.seekCheckIntervalHandle,this.seekCheckInterval=1e3,this.resizeCheckIntervalHandle,this.resizeCheckInterval=250,this.seekThreshold=100,this.contentPlayheadTracker={currentTime:0,previousTime:0,seeking:!1,duration:0},this.adPlayheadTracker={currentTime:0,duration:0,isPod:!1,adPosition:0,totalAds:0},this.adsManagerDimensions={width:0,height:0},this.contentEndedListeners=[],this.contentAndAdsEndedListeners=[],this.adBreakReadyListener=void 0,this.contentSource="",this.localContentEndedListener=function(){this.adsLoader&&!this.contentComplete&&(this.adsLoader.contentComplete(),this.contentComplete=!0);for(var t in this.contentEndedListeners)this.contentEndedListeners[t]();if(this.allAdsCompleted)for(var t in this.contentAndAdsEndedListeners)this.contentAndAdsEndedListeners[t]();clearInterval(this.updateTimeIntervalHandle),clearInterval(this.seekCheckIntervalHandle),clearInterval(this.resizeCheckIntervalHandle),this.player.el()&&this.player.one("play",V)}.bind(this),this.playerDisposedListener=function(){this.contentEndedListeners,this.contentAndAdsEndedListeners=[],[],this.contentComplete=!0,this.player.off("ended",this.localContentEndedListener),this.player.ads.adTimeoutTimeout&&clearTimeout(this.player.ads.adTimeoutTimeout);var t=[this.updateTimeIntervalHandle,this.seekCheckIntervalHandle,this.adTrackingTimer,this.resizeCheckIntervalHandle];for(var e in t){var i=t[e];i&&clearInterval(i)}this.adsManager&&(this.adsManager.destroy(),this.adsManager=null)}.bind(this),this.settings=s({},n,a||{}),!this.settings.id)return void t.console.log("Error: must provide id of video.js div");this.controlPrefix=this.settings.id+"_"||"",this.contentPlayer=e.getElementById(this.settings.id+"_html5_api"),this.contentPlayer.hasAttribute("autoplay")&&(this.settings.adWillAutoPlay=this.settings.adWillAutoPlay||!0),this.showCountdown=!0,0==this.settings.showCountdown&&(this.showCountdown=!1),this.autoPlayAdBreaks=!0,0==this.settings.autoPlayAdBreaks&&(this.autoPlayAdBreaks=!1),i.one("play",V),i.on("ended",this.localContentEndedListener),i.on("dispose",this.playerDisposedListener);var U={debug:this.settings.debug,timeout:this.settings.timeout,prerollTimeout:this.settings.prerollTimeout},x=s({},U,a.contribAdsSettings||{});if(i.ads(x),this.adsRenderingSettings=new google.ima.AdsRenderingSettings,this.adsRenderingSettings.restoreCustomPlaybackStateOnAdBreakComplete=!0,this.settings.adsRenderingSettings)for(var F in this.settings.adsRenderingSettings)this.adsRenderingSettings[F]=this.settings.adsRenderingSettings[F];this.settings.locale&&google.ima.settings.setLocale(this.settings.locale),c(),this.adsLoader=new google.ima.AdsLoader(this.adDisplayContainer),this.adsLoader.getSettings().setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),0==this.settings.vpaidAllowed&&this.adsLoader.getSettings().setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.DISABLED),this.settings.vpaidMode&&this.adsLoader.getSettings().setVpaidMode(this.settings.vpaidMode),this.settings.locale&&this.adsLoader.getSettings().setLocale(this.settings.locale),this.settings.numRedirects&&this.adsLoader.getSettings().setNumRedirects(this.settings.numRedirects),this.adsLoader.getSettings().setPlayerType("videojs-ima"),this.adsLoader.getSettings().setPlayerVersion(this.VERSION),this.adsLoader.getSettings().setAutoPlayAdBreaks(this.autoPlayAdBreaks),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,g,!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,v,!1),d||(d=this.startFromReadyCallback),i.on("readyforpreroll",d),i.ready(function(){N(),i.on("fullscreenchange",I),i.on("volumechange",N)})};i.plugin("ima",a)});
//# sourceMappingURL=videojs.ima.min.js.map