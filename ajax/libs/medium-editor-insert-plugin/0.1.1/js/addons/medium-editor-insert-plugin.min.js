/*! 
 * medium-editor-insert-plugin v0.1.1 - jQuery insert plugin for MediumEditor
 *
 * Addon Initialization
 *
 * https://github.com/orthes/medium-editor-images-plugin
 * 
 * Copyright (c) 2013 Pavel Linkesch (http://linkesch.sk)
 * Released under the MIT license
 */
!function(a){MediumEditor.prototype.hideToolbar=function(){this.toolbar&&(this.toolbar.style.display="none")},MediumEditor.prototype.serialize=function(){var b,c,d,e,f,g,h,i,j={};for(b=0;b<this.elements.length;b+=1){for(d=""!==this.elements[b].id?this.elements[b].id:"element-"+b,e=a(this.elements[b]).clone(),f=a(".mediumInsert",e),c=0;c<f.length;c++)g=f[c],h=a(".mediumInsert-placeholder",g).children(),console.log(h.length),0===h.length?g.remove():(g.removeAttr("contenteditable"),a("img[draggable]",g).removeAttr("draggable"),g.hasClass("small")&&h.addClass("small"),a(".mediumInsert-buttons",g).remove(),h.unwrap());i=e.html().trim(),j[d]={value:i}}return j},a.fn.mediumInsert=function(b){return a.fn.mediumInsert.settings=a.extend(a.fn.mediumInsert.settings,b),this.each(function(){a("p",this).bind("dragover drop",function(a){return a.preventDefault(),!1}),a.fn.mediumInsert.insert.init(a(this)),a.fn.mediumInsert.settings.images===!0&&a.fn.mediumInsert.images.init(),a.fn.mediumInsert.settings.maps===!0&&a.fn.mediumInsert.maps.init()})},a.fn.mediumInsert.settings={imagesUploadScript:"upload.php",images:!0,maps:!1},a.fn.mediumInsert.insert={init:function(a){this.$el=a,this.setPlaceholders()},deselect:function(){document.getSelection().removeAllRanges(),a.fn.mediumInsert.settings.editor.hideToolbar()},setPlaceholders:function(){var b=this,c=a.fn.mediumInsert.insert.$el;c.is(":empty")&&c.html("<p><br></p>"),c.keyup(function(){var b=0;c.children("p").each(function(){a(this).next().hasClass("mediumInsert")===!1&&a(this).after('<div class="mediumInsert" id="mediumInsert-'+b+'" contenteditable="false"><div class="mediumInsert-buttons"><div class="mediumInsert-buttonsIcon">&rarr;</div><a class="mediumInsert-buttonsShow">Insert</a><ul class="mediumInsert-buttonsOptions">'+(a.fn.mediumInsert.settings.images===!0?'<li><a class="images-add">Image</a></li>':"")+(a.fn.mediumInsert.settings.maps===!0?'<li><a class="maps-add">Map</a></li>':"")+'</ul></div><div class="mediumInsert-placeholder"></div></div>'),b++})}).keyup(),c.on("selectstart",".mediumInsert",function(a){return a.preventDefault(),!1}),c.on("blur",function(){var b,c=a(this).clone();c.find(".mediumInsert").remove(),b=c.html().replace(/^\s+|\s+$/g,""),(""===b||"<p><br></p>"===b)&&a(this).addClass("medium-editor-placeholder")}),c.on("click",".mediumInsert-buttons a.mediumInsert-buttonsShow",function(){var c=a(this).siblings(".mediumInsert-buttonsOptions"),d=a(this).parent().siblings(".mediumInsert-placeholder");a(this).hasClass("active")?(a(this).removeClass("active"),c.hide(),a("a",c).show()):(a(this).addClass("active"),c.show(),a("a",c).each(function(){var b=a(this).attr("class"),e=b.split("-")[0];a(".mediumInsert-"+e,d).length>0&&a("a:not(."+b+")",c).hide()})),b.deselect()}),c.on("mouseleave",".mediumInsert",function(){a("a.mediumInsert-buttonsShow",this).removeClass("active"),a(".mediumInsert-buttonsOptions",this).hide()}),c.on("click",".mediumInsert-buttonsOptions a",function(){var b=a(this).attr("class").split("-"),c=a(this).parent().parent().parent().siblings(".mediumInsert-placeholder");a.fn.mediumInsert[b[0]]&&a.fn.mediumInsert[b[0]][b[1]]&&a.fn.mediumInsert[b[0]][b[1]](c),a(this).parents(".mediumInsert").mouseleave()})}}}(jQuery);