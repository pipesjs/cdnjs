!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.holmes=t()}(this,function(){"use strict";function e(t,o){if(!(t instanceof Object&&o instanceof Object))throw new Error("One of both arguments isn't an object.");return Object.keys(t).forEach(function(i){n(o[i])!==n(t[i])&&void 0!==t[i]||(o[i]instanceof Object?e(t[i],o[i]):t[i]=o[i])}),t}function t(e){var t=function(){for(var t=void 0,n=arguments.length,o=Array(n),i=0;i<n;i++)o[i]=arguments[i];return t="undefined"!=typeof this&&this!==s?e.call.apply(e,[this].concat(o)):new(Function.prototype.bind.apply(e,[null].concat(o)))};return t.__proto__=e,t.prototype=e.prototype,t}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=(function(){function e(e){this.value=e}function t(t){function n(e,t){return new Promise(function(n,i){var l={key:e,arg:t,resolve:n,reject:i,next:null};r?r=r.next=l:(s=r=l,o(e,t))})}function o(n,s){try{var r=t[n](s),l=r.value;l instanceof e?Promise.resolve(l.value).then(function(e){o("next",e)},function(e){o("throw",e)}):i(r.done?"return":"normal",r.value)}catch(e){i("throw",e)}}function i(e,t){switch(e){case"return":s.resolve({value:t,done:!0});break;case"throw":s.reject(t);break;default:s.resolve({value:t,done:!1})}s=s.next,s?o(s.key,s.arg):r=null}var s,r;this._invoke=n,"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s="undefined"!=typeof window?window:global,r=function(){function t(i){var s=this;o(this,t);var r=!1;if("object"!==("undefined"==typeof i?"undefined":n(i)))throw new Error('The options need to be given inside an object like this:\nnew Holmes({\n\tfind:".result"\n});\nsee also https://haroen.me/holmes/doc/holmes.html');if("string"!=typeof i.find)throw new Error('A find argument is needed. That should be a querySelectorAll for each of the items you want to match individually. You should have something like: \nnew Holmes({\n\tfind:".result"\n});\nsee also https://haroen.me/holmes/doc/holmes.html');this.options={input:"input[type=search]",find:"",placeholder:void 0,mark:!1,class:{visible:void 0,hidden:"hidden"},dynamic:!1,instant:!1,minCharacters:0,hiddenAttr:!1,onHidden:void 0,onVisible:void 0,onEmpty:void 0,onFound:void 0,onInput:void 0},this.options=e(this.options,i),this.hidden=0,this.input,this.elements,this.placeholderNode,this.running=!1,this.options.instant?this.start(i):window.addEventListener("DOMContentLoaded",function(){s.start(i)}),this._inputHandler=function(){var e=!1;s.searchString=s.inputString(),s.options.minCharacters&&0!==s.searchString.length&&s.options.minCharacters>s.searchString.length||(s.options.dynamic&&(s.elements=document.querySelectorAll(s.options.find),s.elementsLength=s.elements.length,s.elementsArray=Array.prototype.slice.call(s.elements)),s.options.mark&&(s._regex=new RegExp("("+s.searchString+")(?![^<]*>)","gi")),s.elementsArray.forEach(function(t){t.textContent.toLowerCase().includes(s.searchString)?(s._showElement(t),r&&"function"==typeof s.options.onFound&&s.options.onFound(s.placeholderNode),r=!1,e=!0):s._hideElement(t)}),"function"==typeof s.options.onInput&&s.options.onInput(s.searchString),e||r?r||s.options.placeholder&&s.placeholderNode.classList.add(s.options.class.hidden):(r=!0,s.options.placeholder&&s.placeholderNode.classList.remove(s.options.class.hidden),"function"==typeof s.options.onEmpty&&s.options.onEmpty(s.placeholderNode)))}}return i(t,[{key:"_hideElement",value:function(e){this.options.class.visible&&e.classList.remove(this.options.class.visible),e.classList.contains(this.options.class.hidden)||(e.classList.add(this.options.class.hidden),this.hidden++,"function"==typeof this.options.onHidden&&this.options.onHidden(e)),this.options.hiddenAttr&&e.setAttribute("hidden","true"),this.options.mark&&(e.innerHTML=e.innerHTML.replace(/<\/?mark>/g,""))}},{key:"_showElement",value:function(e){this.options.class.visible&&e.classList.add(this.options.class.visible),e.classList.contains(this.options.class.hidden)&&(e.classList.remove(this.options.class.hidden),this.hidden--,"function"==typeof this.options.onVisible&&this.options.onVisible(e)),this.options.hiddenAttr&&e.removeAttribute("hidden"),this.options.mark&&(e.innerHTML=e.innerHTML.replace(/<\/?mark>/g,""),this.searchString.length&&(e.innerHTML=e.innerHTML.replace(this._regex,"<mark>$1</mark>")))}},{key:"inputString",value:function(){if(this.input instanceof HTMLInputElement)return this.input.value.toLowerCase();if(this.input.contentEditable)return this.input.textContent.toLowerCase();throw new Error("The Holmes input was no <input> or contenteditable.")}},{key:"setInput",value:function(e){if(this.input instanceof HTMLInputElement)this.input.value=e;else{if(!this.input.contentEditable)throw new Error("The Holmes input was no <input> or contenteditable.");this.input.textContent=e}}},{key:"start",value:function(){var e=this;if(this.running=!0,this.input=document.querySelector(this.options.input),!this.options.find)throw new Error('A find argument is needed. That should be a querySelectorAll for each of the items you want to match individually. You should have something like: \nnew Holmes({\n\tfind:".result"\n});\nsee also https://haroen.me/holmes/doc/holmes.html');if(this.elements=document.querySelectorAll(this.options.find),this.elementsLength=this.elements.length,this.elementsArray=Array.prototype.slice.call(this.elements),this.hidden=0,this.options.placeholder){if(this.placeholderNode=document.createElement("div"),this.placeholderNode.id="holmes-placeholder",this.placeholderNode.classList.add(this.options.class.hidden),this.placeholderNode.innerHTML=this.options.placeholder,!(this.elements[0].parentNode instanceof Element))throw new Error("The Holmes placeholder could't be put; the elements had no parent.");this.elements[0].parentNode.appendChild(this.placeholderNode)}this.options.class.visible&&!function(){var t=e.options.class.visible;e.elementsArray.forEach(function(e){e.classList.add(t)})}(),this.input.addEventListener("input",this._inputHandler)}},{key:"stop",value:function(){var e=this;return new Promise(function(t,n){try{if(e.input.removeEventListener("input",e._inputHandler),e.options.placeholder){if(!e.placeholderNode.parentNode)throw new Error("The Holmes placeholderNode has no parent.");e.placeholderNode.parentNode.removeChild(e.placeholderNode)}e.options.mark&&e.elementsArray.forEach(function(e){e.innerHTML=e.innerHTML.replace(/<\/?mark>/g,"")}),e.running=!1,t("This instance of Holmes has been stopped.")}catch(e){n(e)}})}},{key:"clear",value:function(){var e=this;this.setInput(""),this.options.class.visible?!function(){var t=e.options.class.visible;e.elementsArray.forEach(function(n){n.classList.remove(e.options.class.hidden),n.classList.add(t)})}():this.elementsArray.forEach(function(t){t.classList.remove(e.options.class.hidden)}),this.options.placeholder&&this.options.class.hidden&&(this.placeholderNode.classList.add(this.options.class.hidden),this.options.class.visible&&this.placeholderNode.classList.remove(this.options.class.visible)),this.hidden=0}},{key:"count",value:function(){return{all:this.elementsLength,hidden:this.hidden,visible:this.elementsLength-this.hidden}}}]),t}(),l=t(r);return l});
