var vertx=vertx||{};!function(e){"function"==typeof define&&define.amd?define("vertxbus",["sockjs"],e):e(SockJS)}(function(e){return vertx.EventBus=function(n,r){function t(){var e={type:"ping"};f.send(JSON.stringify(e))}function o(e,n,r,t,o){s("address","string",n),s("replyHandler","function",t,!0),s("failureHandler","function",o,!0),i();var a={type:e,address:n,body:r};if(t||o){var l=u();a.replyAddress=l,d[l]={replyHandler:t,failureHandler:o}}var v=JSON.stringify(a);f.send(v)}function i(){if(v!=vertx.EventBus.OPEN)throw new Error("INVALID_STATE_ERR")}function s(e,n,r,t){if(!t&&!r)throw new Error("Parameter "+e+" must be specified");if(r&&typeof r!=n)throw new Error("Parameter "+e+" must be of type "+n)}function u(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e,n){return n=16*Math.random(),("y"==e?3&n|8:0|n).toString(16)})}var a=this,f=new e(n,void 0,r),l={},d={},v=vertx.EventBus.CONNECTING,x=null,c=null;r&&(c=r.vertxbus_ping_interval),c||(c=5e3),a.onopen=null,a.onclose=null,a.onerror=null,a.send=function(e,n,r,t){o("send",e,n,r,t)},a.publish=function(e,n){o("publish",e,n,null)},a.registerHandler=function(e,n){s("address","string",e),s("handler","function",n),i();var r=l[e];if(r)r[r.length]=n;else{r=[n],l[e]=r;var t={type:"register",address:e};f.send(JSON.stringify(t))}},a.unregisterHandler=function(e,n){s("address","string",e),s("handler","function",n),i();var r=l[e];if(r){var t=r.indexOf(n);if(t!=-1&&r.splice(t,1),0==r.length){var o={type:"unregister",address:e};f.send(JSON.stringify(o)),delete l[e]}}},a.close=function(){i(),v=vertx.EventBus.CLOSING,f.close()},a.readyState=function(){return v},f.onopen=function(){t(),x=setInterval(t,c),v=vertx.EventBus.OPEN,a.onopen&&a.onopen()},f.onclose=function(){v=vertx.EventBus.CLOSED,x&&clearInterval(x),a.onclose&&a.onclose()},f.onmessage=function(e){var n=e.data,r=JSON.parse(n),t=r.type;if("err"===t)return void(a.onerror?a.onerror(r.body):console.error("Error received on connection: "+r.body));var o,i=r.body,s=r.replyAddress,u=r.address;s&&(o=function(e,n){a.send(s,e,n)});var f=l[u];if(f)for(var v=f.slice(0),x=0;x<v.length;x++)v[x](i,o);else if(f=d[u]){delete d[u];var c=f.replyHandler;if(i)c(i,o);else if("undefined"!=typeof r.failureCode){var p={failureCode:r.failureCode,failureType:r.failureType,message:r.message},y=f.failureHandler;y&&y(p)}}}},vertx.EventBus.CONNECTING=0,vertx.EventBus.OPEN=1,vertx.EventBus.CLOSING=2,vertx.EventBus.CLOSED=3,vertx.EventBus});
//# sourceMappingURL=vertx-eventbus.min.js.map