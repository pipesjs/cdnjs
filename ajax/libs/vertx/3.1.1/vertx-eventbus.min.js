!function(e){if("function"==typeof require&&"undefined"!=typeof module){var s=require("sockjs-client");if(!s)throw new Error("vertx-eventbus.js requires sockjs-client, see http://sockjs.org");e(s)}else if("function"==typeof define&&define.amd)define("vertx3bus",["sockjs"],e);else{if("undefined"==typeof this.SockJS)throw new Error("vertx-eventbus.js requires sockjs-client, see http://sockjs.org");EventBus=e(this.SockJS)}}(function(e){function s(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e,s){return s=16*Math.random(),("y"==e?3&s|8:0|s).toString(16)})}function r(e,s){if(e){if(!s)return e;for(var r in e)e.hasOwnProperty(r)&&"undefined"==typeof s[r]&&(s[r]=e[r])}return s||{}}var n=function(s,r){var t=this;r=r||{};var o,i=r.vertxbus_ping_interval||5e3;this.sockJSConn=new e(s,null,r),this.state=n.CONNECTING,this.handlers={},this.replyHandlers={},this.defaultHeaders=null,this.onerror=console.error;var d=function(){t.sockJSConn.send(JSON.stringify({type:"ping"}))};this.sockJSConn.onopen=function(){d(),o=setInterval(d,i),t.state=n.OPEN,t.onopen&&t.onopen()},this.sockJSConn.onclose=function(){t.state=n.CLOSED,o&&clearInterval(o),t.onclose&&t.onclose()},this.sockJSConn.onmessage=function(e){var s=JSON.parse(e.data);if(s.replyAddress&&Object.defineProperty(s,"reply",{value:function(e,r,n){t.send(s.replyAddress,e,r,n)}}),t.handlers[s.address])for(var r=t.handlers[s.address],n=0;n<r.length;n++)"err"===s.type?r[n]({failureCode:s.failureCode,failureType:s.failureType,message:s.message}):r[n](null,s);else if(t.replyHandlers[s.address]){var o=t.replyHandlers[s.address];delete t.replyHandlers[s.address],"err"===s.type?o({failureCode:s.failureCode,failureType:s.failureType,message:s.message}):o(null,s)}else"err"===s.type?t.onerror(s):console.warn("No handler found for message: ",s)}};return n.prototype.send=function(e,t,o,i){if(this.state!=n.OPEN)throw new Error("INVALID_STATE_ERR");"function"==typeof o&&(i=o,o={});var d={type:"send",address:e,headers:r(this.defaultHeaders,o),body:t};if(i){var a=s();d.replyAddress=a,this.replyHandlers[a]=i}this.sockJSConn.send(JSON.stringify(d))},n.prototype.publish=function(e,s,t){if(this.state!=n.OPEN)throw new Error("INVALID_STATE_ERR");this.sockJSConn.send(JSON.stringify({type:"publish",address:e,headers:r(this.defaultHeaders,t),body:s}))},n.prototype.registerHandler=function(e,s,t){if(this.state!=n.OPEN)throw new Error("INVALID_STATE_ERR");"function"==typeof s&&(t=s,s={}),this.handlers[e]||(this.handlers[e]=[],this.sockJSConn.send(JSON.stringify({type:"register",address:e,headers:r(this.defaultHeaders,s)}))),this.handlers[e].push(t)},n.prototype.unregisterHandler=function(e,s,t){if(this.state!=n.OPEN)throw new Error("INVALID_STATE_ERR");var o=this.handlers[e];if(o){"function"==typeof s&&(t=s,s={});var i=o.indexOf(t);i!=-1&&(o.splice(i,1),0===o.length&&(this.sockJSConn.send(JSON.stringify({type:"unregister",address:e,headers:r(this.defaultHeaders,s)})),delete this.handlers[e]))}},n.prototype.close=function(){this.state=vertx.EventBus.CLOSING,this.sockJSConn.close()},n.CONNECTING=0,n.OPEN=1,n.CLOSING=2,n.CLOSED=3,"undefined"==typeof exports?n:void("undefined"!=typeof module&&module.exports?exports=module.exports=n:exports.EventBus=n)});
//# sourceMappingURL=vertx-eventbus.min.js.map