!function(e){if("function"==typeof require&&"undefined"!=typeof module){var s=require("sockjs-client");if(!s)throw new Error("vertx-eventbus.js requires sockjs-client, see http://sockjs.org");e(s)}else if("function"==typeof define&&define.amd)define("vertx-eventbus",["sockjs"],e);else{if("undefined"==typeof this.SockJS)throw new Error("vertx-eventbus.js requires sockjs-client, see http://sockjs.org");EventBus=e(this.SockJS)}}(function(e){function s(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e,s){return s=16*Math.random(),("y"==e?3&s|8:0|s).toString(16)})}function r(e,s){if(e){if(!s)return e;for(var r in e)e.hasOwnProperty(r)&&"undefined"==typeof s[r]&&(s[r]=e[r])}return s||{}}var t=function(s,r){var n=this;r=r||{};var o,i=r.vertxbus_ping_interval||5e3;this.sockJSConn=new e(s,null,r),this.state=t.CONNECTING,this.handlers={},this.replyHandlers={},this.defaultHeaders=null,this.onerror=function(e){try{console.error(e)}catch(e){}};var d=function(){n.sockJSConn.send(JSON.stringify({type:"ping"}))};this.sockJSConn.onopen=function(){d(),o=setInterval(d,i),n.state=t.OPEN,n.onopen&&n.onopen()},this.sockJSConn.onclose=function(e){n.state=t.CLOSED,o&&clearInterval(o),n.onclose&&n.onclose(e)},this.sockJSConn.onmessage=function(e){var s=JSON.parse(e.data);if(s.replyAddress&&Object.defineProperty(s,"reply",{value:function(e,r,t){n.send(s.replyAddress,e,r,t)}}),n.handlers[s.address])for(var r=n.handlers[s.address],t=0;t<r.length;t++)"err"===s.type?r[t]({failureCode:s.failureCode,failureType:s.failureType,message:s.message}):r[t](null,s);else if(n.replyHandlers[s.address]){var o=n.replyHandlers[s.address];delete n.replyHandlers[s.address],"err"===s.type?o({failureCode:s.failureCode,failureType:s.failureType,message:s.message}):o(null,s)}else if("err"===s.type)n.onerror(s);else try{console.warn("No handler found for message: ",s)}catch(e){}}};return t.prototype.send=function(e,n,o,i){if(this.state!=t.OPEN)throw new Error("INVALID_STATE_ERR");"function"==typeof o&&(i=o,o={});var d={type:"send",address:e,headers:r(this.defaultHeaders,o),body:n};if(i){var a=s();d.replyAddress=a,this.replyHandlers[a]=i}this.sockJSConn.send(JSON.stringify(d))},t.prototype.publish=function(e,s,n){if(this.state!=t.OPEN)throw new Error("INVALID_STATE_ERR");this.sockJSConn.send(JSON.stringify({type:"publish",address:e,headers:r(this.defaultHeaders,n),body:s}))},t.prototype.registerHandler=function(e,s,n){if(this.state!=t.OPEN)throw new Error("INVALID_STATE_ERR");"function"==typeof s&&(n=s,s={}),this.handlers[e]||(this.handlers[e]=[],this.sockJSConn.send(JSON.stringify({type:"register",address:e,headers:r(this.defaultHeaders,s)}))),this.handlers[e].push(n)},t.prototype.unregisterHandler=function(e,s,n){if(this.state!=t.OPEN)throw new Error("INVALID_STATE_ERR");var o=this.handlers[e];if(o){"function"==typeof s&&(n=s,s={});var i=o.indexOf(n);i!=-1&&(o.splice(i,1),0===o.length&&(this.sockJSConn.send(JSON.stringify({type:"unregister",address:e,headers:r(this.defaultHeaders,s)})),delete this.handlers[e]))}},t.prototype.close=function(){this.state=t.CLOSING,this.sockJSConn.close()},t.CONNECTING=0,t.OPEN=1,t.CLOSING=2,t.CLOSED=3,"undefined"==typeof exports?t:void("undefined"!=typeof module&&module.exports?exports=module.exports=t:exports.EventBus=t)});
//# sourceMappingURL=vertx-eventbus.min.js.map