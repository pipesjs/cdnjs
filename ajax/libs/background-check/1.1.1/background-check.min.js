/* BackgroundCheck
   http://kennethcachia.com/background-check
   v1.1.1 */

!function(a,b){"function"==typeof define&&define.amd?define(b):a.BackgroundCheck=b(a)}(this,function(){"use strict";function a(a){if(void 0===a||void 0===a.targets)throw"Missing attributes";y.targets=f(a.targets),y.images=f(a.images||"img"),y.changeParent=d(a.changeParent,!1),y.threshold=d(a.threshold,50),y.minComplexity=d(a.minComplexity,30),y.minOverlap=d(a.minOverlap,50),y.windowEvents=d(a.windowEvents,!0),y.maxDuration=d(a.maxDuration,500),y.debug=d(a.debug,!1),y.mask=d(a.mask,{r:0,g:255,b:0}),y.classes=d(a.classes,{dark:"background--dark",light:"background--light",complex:"background--complex"}),void 0===s&&(g(),s&&(t.style.position="fixed",t.style.top="0px",t.style.left="0px",t.style.width="100%",t.style.height="100%",window.addEventListener(x,p.bind(null,function(){i(),o()})),window.addEventListener("scroll",p.bind(null,o)),i(),o()))}function b(){s=null,t=null,u=null,y={},v&&clearTimeout(v)}function c(a){r("debug")&&console.log(a)}function d(a,b){return e(a,typeof b),void 0===a?b:a}function e(a,b){if(void 0!==a&&typeof a!==b)throw"Incorrect attribute type"}function f(a){var b=a;if("string"==typeof a?b=document.querySelectorAll(a):a&&1===a.nodeType&&(b=[a]),!b||0===b.length||void 0===b.length)throw"Elements not found";return b}function g(){t=document.createElement("canvas"),t&&t.getContext?(u=t.getContext("2d"),s=!0):s=!1}function h(a){var d=(new Date).getTime()-a;c("Duration: "+d+"ms"),d>r("maxDuration")&&(console.log("BackgroundCheck - Killed"),k(),b())}function i(){w={left:0,top:0,right:document.body.clientWidth,bottom:window.innerHeight},t.width=document.body.clientWidth,t.height=window.innerHeight}function j(a){var b=a.getBoundingClientRect();u.drawImage(a,b.left,b.top,b.width,b.height)}function k(a){for(var b,c=a?[a]:r("targets"),d=0;d<c.length;d++)b=c[d],b=r("changeParent")?b.parentNode:b,b.classList.remove(r("classes").light),b.classList.remove(r("classes").dark),b.classList.remove(r("classes").complex)}function l(a){var b,d,e,f,g=a.getBoundingClientRect(),h=0,i=0,j=0,l=0,m=r("mask");if(g.width>0&&g.height>0){k(a),a=r("changeParent")?a.parentNode:a,d=u.getImageData(g.left,g.top,g.width,g.height).data;for(var n=0;n<d.length;n+=4)d[n]===m.r&&d[n+1]===m.g&&d[n+2]===m.b?l++:(h++,b=.2126*d[n]+.7152*d[n+1]+.0722*d[n+2],e=b-j,i+=e*e,j+=e/h);l<=d.length/4*(1-r("minOverlap")/100)&&(f=Math.sqrt(i/h)/255,j/=255,c("Target: "+a.className+" lum: "+j+" var: "+f),a.classList.add(j<=r("threshold")/100?r("classes").dark:r("classes").light),f>r("minComplexity")/100&&a.classList.add(r("classes").complex))}}function m(a,b){return a=a.getBoundingClientRect(),b=b===w?b:b.getBoundingClientRect(),!(a.right<b.left||a.left>b.right||a.top>b.bottom||a.bottom<b.top)}function n(a){for(var b,c=(new Date).getTime(),d=a&&"IMG"===a.tagName?"image":"targets",e=a?!1:!0,f=r("targets").length,g=0;f>g;g++)b=r("targets")[g],m(b,w)&&("targets"!==d||a&&a!==b?"image"===d&&m(b,a)&&l(b):(e=!0,l(b)));if("targets"===d&&!e)throw a+" is not a target";h(c)}function o(a,b,d){var e,f=!1,g=r("mask"),h=d?[d]:r("images");if(c("--- BackgroundCheck ---"),c("Loading: "+f),c("onLoad event: "+(d&&d.src)),s){b!==!0&&(u.clearRect(0,0,t.width,t.height),u.fillStyle="rgb("+g.r+", "+g.g+", "+g.b+")",u.fillRect(0,0,t.width,t.height));for(var i=0;i<h.length;i++)e=h[i],m(e,w)&&(0===e.naturalWidth?(f=!0,c("Loading... "+e.src),e.addEventListener("load",o.bind(null,a,!0,e))):(c("Drawing: "+e.src),j(e)));d||f?d&&n(d):n(a)}}function p(a){r("windowEvents")===!0&&(v&&clearTimeout(v),v=setTimeout(a,200))}function q(a,b){if(void 0===y[a])throw"Unknown property - "+a;if(void 0===b)throw"Missing value for "+a;if("targets"===a||"images"===a)try{b=f("images"!==a||b?b:"img")}catch(c){throw b=[],c}else e(b,typeof y[a]);k(),y[a]=b,o()}function r(a){if(void 0===y[a])throw"Unknown property - "+a;return y[a]}var s,t,u,v,w,x=void 0!==window.orientation?"orientationchange":"resize",y={};return{init:a,destroy:b,refresh:o,set:q,get:r}});