/*
freezer-js v0.12.0
https://github.com/arqex/freezer
MIT: https://github.com/arqex/freezer/raw/master/LICENSE
*/
!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.Freezer=t()}(this,function(){"use strict";var e="undefined"!=typeof e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t={extend:function(e,t){for(var n in t)e[n]=t[n];return e},createNonEnumerable:function(e,t){var n={};for(var r in e)n[r]={value:e[r]};return Object.create(t||{},n)},error:function(e){var t=new Error(e);if(console)return console.error(t);throw t},each:function(e,t){var n,r,i;if(e&&e.constructor===Array)for(n=0,r=e.length;n<r;n++)t(e[n],n);else for(i=Object.keys(e),n=0,r=i.length;n<r;n++)t(e[i[n]],i[n])},addNE:function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!1,configurable:!0,writable:!0,value:t[n]})},createNE:function(e){var t={};for(var n in e)t[n]={writable:!0,configurable:!0,enumerable:!1,value:e[n]};return t},nextTick:function(){function t(){for(;r=i.shift();)r();o=!1}function n(e){i.push(e),o||(o=!0,f())}var r,i=[],o=!1,s=!!e.postMessage&&"undefined"!=typeof Window&&e instanceof Window,a="nexttick",f=function(){return s?function(){e.postMessage(a,"*")}:function(){setTimeout(function(){c()},0)}}(),c=function(){return s?function(n){n.source===e&&n.data===a&&(n.stopPropagation(),t())}:t}();return s&&e.addEventListener("message",c,!0),n.removeListener=function(){e.removeEventListener("message",c,!0)},n}(),findPivot:function(e){if(e&&e.__){if(e.__.pivot)return e;for(var t,n=0,r=e.__.parents,i=0;!n&&i<r.length;)t=r[i],t.__.pivot&&(n=t),i++;if(n)return n;for(i=0;!n&&i<r.length;)n=this.findPivot(r[i]),i++;return n}},isLeaf:function(e,t){var n;return!e||!(n=e.constructor)||(t?n===String||n===Number||n===Boolean:n!==Object&&n!==Array)},warn:function(){var e;"undefined"!=typeof process&&"production"===process.env.NODE_ENV||arguments[0]||"undefined"==typeof console||(e=Array.prototype.slice.call(arguments,1),e[0]="Freezer.js WARNING: "+e[0],console.warn.apply(console,e))}},n={init:function(e){var n={set:function(e,n){var r=e,i=this.__.trans,o=this.constructor===Array,s="Freezer arrays only accept numeric attributes, given: ";if("object"!=typeof e){if(o&&parseInt(e)!=e)return t.warn(0,s+e),t.findPivot(this)||this;r={},r[e]=n}if(!i){for(var a in r){if(o&&parseInt(a)!=a)return t.warn(0,s+a),t.findPivot(this)||this;i=i||this[a]!==r[a]}if(!i)return t.findPivot(this)||this}var f=o?"array.set":"object.set";return this.__.store.notify("merge",this,r,f)},reset:function(e){return this.__.store.notify("replace",this,e,"object.replace")},getListener:function(){return e.createListener(this)},toJS:function(){var e;return e=this.constructor===Array?new Array(this.length):{},t.each(this,function(t,n){t&&t.__?e[n]=t.toJS():e[n]=t}),e},transact:function(){return this.__.store.notify("transact",this)},run:function(){return this.__.store.notify("run",this)},now:function(){return this.__.store.notify("now",this)},pivot:function(){return this.__.store.notify("pivot",this)}},r=t.extend({push:function(e){return this.append([e],"array.push")},append:function(e,t){return e&&e.length?this.__.store.notify("splice",this,[this.length,0].concat(e),t||"array.append"):this},pop:function(){return this.length?this.__.store.notify("splice",this,[this.length-1,1],"array.pop"):this},unshift:function(e){return this.prepend([e],"array.unshift")},prepend:function(e){return e&&e.length?this.__.store.notify("splice",this,[0,0].concat(e),"array.prepend"):this},shift:function(){return this.length?this.__.store.notify("splice",this,[0,1],"array.shift"):this},splice:function(e,t,n){return this.__.store.notify("splice",this,arguments,"array.splice")},sort:function(){var e=this.slice();return e.sort.apply(e,arguments),this.__.store.notify("replace",this,e,"array.sort")}},n),i=Object.create(Array.prototype,t.createNE(r)),o=t.createNE(t.extend({remove:function(e){var t=[],n=e;e.constructor!==Array&&(n=[e]);for(var r=0,i=n.length;r<i;r++)this.hasOwnProperty(n[r])&&t.push(n[r]);return t.length?this.__.store.notify("remove",this,t,"object.remove"):this}},n)),s=Object.create(Object.prototype,o),a=function(){return[].__proto__?function(e){var t=new Array(e);return t.__proto__=i,t}:function(e){var t=new Array(e);for(var n in r)t[n]=r[n];return t}}();this.clone=function(e){var t=e.constructor;return t===Array?a(e.length):t===Object?Object.create(s):Object.create(t.prototype,o)}}},r="beforeAll",i="afterAll",o=[r,i],s={on:function(e,t,n){var r=this._events[e]||[];return r.push({callback:t,once:n}),this._events[e]=r,this},once:function(e,t){return this.on(e,t,!0)},off:function(e,t){if("undefined"==typeof e)this._events={};else if("undefined"==typeof t)this._events[e]=[];else{var n,r=this._events[e]||[];for(n=r.length-1;n>=0;n--)r[n].callback===t&&r.splice(n,1)}return this},emit:function(e){var t,n,s,a,f=[].slice.call(arguments,1),c=this._events[e]||[],u=[],h=o.indexOf(e)!==-1;for(h||this.emit.apply(this,[r,e].concat(f)),t=0;t<c.length;t++)n=c[t],n.callback?a=n.callback.apply(this,f):n.once=!0,n.once&&u.push(t),void 0!==a&&(s=a);for(t=u.length-1;t>=0;t--)c.splice(u[t],1);return h||this.emit.apply(this,[i,e].concat(f)),s},trigger:function(){return t.warn(!1,"Method `trigger` is deprecated and will be removed from freezer in upcoming releases. Please use `emit`."),this.emit.apply(this,arguments)}},a=t.createNonEnumerable(s),f={freeze:function(e,r){if(e&&e.__)return e;var i=this,o=n.clone(e);return t.addNE(o,{__:{listener:!1,parents:[],store:r}}),t.each(e,function(e,n){t.isLeaf(e,r.freezeInstances)||(e=i.freeze(e,r)),e&&e.__&&i.addParent(e,o),o[n]=e}),r.freezeFn(o),o},merge:function(e,n){var r=e.__,i=r.trans,n=t.extend({},n);if(i){for(var o in n)i[o]=n[o];return e}var s,a,f,c=this,u=this.copyMeta(e),h=r.store;t.each(e,function(r,i){return f=r&&r.__,f&&c.removeParent(r,e),(s=n[i])?(t.isLeaf(s,h.freezeInstances)||(s=c.freeze(s,h)),s&&s.__&&c.addParent(s,u),delete n[i],void(u[i]=s)):(f&&c.addParent(r,u),u[i]=r)});for(a in n)s=n[a],t.isLeaf(s,h.freezeInstances)||(s=c.freeze(s,h)),s&&s.__&&c.addParent(s,u),u[a]=s;return r.store.freezeFn(u),this.refreshParents(e,u),u},replace:function(e,n){var r=this,i=e.__,o=n;return t.isLeaf(n,i.store.freezeInstances)||(o=r.freeze(n,i.store),o.__.parents=i.parents,o.__.updateRoot=i.updateRoot,i.listener&&(o.__.listener=i.listener)),o&&this.fixChildren(o,e),this.refreshParents(e,o),o},remove:function(e,n){var r=e.__.trans;if(r){for(var i=n.length-1;i>=0;i--)delete r[n[i]];return e}var o,s=this,a=this.copyMeta(e);return t.each(e,function(t,r){o=t&&t.__,o&&s.removeParent(t,e),n.indexOf(r)===-1&&(o&&s.addParent(t,a),a[r]=t)}),e.__.store.freezeFn(a),this.refreshParents(e,a),a},splice:function(e,n){var r=e.__,i=r.trans;if(i)return i.splice.apply(i,n),e;var o,s=this,a=this.copyMeta(e),f=n[0],c=f+n[1];if(t.each(e,function(t,n){t&&t.__&&(s.removeParent(t,e),(n<f||n>=c)&&s.addParent(t,a)),a[n]=t}),n.length>1)for(var u=n.length-1;u>=2;u--)o=n[u],t.isLeaf(o,r.store.freezeInstances)||(o=this.freeze(o,r.store)),o&&o.__&&this.addParent(o,a),n[u]=o;return Array.prototype.splice.apply(a,n),r.store.freezeFn(a),this.refreshParents(e,a),a},transact:function(e){var n,r=this,i=e.__.trans;return i?i:(n=e.constructor===Array?[]:{},t.each(e,function(e,t){n[t]=e}),e.__.trans=n,t.nextTick(function(){e.__.trans&&r.run(e)}),n)},run:function(e){var n=this,r=e.__.trans;if(!r)return e;t.each(r,function(t,r){t&&t.__&&n.removeParent(t,e)}),delete e.__.trans;var i=this.replace(e,r);return i},pivot:function(e){return e.__.pivot=1,this.unpivot(e),e},unpivot:function(e){t.nextTick(function(){e.__.pivot=0})},refresh:function(e,n,r){var i=this,o=e.__.trans,s=0;if(o)return t.each(o,function(t,a){s||t===n&&(o[a]=r,s=1,r&&r.__&&i.addParent(r,e))}),e;var a,f=this.copyMeta(e);t.each(e,function(t,o){t===n&&(t=r),t&&(a=t.__)&&(i.removeParent(t,e),i.addParent(t,f)),f[o]=t}),e.__.store.freezeFn(f),this.refreshParents(e,f)},fixChildren:function(e,n){var r=this;t.each(e,function(t){if(t&&t.__){if(r.fixChildren(t),1===t.__.parents.length)return t.__.parents=[e];n&&r.removeParent(t,n),r.addParent(t,e)}})},copyMeta:function(e){var r=n.clone(e),i=e.__;return t.addNE(r,{__:{store:i.store,updateRoot:i.updateRoot,listener:i.listener,parents:i.parents.slice(0),trans:i.trans,pivot:i.pivot}}),i.pivot&&this.unpivot(r),r},refreshParents:function(e,t){var n,r=e.__,i=r.parents.length;if(e.__.updateRoot&&e.__.updateRoot(e,t),t&&this.emit(e,"update",t,r.store.live),i)for(n=i-1;n>=0;n--)this.refresh(r.parents[n],e,t)},removeParent:function(e,t){var n=e.__.parents,r=n.indexOf(t);r!==-1&&n.splice(r,1)},addParent:function(e,t){var n=e.__.parents,r=n.indexOf(t);r===-1&&(n[n.length]=t)},emit:function(e,n,r,i){var o=e.__.listener;if(o){var s=o.ticking;if(i)return void((s||r)&&(o.ticking=0,o.emit(n,s||r,e)));o.ticking=r,o.prevState||(o.prevState=e),s||t.nextTick(function(){if(o.ticking){var t=o.ticking;o.prevState;o.ticking=0,o.prevState=0,o.emit(n,t,e)}})}},createListener:function(e){var t=e.__.listener;return t||(t=Object.create(a,{_events:{value:{},writable:!0}}),e.__.listener=t),t}};n.init(f);var c=function(e,n){var r,i,o=this,s=n||{},a={live:s.live||!1,freezeInstances:s.freezeInstances||!1},c=[],u=0,h=function(e){var t,n=e.__;if(n.listener){var r=n.listener.prevState||e;n.listener.prevState=0,f.emit(r,"update",e,!0)}for(t=0;t<n.parents.length;t++)n.store.notify("now",n.parents[t])},p=function(e){c.push(e),u||(u=1,t.nextTick(function(){c=[],u=0}))};a.notify=function(e,n,r,o){if(o&&(i={name:o,node:n,options:r}),"now"===e){if(c.length)for(;c.length;)h(c.shift());else h(n);return n}var s=f[e](n,r);if("pivot"!==e){var a=t.findPivot(s);if(a)return p(s),a}return s},a.freezeFn=s.mutable===!0?function(){}:function(e){Object.freeze(e)},r=f.freeze(e,a),r.__.updateRoot=function(e,n){e===r?r=n:i&&t.warn(!1,"Method "+i.name+" called on a detached node.",i.node,i.options)};var _=r.getListener(),l={};t.each(["on","off","once","emit"],function(e){var n={};n[e]=_[e].bind(_),t.addNE(o,n),t.addNE(l,n)}),t.addNE(this,{get:function(){return r},set:function(e){r.reset(e)},getEventHub:function(){return l}}),t.addNE(this,{getData:this.get,setData:this.set})};return c});