{"version":3,"sources":["url.js"],"names":["global","document","definition","abstractUuid","Descriptor","iterate","getLinkProperty","uuid","property","properties","storage","link","setLinkProperty","value","Parameter","self","this","objectDefineProperties","update","Url","url","call","createElement","href","parameter","toString","valueOf","Object","defineProperties","regexMatchLeadingSlash","regexMatchParameter","regexMatchLocal","RegExp","resolver","slice","regexMatchDefaults","http:","https:","ftp:","prototype","get","name","set","serialize","remove","context","tokens","search","split","join","exec","decodeURIComponent","result","encodeURIComponent","replace","local","test","origin","protocol","host","username","password","hostname","port","pathname","hash","extends","provide"],"mappings":"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","file":"url.js","sourcesContent":["/**\n * @use /demand/abstract/uuid\n */\n\n(function(global, document) {\n\t'use strict';\n\n\tfunction definition(abstractUuid, Descriptor, iterate) {\n\t\tvar objectDefineProperties    = Object.defineProperties,\n\t\t\tstorage                   = {},\n\t\t\tregexMatchLeadingSlash    = /^\\//,\n\t\t\tregexMatchParameter       = /[?&]?([^=]+)=([^&]*)/g,\n\t\t\tregexMatchSpaces          = /%20/g,\n\t\t\tregexMatchOpeningBrackets = /%5B/g,\n\t\t\tregexMatchClosingBrackets = /%5D/g,\n\t\t\tregexMatchLocal           = new RegExp('^' + resolveCurrent(), 'i'),\n\t\t\tregexMatchDefaults        = {\n\t\t\t\t'http:':  /:80$/,\n\t\t\t\t'https:': /:443$/,\n\t\t\t\t'ftp:':   /:21$/\n\t\t\t};\n\n\t\tfunction resolveCurrent() {\n\t\t\tvar resolver = document.createElement('a');\n\n\t\t\tresolver.href = '/';\n\n\t\t\treturn resolver.href.slice(0, -1);\n\t\t}\n\n\t\tfunction getLinkProperty(uuid, property) {\n\t\t\tvar properties;\n\n\t\t\tif(properties = storage[uuid]) {\n\t\t\t\treturn properties.link[property];\n\t\t\t}\n\t\t}\n\n\t\tfunction setLinkProperty(uuid, property, value) {\n\t\t\tvar properties;\n\n\t\t\tif(properties = storage[uuid]) {\n\t\t\t\tproperties.link[property] = value;\n\t\t\t}\n\t\t}\n\n\t\tfunction Parameter(uuid) {\n\t\t\tvar self = this;\n\n\t\t\tobjectDefineProperties(self, { uuid: new Descriptor(uuid) });\n\n\t\t\tParameter.update(self);\n\t\t}\n\n\t\tParameter.prototype = {\n\t\t\t/* only for reference\n\t\t\tuuid: null\n\t\t\t*/\n\t\t\tget: function(name) {\n\t\t\t\treturn storage[this.uuid].parameter[name];\n\t\t\t},\n\t\t\tset: function(name, value) {\n\t\t\t\tstorage[this.uuid].parameter[name] = value;\n\n\t\t\t\tParameter.serialize(this);\n\t\t\t},\n\t\t\tremove: function(name) {\n\t\t\t\tdelete storage[this.uuid].parameter[name];\n\n\t\t\t\tParameter.serialize(this);\n\t\t\t}\n\t\t};\n\n\t\tParameter.update = function(context) {\n\t\t\tvar properties = storage[context.uuid],\n\t\t\t\tparameter  = properties.parameter,\n\t\t\t\tsearch     = properties.link.search.split('+').join(' '),\n\t\t\t\ttokens;\n\n\t\t\titerate(parameter, function(property) {\n\t\t\t\tdelete parameter[property];\n\t\t\t});\n\n\t\t\twhile(tokens = regexMatchParameter.exec(search)) {\n\t\t\t\tparameter[decodeURIComponent(tokens[1])] = decodeURIComponent(tokens[2]);\n\t\t\t}\n\t\t};\n\n\t\tParameter.serialize = function(context) {\n\t\t\tvar properties = storage[context.uuid],\n\t\t\t\tparameter  = properties.parameter,\n\t\t\t\tresult     = '';\n\n\t\t\titerate(parameter, function(property, value) {\n\t\t\t\tresult += (!result ? '?' : '&') + encodeURIComponent(property) + '=' + encodeURIComponent(value);\n\t\t\t});\n\n\t\t\tproperties.link.search = result\n\t\t\t\t.replace(regexMatchSpaces, '+')\n\t\t\t\t.replace(regexMatchOpeningBrackets, '[')\n\t\t\t\t.replace(regexMatchClosingBrackets, ']');\n\t\t};\n\n\t\tfunction Url(url) {\n\t\t\tvar self = abstractUuid.call(this),\n\t\t\t\tlink = document.createElement('a');\n\n\t\t\tlink.href = url;\n\n\t\t\tstorage[self.uuid] = {\n\t\t\t\tlink:      link,\n\t\t\t\tparameter: {}\n\t\t\t};\n\n\t\t\tobjectDefineProperties(self, {\n\t\t\t\ttoString:  new Descriptor(function() { return link.toString(); }),\n\t\t\t\tvalueOf:   new Descriptor(function() { return link.valueOf(); }),\n\t\t\t\tparameter: new Descriptor(new Parameter(self.uuid))\n\t\t\t});\n\t\t\t\n\t\t\treturn self;\n\t\t}\n\n\t\tUrl.prototype = {\n\t\t\tget local() {\n\t\t\t\tvar value;\n\n\t\t\t\tif(value = getLinkProperty(this.uuid, 'href')) {\n\t\t\t\t\treturn regexMatchLocal.test(value);\n\t\t\t\t}\n\t\t\t},\n\t\t\tget href() {\n\t\t\t\treturn getLinkProperty(this.uuid, 'href');\n\t\t\t},\n\t\t\tset href(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'href', value);\n\t\t\t},\n\t\t\tget origin() {\n\t\t\t\tvar self = this;\n\n\t\t\t\treturn getLinkProperty(self.uuid, 'origin') || self.protocol + '//' + self.host;\n\t\t\t},\n\t\t\tget protocol() {\n\t\t\t\treturn getLinkProperty(this.uuid, 'protocol');\n\t\t\t},\n\t\t\tset protocol(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'protocol', value);\n\t\t\t},\n\t\t\tget username() {\n\t\t\t\treturn getLinkProperty(this.uuid, 'username');\n\t\t\t},\n\t\t\tset username(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'username', value);\n\t\t\t},\n\t\t\tget password() {\n\t\t\t\treturn getLinkProperty(this.uuid, 'password');\n\t\t\t},\n\t\t\tset password(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'password', value);\n\t\t\t},\n\t\t\tget host() {\n\t\t\t\tvar value, protocol;\n\n\t\t\t\tif(value = getLinkProperty(this.uuid, 'host')) {\n\t\t\t\t\tprotocol = getLinkProperty(this.uuid, 'protocol');\n\n\t\t\t\t\treturn regexMatchDefaults[protocol] ? value.replace(regexMatchDefaults[protocol], '') : value;\n\t\t\t\t}\n\t\t\t},\n\t\t\tset host(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'host', value);\n\t\t\t},\n\t\t\tget hostname() {\n\t\t\t\treturn getLinkProperty(this.uuid, 'hostname');\n\t\t\t},\n\t\t\tset hostname(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'hostname', value);\n\t\t\t},\n\t\t\tget port() {\n\t\t\t\treturn getLinkProperty(this.uuid, 'port');\n\t\t\t},\n\t\t\tset port(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'port', value);\n\t\t\t},\n\t\t\tget pathname() {\n\t\t\t\tvar value;\n\n\t\t\t\tif(value = getLinkProperty(this.uuid, 'pathname')) {\n\t\t\t\t\treturn regexMatchLeadingSlash.test(value) ? value : '/' + value;\n\t\t\t\t}\n\t\t\t},\n\t\t\tset pathname(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'pathname', value);\n\t\t\t},\n\t\t\tget search() {\n\t\t\t\treturn getLinkProperty(this.uuid, 'search');\n\t\t\t},\n\t\t\tset search(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'search', value);\n\n\t\t\t\tParameter.update.call(this);\n\t\t\t},\n\t\t\tget hash() {\n\t\t\t\treturn getLinkProperty(this.uuid, 'hash');\n\t\t\t},\n\t\t\tset hash(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'hash', value);\n\t\t\t}\n\t\t};\n\n\t\treturn Url.extends(abstractUuid);\n\t}\n\n\tprovide([ '/demand/abstract/uuid', '/demand/descriptor', '/demand/function/iterate' ], definition);\n}(this, document));"]}