!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).vl=e()}}(function(){return function e(t,n,i){function r(o,s){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(a)return a(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return r(n||e)},c,c.exports,e,t,n,i)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(e,t,n){var i="undefined"!=typeof JSON?JSON:e("jsonify");t.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n=t.space||"";"number"==typeof n&&(n=Array(n+1).join(" "));var o="boolean"==typeof t.cycles&&t.cycles,s=t.replacer||function(e,t){return t},l=t.cmp&&function(e){return function(t){return function(n,i){var r={key:n,value:t[n]},a={key:i,value:t[i]};return e(r,a)}}}(t.cmp),u=[];return function e(t,c,f,d){var p=n?"\n"+new Array(d+1).join(n):"",m=n?": ":":";if(f&&f.toJSON&&"function"==typeof f.toJSON&&(f=f.toJSON()),void 0!==(f=s.call(t,c,f))){if("object"!=typeof f||null===f)return i.stringify(f);if(r(f)){for(var g=[],h=0;h<f.length;h++){var v=e(f,h,f[h],d+1)||i.stringify(null);g.push(p+n+v)}return"["+g.join(",")+p+"]"}if(-1!==u.indexOf(f)){if(o)return i.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}u.push(f);for(var y=a(f).sort(l&&l(f)),g=[],h=0;h<y.length;h++){var b=e(f,c=y[h],f[c],d+1);if(b){var S=i.stringify(c)+m+b;g.push(p+n+S)}}return u.splice(u.indexOf(f),1),"{"+g.join(",")+p+"}"}}({"":e},"",e,0)};var r=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},a=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},n=[];for(var i in e)t.call(e,i)&&n.push(i);return n}},{jsonify:2}],2:[function(e,t,n){n.parse=e("./lib/parse"),n.stringify=e("./lib/stringify")},{"./lib/parse":3,"./lib/stringify":4}],3:[function(e,t,n){var i,r,a,o,s={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},l=function(e){throw{name:"SyntaxError",message:e,at:i,text:a}},u=function(e){return e&&e!==r&&l("Expected '"+e+"' instead of '"+r+"'"),r=a.charAt(i),i+=1,r},c=function(){var e,t="";for("-"===r&&(t="-",u("-"));r>="0"&&r<="9";)t+=r,u();if("."===r)for(t+=".";u()&&r>="0"&&r<="9";)t+=r;if("e"===r||"E"===r)for(t+=r,u(),"-"!==r&&"+"!==r||(t+=r,u());r>="0"&&r<="9";)t+=r,u();if(e=+t,isFinite(e))return e;l("Bad number")},f=function(){var e,t,n,i="";if('"'===r)for(;u();){if('"'===r)return u(),i;if("\\"===r)if(u(),"u"===r){for(n=0,t=0;t<4&&(e=parseInt(u(),16),isFinite(e));t+=1)n=16*n+e;i+=String.fromCharCode(n)}else{if("string"!=typeof s[r])break;i+=s[r]}else i+=r}l("Bad string")},d=function(){for(;r&&r<=" ";)u()},p=function(){switch(r){case"t":return u("t"),u("r"),u("u"),u("e"),!0;case"f":return u("f"),u("a"),u("l"),u("s"),u("e"),!1;case"n":return u("n"),u("u"),u("l"),u("l"),null}l("Unexpected '"+r+"'")},m=function(){var e=[];if("["===r){if(u("["),d(),"]"===r)return u("]"),e;for(;r;){if(e.push(o()),d(),"]"===r)return u("]"),e;u(","),d()}}l("Bad array")},g=function(){var e,t={};if("{"===r){if(u("{"),d(),"}"===r)return u("}"),t;for(;r;){if(e=f(),d(),u(":"),Object.hasOwnProperty.call(t,e)&&l('Duplicate key "'+e+'"'),t[e]=o(),d(),"}"===r)return u("}"),t;u(","),d()}}l("Bad object")};o=function(){switch(d(),r){case"{":return g();case"[":return m();case'"':return f();case"-":return c();default:return r>="0"&&r<="9"?c():p()}},t.exports=function(e,t){var n;return a=e,i=0,r=" ",n=o(),d(),r&&l("Syntax error"),"function"==typeof t?function e(n,i){var r,a,o=n[i];if(o&&"object"==typeof o)for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(void 0!==(a=e(o,r))?o[r]=a:delete o[r]);return t.call(n,i,o)}({"":n},""):n}},{}],4:[function(e,t,n){function i(e){return l.lastIndex=0,l.test(e)?'"'+e.replace(l,function(e){var t=u[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function r(e,t){var n,l,u,c,f,d=a,p=t[e];switch(p&&"object"==typeof p&&"function"==typeof p.toJSON&&(p=p.toJSON(e)),"function"==typeof s&&(p=s.call(t,e,p)),typeof p){case"string":return i(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";if(a+=o,f=[],"[object Array]"===Object.prototype.toString.apply(p)){for(c=p.length,n=0;n<c;n+=1)f[n]=r(n,p)||"null";return u=0===f.length?"[]":a?"[\n"+a+f.join(",\n"+a)+"\n"+d+"]":"["+f.join(",")+"]",a=d,u}if(s&&"object"==typeof s)for(c=s.length,n=0;n<c;n+=1)"string"==typeof(l=s[n])&&(u=r(l,p))&&f.push(i(l)+(a?": ":":")+u);else for(l in p)Object.prototype.hasOwnProperty.call(p,l)&&(u=r(l,p))&&f.push(i(l)+(a?": ":":")+u);return u=0===f.length?"{}":a?"{\n"+a+f.join(",\n"+a)+"\n"+d+"}":"{"+f.join(",")+"}",a=d,u}}var a,o,s,l=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,u={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};t.exports=function(e,t,n){var i;if(a="",o="","number"==typeof n)for(i=0;i<n;i+=1)o+=" ";else"string"==typeof n&&(o=n);if(s=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return r("",{"":e})}},{}],5:[function(e,t,n){(function(e){var n,i,r,a,o,s,l,u,c,f,d,p,m,g,h,v;!function(n){function i(e,t){return function(n,i){return e[n]=t?t(n,i):i}}var r="object"==typeof e?e:"object"==typeof self?self:"object"==typeof this?this:{};n("object"==typeof t&&"object"==typeof t.exports?i(r,i(t.exports)):i(r))}(function(e){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};n=function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)},i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},r=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&(n[i[r]]=e[i[r]]);return n},a=function(e,t,n,i){var r,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(o=(a<3?r(o):a>3?r(t,n,o):r(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},o=function(e,t){return function(n,i){t(n,i,e)}},s=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e,t,n,i){return new(n||(n=Promise))(function(r,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})},u=function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,a&&(o=a[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(a,n[1])).done)return o;switch(a=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,a=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){l.label=n[1];break}if(6===n[0]&&l.label<o[1]){l.label=o[1],o=n;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(n);break}o[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(e){n=[6,e],a=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,a,o,s,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},c=function(e,t){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])},f=function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},d=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return o},p=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(d(arguments[t]));return e},m=function(e){return this instanceof m?(this.v=e,this):new m(e)},g=function(e,t,n){function i(e){c[e]&&(u[e]=function(t){return new Promise(function(n,i){f.push([e,t,n,i])>1||r(e,t)})})}function r(e,t){try{a(c[e](t))}catch(e){l(f[0][3],e)}}function a(e){e.value instanceof m?Promise.resolve(e.value.v).then(o,s):l(f[0][2],e)}function o(e){r("next",e)}function s(e){r("throw",e)}function l(e,t){e(t),f.shift(),f.length&&r(f[0][0],f[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var u,c=n.apply(e,t||[]),f=[];return u={},i("next"),i("throw"),i("return"),u[Symbol.asyncIterator]=function(){return this},u},h=function(e){function t(t,r){e[t]&&(n[t]=function(n){return(i=!i)?{value:m(e[t](n)),done:"return"===t}:r?r(n):n})}var n,i;return n={},t("next"),t("throw",function(e){throw e}),t("return"),n[Symbol.iterator]=function(){return this},n},v=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator];return t?t.call(e):"function"==typeof f?f(e):e[Symbol.iterator]()},e("__extends",n),e("__assign",i),e("__rest",r),e("__decorate",a),e("__param",o),e("__metadata",s),e("__awaiter",l),e("__generator",u),e("__exportStar",c),e("__values",f),e("__read",d),e("__spread",p),e("__await",m),e("__asyncGenerator",g),e("__asyncDelegator",h),e("__asyncValues",v)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,t,n){!function(e,i){i("object"==typeof n&&void 0!==t?n:e.vega=e.vega||{})}(this,function(e){"use strict";function t(e){return u.hasOwnProperty(e)}function n(e,t,n,i,r){for(var a,o=0,s=e.length;t<s;++t){if(a=e[t],!o&&a===n)return t;r&&r.indexOf(a)>=0?--o:i&&i.indexOf(a)>=0&&++o}return t}function i(e){for(var t=[],i=0,r=e.length,a=0;a<r;)a=n(e,a,v,d+m,p+g),t.push(e.substring(i,a).trim()),i=++a;if(0===t.length)throw"Empty event selector: "+e;return t}function r(e){return"["===e[0]?a(e):o(e)}function a(e){var t,a,o=e.length,s=1;if((s=n(e,s,p,d,p))===o)throw"Empty between selector: "+e;if(2!==(t=i(e.substring(1,s))).length)throw"Between selector must have two elements: "+e;if((e=e.slice(s+1).trim())[0]!==b)throw"Expected '>' after between selector: "+e;return t=t.map(r),(a=r(e.slice(1).trim())).between?{between:t,stream:a}:(a.between=t,a)}function o(e){var i,r,a={source:l},o=[],u=[0,0],c=0,f=0,v=e.length,b=0;if(e[v-1]===g){if(!((b=e.lastIndexOf(m))>=0))throw"Unmatched right brace: "+e;try{u=s(e.substring(b+1,v-1))}catch(t){throw"Invalid throttle specification: "+e}v=(e=e.slice(0,b).trim()).length,b=0}if(!v)throw e;if(e[0]===y&&(c=++b),(i=n(e,b,h))<v&&(o.push(e.substring(f,i).trim()),f=b=++i),(b=n(e,b,d))===v)o.push(e.substring(f,v).trim());else if(o.push(e.substring(f,b).trim()),r=[],(f=++b)===v)throw"Unmatched left bracket: "+e;for(;b<v;){if((b=n(e,b,p))===v)throw"Unmatched left bracket: "+e;if(r.push(e.substring(f,b).trim()),b<v-1&&e[++b]!==d)throw"Expected left bracket: "+e;f=++b}if(!(v=o.length)||S.test(o[v-1]))throw"Invalid event selector: "+e;return v>1?(a.type=o[1],c?a.markname=o[0].slice(1):t(o[0])?a.marktype=o[0]:a.source=o[0]):a.type=o[0],"!"===a.type.slice(-1)&&(a.consume=!0,a.type=a.type.slice(0,-1)),null!=r&&(a.filter=r),u[0]&&(a.throttle=u[0]),u[1]&&(a.debounce=u[1]),a}function s(e){var t=e.split(v);if(!e.length||t.length>2)throw e;return t.map(function(t){var n=+t;if(n!==n)throw e;return n})}var l,u,c=function(e,t,n){return l=t||f,u=n||_,i(e.trim()).map(r)},f="view",d="[",p="]",m="{",g="}",h=":",v=",",y="@",b=">",S=/[\[\]\{\}]/,_={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};e.selector=c,Object.defineProperty(e,"__esModule",{value:!0})})},{}],7:[function(e,t,n){!function(e,i){i("object"==typeof n&&void 0!==t?n:e.vega=e.vega||{})}(this,function(e){"use strict";function t(e){return null==e?null:e.fname}function n(e){return null==e?null:e.fields}function i(e){return u(e)?"["+e.map(i)+"]":c(e)||f(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function r(e,t,n){var i=[t].concat([].slice.call(n));console[e].apply(console,i)}function a(e){return M(e)?e:R(e)?e:Date.parse(e)}var o=function(e,t,n){return e.fields=t||[],e.fname=n,e},s=function(e){throw Error(e)},l=function(e){function t(){a.push(c+e.substring(n,i)),c="",n=i+1}var n,i,r,a=[],o=null,l=0,u=e.length,c="";for(e+="",n=i=0;i<u;++i)if("\\"===(r=e[i]))c+=e.substring(n,i),n=++i;else if(r===o)t(),o=null,l=-1;else{if(o)continue;n===l&&'"'===r?(n=i+1,o=r):n===l&&"'"===r?(n=i+1,o=r):"."!==r||l?"["===r?(i>n&&t(),l=n=i+1):"]"===r&&(l||s("Access path missing open bracket: "+e),l>0&&t(),l=0,n=i+1):i>n?t():n=i+1}return l&&s("Access path missing closing bracket: "+e),o&&s("Access path missing closing quote: "+e),i>n&&(++i,t()),a},u=Array.isArray,c=function(e){return e===Object(e)},f=function(e){return"string"==typeof e},d=function(e,t){var n=l(e),r="return _["+n.map(i).join("][")+"];";return o(Function("_",r),[e=1===n.length?n[0]:e],t||e)},p=[],m=d("id"),g=o(function(e){return e},p,"identity"),h=o(function(){return 0},p,"zero"),v=o(function(){return 1},p,"one"),y=o(function(){return!0},p,"true"),b=o(function(){return!1},p,"false"),S=function(e){var t=e||0;return{level:function(e){return arguments.length?(t=+e,this):t},warn:function(){return t>=1&&r("warn","WARN",arguments),this},info:function(){return t>=2&&r("log","INFO",arguments),this},debug:function(){return t>=3&&r("log","DEBUG",arguments),this}}},_=function(e){return null!=e?u(e)?e:[e]:[]},E=function(e,t){var n,r,a,s,u,c,f=[],d=(e=_(e)).map(function(e,t){return null==e?null:(f.push(t),l(e).map(i).join("]["))}),p=f.length-1,m=_(t),g="var u,v;return ";if(p<0)return null;for(r=0;r<=p;++r)s="((v=v instanceof Date?+v:v),(u=u instanceof Date?+u:u))",g+="("+("(u=a["+(a=d[n=f[r]])+"])")+"<"+("(v=b["+a+"])")+"||u==null)&&v!=null?"+(u="descending"!==m[n]?(c=1,-1):(c=-1,1))+":(u>v||v==null)&&u!=null?"+c+":"+s+"!==u&&v===v?"+u+":v!==v&&u===u?"+c+(n<p?":":":0");return o(Function("a","b",g+";"),e.filter(function(e){return null!=e}))},O=function(e){return"function"==typeof e},N=function(e){return O(e)?e:function(){return e}},x=function(e,t){function n(){t(r),i=r=null}var i,r;return function(t){r=t,i&&clearTimeout(i),i=setTimeout(n,e)}},T=function(e){for(var t,n,i=1,r=arguments.length;i<r;++i){t=arguments[i];for(n in t)e[n]=t[n]}return e},D=function(e,t){var n,i,r,a,o,s=-1,l=e.length;if(null==t){for(;++s<l;)if(null!=(i=e[s])&&i>=i){n=r=i;break}for(a=o=s;++s<l;)null!=(i=e[s])&&(n>i&&(n=i,a=s),r<i&&(r=i,o=s))}else{for(;++s<l;)if(null!=(i=t(e[s],s,e))&&i>=i){n=r=i;break}for(a=o=s;++s<l;)null!=(i=t(e[s],s,e))&&(n>i&&(n=i,a=s),r<i&&(r=i,o=s))}return[a,o]},A={},w=function(e){function t(e){return r.hasOwnProperty(e)&&r[e]!==A}var n,i,r={};return n={size:0,empty:0,object:r,has:t,get:function(e){return t(e)?r[e]:void 0},set:function(e,i){return t(e)||(++n.size,r[e]===A&&--n.empty),r[e]=i,this},delete:function(e){return t(e)&&(--n.size,++n.empty,r[e]=A),this},clear:function(){n.size=n.empty=0,n.object=r={}},test:function(e){return arguments.length?(i=e,n):i},clean:function(){var e,t,a={},o=0;for(e in r)(t=r[e])===A||i&&i(t)||(a[e]=t,++o);n.size=o,n.empty=0,n.object=r=a}},e&&Object.keys(e).forEach(function(t){n.set(t,e[t])}),n},k=function(e,t){var n=e.prototype=Object.create(t.prototype);return n.constructor=e,n},C=function(e){return"boolean"==typeof e},R=function(e){return"[object Date]"===Object.prototype.toString.call(e)},M=function(e){return"number"==typeof e},P=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},I=function(e){var t=(e=e?_(e):e)&&e.length?Function("_","return ''+"+e.map(function(e){return"_["+l(e).map(i).join("][")+"]"}).join("+'|'+")+";"):function(){return""};return o(t,e,"key")},L=function(e,t,n,i){var r=t.length,a=n.length;if(!a)return t;if(!r)return n;for(var o=i||new t.constructor(r+a),s=0,l=0,u=0;s<r&&l<a;++u)o[u]=e(t[s],n[l])>0?n[l++]:t[s++];for(;s<r;++s,++u)o[u]=t[s];for(;l<a;++l,++u)o[u]=n[l];return o},U=function(e,t){for(var n="";--t>=0;)n+=e;return n},F=function(e,t,n,i){var r=n||" ",a=e+"",o=t-a.length;return o<=0?a:"left"===i?U(r,o)+a:"center"===i?U(r,~~(o/2))+a+U(r,Math.ceil(o/2)):a+U(r,o)},j=function(e){return e[e.length-1]},z=function(e){return null==e||""===e?null:!(!e||"false"===e||"0"===e)&&!!e},H=function(e,t){return t=t||a,null==e||""===e?null:t(e)},Y=function(e){return null==e||""===e?null:+e},B=function(e){return null==e||""===e?null:e+""},X=function(e){for(var t={},n=0,i=e.length;n<i;++n)t[e[n]]=1;return t},W=function(e,t,n,i){var r=null!=i?i:"…",a=e+"",o=a.length,s=Math.max(0,t-r.length);return o<=t?a:"left"===n?r+a.slice(o-s):"center"===n?a.slice(0,Math.ceil(s/2))+r+a.slice(o-~~(s/2)):a.slice(0,s)+r},V=function(e,t,n){if(e){var i,r=0,a=e.length;if(t)for(;r<a;++r)(i=t(e[r]))&&n(i,r,e);else e.forEach(n)}};e.accessor=o,e.accessorName=t,e.accessorFields=n,e.id=m,e.identity=g,e.zero=h,e.one=v,e.truthy=y,e.falsy=b,e.logger=S,e.None=0,e.Warn=1,e.Info=2,e.Debug=3,e.array=_,e.compare=E,e.constant=N,e.debounce=x,e.error=s,e.extend=T,e.extentIndex=D,e.fastmap=w,e.field=d,e.inherits=k,e.isArray=u,e.isBoolean=C,e.isDate=R,e.isFunction=O,e.isNumber=M,e.isObject=c,e.isRegExp=P,e.isString=f,e.key=I,e.merge=L,e.pad=F,e.peek=j,e.repeat=U,e.splitAccessPath=l,e.stringValue=i,e.toBoolean=z,e.toDate=H,e.toNumber=Y,e.toString=B,e.toSet=X,e.truncate=W,e.visitArray=V,Object.defineProperty(e,"__esModule",{value:!0})})},{}],8:[function(e,t,n){t.exports={name:"vega-lite",author:'Jeffrey Heer, Dominik Moritz, Kanit "Ham" Wongsuphasawat',version:"2.0.0-beta.5",collaborators:["Kanit Wongsuphasawat <kanitw@gmail.com> (http://kanitw.yellowpigz.com)","Dominik Moritz <domoritz@cs.washington.edu> (https://www.domoritz.de)","Jeffrey Heer <jheer@uw.edu> (http://jheer.org)"],homepage:"https://vega.github.io/vega-lite/",description:"Vega-lite provides a higher-level grammar for visual analysis, comparable to ggplot or Tableau, that generates complete Vega specifications.",main:"build/src/vl.js",types:"build/src/vl.d.ts",bin:{vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2vg:"./bin/vl2vg"},directories:{test:"test"},scripts:{pretsc:"mkdir -p build && rm -rf build/*/** && cp package.json build/",tsc:"tsc",prebuild:"mkdir -p build/site build/examples/images build/test-gallery",build:"npm run tsc && cp package.json build && browserify src/vl.ts -p tsify -d -s vl | exorcist build/vega-lite.js.map > build/vega-lite.js",postbuild:"uglifyjs build/vega-lite.js -cm --source-map content=build/vega-lite.js.map,filename=build/vega-lite.min.js.map -o build/vega-lite.min.js && npm run schema","build:examples":"npm run build && npm run build:examples-only","build:examples-only":"./scripts/build-examples.sh && rm -rf examples/specs/normalized/* && scripts/build-normalized-examples","build:images":"npm run data && scripts/generate-images.sh","build:toc":"bundle exec jekyll build -q && scripts/generate-toc","build:site":"browserify site/static/main.ts -p [tsify -p site] -d | exorcist build/site/main.js.map > build/site/main.js","build:versions":"scripts/update-version.sh","build:test-gallery":"browserify test-gallery/main.ts -p [tsify -p test-gallery] -d > build/test-gallery/main.js","check:examples":"scripts/check-examples.sh","check:schema":"scripts/check-schema.sh",clean:"rm -rf build && rm -f vega-lite.* & find -E src test site examples -regex '.*\\.(js|js.map|d.ts|vg.json)' -delete & rm -rf data",data:"rsync -r node_modules/vega-datasets/data/* data",link:"npm link && npm link vega-lite",deploy:"scripts/deploy.sh","deploy:gh":"scripts/deploy-gh.sh","deploy:schema":"scripts/deploy-schema.sh",prestart:"npm run data && npm run build && scripts/index-examples",start:"nodemon -x 'npm run build:test-gallery' & browser-sync start --server --files 'build/test-gallery/main.js' --index 'test-gallery/index.html'",poststart:"rm examples/all-examples.json",preschema:"npm run prebuild",schema:"typescript-to-json-schema --path tsconfig.json --type TopLevelExtendedSpec > build/vega-lite-schema.json && npm run renameschema && cp build/vega-lite-schema.json _data/",renameschema:"scripts/rename-schema.sh",presite:"npm run build && npm run data && npm run build:site && npm run build:toc && npm run build:versions",site:"bundle exec jekyll serve",lint:"tslint --project tsconfig.json -c tslint.json --type-check",test:"npm run tsc && npm run test:only && npm run lint",posttest:"npm run schema && npm run data && npm run mocha:examples","test:nocompile":"npm run test:only && npm run lint && npm run mocha:examples","test:only":"nyc --reporter=html --reporter=text-summary npm run mocha:test","test:debug":"npm run tsc && mocha --recursive --debug-brk --inspect build/test","test:debug-examples":"npm run tsc && npm run schema && mocha --recursive --debug-brk --inspect build/examples","mocha:test":"mocha --require source-map-support/register --reporter dot --recursive build/test","mocha:examples":"mocha --require source-map-support/register --reporter dot --recursive build/examples",codecov:"nyc report --reporter=json && codecov -f coverage/*.json","watch:build":"watchify src/vl.ts -p tsify -v -d -s vl -o 'exorcist build/vega-lite.js.map > build/vega-lite.js'","watch:tsc":"npm run tsc -- -w","watch:test":"nodemon -x 'npm test'",watch:"nodemon -x 'npm run build && npm run test:nocompile' # already ran schema in build"},repository:{type:"git",url:"https://github.com/vega/vega-lite.git"},license:"BSD-3-Clause",bugs:{url:"https://github.com/vega/vega-lite/issues"},devDependencies:{"@types/chai":"^4.0.0","@types/d3":"^4.9.0","@types/highlight.js":"^9.1.9","@types/json-stable-stringify":"^1.0.31","@types/mocha":"^2.2.41","@types/node":"^7.0.28",ajv:"5.1.5","browser-sync":"^2.18.12",browserify:"^14.4.0","browserify-shim":"^3.8.14",chai:"^4.0.2",cheerio:"^1.0.0-rc.1",codecov:"^2.2.0",d3:"^4.9.1",exorcist:"^0.4.0","highlight.js":"^9.12.0",mocha:"^3.4.2",nodemon:"^1.11.0",nyc:"^11.0.2","source-map-support":"^0.4.15",tsify:"^3.0.1",tslint:"^5.4.3","tslint-eslint-rules":"^4.1.1",typescript:"^2.3.4","typescript-to-json-schema":"vega/typescript-to-json-schema#v0.5.0","uglify-js":"^3.0.15",vega:"3.0.0-beta.33","vega-datasets":"vega/vega-datasets#gh-pages","vega-embed":"3.0.0-beta.17",watchify:"^3.9.0","yaml-front-matter":"^3.4.0"},dependencies:{"json-stable-stringify":"^1.0.1",tslib:"^1.7.1","vega-event-selector":"^2.0.0-beta","vega-util":"^1.3.0",yargs:"^8.0.1"}}},{}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("./util");n.AGGREGATE_OPS=["values","count","valid","missing","distinct","sum","mean","average","variance","variancep","stdev","stdevp","median","q1","q3","ci0","ci1","modeskew","min","max","argmin","argmax"],n.AGGREGATE_OP_INDEX=i.toSet(n.AGGREGATE_OPS),n.SUM_OPS=["count","sum","distinct","valid","missing"],n.SHARED_DOMAIN_OPS=["mean","average","median","q1","q3","min","max"],n.SHARED_DOMAIN_OP_INDEX=i.toSet(n.SHARED_DOMAIN_OPS)},{"./util":102}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AXIS_PROPERTIES=["domain","format","grid","labelPadding","labels","maxExtent","minExtent","offset","orient","position","tickCount","ticks","tickSize","title","titlePadding","values","zindex"]},{}],11:[function(e,t,n){"use strict";function i(e){return o.isBoolean(e)?"bin":"bin"+o.keys(e).map(function(t){return"_"+t+"_"+e[t]}).join("")}function r(e){switch(e){case a.ROW:case a.COLUMN:case a.SIZE:case a.COLOR:case a.OPACITY:case a.SHAPE:return 6;default:return 10}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("./channel"),o=e("./util");n.binToString=i,n.autoMaxBins=r},{"./channel":12,"./util":102}],12:[function(e,t,n){"use strict";function i(e){return!!p[e]}function r(e){return!!m[e]}function a(e,t){return t in o(e)}function o(e){switch(e){case n.X:case n.Y:case n.COLOR:case n.DETAIL:case n.TOOLTIP:case n.ORDER:case n.OPACITY:case n.ROW:case n.COLUMN:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,rect:!0,line:!0,area:!0,text:!0};case n.X2:case n.Y2:return{rule:!0,bar:!0,rect:!0,area:!0};case n.SIZE:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,text:!0,line:!0};case n.SHAPE:return{point:!0};case n.TEXT:return{text:!0}}}function s(e){return!d.contains([n.DETAIL,n.TEXT,n.ORDER,n.TOOLTIP],e)}function l(e,t){switch(e){case n.ROW:case n.COLUMN:return"band"===t;case n.X:case n.Y:case n.SIZE:case n.OPACITY:return t in g;case n.COLOR:return"band"!==t;case n.SHAPE:return"ordinal"===t}return!1}function u(e){switch(e){case n.X:case n.Y:case n.SIZE:case n.OPACITY:case n.X2:case n.Y2:return"continuous";case n.ROW:case n.COLUMN:case n.SHAPE:case n.TEXT:case n.TOOLTIP:return"discrete";case n.COLOR:return"flexible";case n.DETAIL:case n.ORDER:return}throw new Error("getSupportedRole not implemented for "+e)}Object.defineProperty(n,"__esModule",{value:!0});var c,f=e("./scale"),d=e("./util");!function(e){e.ROW="row",e.COLUMN="column",e.X="x",e.Y="y",e.X2="x2",e.Y2="y2",e.COLOR="color",e.SHAPE="shape",e.SIZE="size",e.OPACITY="opacity",e.TEXT="text",e.ORDER="order",e.DETAIL="detail",e.TOOLTIP="tooltip"}(c=n.Channel||(n.Channel={})),n.X=c.X,n.Y=c.Y,n.X2=c.X2,n.Y2=c.Y2,n.ROW=c.ROW,n.COLUMN=c.COLUMN,n.SHAPE=c.SHAPE,n.SIZE=c.SIZE,n.COLOR=c.COLOR,n.TEXT=c.TEXT,n.DETAIL=c.DETAIL,n.ORDER=c.ORDER,n.OPACITY=c.OPACITY,n.TOOLTIP=c.TOOLTIP,n.CHANNELS=[n.X,n.Y,n.X2,n.Y2,n.ROW,n.COLUMN,n.SIZE,n.SHAPE,n.COLOR,n.ORDER,n.OPACITY,n.TEXT,n.DETAIL,n.TOOLTIP];var p=d.toSet(n.CHANNELS);n.SINGLE_DEF_CHANNELS=[n.X,n.Y,n.X2,n.Y2,n.ROW,n.COLUMN,n.SIZE,n.SHAPE,n.COLOR,n.OPACITY,n.TEXT,n.TOOLTIP],n.isChannel=i,n.UNIT_CHANNELS=[n.X,n.Y,n.X2,n.Y2,n.SIZE,n.SHAPE,n.COLOR,n.ORDER,n.OPACITY,n.TEXT,n.DETAIL,n.TOOLTIP],n.SCALE_CHANNELS=[n.X,n.Y,n.SIZE,n.SHAPE,n.COLOR,n.OPACITY];var m=d.toSet(n.SCALE_CHANNELS);n.isScaleChannel=r,n.NONSPATIAL_CHANNELS=[n.SIZE,n.SHAPE,n.COLOR,n.ORDER,n.OPACITY,n.TEXT,n.DETAIL,n.TOOLTIP],n.SPATIAL_SCALE_CHANNELS=[n.X,n.Y],n.NONSPATIAL_SCALE_CHANNELS=[n.SIZE,n.SHAPE,n.COLOR,n.OPACITY],n.LEVEL_OF_DETAIL_CHANNELS=d.without(n.NONSPATIAL_CHANNELS,["order"]),n.STACK_BY_CHANNELS=[n.COLOR,n.DETAIL,n.ORDER,n.OPACITY,n.SIZE],n.supportMark=a,n.getSupportedMark=o,n.hasScale=s;var g=d.toSet(d.without(f.SCALE_TYPES,["ordinal","sequential"]));n.supportScaleType=l,n.rangeType=u},{"./scale":93,"./util":102}],13:[function(e,t,n){"use strict";function i(e,t,n,i){var f=e.fieldDef(t)||("x"===t?e.fieldDef("x2"):"y"===t?e.fieldDef("y2"):void 0),d=e.axis(t),p=e.config,m={};if(f.type===l.TEMPORAL){var g=e.getScaleComponent(t).get("type")===s.ScaleType.UTC;m.text={signal:c.timeFormatExpression("datum.value",f.timeUnit,d.format,p.axis.shortTimeLabels,p.timeFormat,g)}}if(void 0!==d.labelAngle?m.angle={value:d.labelAngle}:t===o.X&&(u.contains([l.NOMINAL,l.ORDINAL],f.type)||f.bin||f.type===l.TEMPORAL)&&(m.angle={value:270}),m.angle&&"x"===t){var h=(m.angle.value%360+360)%360,v=r(h,i.orient);v&&(m.align={value:v}),u.contains([90,270],h)&&(m.baseline={value:"middle"})}return m=a.__assign({},m,n),0===u.keys(m).length?void 0:m}function r(e,t){if(e&&e>0){if(e>180)return"top"===t?"left":"right";if(e<180)return"top"===t?"right":"left"}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("../../channel"),s=e("../../scale"),l=e("../../type"),u=e("../../util"),c=e("../common");n.labels=i,n.labelAlign=r},{"../../channel":12,"../../scale":93,"../../type":101,"../../util":102,"../common":16,tslib:5}],14:[function(e,t,n){"use strict";function i(e,t){return t.reduce(function(t,n){var i={axes:[],gridAxes:[]};if(e.axis(n)){var r=l(n,e);r&&a(r)&&i.axes.push(r);var o=s(n,e);o&&a(o)&&i.gridAxes.push(o),t[n]=i}return t},{})}function r(e){return!1===e||null===e}function a(e){return d.some(g,function(t){return o(e,t)})}function o(e,t){return"grid"===t||"title"===t?!!e[t]:!r(e[t])}function s(e,t){return u(e,t,!0)}function l(e,t){return u(e,t,!1)}function u(e,t,n){var i=t.axis(e),r={scale:t.scaleName(e)};f.AXIS_PROPERTIES.forEach(function(a){var o=c(a,i,e,t,n);void 0!==o&&(r[a]=o)});var a=c("gridScale",i,e,t,n);void 0!==a&&(r.gridScale=a);var s=i.encoding||{};return g.forEach(function(n){if(o(r,n)){var i;void 0!==(i="labels"===n?p.labels(t,e,s.labels||{},r):s[n]||{})&&d.keys(i).length>0&&(r.encode=r.encode||{},r.encode[n]={update:i})}}),r}function c(e,t,n,i,r){var a=i.fieldDef(n);switch(e){case"labels":return!r&&t[e];case"domain":return m.domain(e,t,r,n);case"ticks":return m.ticks(e,t,r,n);case"format":return m.format(t,n,a,i.config);case"grid":return m.grid(i,n,r);case"gridScale":return m.gridScale(i,n,r);case"orient":return m.orient(t,n);case"tickCount":return m.tickCount(t,n,a);case"title":return m.title(t,a,i.config,r);case"values":return m.values(t,i,a);case"zindex":return m.zindex(t,r)}return t[e]}Object.defineProperty(n,"__esModule",{value:!0});var f=e("../../axis"),d=e("../../util"),p=e("./encode"),m=e("./rules"),g=["domain","grid","labels","ticks","title"];n.parseAxisComponent=i,n.parseGridAxis=s,n.parseMainAxis=l},{"../../axis":10,"../../util":102,"./encode":13,"./rules":15}],15:[function(e,t,n){"use strict";function i(e,t,n,i){return b.numberFormat(n,e.format,i,t)}function r(e,t){var n=e.axis(t).grid;return void 0!==n?n:!e.hasDiscreteDomain(t)&&!e.fieldDef(t).bin}function a(e,t,n){if(n)return r(e,t)}function o(e,t,n){if(n){var i="x"===t?"y":"x";if(e.getScaleComponent(i))return e.scaleName(i)}}function s(e,t){var n=e.orient;if(n)return n;switch(t){case m.COLUMN:return"top";case m.X:return"bottom";case m.ROW:case m.Y:return"left"}throw new Error(v.message.INVALID_CHANNEL_FOR_AXIS)}function l(e,t,n){var i=e.tickCount;return void 0!==i?i:t!==m.X||n.bin?void 0:5}function u(e,t,n,i){if(!i&&""!==e.title){if(void 0!==e.title)return e.title;var r=h.title(t,n),a=e.titleMaxLength;return a?y.truncate(r,a):r}}function c(e,t,n){var i=e.values;if(e.values&&g.isDateTime(i[0]))return i.map(function(e){return{signal:g.dateTimeExpr(e,!0)}});if(!i&&n.bin){var r=t.getName(p.binToString(n.bin)+"_"+n.field+"_bins");return{signal:"sequence("+r+".start, "+r+".stop + "+r+".step, "+r+".step)"}}return i}function f(e,t){var n=e.zindex;return void 0!==n?n:t?0:1}function d(e,t,n,i){return!n&&i!==m.ROW&&i!==m.COLUMN&&t[e]}Object.defineProperty(n,"__esModule",{value:!0});var p=e("../../bin"),m=e("../../channel"),g=e("../../datetime"),h=e("../../fielddef"),v=e("../../log"),y=e("../../util"),b=e("../common");n.format=i,n.gridShow=r,n.grid=a,n.gridScale=o,n.orient=s,n.tickCount=l,n.title=u,n.values=c,n.zindex=f,n.domainAndTicks=d,n.domain=d,n.ticks=d},{"../../bin":11,"../../channel":12,"../../datetime":82,"../../fielddef":85,"../../log":89,"../../util":102,"../common":16}],16:[function(e,t,n){"use strict";function i(e,t,n,i,r,a){if(g.isFacetSpec(e))return new S.FacetModel(e,t,n,r,a);if(g.isLayerSpec(e))return new _.LayerModel(e,t,n,i,r,a);if(g.isUnitSpec(e))return new O.UnitModel(e,t,n,i,r,a);if(g.isRepeatSpec(e))return new E.RepeatModel(e,t,n,r,a);if(g.isConcatSpec(e))return new b.ConcatModel(e,t,n,r,a);throw new Error(p.message.INVALID_SPEC)}function r(e,t,n){for(var i=0,r=n;i<r.length;i++){var a=r[i],o=t[a];void 0!==o&&(e[a]={value:o})}return e}function a(e,t,n){for(var i=0,r=n;i<r.length;i++){var a=r[i],s=o(a,t.mark(),t.config);void 0!==s&&(e[a]={value:s})}return e}function o(e,t,n){var i=n[t];return void 0!==i[e]?i[e]:n.mark[e]}function s(e,t,n,i,r){if("quantitative"===e.type){var a=l(e,t,i,"text");return e.bin?r?{signal:d.field(e,{expr:n,binSuffix:"range"})}:{signal:"format("+d.field(e,{expr:n,binSuffix:"start"})+", '"+a+"')+'-'+format("+d.field(e,{expr:n,binSuffix:"end"})+", '"+a+"')"}:{signal:"format("+d.field(e,{expr:n})+", '"+a+"')"}}if("temporal"===e.type){var o=d.isScaleFieldDef(e)&&e.scale&&e.scale.type===m.ScaleType.UTC;return{signal:u(d.field(e,{expr:n}),e.timeUnit,t,i.text.shortTimeLabels,i.timeFormat,o)}}return{signal:d.field(e,{expr:n})}}function l(e,t,n,i){var r=t;if(e.type===v.QUANTITATIVE)return r||("count"===e.aggregate&&i===f.TEXT?"d":n.numberFormat)}function u(e,t,n,i,r,a){if(!t||n){var o=n||r;return a?"utcFormat("+e+", '"+o+"')":"timeFormat("+e+", '"+o+"')"}return h.formatExpression(t,e,i,a)}function c(e){return(y.isArray(e)?e:[e]).reduce(function(e,t){return e.field.push(d.field(t,{binSuffix:"start"})),e.order.push(t.sort||"ascending"),e},{field:[],order:[]})}Object.defineProperty(n,"__esModule",{value:!0});var f=e("../channel"),d=e("../fielddef"),p=e("../log"),m=e("../scale"),g=e("../spec"),h=e("../timeunit"),v=e("../type"),y=e("../util"),b=e("./concat"),S=e("./facet"),_=e("./layer"),E=e("./repeat"),O=e("./unit");n.buildModel=i,n.applyConfig=r,n.applyMarkConfig=a,n.getMarkConfig=o,n.formatSignalRef=s,n.numberFormat=l,n.timeFormatExpression=u,n.sortParams=c},{"../channel":12,"../fielddef":85,"../log":89,"../scale":93,"../spec":96,"../timeunit":98,"../type":101,"../util":102,"./concat":18,"./facet":34,"./layer":35,"./repeat":55,"./unit":76}],17:[function(e,t,n){"use strict";function i(e,t){t&&l.set(t);try{var n=s.initConfig(e.config),i=u.normalize(e,n),o=f.buildModel(i,null,"",void 0,void 0,n);return o.parse(),a(o,r(e,n))}finally{t&&l.reset()}}function r(e,t){return o.__assign({},c.extractTopLevelProperties(t),c.extractTopLevelProperties(e))}function a(e,t){var n=e.config?s.stripConfig(e.config):void 0,i=(t.autoResize,o.__rest(t,["autoResize"])),r=e.assembleParentGroupProperties();return r&&(delete r.width,delete r.height),{spec:o.__assign({$schema:"http://vega.github.io/schema/vega/v3.0.json"},e.description?{description:e.description}:{},{autosize:t.autoResize?{type:"pad",resize:!0}:"pad"},i,r?{encode:{update:r}}:{},{data:[].concat(e.assembleSelectionData([]),e.assembleData())},e.assembleGroup([].concat(e.name&&(e instanceof d.LayerModel||e instanceof p.UnitModel)?[{name:"width",update:e.getName("width")},{name:"height",update:e.getName("height")}]:[],e.assembleLayoutSignals(),e.assembleSelectionTopLevelSignals([]))),n?{config:n}:{})}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("tslib"),s=e("../config"),l=e("../log"),u=e("../spec"),c=e("../toplevelprops"),f=e("./common"),d=e("./layer"),p=e("./unit");n.compile=i},{"../config":80,"../log":89,"../spec":96,"../toplevelprops":99,"./common":16,"./layer":35,"./unit":76,tslib:5}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("../resolve"),a=e("../spec"),o=e("../util"),s=e("./common"),l=e("./data/assemble"),u=e("./data/parse"),c=e("./legend/parse"),f=function(e){function t(t,n,i,o,l){var u=e.call(this,t,n,i,l,r.initConcatResolve(t.resolve||{}))||this;return u.isVConcat=a.isVConcatSpec(t),u.children=(a.isVConcatSpec(t)?t.vconcat:t.hconcat).map(function(e,t){return s.buildModel(e,u,u.getName("concat_"+t),void 0,o,l)}),u}return i.__extends(t,e),t.prototype.parseData=function(){this.component.data=u.parseData(this),this.children.forEach(function(e){e.parseData()})},t.prototype.parseSelection=function(){var e=this;this.component.selection={};for(var t=0,n=this.children;t<n.length;t++)!function(t){t.parseSelection(),o.keys(t.component.selection).forEach(function(n){e.component.selection[n]=t.component.selection[n]})}(n[t])},t.prototype.parseMarkGroup=function(){for(var e=0,t=this.children;e<t.length;e++)t[e].parseMarkGroup()},t.prototype.parseAxisAndHeader=function(){for(var e=0,t=this.children;e<t.length;e++)t[e].parseAxisAndHeader()},t.prototype.parseAxisGroup=function(){return null},t.prototype.parseLegend=function(){for(var e=this,t=this.component.legends={},n=0,i=this.children;n<i.length;n++)!function(n){n.parseLegend(),o.keys(n.component.legends).forEach(function(i){"shared"===e.resolve[i].legend&&c.moveSharedLegendUp(t,n,i)})}(i[n])},t.prototype.assembleData=function(){return this.parent?[]:l.assembleData(this.component.data)},t.prototype.assembleParentGroupProperties=function(){return null},t.prototype.assembleSelectionTopLevelSignals=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionTopLevelSignals(e)},e)},t.prototype.assembleSelectionSignals=function(){return this.children.forEach(function(e){return e.assembleSelectionSignals()}),[]},t.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLayoutSignals())},[])},t.prototype.assembleSelectionData=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionData(e)},[])},t.prototype.assembleLayout=function(){return i.__assign({padding:{row:10,column:10},offset:10},this.isVConcat?{columns:1}:{},{bounds:"full",align:"all"})},t.prototype.assembleMarks=function(){return this.children.map(function(e){var t=e.assembleParentGroupProperties();return i.__assign({type:"group",name:e.getName("group")},t?{encode:{update:t}}:{},e.assembleGroup())})},t}(e("./model").Model);n.ConcatModel=f},{"../resolve":92,"../spec":96,"../util":102,"./common":16,"./data/assemble":20,"./data/parse":28,"./legend/parse":40,"./model":54,tslib:5}],19:[function(e,t,n){"use strict";function i(e,t){return t.bin?(e[s.field(t,{binSuffix:"start"})]=!0,e[s.field(t,{binSuffix:"end"})]=!0,t.type===u.ORDINAL&&(e[s.field(t,{binSuffix:"range"})]=!0)):e[s.field(t)]=!0,e}function r(e,t){for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];for(var r in i)i.hasOwnProperty(r)&&(n in e?e[n][r]=i[r]:e[n]={op:i[r]})}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("../../channel"),s=e("../../fielddef"),l=e("../../log"),u=e("../../type"),c=e("../../util"),f=function(e){function t(t,n){var i=e.call(this)||this;return i.dimensions=t,i.measures=n,i}return a.__extends(t,e),t.prototype.clone=function(){return new t(c.extend({},this.dimensions),c.duplicate(this.measures))},t.makeFromEncoding=function(e){var n=!1;e.forEachFieldDef(function(e){e.aggregate&&(n=!0)});var r={},a={};return n?(e.forEachFieldDef(function(t,n){t.aggregate?"count"===t.aggregate?(r["*"]=r["*"]||{},r["*"].count=s.field(t,{aggregate:"count"})):(r[t.field]=r[t.field]||{},r[t.field][t.aggregate]=s.field(t),o.isScaleChannel(n)&&"unaggregated"===e.scaleDomain(n)&&(r[t.field].min=s.field(t,{aggregate:"min"}),r[t.field].max=s.field(t,{aggregate:"max"}))):i(a,t)}),c.keys(a).length+c.keys(r).length===0?null:new t(a,r)):null},t.makeFromTransform=function(e,n){for(var i={},r={},a=0,o=n.summarize;a<o.length;a++)(f=o[a]).aggregate&&("count"===f.aggregate?(r["*"]=r["*"]||{},r["*"].count=f.as||s.field(f)):(r[f.field]=r[f.field]||{},r[f.field][f.aggregate]=f.as||s.field(f)));for(var l=0,u=n.groupby;l<u.length;l++){var f=u[l];i[f]=!0}return c.keys(i).length+c.keys(r).length===0?null:new t(i,r)},t.prototype.merge=function(e){c.differ(this.dimensions,e.dimensions)?l.debug("different dimensions, cannot merge"):(r(this.measures,e.measures),e.remove())},t.prototype.addDimensions=function(e){var t=this;e.forEach(function(e){return t.dimensions[e]=!0})},t.prototype.dependentFields=function(){var e={};return c.keys(this.dimensions).forEach(function(t){return e[t]=!0}),c.keys(this.measures).forEach(function(t){return e[t]=!0}),e},t.prototype.producedFields=function(){var e=this,t={};return c.keys(this.measures).forEach(function(n){c.keys(e.measures[n]).forEach(function(e){t[e+"_"+n]=!0})}),t},t.prototype.assemble=function(){var e=this,t=[],n=[],i=[];return c.keys(this.measures).forEach(function(r){c.keys(e.measures[r]).forEach(function(a){i.push(e.measures[r][a]),t.push(a),n.push(r)})}),{type:"aggregate",groupby:c.keys(this.dimensions),ops:t,fields:n,as:i}},t}(e("./dataflow").DataFlowNode);n.AggregateNode=f},{"../../channel":12,"../../fielddef":85,"../../log":89,"../../type":101,"../../util":102,"./dataflow":22,tslib:5}],20:[function(e,t,n){"use strict";function i(e){e instanceof b.NonPositiveFilterNode&&p.every(p.vals(e.filter),function(e){return!1===e})&&e.remove(),e instanceof S.NullFilterNode&&p.every(p.vals(e.filteredFields),function(e){return null===e})&&e.remove(),e instanceof h.OutputNode&&!e.isRequired()&&e.remove(),e.children.forEach(i)}function r(e){function t(i){if(!(i instanceof O.OrderNode)){var r=i.clone();if(r instanceof h.OutputNode){var a=n.FACET_SCALE_PREFIX+e.model.getName(r.getSource());r.setSource(a),e.model.component.data.outputNodes[a]=r}else(r instanceof m.AggregateNode||r instanceof x.StackNode)&&r.addDimensions(e.fields);return p.flatten(i.children.map(t)).forEach(function(e){return e.parent=r}),[r]}return p.flatten(i.children.map(t))}return t}function a(e){if(e instanceof v.FacetNode)if(1!==e.numChildren()||e.children[0]instanceof h.OutputNode)o(e.model.component.data.main),p.flatten(e.children.map(r(e))).forEach(function(t){return t.parent=e.model.component.data.main});else{var t=e.children[0];(t instanceof m.AggregateNode||t instanceof x.StackNode)&&t.addDimensions(e.fields),t.swapWithParent(),a(e)}else e.children.forEach(a)}function o(e){if(e instanceof h.OutputNode&&e.type===d.MAIN&&1===e.numChildren()){var t=e.children[0];t instanceof v.FacetNode||(t.swapWithParent(),o(e))}}function s(e){function t(e){0===e.numChildren()?n.push(e):e.children.forEach(t)}var n=[];return e.forEach(t),n}function l(e){function t(i,r){if(i instanceof N.SourceNode&&(d.isUrlData(i.data)||(e.push(r),r=a={name:null,source:r.name,transform:[]})),i instanceof y.ParseNode&&(i.parent instanceof N.SourceNode&&!r.source?r.format=f.__assign({},r.format||{},{parse:i.assembleFormatParse()}):r.transform=r.transform.concat(i.assembleTransforms())),i instanceof v.FacetNode)return r.name||(r.name="data_"+n++),!r.source||r.transform.length>0?(e.push(r),i.data=r.name):i.data=r.source,void i.assemble().forEach(function(t){return e.push(t)});if((i instanceof D.FilterNode||i instanceof S.NullFilterNode||i instanceof D.CalculateNode||i instanceof m.AggregateNode||i instanceof O.OrderNode||i instanceof D.LookupNode)&&r.transform.push(i.assemble()),(i instanceof b.NonPositiveFilterNode||i instanceof g.BinNode||i instanceof T.TimeUnitNode||i instanceof x.StackNode)&&(r.transform=r.transform.concat(i.assemble())),i instanceof h.OutputNode)if(r.source&&0===r.transform.length)i.setSource(r.source);else if(i.parent instanceof h.OutputNode)i.setSource(r.name);else if(r.name||(r.name="data_"+n++),i.setSource(r.name),1===i.numChildren()){e.push(r);var a={name:null,source:r.name,transform:[]};r=a}switch(i.numChildren()){case 0:i instanceof h.OutputNode&&(!r.source||r.transform.length>0)&&e.push(r);break;case 1:t(i.children[0],r);break;default:r.name||(r.name="data_"+n++);var o=r.name;!r.source||r.transform.length>0?e.push(r):o=r.source,i.children.forEach(function(e){t(e,{name:null,source:o,transform:[]})})}}var n=0;return t}function u(e){var t=[],n=l(t);return e.children.forEach(function(t){return n(t,{source:e.name,name:null,transform:[]})}),t}function c(e){var t=p.vals(e.sources),n=[];t.forEach(i),s(t=t.filter(function(e){return e.numChildren()>0})).forEach(_.iterateFromLeaves(E.removeUnusedSubtrees)),s(t=t.filter(function(e){return e.numChildren()>0})).forEach(_.iterateFromLeaves(E.moveParseUp)),t.forEach(a);var r=l(n),o=0;t.forEach(function(e){e.hasName()||(e.dataName="source_"+o++);var t=e.assemble();r(e,t)}),n.forEach(function(e){0===e.transform.length&&delete e.transform}),n.sort(function(e,t){return 0===(e.transform||[]).length?-1:0===(t.transform||[]).length?1:0});for(var u=0,c=n;u<c.length;u++)for(var f=0,d=c[u].transform||[];f<d.length;f++){var m=d[f];"lookup"===m.type&&(m.from=e.outputNodes[m.from].getSource())}return n}Object.defineProperty(n,"__esModule",{value:!0});var f=e("tslib"),d=e("../../data"),p=e("../../util"),m=e("./aggregate"),g=e("./bin"),h=e("./dataflow"),v=e("./facet"),y=e("./formatparse"),b=e("./nonpositivefilter"),S=e("./nullfilter"),_=e("./optimizers"),E=e("./optimizers"),O=e("./pathorder"),N=e("./source"),x=e("./stack"),T=e("./timeunit"),D=e("./transforms");n.FACET_SCALE_PREFIX="scale_",n.assembleFacetData=u,n.assembleData=c},{"../../data":81,"../../util":102,"./aggregate":19,"./bin":21,"./dataflow":22,"./facet":23,"./formatparse":24,"./nonpositivefilter":25,"./nullfilter":26,"./optimizers":27,"./pathorder":29,"./source":30,"./stack":31,"./timeunit":32,"./transforms":33,tslib:5}],21:[function(e,t,n){"use strict";function i(e,t){return"format("+e+", '"+t+"')"}function r(e,t,n,r){if(e.hasDiscreteDomain(n)){var a=e instanceof d.UnitModel?e.axis(n)||e.legend(n)||{}:{},o=f.numberFormat(t,a.format,r,n),s=u.field(t,{expr:"datum",binSuffix:"start"}),l=u.field(t,{expr:"datum",binSuffix:"end"});return{formulaAs:u.field(t,{binSuffix:"range"}),formula:i(s,o)+" + ' - ' + "+i(l,o)}}return{}}function a(e,t){return l.binToString(e)+"_"+t}function o(e,t,n,i){return{bin:e,field:t.field,as:[u.field(t,{binSuffix:"start"}),u.field(t,{binSuffix:"end"})],signal:n.getName(i+"_bins"),extentSignal:n.getName(i+"_extent")}}Object.defineProperty(n,"__esModule",{value:!0});var s=e("tslib"),l=e("../../bin"),u=e("../../fielddef"),c=e("../../util"),f=e("../common"),d=e("../unit"),p=function(e){function t(t){var n=e.call(this)||this;return n.bins=t,n}return s.__extends(t,e),t.prototype.clone=function(){return new t(c.duplicate(this.bins))},t.makeBinFromEncoding=function(e){var n=e.reduceFieldDef(function(t,n,i){var l=n.bin;if(l){var c=u.normalizeBin(l,void 0)||{},f=a(l,n.field);f in t||(t[f]=o(c,n,e,f)),t[f]=s.__assign({},t[f],r(e,n,i,e.config))}return t},{});return 0===c.keys(n).length?null:new t(n)},t.makeBinFromTransform=function(e,n){var i=u.normalizeBin(n.bin,void 0)||{},r=a(i,n.field);return new t((s={},s[r]=o(i,n,e,r),s));var s},t.prototype.merge=function(e){this.bins=c.extend(e.bins),e.remove()},t.prototype.producedFields=function(){var e={};return c.vals(this.bins).forEach(function(t){t.as.forEach(function(t){return e[t]=!0})}),e},t.prototype.dependentFields=function(){var e={};return c.vals(this.bins).forEach(function(t){e[t.field]=!0}),e},t.prototype.assemble=function(){return c.flatten(c.vals(this.bins).map(function(e){var t=[],n=s.__assign({type:"bin",field:e.field,as:e.as,signal:e.signal},e.bin);return e.bin.extent||(t.push({type:"extent",field:e.field,signal:e.extentSignal}),n.extent={signal:e.extentSignal}),t.push(n),e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t}))},t}(e("./dataflow").DataFlowNode);n.BinNode=p},{"../../bin":11,"../../fielddef":85,"../../util":102,"../common":16,"../unit":76,"./dataflow":22,tslib:5}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=function(){function e(e){this.debugName=e,this._children=[],this._parent=null}return e.prototype.clone=function(){throw new Error("Cannot clone node")},e.prototype.producedFields=function(){return{}},e.prototype.dependentFields=function(){return{}},Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},set:function(e){this._parent=e,e.addChild(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),e.prototype.numChildren=function(){return this._children.length},e.prototype.addChild=function(e){this._children.push(e)},e.prototype.removeChild=function(e){this._children.splice(this._children.indexOf(e),1)},e.prototype.remove=function(){for(var e=0,t=this._children;e<t.length;e++)t[e].parent=this._parent;this._parent.removeChild(this)},e.prototype.swapWithParent=function(){for(var e=this._parent,t=e.parent,n=0,i=this._children;n<i.length;n++)i[n].parent=e;this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this},e}();n.DataFlowNode=r;var a=function(e){function t(t,n,i){var r=e.call(this,t)||this;return r.type=n,r.refCounts=i,r._source=r._name=t,!r.refCounts||r._name in r.refCounts||(r.refCounts[r._name]=0),r}return i.__extends(t,e),t.prototype.clone=function(){var e=new this.constructor;return e.debugName="clone_"+this.debugName,e._source=this._source,e.type=this.type,e.refCounts=this.refCounts,e},t.prototype.getSource=function(){return this.refCounts[this._name]++,this._source},t.prototype.isRequired=function(){return!!this.refCounts[this._name]},t.prototype.setSource=function(e){this._source=e},t}(r);n.OutputNode=a},{tslib:5}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("../../channel"),a=function(e){function t(t,n,i){var a=e.call(this)||this;return a.model=t,a.name=n,a.data=i,t.facet.column&&(a.columnField=t.field(r.COLUMN),a.columnName=t.getName("column")),t.facet.row&&(a.rowField=t.field(r.ROW),a.rowName=t.getName("row")),a}return i.__extends(t,e),Object.defineProperty(t.prototype,"fields",{get:function(){var e=[];return this.columnField&&e.push(this.columnField),this.rowField&&e.push(this.rowField),e},enumerable:!0,configurable:!0}),t.prototype.getSource=function(){return this.name},t.prototype.assemble=function(){var e=[];return this.columnName&&(e.push({name:this.columnName,source:this.data,transform:[{type:"aggregate",groupby:[this.columnField]}]}),e.push({name:this.columnName+"_layout",source:this.columnName,transform:[{type:"aggregate",ops:["distinct"],fields:[this.columnField]}]})),this.rowName&&e.push({name:this.rowName,source:this.data,transform:[{type:"aggregate",groupby:[this.rowField]}]}),e},t}(e("./dataflow").DataFlowNode);n.FacetNode=a},{"../../channel":12,"./dataflow":22,tslib:5}],24:[function(e,t,n){"use strict";function i(e,t){var n="datum["+u.stringValue(e)+"]";if("number"===t)return"toNumber("+n+")";if("boolean"===t)return"toBoolean("+n+")";if("string"===t)return"toString("+n+")";if("date"===t)return"toDate("+n+")";if(0===t.indexOf("date:"))return"timeParse("+n+","+(i=t.slice(5,t.length))+")";if(0===t.indexOf("utc:")){var i=t.slice(4,t.length);return"utcParse("+n+","+i+")"}return o.warn(o.message.unrecognizedParse(t)),null}Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),a=e("../../fielddef"),o=e("../../log"),s=e("../../transform"),l=e("../../type"),u=e("../../util"),c=e("../model"),f=function(e){function t(t){var n=e.call(this)||this;return n._parse={},n._parse=t,n}return r.__extends(t,e),t.prototype.clone=function(){return new t(u.duplicate(this.parse))},t.make=function(e){var n={},i=e.transforms.filter(s.isCalculate).reduce(function(e,t){return e[t.as]=!0,e},{});e instanceof c.ModelWithField&&e.forEachFieldDef(function(e){if(e.type===l.TEMPORAL)n[e.field]="date";else if(e.type===l.QUANTITATIVE){if(a.isCount(e)||i[e.field])return;n[e.field]="number"}});var r=e.data;if(r&&r.format&&r.format.parse){var f=r.format.parse;u.keys(f).forEach(function(e){n[e]=f[e]})}var d=e.component.data.ancestorParse;return u.keys(d).forEach(function(e){n[e]!==d[e]?o.warn(o.message.differentParse(e,n[e],d[e])):delete n[e]}),0===u.keys(n).length?null:new t(n)},Object.defineProperty(t.prototype,"parse",{get:function(){return this._parse},enumerable:!0,configurable:!0}),t.prototype.merge=function(e){this._parse=u.extend(this._parse,e.parse),e.remove()},t.prototype.assembleFormatParse=function(){return this._parse},t.prototype.producedFields=function(){return u.toSet(u.keys(this.parse))},t.prototype.dependentFields=function(){return u.toSet(u.keys(this.parse))},t.prototype.assembleTransforms=function(){var e=this;return u.keys(this._parse).map(function(t){var n=i(t,e._parse[t]);return n?{type:"formula",expr:n,as:t}:null}).filter(function(e){return null!==e})},t}(e("./dataflow").DataFlowNode);n.ParseNode=f},{"../../fielddef":85,"../../log":89,"../../transform":100,"../../type":101,"../../util":102,"../model":54,"./dataflow":22,tslib:5}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("../../channel"),a=e("../../scale"),o=e("../../util"),s=function(e){function t(t){var n=e.call(this)||this;return n._filter=t,n}return i.__extends(t,e),t.prototype.clone=function(){return new t(o.extend({},this._filter))},t.make=function(e){var n=r.SCALE_CHANNELS.reduce(function(t,n){var i=e.getScaleComponent(n);return i&&e.field(n)?(t[e.field(n)]=i.get("type")===a.ScaleType.LOG,t):t},{});return o.keys(n).length?new t(n):null},Object.defineProperty(t.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),t.prototype.assemble=function(){var e=this;return o.keys(this._filter).filter(function(t){return e._filter[t]}).map(function(e){return{type:"filter",expr:'datum["'+e+'"] > 0'}})},t}(e("./dataflow").DataFlowNode);n.NonPositiveFilterNode=s},{"../../channel":12,"../../scale":93,"../../util":102,"./dataflow":22,tslib:5}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("../../type"),a=e("../../util"),o={nominal:!1,ordinal:!1,quantitative:!0,temporal:!0},s=function(e){function t(t){var n=e.call(this)||this;return n._filteredFields=t,n}return i.__extends(t,e),t.prototype.clone=function(){return new t(a.duplicate(this._filteredFields))},t.make=function(e){var n=e.reduceFieldDef(function(t,n){return"count"!==n.aggregate&&(e.config.filterInvalid||void 0===e.config.filterInvalid&&n.field&&o[n.type]?t[n.field]=n:t[n.field]=null),t},{});return 0===a.keys(n).length?null:new t(n)},Object.defineProperty(t.prototype,"filteredFields",{get:function(){return this._filteredFields},enumerable:!0,configurable:!0}),t.prototype.merge=function(e){var t=this,n=a.keys(this._filteredFields).map(function(e){return e+" "+a.hash(t._filteredFields[e])}),i=a.keys(e.filteredFields).map(function(t){return t+" "+a.hash(e.filteredFields[t])});a.differArray(n,i)||(this._filteredFields=a.extend(this._filteredFields,e._filteredFields),e.remove())},t.prototype.assemble=function(){var e=this,t=a.keys(this._filteredFields).reduce(function(t,n){var i=e._filteredFields[n];return null!==i&&(t.push("datum["+a.stringValue(i.field)+"] !== null"),a.contains([r.QUANTITATIVE,r.TEMPORAL],i.type)&&t.push("!isNaN(datum["+a.stringValue(i.field)+"])")),t},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null},t}(e("./dataflow").DataFlowNode);n.NullFilterNode=s},{"../../type":101,"../../util":102,"./dataflow":22,tslib:5}],27:[function(e,t,n){"use strict";function i(e){function t(n){if(!(n instanceof u.SourceNode)){var i=n.parent;e(n)&&t(i)}}return t}function r(e){var t=e.parent;if(e instanceof l.ParseNode){if(t instanceof u.SourceNode)return!1;if(t.numChildren()>1)return!0;if(t instanceof l.ParseNode)t.merge(e);else{if(o.hasIntersection(t.producedFields(),e.dependentFields()))return!0;e.swapWithParent()}}return!0}function a(e){e.parent;return!(e instanceof s.OutputNode||e.numChildren()>0)&&(e.remove(),!0)}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../util"),s=e("./dataflow"),l=e("./formatparse"),u=e("./source");n.iterateFromLeaves=i,n.moveParseUp=r,n.removeUnusedSubtrees=a},{"../../util":102,"./dataflow":22,"./formatparse":24,"./source":30}],28:[function(e,t,n){"use strict";function i(e,t){if(e.data||!e.parent){var n=new b.SourceNode(e.data),i=n.hash();return i in t?t[i]:(t[i]=n,n)}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function r(e){var t=i(e,e.component.data.sources),n=e.component.data.outputNodes,r=e.component.data.outputNodeRefCounts,b=t,O=e.parent&&e.parent instanceof l.LayerModel;if(e instanceof u.ModelWithField&&O&&(w=d.BinNode.makeBinFromEncoding(e))&&(w.parent=b,b=w),e.transforms.length>0){var N=E.parseTransformArray(e),x=N.first,T=N.last;x.parent=b,b=T}var D=g.ParseNode.make(e);if(D&&(D.parent=b,b=D),e instanceof u.ModelWithField){var A=v.NullFilterNode.make(e);if(A&&(A.parent=b,b=A),!O){var w=d.BinNode.makeBinFromEncoding(e);w&&(w.parent=b,b=w)}var k=_.TimeUnitNode.makeFromEncoding(e);k&&(k.parent=b,b=k)}var C=e.getName(o.RAW),R=new p.OutputNode(C,o.RAW,r);if(n[C]=R,R.parent=b,b=R,e instanceof c.UnitModel){var M=f.AggregateNode.makeFromEncoding(e);M&&(M.parent=b,b=M);var P=S.StackNode.make(e);P&&(P.parent=b,b=P);var I=h.NonPositiveFilterNode.make(e);I&&(I.parent=b,b=I)}if(e instanceof c.UnitModel){var L=y.OrderNode.make(e);L&&(L.parent=b,b=L)}var U=e.getName(o.MAIN),F=new p.OutputNode(U,o.MAIN,r);n[U]=F,F.parent=b,b=F;var j=null;if(e instanceof s.FacetModel){var z=e.getName("facet");j=new m.FacetNode(e,z,F.getSource()),n[z]=j,j.parent=b,b=j}var H=a.__assign({},e.component.data.ancestorParse,D?D.parse:{});return a.__assign({},e.component.data,{outputNodes:n,outputNodeRefCounts:r,main:F,facetRoot:j,ancestorParse:H})}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("../../data"),s=e("../facet"),l=e("../layer"),u=e("../model"),c=e("../unit"),f=e("./aggregate"),d=e("./bin"),p=e("./dataflow"),m=e("./facet"),g=e("./formatparse"),h=e("./nonpositivefilter"),v=e("./nullfilter"),y=e("./pathorder"),b=e("./source"),S=e("./stack"),_=e("./timeunit"),E=e("./transforms");n.parseData=r},{"../../data":81,"../facet":34,"../layer":35,"../model":54,"../unit":76,"./aggregate":19,"./bin":21,"./dataflow":22,"./facet":23,"./formatparse":24,"./nonpositivefilter":25,"./nullfilter":26,"./pathorder":29,"./source":30,"./stack":31,"./timeunit":32,"./transforms":33,tslib:5}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("../../encoding"),a=e("../../fielddef"),o=e("../../sort"),s=e("../../util"),l=e("../common"),u=function(e){function t(t){var n=e.call(this)||this;return n.sort=t,n}return i.__extends(t,e),t.prototype.clone=function(){return new t(s.duplicate(this.sort))},t.make=function(e){var n=null;if(!s.contains(["line","area"],e.mark()))return null;if("line"===e.mark()&&e.channelHasField("order"))n=l.sortParams(e.encoding.order);else{var i="horizontal"===e.markDef.orient?"y":"x",u=e.sort(i);n={field:o.isSortField(u)?a.field({aggregate:r.isAggregate(e.encoding)?u.op:void 0,field:u.field}):e.field(i,{binSuffix:"start"}),order:"descending"}}return new t(n)},t.prototype.assemble=function(){return{type:"collect",sort:this.sort}},t}(e("./dataflow").DataFlowNode);n.OrderNode=u},{"../../encoding":83,"../../fielddef":85,"../../sort":95,"../../util":102,"../common":16,"./dataflow":22,tslib:5}],30:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("../../data"),a=e("../../util"),o=function(e){function t(t){var n=e.call(this)||this;if(t=t||{name:"source"},r.isInlineData(t))n._data={values:t.values};else if(r.isUrlData(t)){var o=/(?:\.([^.]+))?$/.exec(t.url)[1];a.contains(["json","csv","tsv","topojson"],o)||(o="json");var s=t.format||{},l=s.type||t.formatType,u=s.property,c=s.feature,f=s.mesh,d=i.__assign({type:l||o},u?{property:u}:{},c?{feature:c}:{},f?{mesh:f}:{});n._data={url:t.url,format:d}}else r.isNamedData(t)&&(n._name=t.name,n._data={});return n}return i.__extends(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),t.prototype.hasName=function(){return!!this._name},Object.defineProperty(t.prototype,"dataName",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{set:function(e){throw new Error("Source nodes have to be roots.")},enumerable:!0,configurable:!0}),t.prototype.remove=function(){throw new Error("Source nodes are roots and cannot be removed.")},t.prototype.hash=function(){return r.isInlineData(this._data)?a.hash(this._data):r.isUrlData(this._data)?this._data.url+" "+a.hash(this._data.format):this._name},t.prototype.assemble=function(){return i.__assign({name:this._name},this._data,{transform:[]})},t}(e("./dataflow").DataFlowNode);n.SourceNode=o},{"../../data":81,"../../util":102,"./dataflow":22,tslib:5}],31:[function(e,t,n){"use strict";function i(e){return e.stack.stackBy.reduce(function(t,n){var i=n.channel,r=n.fieldDef,a=o.isScaleChannel(i)?e.getScaleComponent(i):void 0,u=s.field(r,{binSuffix:a&&l.hasDiscreteDomain(a.get("type"))?"range":"start"});return u&&t.push(u),t},[])}Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),a=e("vega-util"),o=e("../../channel"),s=e("../../fielddef"),l=e("../../scale"),u=e("../../util"),c=e("../common"),f=function(e){function t(t){var n=e.call(this)||this;return n._stack=t,n}return r.__extends(t,e),t.prototype.clone=function(){return new t(u.duplicate(this._stack))},t.make=function(e){var n=e.stack;if(!n)return null;var r=[];n.groupbyChannel&&(e.fieldDef(n.groupbyChannel).bin?(r.push(e.field(n.groupbyChannel,{binSuffix:"start"})),r.push(e.field(n.groupbyChannel,{binSuffix:"end"}))):r.push(e.field(n.groupbyChannel)));var a,o=i(e),s=e.encoding.order;return a=s?c.sortParams(s):o.reduce(function(e,t){return e.field.push(t),e.order.push("descending"),e},{field:[],order:[]}),new t({groupby:r,field:e.field(n.fieldChannel),stackby:o,sort:a,offset:n.offset,impute:u.contains(["area","line"],e.mark())})},Object.defineProperty(t.prototype,"stack",{get:function(){return this._stack},enumerable:!0,configurable:!0}),t.prototype.addDimensions=function(e){this._stack.groupby=this._stack.groupby.concat(e)},t.prototype.dependentFields=function(){var e={};e[this._stack.field]=!0,this._stack.groupby.forEach(function(t){return e[t]=!0});var t=this._stack.sort.field;return a.isArray(t)?t.forEach(function(t){return e[t]=!0}):e[t]=!0,e},t.prototype.producedFields=function(){var e={};return e[this._stack.field+"_start"]=!0,e[this._stack.field+"_end"]=!0,e},t.prototype.assemble=function(){var e=[],t=this._stack;return t.impute&&e.push({type:"impute",field:t.field,groupby:t.stackby,orderby:t.groupby,method:"value",value:0}),e.push({type:"stack",groupby:t.groupby,field:t.field,sort:t.sort,as:[t.field+"_start",t.field+"_end"],offset:t.offset}),e},t}(e("./dataflow").DataFlowNode);n.StackNode=f},{"../../channel":12,"../../fielddef":85,"../../scale":93,"../../util":102,"../common":16,"./dataflow":22,tslib:5,"vega-util":7}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("../../fielddef"),a=e("../../timeunit"),o=e("../../type"),s=e("../../util"),l=function(e){function t(t){var n=e.call(this)||this;return n.formula=t,n}return i.__extends(t,e),t.prototype.clone=function(){return new t(s.duplicate(this.formula))},t.makeFromEncoding=function(e){var n=e.reduceFieldDef(function(e,t){if(t.type===o.TEMPORAL&&t.timeUnit){var n=r.field(t);e[n]={as:n,timeUnit:t.timeUnit,field:t.field}}return e},{});return 0===s.keys(n).length?null:new t(n)},t.makeFromTransfrom=function(e,n){return new t((i={},i[n.field]={as:n.as,timeUnit:n.timeUnit,field:n.field},i));var i},t.prototype.merge=function(e){this.formula=s.extend(this.formula,e.formula),e.remove()},t.prototype.producedFields=function(){var e={};return s.vals(this.formula).forEach(function(t){e[t.as]=!0}),e},t.prototype.dependentFields=function(){var e={};return s.vals(this.formula).forEach(function(t){e[t.field]=!0}),e},t.prototype.assemble=function(){return s.vals(this.formula).map(function(e){return{type:"formula",as:e.as,expr:a.fieldExpr(e.timeUnit,e.field)}})},t}(e("./dataflow").DataFlowNode);n.TimeUnitNode=l},{"../../fielddef":85,"../../timeunit":98,"../../type":101,"../../util":102,"./dataflow":22,tslib:5}],33:[function(e,t,n){"use strict";function i(e){var t,n,i=null,r=0;return e.transforms.forEach(function(p){if(u.isCalculate(p))t=new y(p);else if(u.isFilter(p)){var g={},S=p.filter,_=null;if(s.isEqualFilter(S)?_=S.equal:s.isRangeFilter(S)?_=S.range[0]:s.isOneOfFilter(S)&&(_=(S.oneOf||S.in)[0]),_&&(o.isDateTime(_)?g[S.field]="date":a.isNumber(_)?g[S.field]="number":a.isString(_)&&(g[S.field]="string")),c.keys(g).length>0){var E=new m.ParseNode(g);i?E.parent=n:i=E,n=E}t=new v(e,p.filter)}else if(u.isBin(p))t=d.BinNode.makeBinFromTransform(e,p);else if(u.isTimeUnit(p))t=h.TimeUnitNode.makeFromTransfrom(e,p);else if(u.isSummarize(p))t=f.AggregateNode.makeFromTransform(e,p);else{if(!u.isLookup(p))return void l.warn(l.message.invalidTransformIgnored(p));t=b.make(e,p,r++)}i?t.parent=n:i=t,n=t}),{first:i,last:t}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),a=e("vega-util"),o=e("../../datetime"),s=e("../../filter"),l=e("../../log"),u=e("../../transform"),c=e("../../util"),f=e("./aggregate"),d=e("./bin"),p=e("./dataflow"),m=e("./formatparse"),g=e("./source"),h=e("./timeunit"),v=function(e){function t(t,n){var i=e.call(this)||this;return i.model=t,i.filter=n,i}return r.__extends(t,e),t.prototype.clone=function(){return new t(this.model,c.duplicate(this.filter))},t.prototype.assemble=function(){return{type:"filter",expr:s.expression(this.model,this.filter)}},t}(p.DataFlowNode);n.FilterNode=v;var y=function(e){function t(t){var n=e.call(this)||this;return n.transform=t,n}return r.__extends(t,e),t.prototype.clone=function(){return new t(c.duplicate(this.transform))},t.prototype.producedFields=function(){var e={};return e[this.transform.as]=!0,e},t.prototype.assemble=function(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}},t}(p.DataFlowNode);n.CalculateNode=y;var b=function(e){function t(t,n){var i=e.call(this)||this;return i.transform=t,i.secondary=n,i}return r.__extends(t,e),t.make=function(e,n,i){var r=e.component.data.sources,a=new g.SourceNode(n.from.data),o=r[a.hash()];o||(r[a.hash()]=a,o=a);var s=e.getName("lookup_"+i),l=new p.OutputNode(s,"lookup",e.component.data.outputNodeRefCounts);return l.parent=o,e.component.data.outputNodes[s]=l,new t(n,l.getSource())},t.prototype.producedFields=function(){return c.toSet(this.transform.from.fields||(this.transform.as instanceof Array?this.transform.as:[this.transform.as]))},t.prototype.assemble=function(){var e;if(this.transform.from.fields)e=r.__assign({values:this.transform.from.fields},this.transform.as?{as:this.transform.as instanceof Array?this.transform.as:[this.transform.as]}:{});else{var t=this.transform.as;a.isString(t)||(l.warn(l.message.NO_FIELDS_NEEDS_AS),t="_lookup"),e={as:[t]}}return r.__assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e,this.transform.default?{default:this.transform.default}:{})},t}(p.DataFlowNode);n.LookupNode=b,n.parseTransformArray=i},{"../../datetime":82,"../../filter":86,"../../log":89,"../../transform":100,"../../util":102,"./aggregate":19,"./bin":21,"./dataflow":22,"./formatparse":24,"./source":30,"./timeunit":32,tslib:5,"vega-util":7}],34:[function(e,t,n){"use strict";function i(e){var t=e.child.assembleParentGroupProperties();return r.__assign({},t||{},d.applyConfig({},e.config.facet.cell,u.FILL_STROKE_CONFIG.concat(["clip"])))}Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),a=e("../channel"),o=e("../encoding"),s=e("../fielddef"),l=e("../log"),u=e("../mark"),c=e("../resolve"),f=e("../util"),d=e("./common"),p=e("./data/assemble"),m=e("./data/parse"),g=e("./layout/header"),h=e("./legend/parse"),v=e("./model"),y=e("./repeat"),b=function(e){function t(t,n,i,r,a){var o=e.call(this,t,n,i,a,c.initFacetResolve(t.resolve||{}))||this;o.child=d.buildModel(t.spec,o,o.getName("child"),void 0,r,a),o.children=[o.child];var s=y.replaceRepeaterInFacet(t.facet,r);return o.facet=o.initFacet(s),o}return r.__extends(t,e),t.prototype.initFacet=function(e){return o.reduce(e,function(e,t,n){return f.contains([a.ROW,a.COLUMN],n)?void 0===t.field?(l.warn(l.message.emptyFieldDef(t,n)),e):(e[n]=s.normalize(t,n),e):(l.warn(l.message.incompatibleChannel(n,"facet")),e)},{})},t.prototype.channelHasField=function(e){return!!this.facet[e]},t.prototype.hasDiscreteDomain=function(e){return!0},t.prototype.fieldDef=function(e){return this.facet[e]},t.prototype.parseData=function(){this.component.data=m.parseData(this),this.child.parseData()},t.prototype.parseSelection=function(){this.child.parseSelection(),this.component.selection=this.child.component.selection},t.prototype.parseMarkGroup=function(){this.child.parseMarkGroup();var e=this.channelHasField(a.ROW)&&this.channelHasField(a.COLUMN);this.component.mark=[r.__assign({name:this.getName("cell"),type:"group",from:{facet:r.__assign({name:this.component.data.facetRoot.name,data:this.component.data.facetRoot.data,groupby:[].concat(this.channelHasField(a.ROW)?[this.field(a.ROW)]:[],this.channelHasField(a.COLUMN)?[this.field(a.COLUMN)]:[])},e?{aggregate:{cross:!0}}:{})}},e?{sort:{field:[this.field(a.ROW,{expr:"datum"}),this.field(a.COLUMN,{expr:"datum"})],order:["ascending","ascending"]}}:{},{encode:{update:i(this)}})]},t.prototype.parseAxisAndHeader=function(){this.child.parseAxisAndHeader(),this.parseHeader("column"),this.parseHeader("row"),this.mergeChildAxis("x"),this.mergeChildAxis("y")},t.prototype.parseHeader=function(e){if(this.channelHasField(e)){var t=this.facet[e],n=t.header||{},i=void 0!==n.title?n.title:s.title(t,this.config);this.child.component.layoutHeaders[e].title&&(i+=" / "+this.child.component.layoutHeaders[e].title,this.child.component.layoutHeaders[e].title=null),this.component.layoutHeaders[e]={title:i,fieldRef:d.formatSignalRef(t,n.format,"parent",this.config,!0),header:[this.makeHeaderComponent(e,!0)]}}},t.prototype.makeHeaderComponent=function(e,t){var n="row"===e?"height":"width";return{labels:t,sizeSignal:this.child.getSizeSignalRef(n),axes:[]}},t.prototype.mergeChildAxis=function(e){var t=this.child;if(t.component.axes[e]&&"shared"===this.resolve[e].axis){for(var n="x"===e?"column":"row",i=this.component.layoutHeaders[n],r=0,a=t.component.axes[e].axes;r<a.length;r++){var o=a[r],s=g.getHeaderType(o.orient);i[s]=i[s]||[this.makeHeaderComponent(n,!1)],i[s][0].axes.push(o)}t.component.axes[e].axes=[]}},t.prototype.parseLegend=function(){var e=this;this.child.parseLegend(),this.component.legends={},f.keys(this.child.component.legends).forEach(function(t){"shared"===e.resolve[t].legend&&h.moveSharedLegendUp(e.component.legends,e.child,t)})},t.prototype.assembleData=function(){return this.parent?[]:p.assembleData(this.component.data)},t.prototype.assembleParentGroupProperties=function(){return null},t.prototype.assembleSelectionTopLevelSignals=function(e){return this.child.assembleSelectionTopLevelSignals(e)},t.prototype.assembleSelectionSignals=function(){return this.child.assembleSelectionSignals(),[]},t.prototype.assembleSelectionData=function(e){return this.child.assembleSelectionData(e)},t.prototype.assembleLayout=function(){return{padding:{row:10,column:10},offset:10,columns:this.channelHasField("column")?{signal:this.columnDistinctSignal()}:1,bounds:"full"}},t.prototype.assembleLayoutSignals=function(){return this.child.assembleLayoutSignals()},t.prototype.columnDistinctSignal=function(){var e=this.getName("column")+"_layout",t=this.field("column",{prefix:"distinct"});return"data('"+e+"')[0]["+f.stringValue(t)+"]"},t.prototype.assembleMarks=function(){var e=this.component.data.facetRoot,t=p.assembleFacetData(e),n=this.component.mark[0];return n.from.facet=r.__assign({},n.from.facet,{name:e.name,data:e.data}),[r.__assign({},t.length>0?{data:t}:{},n,this.child.assembleGroup())]},t.prototype.getMapping=function(){return this.facet},t}(v.ModelWithField);n.FacetModel=b},{"../channel":12,"../encoding":83,"../fielddef":85,"../log":89,"../mark":91,"../resolve":92,"../util":102,"./common":16,"./data/assemble":20,"./data/parse":28,"./layout/header":37,"./legend/parse":40,"./model":54,"./repeat":55,tslib:5}],35:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("../log"),a=e("../mark"),o=e("../resolve"),s=e("../spec"),l=e("../util"),u=e("./common"),c=e("./data/assemble"),f=e("./data/parse"),d=e("./layout/assemble"),p=e("./legend/parse"),m=e("./model"),g=e("./selection/selection"),h=e("./unit"),v=function(e){function t(n,a,l,u,c,f){var d=e.call(this,n,a,l,f,o.initLayerResolve(n.resolve||{}))||this,p=i.__assign({},u,n.width?{width:n.width}:{},n.height?{height:n.height}:{});return d.initSize(p),d.children=n.layer.map(function(e,n){if(s.isLayerSpec(e))return new t(e,d,d.getName("layer_"+n),p,c,f);if(s.isUnitSpec(e))return new h.UnitModel(e,d,d.getName("layer_"+n),p,c,f);throw new Error(r.message.INVALID_SPEC)}),d}return i.__extends(t,e),t.prototype.parseData=function(){this.component.data=f.parseData(this);for(var e=0,t=this.children;e<t.length;e++)t[e].parseData()},t.prototype.parseSelection=function(){var e=this;this.component.selection={};for(var t=0,n=this.children;t<n.length;t++)!function(t){t.parseSelection(),l.keys(t.component.selection).forEach(function(n){e.component.selection[n]=t.component.selection[n]})}(n[t])},t.prototype.parseMarkGroup=function(){for(var e=0,t=this.children;e<t.length;e++)t[e].parseMarkGroup()},t.prototype.parseAxisAndHeader=function(){for(var e=this,t=this.component.axes={},n=0,r=this.children;n<r.length;n++)!function(n){n.parseAxisAndHeader(),l.keys(n.component.axes).forEach(function(r){"shared"===e.resolve[r].axis?t[r]||(t[r]=n.component.axes[r]):t[r]?(t[r].axes.push(i.__assign({},n.component.axes[r].axes[0],t[r].axes.length%2==1?{orient:"y"===r?"right":"top"}:{})),n.component.axes[r].gridAxes.length>0&&t[r].gridAxes.push(i.__assign({},n.component.axes[r].gridAxes[0]))):t[r]=n.component.axes[r]})}(r[n])},t.prototype.parseLegend=function(){for(var e=this,t=this.component.legends={},n=0,i=this.children;n<i.length;n++)!function(n){n.parseLegend(),l.keys(n.component.legends).forEach(function(i){"shared"===e.resolve[i].legend&&p.moveSharedLegendUp(t,n,i)})}(i[n])},t.prototype.assembleParentGroupProperties=function(){return i.__assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},u.applyConfig({},this.config.cell,a.FILL_STROKE_CONFIG.concat(["clip"])))},t.prototype.assembleSelectionTopLevelSignals=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionTopLevelSignals(e)},e)},t.prototype.assembleSelectionSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleSelectionSignals())},[])},t.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLayoutSignals())},d.assembleLayoutLayerSignals(this))},t.prototype.assembleSelectionData=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionData(e)},[])},t.prototype.assembleData=function(){return this.parent?[]:c.assembleData(this.component.data)},t.prototype.assembleScales=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleScales())},e.prototype.assembleScales.call(this))},t.prototype.assembleLayout=function(){return null},t.prototype.assembleMarks=function(){return g.assembleLayerSelectionMarks(this,l.flatten(this.children.map(function(e){return e.assembleMarks()})))},t}(m.Model);n.LayerModel=v},{"../log":89,"../mark":91,"../resolve":92,"../spec":96,"../util":102,"./common":16,"./data/assemble":20,"./data/parse":28,"./layout/assemble":36,"./legend/parse":40,"./model":54,"./selection/selection":65,"./unit":76,tslib:5}],36:[function(e,t,n){"use strict";function i(e){return[{name:e.getName("width"),update:r(e,"width")},{name:e.getName("height"),update:r(e,"height")}]}function r(e,t){return"max("+e.children.map(function(e){return e.getName(t)}).join(", ")+")"}function a(e){return[{name:e.getName("width"),update:o(e,"width")},{name:e.getName("height"),update:o(e,"height")}]}function o(e,t){var n="width"===t?"x":"y",i=e.getScaleComponent(n);if(i){var r=i.get("type"),a=i.get("range");if(s.hasDiscreteDomain(r)&&l.isVgRangeStep(a)){var o="domain('"+e.scaleName(n)+"').length",u=i.get("padding"),c=i.get("paddingOuter");c=void 0!==c?c:u;var f=i.get("paddingInner");return f="band"===r?void 0!==f?f:u:1,"bandspace("+o+", "+f+", "+c+") * "+a.step}}return""+e.component.layoutSize.get(t)}Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../scale"),l=e("../../vega.schema");n.assembleLayoutLayerSignals=i,n.layerSizeExpr=r,n.assembleLayoutUnitSignals=a,n.unitSizeExpr=o},{"../../scale":93,"../../vega.schema":104}],37:[function(e,t,n){"use strict";function i(e){return"top"===e||"left"===e?"header":"footer"}function r(e,t){var n="row"===t?"height":"width",i=e.component.layoutHeaders[t].title,r="row"===t?"y":"x",a="row"===t?"right":"center",s="row"===t?"vertical":void 0;return{name:e.getName(t+"_title"),role:t+"-title",type:"group",marks:[{type:"text",role:t+"-title-text",encode:{update:o.__assign((l={},l[r]={signal:"0.5 * "+n},l.align={value:a},l.text={value:i},l.fill={value:"black"},l.fontWeight={value:"bold"},l),"vertical"===s?{angle:{value:270}}:{})}}]};var l}function a(e,t,n,i,r){if(r){var a=null;i.fieldRef&&r.labels&&(a={text:i.fieldRef,offset:10,orient:"row"===t?"left":"top",encode:{update:o.__assign({fontWeight:{value:"normal"},angle:{value:0},fontSize:{value:10}},"row"===t?{align:{value:"right"},baseline:{value:"middle"}}:{})}});var s=r.axes,l=s&&s.length>0;if(a||l){var u="row"===t?"height":"width";return o.__assign({name:e.getName(t+"_"+n),type:"group",role:t+"-"+n},i.fieldRef?{from:{data:e.getName(t)}}:{},a?{title:a}:{},{encode:{update:(c={},c[u]=r.sizeSignal,c)}},l?{axes:s}:{})}}return null;var c}Object.defineProperty(n,"__esModule",{value:!0});var o=e("tslib");n.HEADER_CHANNELS=["row","column"],n.HEADER_TYPES=["header","footer"],n.getHeaderType=i,n.getTitleGroup=r,n.getHeaderGroup=a},{tslib:5}],38:[function(e,t,n){"use strict";function i(e){e instanceof u.UnitModel?a(e):r(e)}function r(e){for(var t=0,n=e.children;t<n.length;t++)i(n[t])}function a(e){var t=e.component.layoutSize;if(!t.explicit.width){var n=o(e,"width");t.set("width",n,!1)}if(!t.explicit.height){var i=o(e,"height");t.set("height",i,!1)}}function o(e,t){var n="width"===t?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){var a=r.get("type"),o=r.get("range");return s.hasDiscreteDomain(a)&&l.isVgRangeStep(o)?null:i.cell[t]}return"width"===t&&"text"===e.mark()?i.scale.textXRangeStep:i.scale.rangeStep||s.defaultScaleConfig.rangeStep}Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../scale"),l=e("../../vega.schema"),u=e("../unit");n.parseLayoutSize=i},{"../../scale":93,"../../vega.schema":104,"../unit":76}],39:[function(e,t,n){"use strict";function i(e,t,n,i){var r={},l=n.mark();switch(l){case s.BAR:case s.TICK:case s.TEXT:r.shape={value:"square"};break;case s.CIRCLE:case s.SQUARE:r.shape={value:l};break;case s.POINT:case s.LINE:case s.AREA:}n.config;var u=n.markDef.filled,p=i===a.COLOR?c.without(s.FILL_STROKE_CONFIG,[u?"fill":"stroke","strokeDash","strokeDashOffset"]):s.FILL_STROKE_CONFIG;if(p=c.without(p,["strokeDash","strokeDashOffset"]),f.applyMarkConfig(r,n,p),i!==a.COLOR){var m=d.color(n);m.fill&&m.fill.field&&delete m.fill,m.stroke&&m.stroke.field&&delete m.stroke,c.extend(r,m)}if(i!==a.SHAPE){var g=n.encoding.shape;o.isValueDef(g)&&(r.shape={value:g.value})}return r=c.extend(r,t||{}),c.keys(r).length>0?r:void 0}function r(e,t,n,i){var r=n.legend(i),a=n.config,o={};if(e.type===u.TEMPORAL){var s=n.getScaleComponent(i).get("type")===l.ScaleType.UTC;t=c.extend({text:{signal:f.timeFormatExpression("datum.value",e.timeUnit,r.format,a.legend.shortTimeLabels,a.timeFormat,s)}},t||{})}return o=c.extend(o,t||{}),c.keys(o).length>0?o:void 0}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../channel"),o=e("../../fielddef"),s=e("../../mark"),l=e("../../scale"),u=e("../../type"),c=e("../../util"),f=e("../common"),d=e("../mark/mixins");n.symbols=i,n.labels=r},{"../../channel":12,"../../fielddef":85,"../../mark":91,"../../scale":93,"../../type":101,"../../util":102,"../common":16,"../mark/mixins":47}],40:[function(e,t,n){"use strict";function i(e){return[l.COLOR,l.SIZE,l.SHAPE,l.OPACITY].reduce(function(t,n){return e.legend(n)&&(t[n]=a(e,n)),t},{})}function r(e,t){switch(t){case l.COLOR:var n=e.scaleName(l.COLOR);return e.markDef.filled?{fill:n}:{stroke:n};case l.SIZE:return{size:e.scaleName(l.SIZE)};case l.SHAPE:return{shape:e.scaleName(l.SHAPE)};case l.OPACITY:return{opacity:e.scaleName(l.OPACITY)}}return null}function a(e,t){var n=e.fieldDef(t),i=e.legend(t),a=r(e,t);u.LEGEND_PROPERTIES.forEach(function(n){var r=o(n,i,t,e);void 0!==r&&(a[n]=r)});var s=i.encoding||{};return["labels","legend","title","symbols"].forEach(function(i){var r=d[i]?d[i](n,s[i],e,t):s[i];void 0!==r&&c.keys(r).length>0&&(a.encode=a.encode||{},a.encode[i]={update:r})}),a}function o(e,t,n,i){var r=i.fieldDef(n);switch(e){case"format":return f.numberFormat(r,t.format,i.config,n);case"title":return p.title(t,r,i.config);case"values":return p.values(t);case"type":return p.type(t,r.type,n,i.getScaleComponent(n).get("type"))}return t[e]}function s(e,t,n){e[n]||(e[n]=t.component.legends[n]),delete t.component.legends[n]}Object.defineProperty(n,"__esModule",{value:!0});var l=e("../../channel"),u=e("../../legend"),c=e("../../util"),f=e("../common"),d=e("./encode"),p=e("./rules");n.parseLegendComponent=i,n.parseLegend=a,n.moveSharedLegendUp=s},{"../../channel":12,"../../legend":88,"../../util":102,"../common":16,"./encode":39,"./rules":41}],41:[function(e,t,n){"use strict";function i(e,t,n){return void 0!==e.title?e.title:l.title(t,n)}function r(e){var t=e.values;return t&&s.isDateTime(t[0])?t.map(function(e){return{signal:s.dateTimeExpr(e,!0)}}):t}function a(e,t,n,i){return e.type?e.type:n===o.COLOR&&("quantitative"===t&&!u.isBinScale(i)||"temporal"===t&&c.contains(["time","utc"],i))?"gradient":void 0}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../channel"),s=e("../../datetime"),l=e("../../fielddef"),u=e("../../scale"),c=e("../../util");n.title=i,n.values=r,n.type=a},{"../../channel":12,"../../datetime":82,"../../fielddef":85,"../../scale":93,"../../util":102}],42:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("./mixins");n.area={vgMark:"area",defaultRole:void 0,encodeEntry:function(e){return i.__assign({},r.pointPosition("x",e,"zeroOrMin"),r.pointPosition("y",e,"zeroOrMin"),r.pointPosition2(e,"zeroOrMin"),r.color(e),r.text(e,"tooltip"),r.nonPosition("opacity",e),r.markDefProperties(e.markDef,["orient","interpolate","tension"]))}}},{"./mixins":47,tslib:5}],43:[function(e,t,n){"use strict";function i(e,t){var n=e.config,i=e.width,r=e.markDef.orient,u=e.encoding.size,f=e.encoding.x,m=e.scaleName(s.X),g=e.getScaleComponent(s.X);if("horizontal"===r)return o.__assign({},d.pointPosition("x",e,"zeroOrMin"),d.pointPosition2(e,"zeroOrMin"));if(l.isFieldDef(f)){if(f.bin&&!u)return d.binnedPosition(f,"x",e.scaleName("x"),n.bar.binSpacing);if(g.get("type")===c.ScaleType.BAND)return d.bandPosition(f,"x",e)}return d.centeredBandPosition("x",e,o.__assign({},p.midX(i,n)),a(m,g,n))}function r(e,t){var n=e.config,i=e.encoding,r=e.height,u=e.markDef.orient,f=i.size,m=i.y,g=e.scaleName(s.Y),h=e.getScaleComponent(s.Y);if("vertical"===u)return o.__assign({},d.pointPosition("y",e,"zeroOrMin"),d.pointPosition2(e,"zeroOrMin"));if(l.isFieldDef(m)){var v=h.get("type");if(m.bin&&!f)return d.binnedPosition(m,"y",e.scaleName("y"),n.bar.binSpacing);if(v===c.ScaleType.BAND)return d.bandPosition(m,"y",e)}return d.centeredBandPosition("y",e,p.midY(r,n),a(g,h,n))}function a(e,t,n){if(n.bar.discreteBandSize)return{value:n.bar.discreteBandSize};if(t){var i=t.get("type");if(i!==c.ScaleType.POINT)return i===c.ScaleType.BAND?p.band(e):{value:n.bar.continuousBandSize};var r=t.get("range");if(f.isVgRangeStep(r))return{value:r.step-1};u.warn(u.message.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL)}return n.scale.rangeStep&&null!==n.scale.rangeStep?{value:n.scale.rangeStep-1}:{value:20}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("tslib"),s=e("../../channel"),l=e("../../fielddef"),u=e("../../log"),c=e("../../scale"),f=e("../../vega.schema"),d=e("./mixins"),p=e("./valueref");n.bar={vgMark:"rect",defaultRole:"bar",encodeEntry:function(e){var t=e.stack;return o.__assign({},i(e,t),r(e,t),d.color(e),d.text(e,"tooltip"),d.nonPosition("opacity",e))}}},{"../../channel":12,"../../fielddef":85,"../../log":89,"../../scale":93,"../../vega.schema":104,"./mixins":47,"./valueref":53,tslib:5}],44:[function(e,t,n){"use strict";function i(e,t,n,i){var r=e.orient||g.getMarkConfig("orient",e.type,i);e.orient=s(e.type,t,n,r),void 0!==r&&r!==e.orient&&c.warn(c.message.orientOverridden(e.orient,r)),void 0===e.filled&&(e.filled=o(e.type,i))}function r(e,t,n,i){var r=g.getMarkConfig("opacity",e,i);if(!t.opacity&&void 0===r){var o=a(e,t,n);void 0!==o&&(t.opacity={value:o})}return t}function a(e,t,n){if(m.contains([f.POINT,f.TICK,f.CIRCLE,f.SQUARE],e)&&!l.isAggregate(t))return.7}function o(e,t){var n=g.getMarkConfig("filled",e,t);return void 0!==n?n:e!==f.POINT&&e!==f.LINE&&e!==f.RULE}function s(e,t,n,i){switch(e){case f.POINT:case f.CIRCLE:case f.SQUARE:case f.TEXT:case f.RECT:return}var r=t.y&&t.y2,a=t.x&&t.x2;switch(e){case f.TICK:var o=n.x?n.x.get("type"):null,s=n.y?n.y.get("type"):null;return!d.hasDiscreteDomain(o)&&(!t.y||d.hasDiscreteDomain(s)||u.isFieldDef(t.y)&&t.y.bin)?"vertical":"horizontal";case f.RULE:case f.BAR:case f.AREA:if(r)return"vertical";if(a)return"horizontal";if(e===f.RULE){if(t.x&&!t.y)return"vertical";if(t.y&&!t.x)return"horizontal"}case f.LINE:var l=u.isFieldDef(t.x)&&u.isContinuous(t.x),m=u.isFieldDef(t.y)&&u.isContinuous(t.y);if(l&&!m)return"horizontal";if(!l&&m)return"vertical";if(l&&m){var g=t.x,h=t.y,v=g.type===p.TEMPORAL,y=h.type===p.TEMPORAL;return v&&!y?"vertical":!v&&y?"horizontal":!g.aggregate&&h.aggregate?"vertical":g.aggregate&&!h.aggregate?"horizontal":i||(e===f.LINE&&t.order||c.warn(c.message.unclearOrientContinuous(e)),"vertical")}return void c.warn(c.message.unclearOrientDiscreteOrEmpty(e))}return"vertical"}Object.defineProperty(n,"__esModule",{value:!0});var l=e("../../encoding"),u=e("../../fielddef"),c=e("../../log"),f=e("../../mark"),d=e("../../scale"),p=e("../../type"),m=e("../../util"),g=e("../common");n.normalizeMarkDef=i,n.initEncoding=r},{"../../encoding":83,"../../fielddef":85,"../../log":89,"../../mark":91,"../../scale":93,"../../type":101,"../../util":102,"../common":16}],45:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("./mixins");n.line={vgMark:"line",defaultRole:void 0,encodeEntry:function(e){return i.__assign({},r.pointPosition("x",e,"zeroOrMin"),r.pointPosition("y",e,"zeroOrMin"),r.color(e),r.text(e,"tooltip"),r.nonPosition("opacity",e),r.nonPosition("size",e,{vgChannel:"strokeWidth"}),r.markDefProperties(e.markDef,["interpolate","tension"]))}}},{"./mixins":47,tslib:5}],46:[function(e,t,n){"use strict";function i(e){if(e instanceof y.UnitModel)_.normalizeMarkDef(e.markDef,e.encoding,e.component.scales,e.config);else for(var t=0,n=e.children;t<n.length;t++)i(n[t])}function r(e){return v.contains([g.LINE,g.AREA],e.mark())?a(e):o(e)}function a(e){var t=e.mark(),n=s(e),i=e.markDef.role||A[t].defaultRole,r=[u.__assign({name:e.getName("marks"),type:A[t].vgMark},l(e),i?{role:i}:{},{from:{data:(n.length>0?w:"")+e.requestDataName(p.MAIN)},encode:{update:A[t].encodeEntry(e)}})];return n.length>0?[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:w+e.requestDataName(p.MAIN),data:e.requestDataName(p.MAIN),groupby:n}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:r}]:r}function o(e){var t=e.mark(),n=e.markDef.role||A[t].defaultRole,i=[];return i.push(u.__assign({name:e.getName("marks"),type:A[t].vgMark},l(e),n?{role:n}:{},{from:{data:e.requestDataName(p.MAIN)},encode:{update:A[t].encodeEntry(e)}})),i}function s(e){return d.LEVEL_OF_DETAIL_CHANNELS.reduce(function(t,n){var i=e.encoding;if("detail"===n||"order"===n){var r=i[n];r&&(c.isArray(r)?r:[r]).forEach(function(e){e.aggregate||t.push(m.field(e,{binSuffix:"start"}))})}else{var a=m.getFieldDef(i[n]);a&&!a.aggregate&&t.push(m.field(a,{binSuffix:"start"}))}return t},[])}function l(e){var t=e.scaleDomain(f.X),n=e.scaleDomain(f.Y);return t&&h.isSelectionDomain(t)||n&&h.isSelectionDomain(n)?{clip:!0}:{}}Object.defineProperty(n,"__esModule",{value:!0});var u=e("tslib"),c=e("vega-util"),f=e("../../channel"),d=e("../../channel"),p=e("../../data"),m=e("../../fielddef"),g=e("../../mark"),h=e("../../scale"),v=e("../../util"),y=e("../unit"),b=e("./area"),S=e("./bar"),_=e("./init"),E=e("./line"),O=e("./point"),N=e("./rect"),x=e("./rule"),T=e("./text"),D=e("./tick"),A={area:b.area,bar:S.bar,line:E.line,point:O.point,text:T.text,tick:D.tick,rect:N.rect,rule:x.rule,circle:O.circle,square:O.square};n.parseMarkDef=i,n.parseMarkGroup=r;var w="faceted_path_"},{"../../channel":12,"../../data":81,"../../fielddef":85,"../../mark":91,"../../scale":93,"../../util":102,"../unit":76,"./area":42,"./bar":43,"./init":44,"./line":45,"./point":48,"./rect":49,"./rule":50,"./text":51,"./tick":52,tslib:5,"vega-util":7}],47:[function(e,t,n){"use strict";function i(e){var t=e.config,n=o("color",e,{vgChannel:e.markDef.filled?"fill":"stroke",defaultValue:y.getMarkConfig("color",e.mark(),t)});return!n.fill&&v.contains(["bar","point","circle","square"],e.mark())&&(n.fill={value:"transparent"}),n}function r(e,t){return t.reduce(function(t,n){return e[n]&&(t[n]={value:e[n]}),t},{})}function a(e,t){if(void 0!==t)return n={},n[e]={value:t},n;return;var n}function o(e,t,n){void 0===n&&(n={});var i=n.defaultValue,r=n.vgChannel,a=n.defaultRef||(void 0!==i?{value:i}:void 0),o=t.encoding[e];return s(t,o,r||e,function(n){return S.midPoint(e,n,t.scaleName(e),t.getScaleComponent(e),a)})}function s(e,t,n,i){var r=t&&t.condition,a=i(t);if(r){var o=i(r);return s={},s[n]=[m.__assign({test:b.predicate(e,r.selection)},o)].concat(void 0!==a?[a]:[]),s}return void 0!==a?(l={},l[n]=a,l):{};var s,l}function l(e,t){void 0===t&&(t="text");var n=e.encoding[t];return s(e,n,t,function(t){return S.text(t,e.config)})}function u(e,t,n){var i=n.scaleName(t),r="x"===t?"width":"height";if(n.encoding.size)if(n.markDef.orient){var a=(s={},s[t+"c"]=S.fieldRef(e,i,{},{band:.5}),s);if(g.getFieldDef(n.encoding.size))h.warn(h.message.cannotUseSizeFieldWithBandSize(t));else if(g.isValueDef(n.encoding.size))return m.__assign({},a,o("size",n,{vgChannel:r}))}else h.warn(h.message.cannotApplySizeToNonOrientedMark(n.markDef.type));return l={},l[t]=S.fieldRef(e,i,{}),l[r]=S.band(i),l;var s,l}function c(e,t,n,i){var r="x"===e?"xc":"yc",a="x"===e?"width":"height";return m.__assign({},d(e,t,n,r),o("size",t,{defaultRef:i,vgChannel:a}))}function f(e,t,n,i){return"x"===t?{x2:S.bin(e,n,"start",i),x:S.bin(e,n,"end")}:{y2:S.bin(e,n,"start"),y:S.bin(e,n,"end",i)}}function d(e,t,n,i){var r=t.encoding,a=t.stack,o=S.stackable(e,r[e],t.scaleName(e),t.getScaleComponent(e),a,n);return s={},s[i||e]=o,s;var s}function p(e,t,n){var i=e.encoding,r=e.markDef,a=e.stack,o="x2"===(n=n||("horizontal"===r.orient?"x2":"y2"))?"x":"y",s=S.stackable2(n,i[o],i[n],e.scaleName(o),e.getScaleComponent(o),a,t);return l={},l[n]=s,l;var l}Object.defineProperty(n,"__esModule",{value:!0});var m=e("tslib"),g=e("../../fielddef"),h=e("../../log"),v=e("../../util"),y=e("../common"),b=e("../selection/selection"),S=e("./valueref");n.color=i,n.markDefProperties=r,n.valueIfDefined=a,n.nonPosition=o,n.text=l,n.bandPosition=u,n.centeredBandPosition=c,n.binnedPosition=f,n.pointPosition=d,n.pointPosition2=p},{"../../fielddef":85,"../../log":89,"../../util":102,"../common":16,"../selection/selection":65,"./valueref":53,tslib:5}],48:[function(e,t,n){"use strict";function i(e,t){var n=e.config,i=e.width,o=e.height;return a.__assign({},s.pointPosition("x",e,l.midX(i,n)),s.pointPosition("y",e,l.midY(o,n)),s.color(e),s.text(e,"tooltip"),s.nonPosition("size",e),r(e,n,t),s.nonPosition("opacity",e))}function r(e,t,n){return n?{shape:{value:n}}:s.nonPosition("shape",e,{defaultValue:o.getMarkConfig("shape","point",t)})}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("../common"),s=e("./mixins"),l=e("./valueref");n.shapeMixins=r,n.point={vgMark:"symbol",defaultRole:"point",encodeEntry:function(e){return i(e)}},n.circle={vgMark:"symbol",defaultRole:"circle",encodeEntry:function(e){return i(e,"circle")}},n.square={vgMark:"symbol",defaultRole:"square",encodeEntry:function(e){return i(e,"square")}}},{"../common":16,"./mixins":47,"./valueref":53,tslib:5}],49:[function(e,t,n){"use strict";function i(e){var t=e.encoding.x,n=e.encoding.x2,i=e.getScaleComponent(o.X),r=i?i.get("type"):void 0;if(s.isFieldDef(t)&&t.bin&&!n)return f.binnedPosition(t,"x",e.scaleName("x"),0);if(s.isFieldDef(t)&&i&&c.hasDiscreteDomain(r)){if(r===c.ScaleType.BAND)return f.bandPosition(t,"x",e);throw new Error(l.message.scaleTypeNotWorkWithMark(u.RECT,r))}return a.__assign({},f.pointPosition("x",e,"zeroOrMax"),f.pointPosition2(e,"zeroOrMin","x2"))}function r(e){var t=e.encoding.y,n=e.encoding.y2,i=e.getScaleComponent(o.Y),r=i?i.get("type"):void 0;if(s.isFieldDef(t)&&t.bin&&!n)return f.binnedPosition(t,"y",e.scaleName("y"),0);if(s.isFieldDef(t)&&i&&c.hasDiscreteDomain(r)){if(r===c.ScaleType.BAND)return f.bandPosition(t,"y",e);throw new Error(l.message.scaleTypeNotWorkWithMark(u.RECT,r))}return a.__assign({},f.pointPosition("y",e,"zeroOrMax"),f.pointPosition2(e,"zeroOrMin","y2"))}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("../../channel"),s=e("../../fielddef"),l=e("../../log"),u=e("../../mark"),c=e("../../scale"),f=e("./mixins");n.rect={vgMark:"rect",defaultRole:void 0,encodeEntry:function(e){return a.__assign({},i(e),r(e),f.color(e),f.text(e,"tooltip"),f.nonPosition("opacity",e))}}},{"../../channel":12,"../../fielddef":85,"../../log":89,"../../mark":91,"../../scale":93,"./mixins":47,tslib:5}],50:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("./mixins"),a=e("./valueref");n.rule={vgMark:"rule",defaultRole:void 0,encodeEntry:function(e){var t=e.config,n=e.markDef,o=e.width,s=e.height,l=n.orient;return i.__assign({},r.pointPosition("x",e,"horizontal"===l?"zeroOrMin":a.midX(o,t)),r.pointPosition("y",e,"vertical"===l?"zeroOrMin":a.midY(s,t)),r.pointPosition2(e,"zeroOrMax"),r.color(e),r.text(e,"tooltip"),r.nonPosition("opacity",e),r.nonPosition("size",e,{vgChannel:"strokeWidth"}))}}},{"./mixins":47,"./valueref":53,tslib:5}],51:[function(e,t,n){"use strict";function i(e,t){return l.isFieldDef(t)&&t.type===u.QUANTITATIVE?{field:{group:"width"},offset:-5}:{value:e.scale.textXRangeStep/2}}function r(e,t){if(void 0===c.getMarkConfig("align","text",t))return s.channelHasField(e,o.X)?"center":"right"}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("../../channel"),s=e("../../encoding"),l=e("../../fielddef"),u=e("../../type"),c=e("../common"),f=e("./mixins"),d=e("./valueref");n.text={vgMark:"text",defaultRole:void 0,encodeEntry:function(e){var t=e.config,n=e.encoding,o=e.height,s=n.text;return a.__assign({},f.pointPosition("x",e,i(t,s)),f.pointPosition("y",e,d.midY(o,t)),f.text(e),f.color(e),f.text(e,"tooltip"),f.nonPosition("opacity",e),f.nonPosition("size",e,{vgChannel:"fontSize"}),f.valueIfDefined("align",r(n,t)))}}},{"../../channel":12,"../../encoding":83,"../../fielddef":85,"../../type":101,"../common":16,"./mixins":47,"./valueref":53,tslib:5}],52:[function(e,t,n){"use strict";function i(e){var t=e.config,n=e.markDef.orient,i=e.getScaleComponent("horizontal"===n?"x":"y");if(void 0!==t.tick.bandSize)return t.tick.bandSize;var r=i?i.get("range"):void 0,o=r&&a.isVgRangeStep(r)?r.step:t.scale.rangeStep;if("number"!=typeof o)throw new Error("Function does not handle non-numeric rangeStep");return o/1.5}Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),a=e("../../vega.schema"),o=e("./mixins"),s=e("./valueref");n.tick={vgMark:"rect",defaultRole:"tick",encodeEntry:function(e){var t=e.config,n=e.markDef,a=e.width,l=e.height,u=n.orient,c="horizontal"===u?"width":"height",f="horizontal"===u?"height":"width";return r.__assign({},o.pointPosition("x",e,s.midX(a,t),"xc"),o.pointPosition("y",e,s.midY(l,t),"yc"),o.nonPosition("size",e,{defaultValue:i(e),vgChannel:c}),(d={},d[f]={value:t.tick.thickness},d),o.color(e),o.nonPosition("opacity",e));var d}}},{"../../vega.schema":104,"./mixins":47,"./valueref":53,tslib:5}],53:[function(e,t,n){"use strict";function i(e,t,n,i,r,a){return b.isFieldDef(t)&&r&&e===r.fieldChannel?o(t,n,{suffix:"end"}):u(e,t,n,i,a)}function r(e,t,n,i,r,a,s){return b.isFieldDef(t)&&a&&e.charAt(0)===a.fieldChannel.charAt(0)?o(t,i,{suffix:"start"}):u(e,n,i,r,s)}function a(e,t,n,i){return o(e,t,{binSuffix:n},i?{offset:i}:{})}function o(e,t,n,i){var r={scale:t,field:b.field(e,n)};return i?v.__assign({},r,i):r}function s(e,t){return void 0===t&&(t=!0),{scale:e,band:t}}function l(e,t){return{signal:'(scale("'+t+'", '+b.field(e,{binSuffix:"start",expr:"datum"})+') + scale("'+t+'", '+b.field(e,{binSuffix:"end",expr:"datum"})+"))/2"}}function u(e,t,n,i,r){if(t){if(b.isFieldDef(t)){if(t.bin)return _.contains(["x","y"],e)?l(t,n):o(t,n,{binSuffix:"start"});var a=i.get("type");return S.hasDiscreteDomain(a)?"band"===a?o(t,n,{binSuffix:"range"},{band:.5}):o(t,n,{binSuffix:"range"}):o(t,n,{})}if(b.isValueDef(t))return{value:t.value};throw new Error("FieldDef without field or value.")}if("zeroOrMin"===r){if(e===y.X||e===y.X2)return p(n,i);if(e===y.Y||e===y.Y2)return g(n,i);throw new Error("Unsupported channel "+e+" for base function")}if("zeroOrMax"===r){if(e===y.X||e===y.X2)return m(n,i);if(e===y.Y||e===y.Y2)return h(n,i);throw new Error("Unsupported channel "+e+" for base function")}return r}function c(e,t){if(e){if(b.isFieldDef(e))return E.formatSignalRef(e,e.format,"datum",t);if(b.isValueDef(e))return{value:e.value}}}function f(e,t){if(e)return{value:e/2};if("string"==typeof t.scale.rangeStep)throw new Error("midX can not handle string rangeSteps");return{value:t.scale.rangeStep/2}}function d(e,t){if(e)return{value:e/2};if("string"==typeof t.scale.rangeStep)throw new Error("midX can not handle string rangeSteps");return{value:t.scale.rangeStep/2}}function p(e,t){return e&&!_.contains([S.ScaleType.LOG,S.ScaleType.TIME,S.ScaleType.UTC],t.get("type"))&&!1!==t.get("zero")?{scale:e,value:0}:{value:0}}function m(e,t){return e&&!_.contains([S.ScaleType.LOG,S.ScaleType.TIME,S.ScaleType.UTC],t.get("type"))&&!1!==t.get("zero")?{scale:e,value:0}:{field:{group:"width"}}}function g(e,t){return e&&!_.contains([S.ScaleType.LOG,S.ScaleType.TIME,S.ScaleType.UTC],t.get("type"))&&!1!==t.get("zero")?{scale:e,value:0}:{field:{group:"height"}}}function h(e,t){return e&&!_.contains([S.ScaleType.LOG,S.ScaleType.TIME,S.ScaleType.UTC],t.get("type"))&&!1!==t.get("zero")?{scale:e,value:0}:{value:0}}Object.defineProperty(n,"__esModule",{value:!0});var v=e("tslib"),y=e("../../channel"),b=e("../../fielddef"),S=e("../../scale"),_=e("../../util"),E=e("../common");n.stackable=i,n.stackable2=r,n.bin=a,n.fieldRef=o,n.band=s,n.midPoint=u,n.text=c,n.midX=f,n.midY=d},{"../../channel":12,"../../fielddef":85,"../../scale":93,"../../util":102,"../common":16,tslib:5}],54:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("../channel"),a=e("../encoding"),o=e("../fielddef"),s=e("../util"),l=e("./layout/header"),u=e("./layout/parse"),c=e("./mark/mark"),f=e("./scale/assemble"),d=e("./scale/parse"),p=e("./split"),m=e("./unit"),g=function(){function e(){this.nameMap={}}return e.prototype.rename=function(e,t){this.nameMap[e]=t},e.prototype.has=function(e){return void 0!==this.nameMap[e]},e.prototype.get=function(e){for(;this.nameMap[e];)e=this.nameMap[e];return e},e}();n.NameMap=g;var h=function(){function e(e,t,n,r,a){var o=this;this.resolve=a,this.children=[],this.correctDataNames=function(e){return e.from&&e.from.data&&(e.from.data=o.lookupDataSource(e.from.data)),e.from&&e.from.facet&&e.from.facet.data&&(e.from.facet.data=o.lookupDataSource(e.from.facet.data)),e},this.parent=t,this.config=r,this.name=e.name||n,this.scaleNameMap=t?t.scaleNameMap:new g,this.sizeNameMap=t?t.sizeNameMap:new g,this.data=e.data,this.description=e.description,this.transforms=e.transform||[],this.component={data:{sources:t?t.component.data.sources:{},outputNodes:t?t.component.data.outputNodes:{},outputNodeRefCounts:t?t.component.data.outputNodeRefCounts:{},ancestorParse:t?i.__assign({},t.component.data.ancestorParse):{}},mark:null,scales:null,axes:{x:null,y:null},layoutSize:new p.Split,layoutHeaders:{row:{},column:{}},legends:null,selection:null}}return Object.defineProperty(e.prototype,"width",{get:function(){var e=this.component.layoutSize.get("width");if(void 0!==e)return e;throw new Error("calling model.width before parseLayoutSize()")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var e=this.component.layoutSize.get("height");if(void 0!==e)return e;throw new Error("calling model.height before parseLayoutSize()")},enumerable:!0,configurable:!0}),e.prototype.initSize=function(e){var t=e.width,n=e.height;t&&this.component.layoutSize.set("width",t,!0),n&&this.component.layoutSize.set("height",n,!0)},e.prototype.parse=function(){this.parseScale(),this.parseMarkDef(),this.parseLayoutSize(),this.parseData(),this.parseSelection(),this.parseAxisAndHeader(),this.parseLegend(),this.parseMarkGroup()},e.prototype.parseScale=function(){d.parseScale(this)},e.prototype.parseLayoutSize=function(){u.parseLayoutSize(this)},e.prototype.parseMarkDef=function(){c.parseMarkDef(this)},e.prototype.assembleScales=function(){return f.assembleScale(this)},e.prototype.assembleHeaderMarks=function(){for(var e=this.component.layoutHeaders,t=[],n=0,i=l.HEADER_CHANNELS;n<i.length;n++)e[o=i[n]].title&&t.push(l.getTitleGroup(this,o));for(var r=0,a=l.HEADER_CHANNELS;r<a.length;r++)for(var o=a[r],s=e[o],u=0,c=l.HEADER_TYPES;u<c.length;u++){var f=c[u];if(s[f])for(var d=0,p=s[f];d<p.length;d++){var m=p[d],g=l.getHeaderGroup(this,o,f,s,m);g&&t.push(g)}}return t},e.prototype.assembleAxes=function(){var e=this.component.axes,t=e.x,n=e.y;return(t?t.axes.concat(t.gridAxes):[]).concat(n?n.axes.concat(n.gridAxes):[])},e.prototype.assembleLegends=function(){return s.vals(this.component.legends)},e.prototype.assembleGroup=function(e){void 0===e&&(e=[]);var t={};(e=e.concat(this.assembleSelectionSignals())).length>0&&(t.signals=e);var n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());var i=this.assembleScales();i.length>0&&(t.scales=i);var r=this.assembleAxes();r.length>0&&(t.axes=r);var a=this.assembleLegends();return a.length>0&&(t.legends=a),t},e.prototype.hasDescendantWithFieldOnChannel=function(e){for(var t=0,n=this.children;t<n.length;t++){var i=n[t];if(i instanceof m.UnitModel){if(i.channelHasField(e))return!0}else if(i.hasDescendantWithFieldOnChannel(e))return!0}return!1},e.prototype.getName=function(e){return s.varName((this.name?this.name+"_":"")+e)},e.prototype.requestDataName=function(e){var t=this.getName(e),n=this.component.data.outputNodeRefCounts;return n[t]=(n[t]||0)+1,t},e.prototype.getSizeSignalRef=function(e){return{signal:this.getName(e)}},e.prototype.lookupDataSource=function(e){var t=this.component.data.outputNodes[e];return t?t.getSource():e},e.prototype.renameSize=function(e,t){this.sizeNameMap.rename(e,t)},e.prototype.channelSizeName=function(e){return this.sizeName(e===r.X||e===r.COLUMN?"width":"height")},e.prototype.sizeName=function(e){return this.sizeNameMap.get(this.getName(e))},e.prototype.renameScale=function(e,t){this.scaleNameMap.rename(e,t)},e.prototype.scaleName=function(e,t){return t?this.getName(e):r.isChannel(e)&&r.isScaleChannel(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0},e.prototype.getScaleComponent=function(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale().  Make sure you have called parseScale or use parseUnitModelWithScale().");var t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0},e.prototype.getSelectionComponent=function(e){return this.component.selection[e]||this.parent.getSelectionComponent(e)},e}();n.Model=h;var v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i.__extends(t,e),t.prototype.field=function(e,t){void 0===t&&(t={});var n=this.fieldDef(e);return n.bin&&(t=s.extend({binSuffix:this.hasDiscreteDomain(e)?"range":"start"},t)),o.field(n,t)},t.prototype.reduceFieldDef=function(e,t,n){return a.reduce(this.getMapping(),function(t,n,i){var r=o.getFieldDef(n);return r?e(t,r,i):t},t,n)},t.prototype.forEachFieldDef=function(e,t){a.forEach(this.getMapping(),function(t,n){var i=o.getFieldDef(t);i&&e(i,n)},t)},t}(h);n.ModelWithField=v},{"../channel":12,"../encoding":83,"../fielddef":85,"../util":102,"./layout/header":37,"./layout/parse":38,"./mark/mark":46,"./scale/assemble":56,"./scale/parse":59,"./split":75,"./unit":76,tslib:5}],55:[function(e,t,n){"use strict";function i(e,t){return o(e,t)}function r(e,t){return o(e,t)}function a(e,t){var n=e.field;return u.isRepeatRef(n)?n.repeat in t?s.__assign({},e,{field:t[n.repeat]}):(c.warn(c.message.noSuchRepeatedValue(n.repeat)),null):e}function o(e,t){var n={};for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];if(l.isArray(r))n[i]=r.map(function(e){return a(e,t)}).filter(function(e){return null!==e});else{var o=a(r,t);null!==o&&(n[i]=o)}}return n}Object.defineProperty(n,"__esModule",{value:!0});var s=e("tslib"),l=e("vega-util"),u=e("../fielddef"),c=e("../log"),f=e("../resolve"),d=e("../util"),p=e("./common"),m=e("./data/assemble"),g=e("./data/parse"),h=e("./legend/parse"),v=e("./model");n.replaceRepeaterInFacet=i,n.replaceRepeaterInEncoding=r;var y=function(e){function t(t,n,i,r,a){var o=e.call(this,t,n,i,a,f.initRepeatResolve(t.resolve||{}))||this;return o.repeat=t.repeat,o.children=o._initChildren(t,o.repeat,r,a),o}return s.__extends(t,e),t.prototype._initChildren=function(e,t,n,i){for(var r=[],a=t.row||[n?n.row:null],o=t.column||[n?n.column:null],s=0,l=a;s<l.length;s++)for(var u=l[s],c=0,f=o;c<f.length;c++){var d=f[c],m=(u?"_"+u:"")+(d?"_"+d:""),g={row:u,column:d};r.push(p.buildModel(e.spec,this,this.getName("child"+m),void 0,g,i))}return r},t.prototype.parseData=function(){this.component.data=g.parseData(this),this.children.forEach(function(e){e.parseData()})},t.prototype.parseSelection=function(){var e=this;this.component.selection={};for(var t=0,n=this.children;t<n.length;t++)!function(t){t.parseSelection(),d.keys(t.component.selection).forEach(function(n){e.component.selection[n]=t.component.selection[n]})}(n[t])},t.prototype.parseMarkGroup=function(){for(var e=0,t=this.children;e<t.length;e++)t[e].parseMarkGroup()},t.prototype.parseAxisAndHeader=function(){for(var e=0,t=this.children;e<t.length;e++)t[e].parseAxisAndHeader()},t.prototype.parseLegend=function(){for(var e=this,t=(this.component.legends={},0),n=this.children;t<n.length;t++)!function(t){t.parseLegend(),d.keys(t.component.legends).forEach(function(n){"shared"===e.resolve[n].legend&&h.moveSharedLegendUp(e.component.legends,t,n)})}(n[t])},t.prototype.assembleData=function(){return this.parent?[]:m.assembleData(this.component.data)},t.prototype.assembleParentGroupProperties=function(){return null},t.prototype.assembleSelectionTopLevelSignals=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionTopLevelSignals(e)},e)},t.prototype.assembleSelectionSignals=function(){return this.children.forEach(function(e){return e.assembleSelectionSignals()}),[]},t.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLayoutSignals())},[])},t.prototype.assembleSelectionData=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionData(e)},[])},t.prototype.assembleLayout=function(){return{padding:{row:10,column:10},offset:10,columns:this.repeat&&this.repeat.column?this.repeat.column.length:1,bounds:"full",align:"all"}},t.prototype.assembleMarks=function(){return this.children.map(function(e){var t=e.assembleParentGroupProperties();return s.__assign({type:"group",name:e.getName("group")},t?{encode:{update:t}}:{},e.assembleGroup())})},t}(v.Model);n.RepeatModel=y},{"../fielddef":85,"../log":89,"../resolve":92,"../util":102,"./common":16,"./data/assemble":20,"./data/parse":28,"./legend/parse":40,"./model":54,tslib:5,"vega-util":7}],56:[function(e,t,n){"use strict";function i(e){return o.vals(e.component.scales).reduce(function(t,n){if(n.merged)return t;var i=n.combine(["name","type","domain","domainRaw","range"]),o=n.get("domainRaw");o&&l.isRawSelectionDomain(o)&&(i.domainRaw=l.selectionScaleDomain(e,o));var u=n.get("domain");if(s.isDataRefDomain(u)||s.isFieldRefUnionDomain(u))u.data=e.lookupDataSource(u.data),t.push(i);else if(s.isDataRefUnionedDomain(u))u.fields=u.fields.map(function(t){return r.__assign({},t,{data:e.lookupDataSource(t.data)})}),t.push(i);else{if(!s.isSignalRefDomain(u)&&!a.isArray(u))throw new Error("invalid scale domain");t.push(i)}return t},[])}Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),a=e("vega-util"),o=e("../../util"),s=e("../../vega.schema"),l=e("../selection/selection");n.assembleScale=i},{"../../util":102,"../../vega.schema":104,"../selection/selection":65,tslib:5,"vega-util":7}],57:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=function(e){function t(t,n){var i=e.call(this,{},{name:t})||this;return i.merged=!1,i.setWithExplicit("type",n),i}return i.__extends(t,e),t}(e("../split").Split);n.ScaleComponent=r},{"../split":75,tslib:5}],58:[function(e,t,n){"use strict";function i(e){e instanceof D.UnitModel?r(e):a(e)}function r(e){var t=e.specifiedScales,n=e.component.scales;E.keys(n).forEach(function(i){var r=t[i],a=r?r.domain:void 0,o=a&&!b.isSelectionDomain(a),l=s(e,i),u=n[i];u.set("domain",l,o),b.isSelectionDomain(a)&&u.set("domainRaw",{signal:T.SELECTION_DOMAIN+JSON.stringify(a)},!0)})}function a(e){for(var t=0,n=e.children;t<n.length;t++)i(n[t]);var r=e.component.scales;E.keys(r).forEach(function(t){for(var n,i=0,a=e.children;i<a.length;i++){var o=a[i].component.scales[t];if(o){var s=o.get("domain");n=void 0===n?s:d(n,s)}}e instanceof x.FacetModel&&(O.isDataRefDomain(n)||O.isFieldRefUnionDomain(n)?n.data=N.FACET_SCALE_PREFIX+e.getName(n.data):O.isDataRefUnionedDomain(n)&&(n.fields=n.fields.map(function(t){return p.__assign({},t,{data:N.FACET_SCALE_PREFIX+e.getName(t.data)})}))),r[t].set("domain",n,!0)})}function o(e,t,n,i){if("unaggregated"===e){var r=c(t,n),a=r.valid,o=r.reason;if(!a)return void y.warn(o)}else if(void 0===e&&i.useUnaggregatedDomain&&(a=c(t,n).valid))return"unaggregated";return e}function s(e,t){var n=e.getScaleComponent(t).get("type"),i=o(e.scaleDomain(t),e.fieldDef(t),n,e.config.scale);return i!==e.scaleDomain(t)&&(e.specifiedScales[t]=p.__assign({},e.specifiedScales[t],{domain:i})),"x"===t&&e.channelHasField("x2")?e.channelHasField("x")?d(l(n,i,e,"x"),l(n,i,e,"x2")):l(n,i,e,"x2"):"y"===t&&e.channelHasField("y2")?e.channelHasField("y")?d(l(n,i,e,"y"),l(n,i,e,"y2")):l(n,i,e,"y2"):l(n,i,e,t)}function l(e,t,n,i){var r=n.fieldDef(i);if(t&&"unaggregated"!==t&&!b.isSelectionDomain(t)){if(!r.bin)return v.isDateTime(t[0])?t.map(function(e){return{signal:v.dateTimeExpr(e,!0)}}):t;y.warn(y.message.conflictedDomain(i))}var a=n.stack;if(a&&i===a.fieldChannel)return"normalize"===a.offset?[0,1]:{data:n.requestDataName(h.MAIN),fields:[n.field(i,{suffix:"start"}),n.field(i,{suffix:"end"})]};var o=u(n,i,e);if("unaggregated"===t)return{data:n.requestDataName(h.MAIN),fields:[n.field(i,{aggregate:"min"}),n.field(i,{aggregate:"max"})]};if(r.bin){if(b.isBinScale(e)){var s=n.getName(g.binToString(r.bin)+"_"+r.field+"_bins");return{signal:"sequence("+s+".start, "+s+".stop + "+s+".step, "+s+".step)"}}return b.hasDiscreteDomain(e)?{data:n.requestDataName(h.MAIN),field:n.field(i,{binSuffix:"range"}),sort:{field:n.field(i,{binSuffix:"start"}),op:"min"}}:"x"===i||"y"===i?{data:n.requestDataName(h.MAIN),fields:[n.field(i,{binSuffix:"start"}),n.field(i,{binSuffix:"end"})]}:{data:n.requestDataName(h.MAIN),field:n.field(i,{binSuffix:"start"})}}return o?{data:_.isBoolean(o)?n.requestDataName(h.MAIN):n.requestDataName(h.RAW),field:n.field(i),sort:o}:{data:n.requestDataName(h.MAIN),field:n.field(i)}}function u(e,t,n){if(b.hasDiscreteDomain(n)){var i=e.sort(t);return S.isSortField(i)?i:!!_.contains(["ascending","descending",void 0],i)||void 0}}function c(e,t){return e.aggregate?m.SHARED_DOMAIN_OP_INDEX[e.aggregate]?"quantitative"===e.type&&"log"===t?{valid:!1,reason:y.message.unaggregatedDomainWithLogScale(e)}:{valid:!0}:{valid:!1,reason:y.message.unaggregateDomainWithNonSharedDomainOp(e.aggregate)}:{valid:!1,reason:y.message.unaggregateDomainHasNoEffectForRawField(e)}}function f(e){if(_.isArray(e))return[e];if(O.isSignalRefDomain(e))return[e];if(O.isDataRefDomain(e))return delete e.sort,[e];if(O.isFieldRefUnionDomain(e))return e.fields.map(function(t){return{data:e.data,field:t}});if(O.isDataRefUnionedDomain(e))return e.fields;throw new Error(y.message.INVAID_DOMAIN)}function d(e,t){var n=f(e),i=f(t),r=n.concat(i);if((r=_.unique(r,_.hash)).length>1){var a=r.map(function(e){return O.isDataRefDomain(e)?e.data:null});return 1===_.unique(a,function(e){return e}).length&&null!==a[0]?{data:a[0],fields:r.map(function(e){return e.field})}:{fields:r,sort:!0}}return r[0]}Object.defineProperty(n,"__esModule",{value:!0});var p=e("tslib"),m=e("../../aggregate"),g=e("../../bin"),h=e("../../data"),v=e("../../datetime"),y=e("../../log"),b=e("../../scale"),S=e("../../sort"),_=e("../../util"),E=e("../../util"),O=e("../../vega.schema"),N=e("../data/assemble"),x=e("../facet"),T=e("../selection/selection"),D=e("../unit");n.parseScaleDomain=i,n.parseDomainForChannel=s,n.domainSort=u,n.canUseUnaggregatedDomain=c,n.unionDomains=d},{"../../aggregate":9,"../../bin":11,"../../data":81,"../../datetime":82,"../../log":89,"../../scale":93,"../../sort":95,"../../util":102,"../../vega.schema":104,"../data/assemble":20,"../facet":34,"../selection/selection":65,"../unit":76,tslib:5}],59:[function(e,t,n){"use strict";function i(e){r(e),m.parseScaleDomain(e);for(var t=0,i=n.NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES;t<i.length;t++){var a=i[t];g.parseScaleProperty(e,a)}h.parseScaleRange(e)}function r(e){e instanceof d.UnitModel?e.component.scales=a(e):e.component.scales=o(e)}function a(e){var t=e.encoding,n=e.config,i=e.mark();return s.SCALE_CHANNELS.reduce(function(r,a){var o,s={},u=t[a];if(l.isFieldDef(u)?(o=u,s=u.scale||{}):l.isConditionalDef(u)&&l.isFieldDef(u.condition)?(o=u.condition,s=u.condition.scale||{}):"x"===a?o=l.getFieldDef(t.x2):"y"===a&&(o=l.getFieldDef(t.y2)),o){var c=s.type,f=v.scaleType(s.type,a,o,i,s.rangeStep,n.scale);r[a]=new p.ScaleComponent(e.scaleName(a+"",!0),{value:f,explicit:c===f})}return r},{})}function o(e){for(var t=e.component.scales={},n={},i={},a=0,o=e.children;a<o.length;a++)!function(t){r(t),c.keys(t.component.scales).forEach(function(r){if("shared"===e.resolve[r].scale){if(i[r])return;var a=n[r],o=t.component.scales[r].getWithExplicit("type");a?u.scaleCompatible(a.value,o.value)?n[r]=f.mergeValuesWithExplicit(a,o,function(e,t){return u.scaleTypePrecedence(e)-u.scaleTypePrecedence(t)}):(i[r]=!0,delete n[r]):n[r]=o}})}(o[a]);return c.keys(n).forEach(function(i){for(var r=e.scaleName(i,!0),a=n[i],o=(t[i]=new p.ScaleComponent(r,a),0),s=e.children;o<s.length;o++){var l=s[o],u=l.component.scales[i];u&&(l.renameScale(u.get("name"),r),u.merged=!0)}}),t}Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../channel"),l=e("../../fielddef"),u=e("../../scale"),c=e("../../util"),f=e("../split"),d=e("../unit"),p=e("./component"),m=e("./domain"),g=e("./properties"),h=e("./range"),v=e("./type");n.NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES=["round","clamp","nice","exponent","interpolate","zero","padding","paddingInner","paddingOuter"],n.parseScale=i,n.parseScaleCore=r},{"../../channel":12,"../../fielddef":85,"../../scale":93,"../../util":102,"../split":75,"../unit":76,"./component":57,"./domain":58,"./properties":60,"./range":61,"./type":62}],60:[function(e,t,n){"use strict";function i(e,t){e instanceof S.UnitModel?r(e,t):o(e,t)}function r(e,t){var n=e.component.scales;y.keys(n).forEach(function(i){var r=e.specifiedScales[i],o=n[i],s=e.getScaleComponent(i),l=e.fieldDef(i),u=e.config,c=r[t],f=s.get("type"),d=g.scaleTypeSupportProperty(f,t),p=g.channelScalePropertyIncompatability(i,t);if(void 0!==c&&(d?p&&m.warn(p):m.warn(m.message.scalePropertyNotWorkWithScaleType(f,t,i))),d&&void 0===p)if(void 0!==c)o.copyKeyFromObject(t,r);else{var h=a(t,r,s,i,l,u.scale);void 0!==h&&o.set(t,h,!1)}})}function a(e,t,n,i,r,a){switch(e){case"nice":return s(n.get("type"),i,r);case"padding":return l(i,n.get("type"),a);case"paddingInner":return u(n.get("padding"),i,a);case"paddingOuter":return c(n.get("padding"),i,n.get("type"),n.get("paddingInner"),a);case"round":return f(i,a);case"zero":return d(i,r,!!t.domain)}return a[e]}function o(e,t){for(var n=e.component.scales,r=0,a=e.children;r<a.length;r++){var o=a[r];"range"===t?_.parseScaleRange(o):i(o,t)}y.keys(n).forEach(function(i){for(var r,a=0,o=e.children;a<o.length;a++){var s=o[a].component.scales[i];if(s){var l=s.getWithExplicit(t);r=b.mergeValuesWithExplicit(r,l,function(e,n){switch(t){case"range":return e.step&&n.step?e.step-n.step:0}return 0})}}n[i].setWithExplicit(t,r)})}function s(e,t,n){if(v.contains([g.ScaleType.TIME,g.ScaleType.UTC],e))return h.smallestUnit(n.timeUnit);if(!n.bin)return v.contains([p.X,p.Y],t)}function l(e,t,n){if(v.contains([p.X,p.Y],e)&&t===g.ScaleType.POINT)return n.pointPadding}function u(e,t,n){if(void 0===e)return v.contains([p.X,p.Y],t)?n.bandPaddingInner:void 0}function c(e,t,n,i,r){if(void 0===e)return v.contains([p.X,p.Y],t)&&n===g.ScaleType.BAND?void 0!==r.bandPaddingOuter?r.bandPaddingOuter:i/2:void 0}function f(e,t){if(v.contains(["x","y","row","column"],e))return t.round}function d(e,t,n){return"size"===e&&"quantitative"===t.type||!(n||t.bin||!v.contains([p.X,p.Y],e))}Object.defineProperty(n,"__esModule",{value:!0});var p=e("../../channel"),m=e("../../log"),g=e("../../scale"),h=e("../../timeunit"),v=e("../../util"),y=e("../../util"),b=e("../split"),S=e("../unit"),_=e("./range");n.parseScaleProperty=i,n.parseNonUnitScaleProperty=o,n.nice=s,n.padding=l,n.paddingInner=u,n.paddingOuter=c,n.round=f,n.zero=d},{"../../channel":12,"../../log":89,"../../scale":93,"../../timeunit":98,"../../util":102,"../split":75,"../unit":76,"./range":61}],61:[function(e,t,n){"use strict";function i(e){e instanceof y.UnitModel?r(e):b.parseNonUnitScaleProperty(e,"range")}function r(e){var t=e.component.scales;d.SCALE_CHANNELS.forEach(function(n){var i=t[n];if(i){var r=e.specifiedScales[n],s=e.fieldDef(n),l="x"===n?e.component.layoutSize.get("width"):"y"===n?e.component.layoutSize.get("height"):void 0,u=a(e),c=o(n,i.get("type"),s.type,r,e.config,i.get("zero"),e.mark(),l,u);i.setWithExplicit("range",c)}})}function a(e){var t=[],n=e.getScaleComponent("x"),i=n&&n.get("range");i&&h.isVgRangeStep(i)&&t.push(i.step);var r=e.getScaleComponent("y"),a=r&&r.get("range");return a&&h.isVgRangeStep(a)&&t.push(a.step),t}function o(e,t,i,r,a,o,u,c,f){for(var d=!1,g=0,h=n.RANGE_PROPERTIES;g<h.length;g++){var y=h[g];if(void 0!==r[y]){var b=m.scaleTypeSupportProperty(t,y),S=m.channelScalePropertyIncompatability(e,y);if(b)if(S)p.warn(S);else switch(y){case"range":return v.makeImplicit(r[y]);case"scheme":return v.makeImplicit(s(r[y]));case"rangeStep":if(void 0===c){var _=r[y];if(null!==_)return v.makeImplicit({step:_});d=!0}else p.warn(p.message.rangeStepDropped(e))}else p.warn(p.message.scalePropertyNotWorkWithScaleType(t,y,e))}}return{explicit:!1,value:l(e,t,i,a,o,u,c,f,d)}}function s(e){if(m.isExtendedScheme(e)){var t={scheme:e.name};return e.count&&(t.count=e.count),e.extent&&(t.extent=e.extent),t}return{scheme:e}}function l(e,t,n,i,r,a,o,s,l){switch(e){case d.ROW:return"height";case d.COLUMN:return"width";case d.X:case d.Y:if(void 0===o){if(g.contains(["point","band"],t)&&!l)if(e===d.X&&"text"===a){if(i.scale.textXRangeStep)return{step:i.scale.textXRangeStep}}else if(i.scale.rangeStep)return{step:i.scale.rangeStep};o=e===d.X?i.cell.width:i.cell.height}return e===d.X?[0,o]:[o,0];case d.SIZE:return[u(a,r,i),c(a,s,i)];case d.SHAPE:return"symbol";case d.COLOR:return"ordinal"===t?"nominal"===n?"category":"ordinal":"rect"===a?"heatmap":"ramp";case d.OPACITY:return[i.scale.minOpacity,i.scale.maxOpacity]}throw new Error("Scale range undefined for channel "+e)}function u(e,t,n){if(t)return 0;switch(e){case"bar":return void 0!==n.scale.minBandSize?n.scale.minBandSize:n.bar.continuousBandSize;case"tick":return n.scale.minBandSize;case"line":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":if(n.scale.minSize)return n.scale.minSize}throw new Error(p.message.incompatibleChannel("size",e))}function c(e,t,n){var i=n.scale;switch(e){case"bar":case"tick":return void 0!==n.scale.maxBandSize?n.scale.maxBandSize:f(t,n.scale)-1;case"line":case"rule":return n.scale.maxStrokeWidth;case"text":return n.scale.maxFontSize;case"point":case"square":case"circle":if(n.scale.maxSize)return n.scale.maxSize;var r=f(t,i);return(r-2)*(r-2)}throw new Error(p.message.incompatibleChannel("size",e))}function f(e,t){return e.length>0?Math.min.apply(null,e):t.rangeStep?t.rangeStep:21}Object.defineProperty(n,"__esModule",{value:!0});var d=e("../../channel"),p=e("../../log"),m=e("../../scale"),g=e("../../util"),h=e("../../vega.schema"),v=e("../split"),y=e("../unit"),b=e("./properties");n.RANGE_PROPERTIES=["range","rangeStep","scheme"],n.parseScaleRange=i,n.parseRangeForChannel=o,n.defaultRange=l},{"../../channel":12,"../../log":89,"../../scale":93,"../../util":102,"../../vega.schema":104,"../split":75,"../unit":76,"./properties":60}],62:[function(e,t,n){"use strict";function i(e,t,n,i,a,u){var c=r(t,n,i,a,u);return s.hasScale(t)?void 0!==e?s.supportScaleType(t,e)?o(e,n)?e:(l.warn(l.message.scaleTypeNotWorkWithFieldDef(e,c)),c):(l.warn(l.message.scaleTypeNotWorkWithChannel(t,e,c)),c):c:null}function r(e,t,n,i,r){if(p.contains(["row","column"],e))return"band";switch(t.type){case"nominal":return"color"===e||"discrete"===s.rangeType(e)?"ordinal":a(e,n,i,r);case"ordinal":return"color"===e?"sequential":"discrete"===s.rangeType(e)?(l.warn(l.message.discreteChannelCannotEncode(e,"ordinal")),"ordinal"):a(e,n,i,r);case"temporal":return"color"===e?f.isDiscreteByDefault(t.timeUnit)?"ordinal":"sequential":"discrete"===s.rangeType(e)?(l.warn(l.message.discreteChannelCannotEncode(e,"temporal")),"ordinal"):f.isDiscreteByDefault(t.timeUnit)?a(e,n,i,r):"time";case"quantitative":return"color"===e?t.bin?"bin-ordinal":"sequential":"discrete"===s.rangeType(e)?(l.warn(l.message.discreteChannelCannotEncode(e,"quantitative")),"ordinal"):t.bin&&"x"!==e&&"y"!==e?"bin-linear":"linear"}throw new Error(l.message.invalidFieldType(t.type))}function a(e,t,n,i){if(p.contains(["x","y"],e)){if("rect"===t)return"band";if("bar"===t)return"band"}return"point"}function o(e,t){var n=t.type;return m.contains([d.Type.ORDINAL,d.Type.NOMINAL],n)?void 0===e||c.hasDiscreteDomain(e):n===d.Type.TEMPORAL?t.timeUnit?m.contains([u.ScaleType.TIME,u.ScaleType.UTC,void 0],e)||c.hasDiscreteDomain(e):m.contains([u.ScaleType.TIME,u.ScaleType.UTC,void 0],e):n!==d.Type.QUANTITATIVE||(t.bin?e===u.ScaleType.BIN_LINEAR||e===u.ScaleType.BIN_ORDINAL:m.contains([u.ScaleType.LOG,u.ScaleType.POW,u.ScaleType.SQRT,u.ScaleType.QUANTILE,u.ScaleType.QUANTIZE,u.ScaleType.LINEAR,void 0],e))}Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../channel"),l=e("../../log"),u=e("../../scale"),c=e("../../scale"),f=e("../../timeunit"),d=e("../../type"),p=e("../../util"),m=e("../../util");n.scaleType=i,n.fieldDefMatchScaleType=o},{"../../channel":12,"../../log":89,"../../scale":93,"../../timeunit":98,"../../type":101,"../../util":102}],63:[function(e,t,n){"use strict";function i(e){var t=null,n=null,i=null,r=null;return e.project.forEach(function(e,a){e.encoding===s.X?(t=e,n=a):e.encoding===s.Y&&(i=e,r=a)}),{x:t,xi:n,y:i,yi:r}}function r(e,t,n){var i=f.channelSignalName(t,n,"visual"),r=f.channelSignalName(t,n,"data"),o=d.default.has(t),l=e.scaleName(n),p=c.stringValue(l),m=e.getScaleComponent(n),g=m?m.get("type"):void 0,h=e.getSizeSignalRef(n===s.X?"width":"height").signal,v=n+"(unit)",y=a(t,function(e,t){return e.concat({events:t.between[0],update:"["+v+", "+v+"]"},{events:t,update:"["+i+"[0], clamp("+v+", 0, "+h+")]"})});return u.hasContinuousDomain(g)&&!u.isBinScale(g)&&y.push({events:{scale:l},update:"!isArray("+r+") ? "+i+" : [scale("+p+", "+r+"[0]), scale("+p+", "+r+"[1])]"}),o?[{name:r,on:[]}]:[{name:i,value:[],on:y},{name:r,on:[{events:{signal:i},update:"invert("+p+", "+i+")"}]}]}function a(e,t){return e.events.reduce(function(e,n){return n.between?t(e,n):(l.warn(n+" is not an ordered event stream for interval selections"),e)},[])}Object.defineProperty(n,"__esModule",{value:!0});var o=e("tslib"),s=e("../../channel"),l=e("../../log"),u=e("../../scale"),c=e("../../util"),f=e("./selection"),d=e("./transforms/scales");n.BRUSH="_brush";var p={predicate:"vlInterval",scaleDomain:"vlIntervalDomain",signals:function(e,t){var i=[],o=[],u=t.name;if(t.translate&&!d.default.has(t)){var p="!event.item || event.item.mark.name !== "+c.stringValue(u+n.BRUSH);a(t,function(e,t){var n=t.between[0].filter||(t.between[0].filter=[]);n.indexOf(p)<0&&n.push(p)})}return t.project.forEach(function(n){if(n.encoding===s.X||n.encoding===s.Y){var a=r(e,t,n.encoding),u=f.channelSignalName(t,n.encoding,"data");i.push.apply(i,a),o.push("{encoding: "+c.stringValue(n.encoding)+", field: "+c.stringValue(n.field)+", extent: "+u+"}")}else l.warn("Interval selections only support x and y encoding channels.")}),i.concat({name:u+f.TUPLE,update:"{unit: "+c.stringValue(e.getName(""))+", intervals: ["+o.join(", ")+"]}"})},modifyExpr:function(e,t){return t.name+f.TUPLE+", "+("global"===t.resolve?"true":"{unit: "+c.stringValue(e.getName(""))+"}")},marks:function(e,t,r){var a=t.name,s=i(t),l=s.xi,u=s.yi,p=(f.TUPLE,"data("+c.stringValue(t.name+f.STORE)+")");if(d.default.has(t))return r;var m={x:null!==l?{signal:a+"_x[0]"}:{value:0},y:null!==u?{signal:a+"_y[0]"}:{value:0},x2:null!==l?{signal:a+"_x[1]"}:{field:{group:"width"}},y2:null!==u?{signal:a+"_y[1]"}:{field:{group:"height"}}};return"global"===t.resolve&&c.keys(m).forEach(function(t){m[t]=[o.__assign({test:p+".length && "+p+"[0].unit === "+c.stringValue(e.getName(""))},m[t]),{value:0}]}),[{type:"rect",encode:{enter:{fill:{value:"#333"},fillOpacity:{value:.125}},update:m}}].concat(r,{name:a+n.BRUSH,type:"rect",encode:{enter:{fill:{value:"transparent"},stroke:{value:"white"}},update:m}})}};n.default=p,n.projections=i},{"../../channel":12,"../../log":89,"../../scale":93,"../../util":102,"./selection":65,"./transforms/scales":70,tslib:5}],64:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../util"),r=e("./selection"),a=e("./transforms/nearest"),o={predicate:"vlPoint",scaleDomain:"vlPointDomain",signals:function(e,t){var n=t.project,o=a.default.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum",s={},l=n.map(function(e){return i.stringValue(e.encoding)}).filter(function(e){return e}).join(", "),u=n.map(function(e){return i.stringValue(e.field)}).join(", "),c=n.map(function(t){var n=t.encoding,r=e.fieldDef(n);return r&&r.bin?(s[t.field]=1,"["+o+"["+i.stringValue(e.field(n,{binSuffix:"start"}))+"], "+o+"["+i.stringValue(e.field(n,{binSuffix:"end"}))+"]]"):o+"["+i.stringValue(t.field)+"]"}).join(", ");return[{name:t.name+r.TUPLE,value:{},on:[{events:t.events,update:"datum && {unit: "+i.stringValue(e.getName(""))+", encodings: ["+l+"], fields: ["+u+"], values: ["+c+"]"+(i.keys(s).length?", bins: "+JSON.stringify(s)+"}":"}")}]}]},modifyExpr:function(e,t){return t.name+r.TUPLE+", "+("global"===t.resolve?"null":"{unit: "+i.stringValue(e.getName(""))+"}")}};n.default=o},{"../../util":102,"./selection":65,"./transforms/nearest":68}],65:[function(e,t,n){"use strict";function i(e,t){var n={},i=e.config.selection;for(var r in t)!function(r){if(!t.hasOwnProperty(r))return"continue";var a=t[r],o=i[a.type];for(var s in o)"encodings"===s&&a.fields||"fields"===s&&a.encodings||void 0!==a[s]&&!0!==a[s]||(a[s]=o[s]||a[s]);var l=n[r]=y.extend({},a,{name:r,events:y.isString(a.on)?h.selector(a.on,"scope"):a.on});N.forEachTransform(l,function(t){t.parse&&t.parse(e,a,l)})}(r);return n}function r(e,t){return d(e,function(i,r){var a=i.name,o=r.modifyExpr(e,i);t.push.apply(t,r.signals(e,i)),N.forEachTransform(i,function(n){n.signals&&(t=n.signals(e,i,t)),n.modifyExpr&&(o=n.modifyExpr(e,i,o))}),t.push({name:a+n.MODIFY,on:[{events:{signal:a+n.TUPLE},update:"modify("+y.stringValue(i.name+n.STORE)+", "+o+")"}]})}),t}function a(e,t){var n=!1;return d(e,function(i,r){r.topLevelSignals&&(t=r.topLevelSignals(e,i,t)),N.forEachTransform(i,function(n){n.topLevelSignals&&(t=n.topLevelSignals(e,i,t))}),n=!0}),n&&(t.filter(function(e){return"unit"===e.name}).length||t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"group()._id ? group() : unit"}]})),t}function o(e,t){return d(e,function(e){t.filter(function(t){return t.name===e.name+n.STORE}).length||t.push({name:e.name+n.STORE})}),t}function s(e,t){var n=!1,i=t;return d(e,function(r,a){i=a.marks?a.marks(e,r,i):i,N.forEachTransform(r,function(a){n=n||a.clipGroup,a.marks&&(i=a.marks(e,r,t,i))})}),e.parent&&e.parent instanceof b.LayerModel?[i,g]:n?g(i):i}function l(e,t){var n=!1;return e.children.forEach(function(e){if(e instanceof S.UnitModel){var i=s(e,t);t=i[0],n=n||i[1]}}),n?g(t):t}function u(e,t){function i(t){var i=e.getSelectionComponent(t),r=y.stringValue(t+n.STORE),a=x[i.resolve];return p(i.type).predicate+"("+r+", "+y.stringValue(e.getName(""))+", datum, "+a+")"}return y.logicalExpr(t,i)}function c(e){return e.signal.indexOf(n.SELECTION_DOMAIN)>=0}function f(e,t){var i=JSON.parse(t.signal.replace(n.SELECTION_DOMAIN,"")),r=i.selection,a=e.component.selection&&e.component.selection[r];if(a)v.warn('Use "bind": "scales" to setup a binding for scales and selections within the same view.');else{if(i.encoding||i.field)return a=e.getSelectionComponent(r),{signal:p(a.type).scaleDomain+"("+y.stringValue(r+n.STORE)+", "+y.stringValue(i.encoding||null)+", "+y.stringValue(i.field||null)+", "+x[a.resolve]+")"};v.warn('A "field" or "encoding" must be specified when using a selection as a scale domain.')}return{signal:"null"}}function d(e,t){var n=e.component.selection;for(var i in n)if(n.hasOwnProperty(i)){var r=n[i];t(r,p(r.type))}}function p(e){switch(e){case"single":return O.default;case"multi":return E.default;case"interval":return _.default}return null}function m(e,t,n){return e.name+"_"+("visual"===n?t:e.fields[t])}function g(e){return e.map(function(e){return e.clip=!0,e})}Object.defineProperty(n,"__esModule",{value:!0});var h=e("vega-event-selector"),v=e("../../log"),y=e("../../util"),b=e("../layer"),S=e("../unit"),_=e("./interval"),E=e("./multi"),O=e("./single"),N=e("./transforms/transforms");n.STORE="_store",n.TUPLE="_tuple",n.MODIFY="_modify",n.SELECTION_DOMAIN="_selection_domain_",n.parseUnitSelection=i,n.assembleUnitSelectionSignals=r,n.assembleTopLevelSignals=a,n.assembleUnitSelectionData=o,n.assembleUnitSelectionMarks=s,n.assembleLayerSelectionMarks=l;var x={global:'"union", "all"',independent:'"intersect", "unit"',union:'"union", "all"',union_others:'"union", "others"',intersect:'"intersect", "all"',intersect_others:'"intersect", "others"'};n.predicate=u,n.isRawSelectionDomain=c,n.selectionScaleDomain=f,n.channelSignalName=m},{"../../log":89,"../../util":102,"../layer":35,"../unit":76,"./interval":63,"./multi":64,"./single":66,"./transforms/transforms":72,"vega-event-selector":6}],66:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../util"),r=e("./multi"),a=e("./selection"),o={predicate:r.default.predicate,scaleDomain:r.default.scaleDomain,signals:r.default.signals,topLevelSignals:function(e,t,n){var r=n.filter(function(e){return e.name===t.name}),o="data("+i.stringValue(t.name+a.STORE)+")",s=o+"[0].values";return r.length?n:n.concat({name:t.name,update:o+".length && {"+t.project.map(function(e,t){return e.field+": "+s+"["+t+"]"}).join(", ")+"}"})},modifyExpr:function(e,t){return t.name+a.TUPLE+", "+("global"===t.resolve?"true":"{unit: "+i.stringValue(e.getName(""))+"}")}};n.default=o},{"../../util":102,"./multi":64,"./selection":65}],67:[function(e,t,n){"use strict";function i(e){return"_"+e.replace(/\W/g,"_")}Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../../util"),a=e("../selection"),o=e("./nearest"),s={has:function(e){return"single"===e.type&&"global"===e.resolve&&e.bind&&"scales"!==e.bind},topLevelSignals:function(e,t,n){var a=t.name,s=t.project,l=t.bind,u=o.default.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return s.forEach(function(e){n.unshift({name:a+i(e.field),value:"",on:[{events:t.events,update:"datum && "+u+"["+r.stringValue(e.field)+"]"}],bind:l[e.field]||l[e.encoding]||l})}),n},signals:function(e,t,n){var o=t.name,s=t.project,l=n.filter(function(e){return e.name===o+a.TUPLE})[0],u=s.map(function(e){return r.stringValue(e.field)}).join(", "),c=s.map(function(e){return o+i(e.field)}).join(", ");return l.update="{fields: ["+u+"], values: ["+c+"]}",delete l.value,delete l.on,n}};n.default=s},{"../../../util":102,"../selection":65,"./nearest":68}],68:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i={has:function(e){return void 0!==e.nearest&&!1!==e.nearest},marks:function(e,t,n,i){var r=n[0],a=i.indexOf(r),o=r.name===e.getName("pathgroup"),s=function(e){return e.name&&e.name.indexOf("voronoi")>=0},l={name:e.getName("voronoi"),type:"path",from:{data:e.getName("marks")},encode:{enter:{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}}},transform:[{type:"voronoi",x:"datum.x",y:"datum.y",size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};return o&&!r.marks.filter(s).length?(r.marks.push(l),i.splice(a,1,r)):o||i.filter(s).length||i.splice(a+1,0,l),i}};n.default=i},{}],69:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../../log"),r={has:function(e){return void 0!==e.fields||void 0!==e.encodings},parse:function(e,t,n){var r={};(t.fields||[]).forEach(function(e){return r[e]=null}),(t.encodings||[]).forEach(function(t){var n=e.fieldDef(t);n?n.timeUnit?r[e.field(t)]=t:r[n.field]=t:i.warn(i.message.cannotProjectOnChannelWithoutField(t))});var a=n.project||(n.project=[]);for(var o in r)r.hasOwnProperty(o)&&a.push({field:o,encoding:r[o]});r=n.fields||(n.fields={}),a.filter(function(e){return e.encoding}).forEach(function(e){return r[e.encoding]=e.field})}};n.default=r},{"../../../log":89}],70:[function(e,t,n){"use strict";function i(e,t){return"domain("+o.stringValue(e.scaleName(t))+")"}Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../../log"),a=e("../../../scale"),o=e("../../../util"),s=e("../selection"),l={clipGroup:!0,has:function(e){return"interval"===e.type&&"global"===e.resolve&&e.bind&&"scales"===e.bind},parse:function(e,t,n){var i=n.scales=[];n.project.forEach(function(t){var o=t.encoding,l=e.getScaleComponent(o),u=l?l.get("type"):void 0;l&&a.hasContinuousDomain(u)&&!a.isBinScale(u)?(l.set("domainRaw",{signal:s.channelSignalName(n,o,"data")},!0),i.push(o)):r.warn("Scale bindings are currently only supported for scales with unbinned, continuous domains.")})},topLevelSignals:function(e,t,n){if(!e.parent)return n;var i=t.scales.filter(function(e){return!n.filter(function(n){return n.name===s.channelSignalName(t,e,"data")}).length});return n.concat(i.map(function(e){return{name:s.channelSignalName(t,e,"data")}}))},signals:function(e,t,n){return e.parent&&t.scales.forEach(function(e){var i=n.filter(function(n){return n.name===s.channelSignalName(t,e,"data")})[0];i.push="outer",delete i.value,delete i.update}),n}};n.default=l,n.domain=i},{"../../../log":89,"../../../scale":93,"../../../util":102,"../selection":65}],71:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../../util"),r=e("../selection"),a={has:function(e){return void 0!==e.toggle&&!1!==e.toggle},signals:function(e,t,n){return n.concat({name:t.name+"_toggle",value:!1,on:[{events:t.events,update:t.toggle}]})},modifyExpr:function(e,t,n){var a=t.name+r.TUPLE,o=t.name+"_toggle";return o+" ? null : "+a+", "+("global"===t.resolve?o+" ? null : true, ":o+" ? null : {unit: "+i.stringValue(e.getName(""))+"}, ")+o+" ? "+a+" : null"}};n.default=a},{"../../../util":102,"../selection":65}],72:[function(e,t,n){"use strict";function i(e,t){for(var n in f)f[n].has(e)&&t(f[n])}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./inputs"),a=e("./nearest"),o=e("./project"),s=e("./scales"),l=e("./toggle"),u=e("./translate"),c=e("./zoom"),f={project:o.default,toggle:l.default,scales:s.default,translate:u.default,zoom:c.default,inputs:r.default,nearest:a.default};n.forEachTransform=i},{"./inputs":67,"./nearest":68,"./project":69,"./scales":70,"./toggle":71,"./translate":73,"./zoom":74}],73:[function(e,t,n){"use strict";function i(e,t){return u.default.has(e)?t===o.Y?"+":"-":"+"}function r(e,t,n,r,a){var o=t.name,s=u.default.has(t),d=a.filter(function(e){return e.name===l.channelSignalName(t,n,s?"data":"visual")})[0],p=e.getSizeSignalRef(r).signal,m=o+c,g=o+f,h=i(t,n)+(s?" span("+m+".extent_"+n+") * "+g+"."+n+" / "+p:" "+g+"."+n),v=m+".extent_"+n,y="["+v+"[0] "+h+", "+v+"[1] "+h+"]";d.on.push({events:{signal:g},update:s?y:"clampRange("+y+", 0, "+p+")"})}Object.defineProperty(n,"__esModule",{value:!0});var a=e("vega-event-selector"),o=e("../../../channel"),s=e("../interval"),l=e("../selection"),u=e("./scales"),c="_translate_anchor",f="_translate_delta",d={has:function(e){return"interval"===e.type&&void 0!==e.translate&&!1!==e.translate},signals:function(e,t,n){var i=t.name,d=u.default.has(t),p=i+c,m=s.projections(t),g=m.x,h=m.y,v=a.selector(t.translate,"scope");return d||(v=v.map(function(e){return e.between[0].markname=i+s.BRUSH,e})),n.push({name:p,value:{},on:[{events:v.map(function(e){return e.between[0]}),update:"{x: x(unit), y: y(unit)"+(null!==g?", extent_x: "+(d?u.domain(e,o.X):"slice("+l.channelSignalName(t,"x","visual")+")"):"")+(null!==h?", extent_y: "+(d?u.domain(e,o.Y):"slice("+l.channelSignalName(t,"y","visual")+")"):"")+"}"}]},{name:i+f,value:{},on:[{events:v,update:"{x: x(unit) - "+p+".x, y: y(unit) - "+p+".y}"}]}),null!==g&&r(e,t,o.X,"width",n),null!==h&&r(e,t,o.Y,"height",n),n}};n.default=d},{"../../../channel":12,"../interval":63,"../selection":65,"./scales":70,"vega-event-selector":6}],74:[function(e,t,n){"use strict";function i(e,t,n,i,r){var a=t.name,s=u.default.has(t),d=r.filter(function(e){return e.name===l.channelSignalName(t,n,s?"data":"visual")})[0],p=e.getSizeSignalRef(i).signal,m=s?u.domain(e,n):d.name,g=""+a+c+"."+n,h=a+f,v=(o.stringValue(e.scaleName(n)),"["+g+" + ("+m+"[0] - "+g+") * "+h+", "+g+" + ("+m+"[1] - "+g+") * "+h+"]");d.on.push({events:{signal:h},update:s?v:"clampRange("+v+", 0, "+p+")"})}Object.defineProperty(n,"__esModule",{value:!0});var r=e("vega-event-selector"),a=e("../../../channel"),o=e("../../../util"),s=e("../interval"),l=e("../selection"),u=e("./scales"),c="_zoom_anchor",f="_zoom_delta",d={has:function(e){return"interval"===e.type&&void 0!==e.zoom&&!1!==e.zoom},signals:function(e,t,n){var l=t.name,d=u.default.has(t),p=l+f,m=s.projections(t),g=m.x,h=m.y,v=o.stringValue(e.scaleName(a.X)),y=o.stringValue(e.scaleName(a.Y)),b=r.selector(t.zoom,"scope");return d||(b=b.map(function(e){return e.markname=l+s.BRUSH,e})),n.push({name:l+c,on:[{events:b,update:d?"{x: invert("+v+", x(unit)), y: invert("+y+", y(unit))}":"{x: x(unit), y: y(unit)}"}]},{name:p,on:[{events:b,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),null!==g&&i(e,t,"x","width",n),null!==h&&i(e,t,"y","height",n),n}};n.default=d},{"../../../channel":12,"../../../util":102,"../interval":63,"../selection":65,"./scales":70,"vega-event-selector":6}],75:[function(e,t,n){"use strict";function i(e){return{explicit:!0,value:e}}function r(e){return{explicit:!1,value:e}}function a(e,t,n){if(void 0===n&&(n=function(){return 0}),void 0===e||void 0===e.value)return t;if(e.explicit&&!t.explicit)return e;if(t.explicit&&!e.explicit)return t;var i=n(e.value,t.value);return i>0?e:i<0?t:e}Object.defineProperty(n,"__esModule",{value:!0});var o=e("tslib"),s=function(){function e(e,t){void 0===e&&(e={}),void 0===t&&(t={}),this.explicit=e,this.implicit=t}return e.prototype.combine=function(e){var t=this;void 0===e&&(e=[]);var n=e.reduce(function(e,n){var i=t.get(n);return i&&(e[n]=i),e},{});return o.__assign({},n,this.explicit,this.implicit)},e.prototype.get=function(e){return void 0!==this.explicit[e]?this.explicit[e]:this.implicit[e]},e.prototype.getWithExplicit=function(e){return void 0!==this.explicit[e]?{explicit:!0,value:this.explicit[e]}:void 0!==this.implicit[e]?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}},e.prototype.setWithExplicit=function(e,t){void 0!==t.value&&this.set(e,t.value,t.explicit)},e.prototype.set=function(e,t,n){return this[n?"explicit":"implicit"][e]=t,n&&delete this.implicit[e],this},e.prototype.copyKeyFromSplit=function(e,t){void 0!==t.explicit[e]?this.set(e,t.explicit[e],!0):void 0!==t.implicit[e]&&this.set(e,t.implicit[e],!1)},e.prototype.copyKeyFromObject=function(e,t){void 0!==t[e]&&this.set(e,t[e],!0)},e.prototype.extend=function(t,n){return new e(n?o.__assign({},this.explicit,t):this.explicit,n?this.implicit:o.__assign({},this.implicit,t))},e}();n.Split=s,n.makeExplicit=i,n.makeImplicit=r,n.mergeValuesWithExplicit=a},{tslib:5}],76:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("../channel"),a=e("../encoding"),o=e("../encoding"),s=e("../fielddef"),l=e("../mark"),u=e("../scale"),c=e("../stack"),f=e("../util"),d=e("./axis/parse"),p=e("./common"),m=e("./data/assemble"),g=e("./data/parse"),h=e("./facet"),v=e("./layer"),y=e("./layout/assemble"),b=e("./legend/parse"),S=e("./mark/init"),_=e("./mark/mark"),E=e("./model"),O=e("./repeat"),N=e("./selection/selection"),x=function(e){function t(t,n,r,a,s,u){void 0===a&&(a={});var f=e.call(this,t,n,r,u,{})||this;f.specifiedScales={},f.specifiedAxes={},f.specifiedLegends={},f.selection={},f.children=[],f.initSize(i.__assign({},a,t.width?{width:t.width}:{},t.height?{height:t.height}:{})),f.initFacetCellConfig(),f.markDef=l.isMarkDef(t.mark)?i.__assign({},t.mark):{type:t.mark};var d=f.markDef.type,p=f.encoding=o.normalizeEncoding(O.replaceRepeaterInEncoding(t.encoding||{},s),d);return f.stack=c.stack(d,p,f.config.stack),f.specifiedScales=f.initScales(d,p),f.encoding=S.initEncoding(d,p,f.stack,f.config),f.specifiedAxes=f.initAxes(p),f.specifiedLegends=f.initLegend(p),f.selection=t.selection,f}return i.__extends(t,e),t.prototype.scaleDomain=function(e){var t=this.specifiedScales[e];return t?t.domain:void 0},t.prototype.hasDiscreteDomain=function(e){if(r.isScaleChannel(e)){var t=this.getScaleComponent(e);return t&&u.hasDiscreteDomain(t.get("type"))}return!1},t.prototype.sort=function(e){return(this.getMapping()[e]||{}).sort},t.prototype.axis=function(e){return this.specifiedAxes[e]},t.prototype.legend=function(e){return this.specifiedLegends[e]},t.prototype.initFacetCellConfig=function(){for(var e=this.config,t=this.parent,n=!1;null!==t;){if(t instanceof h.FacetModel){n=!0;break}t=t.parent}n&&(e.cell=f.extend({},e.cell,e.facet.cell))},t.prototype.initScales=function(e,t){return r.SCALE_CHANNELS.reduce(function(e,n){var i,r,a=t[n];return s.isFieldDef(a)?(i=a,r=a.scale):s.isConditionalDef(a)&&s.isFieldDef(a.condition)?(i=a.condition,r=a.condition.scale):"x"===n?i=s.getFieldDef(t.x2):"y"===n&&(i=s.getFieldDef(t.y2)),i&&(e[n]=r||{}),e},{})},t.prototype.initAxes=function(e){return[r.X,r.Y].reduce(function(t,n){var a=e[n];if(s.isFieldDef(a)||n===r.X&&s.isFieldDef(e.x2)||n===r.Y&&s.isFieldDef(e.y2)){var o=s.isFieldDef(a)?a.axis:null;null!==o&&!1!==o&&(t[n]=i.__assign({},o))}return t},{})},t.prototype.initLegend=function(e){return r.NONSPATIAL_SCALE_CHANNELS.reduce(function(t,n){var r=e[n];if(r){var a=s.isFieldDef(r)?r.legend:r.condition&&s.isFieldDef(r.condition)?r.condition.legend:null;null!==a&&!1!==a&&(t[n]=i.__assign({},a))}return t},{})},t.prototype.parseData=function(){this.component.data=g.parseData(this)},t.prototype.parseSelection=function(){this.component.selection=N.parseUnitSelection(this,this.selection)},t.prototype.parseMarkGroup=function(){this.component.mark=_.parseMarkGroup(this)},t.prototype.parseAxisAndHeader=function(){this.component.axes=d.parseAxisComponent(this,[r.X,r.Y])},t.prototype.parseLegend=function(){this.component.legends=b.parseLegendComponent(this)},t.prototype.assembleData=function(){return this.parent?[]:m.assembleData(this.component.data)},t.prototype.assembleSelectionTopLevelSignals=function(e){return N.assembleTopLevelSignals(this,e)},t.prototype.assembleSelectionSignals=function(){return N.assembleUnitSelectionSignals(this,[])},t.prototype.assembleSelectionData=function(e){return N.assembleUnitSelectionData(this,e)},t.prototype.assembleLayout=function(){return null},t.prototype.assembleLayoutSignals=function(){return y.assembleLayoutUnitSignals(this)},t.prototype.assembleMarks=function(){var e=this.component.mark||[];return this.parent&&this.parent instanceof v.LayerModel||(e=N.assembleUnitSelectionMarks(this,e)),e.map(this.correctDataNames)},t.prototype.assembleParentGroupProperties=function(){return i.__assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},p.applyConfig({},this.config.cell,l.FILL_STROKE_CONFIG.concat(["clip"])))},t.prototype.getMapping=function(){return this.encoding},t.prototype.toSpec=function(e,t){var n,i=f.duplicate(this.encoding);return n={mark:this.markDef,encoding:i},e||(n.config=f.duplicate(this.config)),t||(n.data=f.duplicate(this.data)),n},t.prototype.mark=function(){return this.markDef.type},t.prototype.channelHasField=function(e){return a.channelHasField(this.encoding,e)},t.prototype.fieldDef=function(e){var t=this.encoding[e];return s.getFieldDef(t)},t.prototype.field=function(e,t){void 0===t&&(t={});var n=this.fieldDef(e);if(n)return n.bin&&(t=f.extend({binSuffix:this.hasDiscreteDomain(e)?"range":"start"},t)),s.field(n,t)},t}(E.ModelWithField);n.UnitModel=x},{"../channel":12,"../encoding":83,"../fielddef":85,"../mark":91,"../scale":93,"../stack":97,"../util":102,"./axis/parse":14,"./common":16,"./data/assemble":20,"./data/parse":28,"./facet":34,"./layer":35,"./layout/assemble":36,"./legend/parse":40,"./mark/init":44,"./mark/mark":46,"./model":54,"./repeat":55,"./selection/selection":65,tslib:5}],77:[function(e,t,n){"use strict";function i(e){return!!e.type}function r(e,t){e.mark;var i,r,c,f,d=e.encoding,p=s.__rest(e,["mark","encoding"]),m=(d.x,d.y,s.__rest(d,["x","y"])),g=m.size,h=s.__rest(m,["size"]),v=(h.color,s.__rest(h,["color"])),y=g?{size:g}:{size:{value:t.box.size}};if(l.isFieldDef(d.x)&&l.isFieldDef(d.y)){var b=o(e,a(e));i=b.discreteAxisFieldDef,r=b.continuousAxisChannelDef,c=b.discreteAxis,f=b.continuousAxis}else if(l.isFieldDef(d.x)&&u.isContinuous(d.x)&&void 0===d.y)f="x",r=d.x;else{if(void 0!==d.x||!l.isFieldDef(d.y)||!u.isContinuous(d.y))throw new Error("Need a continuous axis for 1D boxplots");f="y",r=d.y}if(void 0!==r.aggregate&&r.aggregate!==n.BOXPLOT)throw new Error("Continuous axis should not have customized aggregation function "+r.aggregate);var S={field:r.field,type:r.type},_=s.__assign({aggregate:"min"},S),E=s.__assign({axis:r.axis},_),O=s.__assign({aggregate:"q1"},S),N=s.__assign({aggregate:"median"},S),x=s.__assign({aggregate:"q3"},S),T=s.__assign({aggregate:"max"},S),D=void 0!==i?(A={},A[c]=i,A):{};return s.__assign({},p,{layer:[{mark:{type:"rule",role:"boxWhisker"},encoding:s.__assign({},D,(w={},w[f]=E,w[f+"2"]=O,w),v)},{mark:{type:"rule",role:"boxWhisker"},encoding:s.__assign({},D,(k={},k[f]=x,k[f+"2"]=T,k),v)},{mark:{type:"bar",role:"box"},encoding:s.__assign({},D,(C={},C[f]=O,C[f+"2"]=x,C),h,y)},{mark:{type:"tick",role:"boxMid"},encoding:s.__assign({},D,(R={},R[f]=N,R),m,y,{color:{value:"white"}})}]});var A,w,k,C,R}function a(e){var t,r=e.mark,a=e.encoding,o=(s.__rest(e,["mark","encoding"]),a.x),l=a.y;if(u.isDiscrete(o)&&u.isContinuous(l))t="vertical";else if(u.isDiscrete(l)&&u.isContinuous(o))t="horizontal";else{if(!u.isContinuous(o)||!u.isContinuous(l))throw new Error("Both x and y cannot be discrete");if(void 0===o.aggregate&&l.aggregate===n.BOXPLOT)t="vertical";else if(void 0===l.aggregate&&o.aggregate===n.BOXPLOT)t="horizontal";else{if(o.aggregate===n.BOXPLOT&&l.aggregate===n.BOXPLOT)throw new Error("Both x and y cannot have aggregate");t=i(r)&&r&&r.orient?r.orient:"vertical"}}return t}function o(e,t){e.mark;var i,r,a,o,l=e.encoding,u=(s.__rest(e,["mark","encoding"]),l.x),c=l.y;if("vertical"===t?(a="x",o="y",r=c,i=u):(a="y",o="x",r=u,i=c),r&&r.aggregate){var f=r.aggregate,d=s.__rest(r,["aggregate"]);if(f!==n.BOXPLOT)throw new Error("Continuous axis should not have customized aggregation function "+f);r=d}return{discreteAxisFieldDef:i,continuousAxisChannelDef:r,discreteAxis:a,continuousAxis:o}}Object.defineProperty(n,"__esModule",{value:!0});var s=e("tslib"),l=e("../fielddef"),u=e("./../fielddef");n.BOXPLOT="box-plot",n.isBoxPlotDef=i,n.BOXPLOT_ROLES=["boxWhisker","box","boxMid"],n.VL_ONLY_BOXPLOT_CONFIG_PROPERTY_INDEX={box:["size"]},n.normalizeBoxPlot=r,n.box2DOrient=a,n.box2DParams=o},{"../fielddef":85,"./../fielddef":85,tslib:5}],78:[function(e,t,n){"use strict";function i(e){e.mark;var t=e.encoding,n=r.__rest(e,["mark","encoding"]),i=(t.size,r.__rest(t,["size"])),a=(t.x2,t.y2,r.__rest(t,["x2","y2"])),o=(a.x,a.y,r.__rest(a,["x","y"]));if(!t.x2&&!t.y2)throw new Error("Neither x2 or y2 provided");return r.__assign({},n,{layer:[{mark:"rule",encoding:i},{mark:"tick",encoding:a},{mark:"tick",encoding:t.x2?r.__assign({x:t.x2,y:t.y},o):r.__assign({x:t.x,y:t.y2},o)}]})}Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib");n.ERRORBAR="error-bar",n.normalizeErrorBar=i},{tslib:5}],79:[function(e,t,n){"use strict";function i(e,t){c[e]=t}function r(e){delete c[e]}function a(e,t){var n=s.isMarkDef(e.mark)?e.mark.type:e.mark,i=c[n];if(i)return i(e,t);throw new Error("Unregistered composite mark "+n)}Object.defineProperty(n,"__esModule",{value:!0});var o=e("tslib"),s=e("./../mark"),l=e("./boxplot"),u=e("./errorbar"),c={};n.add=i,n.remove=r,n.COMPOSITE_MARK_ROLES=l.BOXPLOT_ROLES,n.VL_ONLY_COMPOSITE_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX=o.__assign({},l.VL_ONLY_BOXPLOT_CONFIG_PROPERTY_INDEX),i(l.BOXPLOT,l.normalizeBoxPlot),i(u.ERRORBAR,u.normalizeErrorBar),n.normalize=a},{"./../mark":91,"./boxplot":77,"./errorbar":78,tslib:5}],80:[function(e,t,n){"use strict";function i(e){return m.mergeDeep(m.duplicate(n.defaultConfig),e)}function r(e){e=m.duplicate(e);for(var t=0,n=h;t<n.length;t++)delete e[O=n[t]];if(e.axis)for(var i=0,r=l.VL_ONLY_GUIDE_CONFIG;i<r.length;i++){O=r[i];delete e.axis[O]}if(e.legend)for(var a=0,o=l.VL_ONLY_GUIDE_CONFIG;a<o.length;a++){O=o[a];delete e.legend[O]}if(e.mark)for(var s=0,u=f.VL_ONLY_MARK_CONFIG_PROPERTIES;s<u.length;s++){O=u[s];delete e.mark[O]}for(var c=0,d=g;c<d.length;c++){for(var p=d[c],y=0,b=f.VL_ONLY_MARK_CONFIG_PROPERTIES;y<b.length;y++){O=b[y];delete e[p][O]}var S=v[p];if(S)for(var _=0,E=S;_<E.length;_++){O=E[_];delete e[p][O]}}for(var O in e)m.isObject(e[O])&&0===m.keys(e[O]).length&&delete e[O];return m.keys(e).length>0?e:void 0}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("./compositemark"),s=e("./compositemark/index"),l=e("./guide"),u=e("./legend"),c=e("./mark"),f=e("./mark"),d=e("./scale"),p=e("./selection"),m=e("./util");n.defaultCellConfig={width:200,height:200,fill:"transparent"},n.defaultFacetCellConfig={stroke:"#ccc",strokeWidth:1},n.defaultFacetConfig={cell:n.defaultFacetCellConfig},n.defaultOverlayConfig={line:!1},n.defaultConfig={padding:5,numberFormat:"s",timeFormat:"%b %d, %Y",countTitle:"Number of Records",cell:n.defaultCellConfig,mark:f.defaultMarkConfig,area:{},bar:f.defaultBarConfig,circle:{},line:{},point:{},rect:{},rule:{},square:{},text:f.defaultTextConfig,tick:f.defaultTickConfig,box:{size:14},boxWhisker:{},boxMid:{},overlay:n.defaultOverlayConfig,scale:d.defaultScaleConfig,axis:{},axisX:{},axisY:{},axisLeft:{},axisRight:{},axisTop:{},axisBottom:{},axisBand:{},legend:u.defaultLegendConfig,facet:n.defaultFacetConfig,selection:p.defaultConfig,title:{}},n.initConfig=i;var g=[].concat(c.PRIMITIVE_MARKS,o.COMPOSITE_MARK_ROLES),h=["padding","numberFormat","timeFormat","countTitle","cell","stack","overlay","scale","facet","selection","filterInvalid"],v=a.__assign({},c.VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX,s.VL_ONLY_COMPOSITE_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX);n.stripConfig=r},{"./compositemark":79,"./compositemark/index":79,"./guide":87,"./legend":88,"./mark":91,"./scale":93,"./selection":94,"./util":102,tslib:5}],81:[function(e,t,n){"use strict";function i(e){return!!e.url}function r(e){return!!e.values}function a(e){return!!e.name}Object.defineProperty(n,"__esModule",{value:!0}),n.isUrlData=i,n.isInlineData=r,n.isNamedData=a,n.MAIN="main",n.RAW="raw"},{}],82:[function(e,t,n){"use strict";function i(e){return!!(e&&(e.year||e.quarter||e.month||e.date||e.day||e.hours||e.minutes||e.seconds||e.milliseconds))}function r(e){if(u.isNumber(e))return e>4&&l.warn(l.message.invalidTimeUnit("quarter",e)),e-1+"";throw new Error(l.message.invalidTimeUnit("quarter",e))}function a(e){if(u.isNumber(e))return e-1+"";var t=e.toLowerCase(),i=n.MONTHS.indexOf(t);if(-1!==i)return i+"";var r=t.substr(0,3),a=n.SHORT_MONTHS.indexOf(r);if(-1!==a)return a+"";throw new Error(l.message.invalidTimeUnit("month",e))}function o(e){if(u.isNumber(e))return e%7+"";var t=e.toLowerCase(),i=n.DAYS.indexOf(t);if(-1!==i)return i+"";var r=t.substr(0,3),a=n.SHORT_DAYS.indexOf(r);if(-1!==a)return a+"";throw new Error(l.message.invalidTimeUnit("day",e))}function s(e,t){void 0===t&&(t=!1);var n=[];if(t&&void 0!==e.day&&u.keys(e).length>1&&(l.warn(l.message.droppedDay(e)),delete(e=u.duplicate(e)).day),void 0!==e.year?n.push(e.year):void 0!==e.day?n.push(c):n.push(0),void 0!==e.month){var i=t?a(e.month):e.month;n.push(i)}else if(void 0!==e.quarter){var s=t?r(e.quarter):e.quarter;n.push(s+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){var f=t?o(e.day):e.day;n.push(f+"+1")}else n.push(1);for(var d=0,p=["hours","minutes","seconds","milliseconds"];d<p.length;d++){var m=p[d];void 0!==e[m]?n.push(e[m]):n.push(0)}return e.utc?"utc("+n.join(", ")+")":"datetime("+n.join(", ")+")"}Object.defineProperty(n,"__esModule",{value:!0});var l=e("./log"),u=e("./util"),c=2006;n.isDateTime=i,n.MONTHS=["january","february","march","april","may","june","july","august","september","october","november","december"],n.SHORT_MONTHS=n.MONTHS.map(function(e){return e.substr(0,3)}),n.DAYS=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],n.SHORT_DAYS=n.DAYS.map(function(e){return e.substr(0,3)}),n.dateTimeExpr=s},{"./log":89,"./util":102}],83:[function(e,t,n){"use strict";function i(e,t){var n=e&&e[t];return!!n&&(p.isArray(n)?p.some(n,function(e){return!!e.field}):f.isFieldDef(n)||f.hasConditionFieldDef(n))}function r(e){return p.some(c.CHANNELS,function(t){if(i(e,t)){var n=e[t];if(p.isArray(n))return p.some(n,function(e){return!!e.aggregate});var r=f.getFieldDef(n);return r&&!!r.aggregate}return!1})}function a(e,t){return p.keys(e).reduce(function(n,i){if(!c.supportMark(i,t))return d.warn(d.message.incompatibleChannel(i,t)),n;if("size"===i&&"line"===t){var r=f.getFieldDef(e[i]);if(r&&r.aggregate)return d.warn(d.message.incompatibleChannel(i,t,"when the field is aggregated.")),n}if("detail"===i||"order"===i)(a=e[i])&&(n[i]=(p.isArray(a)?a:[a]).reduce(function(e,t){return f.isFieldDef(t)?e.push(f.normalizeFieldDef(t,i)):d.warn(d.message.emptyFieldDef(t,i)),e},[]));else{var a=e[i];if(!f.isFieldDef(a)&&!f.isValueDef(a)&&!f.isConditionalDef(a))return d.warn(d.message.emptyFieldDef(a,i)),n;n[i]=f.normalize(a,i)}return n},{})}function o(e){return e&&(!!e.x&&!!e.x2||!!e.y&&!!e.y2)}function s(e){var t=[];return c.CHANNELS.forEach(function(n){if(i(e,n)){var r=e[n];(p.isArray(r)?r:[r]).forEach(function(e){f.isFieldDef(e)?t.push(e):f.hasConditionFieldDef(e)&&t.push(e.condition)})}}),t}function l(e,t,n){e&&p.keys(e).forEach(function(i){var r=i;p.isArray(e[r])?e[r].forEach(function(e){t.call(n,e,r)}):t.call(n,e[r],r)})}function u(e,t,n,i){return e?p.keys(e).reduce(function(n,r){var a=r;return p.isArray(e[a])?e[a].reduce(function(e,n){return t.call(i,e,n,a)},n):t.call(i,n,e[a],a)},n):n}Object.defineProperty(n,"__esModule",{value:!0});var c=e("./channel"),f=e("./fielddef"),d=e("./log"),p=e("./util");n.channelHasField=i,n.isAggregate=r,n.normalizeEncoding=a,n.isRanged=o,n.fieldDefs=s,n.forEach=l,n.reduce=u},{"./channel":12,"./fielddef":85,"./log":89,"./util":102}],84:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],85:[function(e,t,n){"use strict";function i(e){return e&&!D.isString(e)&&"repeat"in e}function r(e){return!!e&&!!e.condition}function a(e){return!!e&&!!e.condition&&o(e.condition)}function o(e){return!(!e||!e.field&&"count"!==e.aggregate)}function s(e){return e&&"value"in e&&void 0!==e.value}function l(e){return!(!e||!e.scale&&!e.sort)}function u(e,t){void 0===t&&(t={});var n=e.field,i=t.prefix,r=t.suffix;if(d(e))n="count_*";else{var a=void 0;t.nofn||(e.bin?(a=E.binToString(e.bin),r=t.binSuffix):e.aggregate?a=String(t.aggregate||e.aggregate):e.timeUnit&&(a=String(e.timeUnit))),a&&(n=a+"_"+n)}return r&&(n=n+"_"+r),i&&(n=i+"_"+n),t.expr&&(n=t.expr+"["+D.stringValue(n)+"]"),n}function c(e){switch(e.type){case"nominal":case"ordinal":return!0;case"quantitative":return!!e.bin;case"temporal":return x.isDiscreteByDefault(e.timeUnit)}throw new Error(N.message.invalidFieldType(e.type))}function f(e){return!c(e)}function d(e){return"count"===e.aggregate}function p(e,t){if(d(e))return t.countTitle;var n=e.aggregate||e.timeUnit||e.bin&&"bin";return n?n.toUpperCase()+"("+e.field+")":e.field}function m(e,t){if(e.timeUnit)return"temporal";if(e.bin)return"quantitative";switch(O.rangeType(t)){case"continuous":return"quantitative";case"discrete":case"flexible":return"nominal";default:return"quantitative"}}function g(e){return o(e)?e:a(e)?e.condition:void 0}function h(e,t){return o(e)?v(e,t):a(e)?S.__assign({},e,{condition:v(e.condition,t)}):e}function v(e,t){if(e.aggregate&&!_.AGGREGATE_OP_INDEX[e.aggregate]){e.aggregate;var n=S.__rest(e,["aggregate"]);N.warn(N.message.invalidAggregate(e.aggregate)),e=n}if(e.bin&&(e=S.__assign({},e,{bin:y(e.bin,t)})),e.type){var i=T.getFullName(e.type);e.type!==i&&(e=S.__assign({},e,{type:i}))}else{var r=m(e,t);N.warn(N.message.emptyOrInvalidFieldType(e.type,t,r)),e=S.__assign({},e,{type:r})}var a=b(e,t),o=a.compatible,s=a.warning;return o||N.warn(s),e}function y(e,t){return D.isBoolean(e)?{maxbins:E.autoMaxBins(t)}:e.maxbins||e.step?e:S.__assign({},e,{maxbins:E.autoMaxBins(t)})}function b(e,t){switch(t){case"row":case"column":return f(e)&&!e.timeUnit?{compatible:!1,warning:N.message.facetChannelShouldBeDiscrete(t)}:A;case"x":case"y":case"color":case"text":case"detail":case"tooltip":return A;case"opacity":case"size":case"x2":case"y2":return c(e)&&!e.bin?{compatible:!1,warning:"Channel "+t+" should not be used with discrete field."}:A;case"shape":return"nominal"!==e.type?{compatible:!1,warning:"Shape channel should be used with nominal data only"}:A;case"order":return"nominal"===e.type?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:A}throw new Error("channelCompatability not implemented for channel "+t)}Object.defineProperty(n,"__esModule",{value:!0});var S=e("tslib"),_=e("./aggregate"),E=e("./bin"),O=e("./channel"),N=e("./log"),x=e("./timeunit"),T=e("./type"),D=e("./util");n.isRepeatRef=i,n.isConditionalDef=r,n.hasConditionFieldDef=a,n.isFieldDef=o,n.isValueDef=s,n.isScaleFieldDef=l,n.field=u,n.isDiscrete=c,n.isContinuous=f,n.isCount=d,n.title=p,n.defaultType=m,n.getFieldDef=g,n.normalize=h,n.normalizeFieldDef=v,n.normalizeBin=y;var A={compatible:!0};n.channelCompatibility=b},{"./aggregate":9,"./bin":11,"./channel":12,"./log":89,"./timeunit":98,"./type":101,"./util":102,tslib:5}],86:[function(e,t,n){"use strict";function i(e){return e&&e.selection}function r(e){return e&&!!e.field&&void 0!==e.equal}function a(e){return!!(e&&e.field&&p.isArray(e.range)&&2===e.range.length)}function o(e){return e&&!!e.field&&(p.isArray(e.oneOf)||p.isArray(e.in))}function s(e,t){return p.logicalExpr(t,function(t){if(p.isString(t))return t;if(i(t))return u.predicate(e,t.selection);var n=t.timeUnit?"time("+d.fieldExpr(t.timeUnit,t.field)+")":f.field(t,{expr:"datum"});if(r(t))return n+"==="+l(t.equal,t.timeUnit);if(o(t))return"indexof(["+(t.oneOf||t.in).map(function(e){return l(e,t.timeUnit)}).join(",")+"], "+n+") !== -1";if(a(t)){var s=t.range[0],c=t.range[1];if(null!==s&&null!==c)return"inrange("+n+", "+l(s,t.timeUnit)+", "+l(c,t.timeUnit)+")";if(null!==s)return n+" >= "+s;if(null!==c)return n+" <= "+c}})}function l(e,t){if(c.isDateTime(e))return"time("+(i=c.dateTimeExpr(e,!0))+")";if(d.isSingleTimeUnit(t)){var n={};n[t]=e;var i=c.dateTimeExpr(n,!0);return"time("+i+")"}return JSON.stringify(e)}Object.defineProperty(n,"__esModule",{value:!0});var u=e("./compile/selection/selection"),c=e("./datetime"),f=e("./fielddef"),d=e("./timeunit"),p=e("./util");n.isSelectionFilter=i,n.isEqualFilter=r,n.isRangeFilter=a,n.isOneOfFilter=o,n.expression=s},{"./compile/selection/selection":65,"./datetime":82,"./fielddef":85,"./timeunit":98,"./util":102}],87:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.VL_ONLY_GUIDE_CONFIG=["shortTimeLabels"]},{}],88:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.defaultLegendConfig={orient:void 0},n.LEGEND_PROPERTIES=["entryPadding","format","offset","orient","tickCount","title","type","values","zindex"]},{}],89:[function(e,t,n){"use strict";function i(e){e(d=new p),o()}function r(e){return function(){var t=d=new p;e(t),o()}}function a(e){return d=e}function o(){return d=f}function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];d.warn.apply(d,arguments)}function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];d.info.apply(d,arguments)}function u(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];d.debug.apply(d,arguments)}Object.defineProperty(n,"__esModule",{value:!0});var c=e("vega-util"),f=c.logger(c.Warn),d=f,p=function(){function e(){this.warns=[],this.infos=[],this.debugs=[]}return e.prototype.level=function(){return this},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.warns).push.apply(n,e),this;var n},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.infos).push.apply(n,e),this;var n},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.debugs).push.apply(n,e),this;var n},e}();n.LocalLogger=p,n.runLocalLogger=i,n.wrap=r,n.set=a,n.reset=o,n.warn=s,n.info=l,n.debug=u;!function(e){function t(e){return"Cannot project a selection on encoding channel "+e+", which has no field."}function n(e){return'Unknown repeated value "'+e+'".'}function i(e){return"Unrecognized parse "+e+"."}function r(e,t,n){return"An ancestor parsed field "+e+" as "+n+" but a child wants to parse the field as "+t+"."}function a(e){return"Ignoring an invalid transform: "+JSON.stringify(e)+"."}function o(e){return'Invalid field type "'+e+'"'}function s(e){return'Invalid aggregation operator "'+e+'"'}function l(e,t,n){return"Invalid field type ("+e+") for channel "+t+", using "+n+" instead."}function u(e,t){return"Dropping "+JSON.stringify(e)+" from channel "+t+" since it does not contain data field or value."}function c(e,t,n){return e+" dropped as it is incompatible with "+t+(n?" when "+n:"")+"."}function f(e){return e+" encoding should be discrete (ordinal / nominal / binned)."}function d(e,t){return"Using discrete channel "+e+" to encode "+t+" field can be misleading as it does not encode "+("ordinal"===t?"order":"magnitude")+"."}function p(e){return"Cannot clearly determine orientation for "+e+" since both x and y channel encode continous fields. In this case, we use vertical by default"}function m(e){return"Cannot clearly determine orientation for "+e+" since both x and y channel encode discrete or empty fields."}function g(e,t){return"Specified orient "+e+" overridden with "+t}function h(e){return"Cannot use "+e+" with non-color channel."}function v(e){return"Using unaggregated domain with raw field has no effect ("+JSON.stringify(e)+")."}function y(e){return"Unaggregated domain not applicable for "+e+" since it produces values outside the origin domain of the source data."}function b(e){return"Unaggregated domain is currently unsupported for log scale ("+JSON.stringify(e)+")."}function S(e){return"Using size field when "+e+"-channel has a band scale is not supported."}function _(e){return"Cannot apply size to non-oriented mark "+e+"."}function E(e){return"rangeStep for "+e+" is dropped as top-level "+("x"===e?"width":"height")+" is provided."}function O(e,t,n){return"Channel "+e+" does not work with "+t+" scale. We are using "+n+" scale instead."}function N(e,t){return"FieldDef does not work with "+e+" scale. We are using "+t+" scale instead."}function x(e,t,n){return n+"-scale's \""+t+'" is dropped as it does not work with '+e+" scale."}function T(e,t){return'Scale type "'+t+'" does not work with mark '+e+"."}function D(e){return"Setting the scale to be independent for "+e+" means we also have to set the guide (axis or legend) to be independent."}function A(e){return"Cannot set "+e+'-scale\'s "domain" as it is binned. Please use "bin"\'s "extent" instead.'}function w(e){return"Cannot stack "+e+" if there is already "+e+"2"}function k(e){return"Cannot stack non-linear scale ("+e+")"}function C(e){return"Cannot stack when the aggregate function is non-summative ("+e+")"}function R(e,t){return"Invalid "+e+": "+t}function M(e){return'Time unit "'+e+'" is not supported. We are replacing it with '+e.replace("day","date")+"."}function P(e){return"Dropping day from datetime "+JSON.stringify(e)+" as day cannot be combined with other units."}e.INVALID_SPEC="Invalid spec",e.cannotProjectOnChannelWithoutField=t,e.noSuchRepeatedValue=n,e.unrecognizedParse=i,e.differentParse=r,e.invalidTransformIgnored=a,e.NO_FIELDS_NEEDS_AS="If `from.fields` is not specified, `as` has to be a string that specifies the key to be used for the the data from the secondary source.",e.invalidFieldType=o,e.invalidAggregate=s,e.emptyOrInvalidFieldType=l,e.emptyFieldDef=u,e.incompatibleChannel=c,e.facetChannelShouldBeDiscrete=f,e.discreteChannelCannotEncode=d,e.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL="Bar mark should not be used with point scale when rangeStep is null. Please use band scale instead.",e.unclearOrientContinuous=p,e.unclearOrientDiscreteOrEmpty=m,e.orientOverridden=g,e.CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN="custom domain scale cannot be unioned with default field-based domain",e.cannotUseScalePropertyWithNonColor=h,e.unaggregateDomainHasNoEffectForRawField=v,e.unaggregateDomainWithNonSharedDomainOp=y,e.unaggregatedDomainWithLogScale=b,e.CANNOT_USE_RANGE_WITH_POSITION="Cannot use custom range with x or y channel.  Please customize width, height, padding, or rangeStep instead.",e.cannotUseSizeFieldWithBandSize=S,e.cannotApplySizeToNonOrientedMark=_,e.rangeStepDropped=E,e.scaleTypeNotWorkWithChannel=O,e.scaleTypeNotWorkWithFieldDef=N,e.scalePropertyNotWorkWithScaleType=x,e.scaleTypeNotWorkWithMark=T,e.independentScaleMeansIndependentGuide=D,e.conflictedDomain=A,e.INVAID_DOMAIN="Invalid scale domain",e.UNABLE_TO_MERGE_DOMAINS="Unable to merge domains",e.INVALID_CHANNEL_FOR_AXIS="Invalid channel for axis.",e.cannotStackRangedMark=w,e.cannotStackNonLinearScale=k,e.cannotStackNonSummativeAggregate=C,e.invalidTimeUnit=R,e.dayReplacedWithDate=M,e.droppedDay=P}(n.message||(n.message={}))},{"vega-util":7}],90:[function(e,t,n){"use strict";function i(e){return!!e.or}function r(e){return!!e.and}function a(e){return!!e.not}Object.defineProperty(n,"__esModule",{value:!0}),n.isLogicalOr=i,n.isLogicalAnd=r,n.isLogicalNot=a},{}],91:[function(e,t,n){"use strict";function i(e){return e.type}function r(e){return(i(e)?e.type:e)in s}Object.defineProperty(n,"__esModule",{value:!0});var a,o=e("./util");!function(e){e.AREA="area",e.BAR="bar",e.LINE="line",e.POINT="point",e.RECT="rect",e.RULE="rule",e.TEXT="text",e.TICK="tick",e.CIRCLE="circle",e.SQUARE="square"}(a=n.Mark||(n.Mark={})),n.AREA=a.AREA,n.BAR=a.BAR,n.LINE=a.LINE,n.POINT=a.POINT,n.TEXT=a.TEXT,n.TICK=a.TICK,n.RECT=a.RECT,n.RULE=a.RULE,n.CIRCLE=a.CIRCLE,n.SQUARE=a.SQUARE,n.PRIMITIVE_MARKS=[n.AREA,n.BAR,n.LINE,n.POINT,n.TEXT,n.TICK,n.RECT,n.RULE,n.CIRCLE,n.SQUARE],n.isMarkDef=i;var s=o.toSet(n.PRIMITIVE_MARKS);n.isPrimitiveMark=r,n.STROKE_CONFIG=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity"],n.FILL_CONFIG=["fill","fillOpacity"],n.FILL_STROKE_CONFIG=[].concat(n.STROKE_CONFIG,n.FILL_CONFIG),n.VL_ONLY_MARK_CONFIG_PROPERTIES=["filled","color"],n.VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX={bar:["binSpacing","continuousBandSize","discreteBandSize"],text:["shortTimeLabels"],tick:["bandSize","thickness"]},n.defaultMarkConfig={color:"#4c78a8"},n.defaultBarConfig={binSpacing:1,continuousBandSize:2},n.defaultTextConfig={},n.defaultTickConfig={thickness:1}},{"./util":102}],92:[function(e,t,n){"use strict";function i(e,t){var n={};return l.SCALE_CHANNELS.forEach(function(i){var r=e[i]||{scale:t(i)},a=c.contains(l.SPATIAL_SCALE_CHANNELS,i)?"axis":"legend";"independent"!==r.scale||"shared"!==r.axis&&"shared"!==r.legend||u.warn(u.message.independentScaleMeansIndependentGuide(i)),n[i]=(o={scale:r.scale||"shared"},o[a]="independent"===r.scale?"independent":r[a]||"shared",o);var o}),n}function r(e){return i(e,function(e){return"shared"})}function a(e){return i(e,function(e){return"independent"})}function o(e){return i(e,function(e){return c.contains(l.NONSPATIAL_SCALE_CHANNELS,e)?"shared":"independent"})}function s(e){return i(e,function(e){return"shared"})}Object.defineProperty(n,"__esModule",{value:!0});var l=e("./channel"),u=e("./log"),c=e("./util");n.initLayerResolve=r,n.initConcatResolve=a,n.initRepeatResolve=o,n.initFacetResolve=s},{"./channel":12,"./log":89,"./util":102}],93:[function(e,t,n){"use strict";function i(e,t){return g[e]===g[t]}function r(e){return h[e]}function a(e){return e in b}function o(e){return e in S}function s(e){return e in y}function l(e){return e in v}function u(e){return e&&!!e.name}function c(e){return e&&e.selection}function f(e,t){switch(t){case"type":case"domain":case"range":case"scheme":return!0;case"interpolate":return m.contains(["linear","bin-linear","pow","log","sqrt","utc","time"],e);case"round":return l(e)||"band"===e||"point"===e;case"rangeStep":case"padding":case"paddingOuter":return m.contains(["point","band"],e);case"paddingInner":return"band"===e;case"clamp":return l(e)||"sequential"===e;case"nice":return l(e)||"sequential"===e||"quantize"===e;case"exponent":return"pow"===e||"log"===e;case"zero":return"bin-ordinal"===e||!a(e)&&!m.contains(["log","time","utc","bin-linear"],e)}throw new Error("Invalid scale property "+t+".")}function d(e,t){switch(t){case"range":if("x"===e||"y"===e)return p.message.CANNOT_USE_RANGE_WITH_POSITION;return;case"rangeStep":return;case"padding":case"paddingInner":case"paddingOuter":return;case"interpolate":case"scheme":if("color"!==e)return p.message.cannotUseScalePropertyWithNonColor(e);return;case"type":case"domain":case"round":case"clamp":case"exponent":case"nice":case"zero":return}throw new Error('Invalid scale property "${propName}".')}Object.defineProperty(n,"__esModule",{value:!0});var p=e("./log"),m=e("./util");!function(e){e.LINEAR="linear",e.BIN_LINEAR="bin-linear",e.LOG="log",e.POW="pow",e.SQRT="sqrt",e.TIME="time",e.UTC="utc",e.SEQUENTIAL="sequential",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.ORDINAL="ordinal",e.BIN_ORDINAL="bin-ordinal",e.POINT="point",e.BAND="band"}(n.ScaleType||(n.ScaleType={})),n.SCALE_TYPES=["linear","bin-linear","log","pow","sqrt","time","utc","sequential","ordinal","bin-ordinal","point","band"];var g={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric","bin-linear":"bin-linear",time:"time",utc:"time",sequential:"sequential",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position"};n.scaleCompatible=i;var h={linear:0,log:1,pow:1,sqrt:1,time:0,utc:0,point:0,band:1,"bin-linear":0,sequential:0,ordinal:0,"bin-ordinal":0};n.scaleTypePrecedence=r,n.CONTINUOUS_TO_CONTINUOUS_SCALES=["linear","bin-linear","log","pow","sqrt","time","utc"];var v=m.toSet(n.CONTINUOUS_TO_CONTINUOUS_SCALES);n.CONTINUOUS_DOMAIN_SCALES=n.CONTINUOUS_TO_CONTINUOUS_SCALES.concat(["sequential"]);var y=m.toSet(n.CONTINUOUS_DOMAIN_SCALES);n.DISCRETE_DOMAIN_SCALES=["ordinal","bin-ordinal","point","band"];var b=m.toSet(n.DISCRETE_DOMAIN_SCALES),S=m.toSet(["bin-linear","bin-ordinal"]);n.TIME_SCALE_TYPES=["time","utc"],n.hasDiscreteDomain=a,n.isBinScale=o,n.hasContinuousDomain=s,n.isContinuousToContinuous=l,n.defaultScaleConfig={round:!0,textXRangeStep:90,rangeStep:21,pointPadding:.5,bandPaddingInner:.1,facetSpacing:16,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,shapes:["circle","square","cross","diamond","triangle-up","triangle-down"]},n.isExtendedScheme=u,n.isSelectionDomain=c,n.SCALE_PROPERTIES=["type","domain","range","round","rangeStep","scheme","padding","paddingInner","paddingOuter","clamp","nice","exponent","zero","interpolate"],n.scaleTypeSupportProperty=f,n.channelScalePropertyIncompatability=d},{"./log":89,"./util":102}],94:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.defaultConfig={single:{on:"click",fields:["_id"],resolve:"global"},multi:{on:"click",fields:["_id"],toggle:"event.shiftKey",resolve:"global"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel",resolve:"global"}}},{}],95:[function(e,t,n){"use strict";function i(e){return!(!e||"count"!==e.op&&!e.field||!e.op)}Object.defineProperty(n,"__esModule",{value:!0}),n.isSortField=i},{}],96:[function(e,t,n){"use strict";function i(e){return void 0!==e.facet}function r(e){return!!e.mark}function a(e){return void 0!==e.layer}function o(e){return void 0!==e.repeat}function s(e){return l(e)||u(e)}function l(e){return void 0!==e.vconcat}function u(e){return void 0!==e.hconcat}function c(e,t){if(i(e))return p(e,t);if(a(e))return m(e,t);if(o(e))return g(e,e.config);if(l(e))return h(e,e.config);if(u(e))return v(e,e.config);if(r(e)){var n=k.channelHasField(e.encoding,A.ROW),s=k.channelHasField(e.encoding,A.COLUMN);return n||s?y(e,t):S(e,t)}throw new Error(R.message.INVALID_SPEC)}function f(e,t){return a(e)?m(e,t):o(e)?g(e,t):S(e,t)}function d(e,t){return a(e)?m(e,t):o(e)?g(e,t):S(e,t)}function p(e,t){var n=e.spec,i=D.__rest(e,["spec"]);return D.__assign({},i,{spec:f(n,t)})}function m(e,t){var n=e.layer,i=D.__rest(e,["layer"]);return D.__assign({},i,{layer:n.map(function(e){return a(e)?m(e,t):S(e,t)})})}function g(e,t){var n=e.spec,i=D.__rest(e,["spec"]);return D.__assign({},i,{spec:d(n,t)})}function h(e,t){var n=e.vconcat,i=D.__rest(e,["vconcat"]);return D.__assign({},i,{vconcat:n.map(function(e){return f(e,t)})})}function v(e,t){var n=e.hconcat,i=D.__rest(e,["hconcat"]);return D.__assign({},i,{hconcat:n.map(function(e){return f(e,t)})})}function y(e,t){var n=e.encoding,i=n.row,r=n.column,a=D.__rest(n,["row","column"]),o=e.mark,s=e.selection,l=(e.encoding,D.__rest(e,["mark","selection","encoding"]));return D.__assign({},l,{facet:D.__assign({},i?{row:i}:{},r?{column:r}:{}),spec:S(D.__assign({mark:o,encoding:a},s?{selection:s}:{}),t)})}function b(e){return M.isPrimitiveMark(e.mark)}function S(e,t){if(b(e)){if(k.isRanged(e.encoding))return _(e);var n=t&&t.overlay,i=n&&e.mark===M.AREA&&I.contains(["linepoint","line"],n.area),r=n&&(n.line&&e.mark===M.LINE||"linepoint"===n.area&&e.mark===M.AREA);return r||i?E(e,r,i,t):e}return w.normalize(e,t)}function _(e){var t=k.channelHasField(e.encoding,A.X),n=k.channelHasField(e.encoding,A.Y),i=k.channelHasField(e.encoding,A.X2),r=k.channelHasField(e.encoding,A.Y2);if(i&&!t||r&&!n){var a=I.duplicate(e);return i&&!t&&(a.encoding.x=a.encoding.x2,delete a.encoding.x2),r&&!n&&(a.encoding.y=a.encoding.y2,delete a.encoding.y2),a}return e}function E(e,t,n,i){var r=e.mark,a=e.encoding,o=D.__rest(e,["mark","encoding"]),s=[{mark:r,encoding:a}],l=P.stack(r,a,i?i.stack:void 0),u=a;if(l){var c=l.fieldChannel,f=l.offset;u=D.__assign({},a,(d={},d[c]=D.__assign({},a[c],f?{stack:f}:{}),d))}return n&&s.push({mark:{type:"line",role:"lineOverlay"},encoding:u}),t&&s.push({mark:{type:"point",filled:!0,role:"pointOverlay"},encoding:u}),D.__assign({},o,{layer:s});var d}function O(e,t){return t.forEach(function(t){var n=["field","type","value","timeUnit","bin","aggregate"].reduce(function(e,n){return void 0!==t[n]&&(e[n]=t[n]),e},{}),i=I.hash(n);e[i]=e[i]||t}),e}function N(e,t){return void 0===t&&(t={}),a(e)?e.layer.forEach(function(e){r(e)?O(t,C.fieldDefs(e.encoding)):N(e,t)}):i(e)?(O(t,C.fieldDefs(e.facet)),N(e.spec,t)):o(e)?(O(t,C.fieldDefs(e.spec)),N(e.spec,t)):s(e)?(l(e)?e.vconcat:e.hconcat).forEach(function(e){r(e)?O(t,C.fieldDefs(e.encoding)):N(e,t)}):O(t,C.fieldDefs(e.encoding)),t}function x(e){return I.vals(N(e))}function T(e,t){return t=t||e.config,!!M.isPrimitiveMark(e.mark)&&null!==P.stack(e.mark,e.encoding,t?t.stack:void 0)}Object.defineProperty(n,"__esModule",{value:!0});var D=e("tslib"),A=e("./channel"),w=e("./compositemark"),k=e("./encoding"),C=e("./encoding"),R=e("./log"),M=e("./mark"),P=e("./stack"),I=e("./util");n.isFacetSpec=i,n.isUnitSpec=r,n.isLayerSpec=a,n.isRepeatSpec=o,n.isConcatSpec=s,n.isVConcatSpec=l,n.isHConcatSpec=u,n.normalize=c,n.fieldDefs=x,n.isStacked=T},{"./channel":12,"./compositemark":79,"./encoding":83,"./log":89,"./mark":91,"./stack":97,"./util":102,tslib:5}],97:[function(e,t,n){"use strict";function i(e,t,i){var d=u.isMarkDef(e)?e.type:e;if(!f.contains(n.STACKABLE_MARKS,d))return null;if(!o.isAggregate(t))return null;var p=a.STACK_BY_CHANNELS.reduce(function(e,n){if(o.channelHasField(t,n)){var i=t[n];(f.isArray(i)?i:[i]).forEach(function(t){var i=s.getFieldDef(t);i.aggregate||e.push({channel:n,fieldDef:i})})}return e},[]);if(0===p.length)return null;var m=s.isFieldDef(t.x),g=s.isFieldDef(t.y),h=s.isFieldDef(t.x)&&!!t.x.aggregate;if(h!==(s.isFieldDef(t.y)&&!!t.y.aggregate)){var v=h?a.X:a.Y,y=t[v],b=y.aggregate,S=y.scale,_=null;return _=void 0!==y.stack?y.stack:f.contains(n.STACK_BY_DEFAULT_MARKS,d)&&void 0===i?"zero":i,_&&"none"!==_?S&&S.type&&S.type!==c.ScaleType.LINEAR?(l.warn(l.message.cannotStackNonLinearScale(S.type)),null):o.channelHasField(t,v===a.X?a.X2:a.Y2)?(l.warn(l.message.cannotStackRangedMark(v)),null):f.contains(r.SUM_OPS,b)?{groupbyChannel:h?g?a.Y:null:m?a.X:null,fieldChannel:v,stackBy:p,offset:_}:(l.warn(l.message.cannotStackNonSummativeAggregate(b)),null):null}return null}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./aggregate"),a=e("./channel"),o=e("./encoding"),s=e("./fielddef"),l=e("./log"),u=e("./mark"),c=e("./scale"),f=e("./util");n.STACKABLE_MARKS=[u.BAR,u.AREA,u.RULE,u.POINT,u.CIRCLE,u.SQUARE,u.LINE,u.TEXT,u.TICK],n.STACK_BY_DEFAULT_MARKS=[u.BAR,u.AREA],n.stack=i},{"./aggregate":9,"./channel":12,"./encoding":83,"./fielddef":85,"./log":89,"./mark":91,"./scale":93,"./util":102}],98:[function(e,t,n){"use strict";function i(e){return!!h[e]}function r(e,t){var i=new Date(0,0,1,0,0,0,0);return n.SINGLE_TIMEUNITS.forEach(function(n){if(o(e,n))switch(n){case d.DAY:throw new Error("Cannot convert to TimeUnits containing 'day'");case d.YEAR:i.setFullYear(t.getFullYear());break;case d.QUARTER:i.setMonth(3*Math.floor(t.getMonth()/3));break;case d.MONTH:i.setMonth(t.getMonth());break;case d.DATE:i.setDate(t.getDate());break;case d.HOURS:i.setHours(t.getHours());break;case d.MINUTES:i.setMinutes(t.getMinutes());break;case d.SECONDS:i.setSeconds(t.getSeconds());break;case d.MILLISECONDS:i.setMilliseconds(t.getMilliseconds())}}),i}function a(e){return!!v[e]}function o(e,t){var n=e.indexOf(t);return n>-1&&(t!==d.SECONDS||0===n||"i"!==e.charAt(n-1))}function s(e,t){function i(e){return e===d.QUARTER?"("+a+"quarter("+r+")-1)":""+a+e+"("+r+")"}var r="datum["+g.stringValue(t)+"]",a=f(e)?"utc":"",s=n.SINGLE_TIMEUNITS.reduce(function(t,n){return o(e,n)&&(t[n]=i(n)),t},{});return s.day&&g.keys(s).length>1&&(m.warn(m.message.dayReplacedWithDate(e)),delete s.day,s.date=i(d.DATE)),p.dateTimeExpr(s)}function l(e){if(e)return o(e,d.SECONDS)?"second":o(e,d.MINUTES)?"minute":o(e,d.HOURS)?"hour":o(e,d.DAY)||o(e,d.DATE)?"day":o(e,d.MONTH)?"month":o(e,d.YEAR)?"year":void 0}function u(e,t,n,i){if(e){var r=[],a="",s=o(e,d.YEAR);o(e,d.QUARTER)&&(a="'Q' + quarter("+t+")"),o(e,d.MONTH)&&r.push(!1!==n?"%b":"%B"),o(e,d.DAY)?r.push(n?"%a":"%A"):o(e,d.DATE)&&r.push("%d"+(s?",":"")),s&&r.push(n?"%y":"%Y");var l=[];o(e,d.HOURS)&&l.push("%H"),o(e,d.MINUTES)&&l.push("%M"),o(e,d.SECONDS)&&l.push("%S"),o(e,d.MILLISECONDS)&&l.push("%L");var u=[];return r.length>0&&u.push(r.join(" ")),l.length>0&&u.push(l.join(":")),u.length>0&&(a&&(a+=" + ' ' + "),a+=i?"utcFormat("+t+", '"+u.join(" ")+"')":"timeFormat("+t+", '"+u.join(" ")+"')"),a||void 0}}function c(e){switch(e){case"hours":case"day":case"month":case"quarter":return!0}return!1}function f(e){return"utc"===e.substr(0,3)}Object.defineProperty(n,"__esModule",{value:!0});var d,p=e("./datetime"),m=e("./log"),g=e("./util");!function(e){e.YEAR="year",e.MONTH="month",e.DAY="day",e.DATE="date",e.HOURS="hours",e.MINUTES="minutes",e.SECONDS="seconds",e.MILLISECONDS="milliseconds",e.YEARMONTH="yearmonth",e.YEARMONTHDATE="yearmonthdate",e.YEARMONTHDATEHOURS="yearmonthdatehours",e.YEARMONTHDATEHOURSMINUTES="yearmonthdatehoursminutes",e.YEARMONTHDATEHOURSMINUTESSECONDS="yearmonthdatehoursminutesseconds",e.MONTHDATE="monthdate",e.HOURSMINUTES="hoursminutes",e.HOURSMINUTESSECONDS="hoursminutesseconds",e.MINUTESSECONDS="minutesseconds",e.SECONDSMILLISECONDS="secondsmilliseconds",e.QUARTER="quarter",e.YEARQUARTER="yearquarter",e.QUARTERMONTH="quartermonth",e.YEARQUARTERMONTH="yearquartermonth",e.UTCYEAR="utcyear",e.UTCMONTH="utcmonth",e.UTCDAY="utcday",e.UTCDATE="utcdate",e.UTCHOURS="utchours",e.UTCMINUTES="utcminutes",e.UTCSECONDS="utcseconds",e.UTCMILLISECONDS="utcmilliseconds",e.UTCYEARMONTH="utcyearmonth",e.UTCYEARMONTHDATE="utcyearmonthdate",e.UTCYEARMONTHDATEHOURS="utcyearmonthdatehours",e.UTCYEARMONTHDATEHOURSMINUTES="utcyearmonthdatehoursminutes",e.UTCYEARMONTHDATEHOURSMINUTESSECONDS="utcyearmonthdatehoursminutesseconds",e.UTCMONTHDATE="utcmonthdate",e.UTCHOURSMINUTES="utchoursminutes",e.UTCHOURSMINUTESSECONDS="utchoursminutesseconds",e.UTCMINUTESSECONDS="utcminutesseconds",e.UTCSECONDSMILLISECONDS="utcsecondsmilliseconds",e.UTCQUARTER="utcquarter",e.UTCYEARQUARTER="utcyearquarter",e.UTCQUARTERMONTH="utcquartermonth",e.UTCYEARQUARTERMONTH="utcyearquartermonth"}(d=n.TimeUnit||(n.TimeUnit={})),n.SINGLE_TIMEUNITS=[d.YEAR,d.QUARTER,d.MONTH,d.DAY,d.DATE,d.HOURS,d.MINUTES,d.SECONDS,d.MILLISECONDS];var h=n.SINGLE_TIMEUNITS.reduce(function(e,t){return e[t]=!0,e},{});n.isSingleTimeUnit=i,n.convert=r,n.MULTI_TIMEUNITS=[d.YEARQUARTER,d.YEARQUARTERMONTH,d.YEARMONTH,d.YEARMONTHDATE,d.YEARMONTHDATEHOURS,d.YEARMONTHDATEHOURSMINUTES,d.YEARMONTHDATEHOURSMINUTESSECONDS,d.QUARTERMONTH,d.HOURSMINUTES,d.HOURSMINUTESSECONDS,d.MINUTESSECONDS,d.SECONDSMILLISECONDS];var v=n.MULTI_TIMEUNITS.reduce(function(e,t){return e[t]=!0,e},{});n.isMultiTimeUnit=a,n.TIMEUNITS=[d.YEAR,d.QUARTER,d.MONTH,d.DAY,d.DATE,d.HOURS,d.MINUTES,d.SECONDS,d.MILLISECONDS,d.YEARQUARTER,d.YEARQUARTERMONTH,d.YEARMONTH,d.YEARMONTHDATE,d.YEARMONTHDATEHOURS,d.YEARMONTHDATEHOURSMINUTES,d.YEARMONTHDATEHOURSMINUTESSECONDS,d.QUARTERMONTH,d.HOURSMINUTES,d.HOURSMINUTESSECONDS,d.MINUTESSECONDS,d.SECONDSMILLISECONDS],n.containsTimeUnit=o,n.fieldExpr=s,n.smallestUnit=l,n.formatExpression=u,n.isDiscreteByDefault=c},{"./datetime":82,"./log":89,"./util":102}],99:[function(e,t,n){"use strict";function i(e){return r.reduce(function(t,n){return e&&void 0!==e[n]&&(t[n]=e[n]),t},{})}Object.defineProperty(n,"__esModule",{value:!0});var r=["background","padding","autoResize"];n.extractTopLevelProperties=i},{}],100:[function(e,t,n){"use strict";function i(e){return void 0!==e.filter}function r(e){return void 0!==e.lookup}function a(e){return void 0!==e.calculate}function o(e){return void 0!==e.bin}function s(e){return void 0!==e.timeUnit}function l(e){return void 0!==e.summarize}Object.defineProperty(n,"__esModule",{value:!0}),n.isFilter=i,n.isLookup=r,n.isCalculate=a,n.isBin=o,n.isTimeUnit=s,n.isSummarize=l},{}],101:[function(e,t,n){"use strict";function i(e){if(e)switch(e=e.toLowerCase()){case"q":case n.QUANTITATIVE:return"quantitative";case"t":case n.TEMPORAL:return"temporal";case"o":case n.ORDINAL:return"ordinal";case"n":case n.NOMINAL:return"nominal"}}Object.defineProperty(n,"__esModule",{value:!0});var r;!function(e){e.QUANTITATIVE="quantitative",e.ORDINAL="ordinal",e.TEMPORAL="temporal",e.NOMINAL="nominal"}(r=n.Type||(n.Type={})),n.QUANTITATIVE=r.QUANTITATIVE,n.ORDINAL=r.ORDINAL,n.TEMPORAL=r.TEMPORAL,n.NOMINAL=r.NOMINAL,n.getFullName=i},{}],102:[function(e,t,n){"use strict";function i(e,t){var n={};return t.forEach(function(t){e.hasOwnProperty(t)&&(n[t]=e[t])}),n}function r(e,t){var n=b(e);return t.forEach(function(e){delete n[e]}),n}function a(e){return N.isString(e)||N.isNumber(e)||S(e)?String(e):O(e)}function o(e,t){return e.indexOf(t)>-1}function s(e,t){return e.filter(function(e){return!o(t,e)})}function l(e,t){return e.concat(s(t,e))}function u(e,t){for(var n=0,i=0;i<e.length;i++)if(t(e[i],i,n++))return!0;return!1}function c(e,t){for(var n=0,i=0;i<e.length;i++)if(!t(e[i],i,n++))return!1;return!0}function f(e){return[].concat.apply([],e)}function d(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var i=0,r=t;i<r.length;i++)e=p(e,r[i]);return e}function p(e,t){if("object"!=typeof t||null===t)return e;for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&("object"!=typeof t[n]||N.isArray(t[n])||null===t[n]?e[n]=t[n]:"object"!=typeof e[n]||null===e[n]?e[n]=d(t[n].constructor===Array?[]:{},t[n]):d(e[n],t[n]));return e}function m(e,t){for(var n,i=[],r={},a=0,o=e;a<o.length;a++){var s=o[a];(n=t(s))in r||(r[n]=1,i.push(s))}return i}function g(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t[n]&&e[n]&&t[n]!==e[n])return!0;return!1}function h(e,t){for(var n in e)if(n in t)return!0;return!1}function v(e,t){if(e.length!==t.length)return!0;e.sort(),t.sort();for(var n=0;n<e.length;n++)if(t[n]!==e[n])return!0;return!1}function y(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}function b(e){return JSON.parse(JSON.stringify(e))}function S(e){return!0===e||!1===e}function _(e){var t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function E(e,t){return x.isLogicalNot(e)?"!("+E(e.not,t)+")":x.isLogicalAnd(e)?"("+e.and.map(function(e){return E(e,t)}).join(") && (")+")":x.isLogicalOr(e)?"("+e.or.map(function(e){return E(e,t)}).join(") || (")+")":t(e)}Object.defineProperty(n,"__esModule",{value:!0});var O=e("json-stable-stringify"),N=e("vega-util"),x=e("./logical"),T=e("vega-util");n.extend=T.extend,n.isArray=T.isArray,n.isObject=T.isObject,n.isNumber=T.isNumber,n.isString=T.isString,n.truncate=T.truncate,n.toSet=T.toSet,n.stringValue=T.stringValue,n.pick=i,n.omit=r,n.hash=a,n.contains=o,n.without=s,n.union=l,n.some=u,n.every=c,n.flatten=f,n.mergeDeep=d,n.unique=m,n.differ=g,n.hasIntersection=h,n.differArray=v,n.keys=Object.keys,n.vals=y,n.duplicate=b,n.isBoolean=S,n.varName=_,n.logicalExpr=E},{"./logical":90,"json-stable-stringify":1,"vega-util":7}],103:[function(e,t,n){"use strict";function i(e,t,i){void 0===t&&(t=n.DEFAULT_REQUIRED_CHANNEL_MAP),void 0===i&&(i=n.DEFAULT_SUPPORTED_CHANNEL_TYPE);var o=r.isMarkDef(e.mark)?e.mark.type:e.mark,s=e.encoding,l=t[o],u=i[o];for(var c in l)if(!(l[c]in s))return'Missing encoding channel "'+l[c]+'" for mark "'+o+'"';for(var f in s)if(!u[f])return'Encoding channel "'+f+'" is not supported by mark type "'+o+'"';return o!==a.BAR||s.x||s.y?null:"Missing both x and y for bar"}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./mark"),a=e("./mark"),o=e("./util");n.DEFAULT_REQUIRED_CHANNEL_MAP={text:["text"],line:["x","y"],area:["x","y"]},n.DEFAULT_SUPPORTED_CHANNEL_TYPE={bar:o.toSet(["row","column","x","y","size","color","detail"]),line:o.toSet(["row","column","x","y","color","detail"]),area:o.toSet(["row","column","x","y","color","detail"]),tick:o.toSet(["row","column","x","y","color","detail"]),circle:o.toSet(["row","column","x","y","color","size","detail"]),square:o.toSet(["row","column","x","y","color","size","detail"]),point:o.toSet(["row","column","x","y","color","size","detail","shape"]),text:o.toSet(["row","column","size","color","text"])},n.getEncodingMappingError=i},{"./mark":91,"./util":102}],104:[function(e,t,n){"use strict";function i(e){return!!e.step}function r(e){return!l.isArray(e)&&("fields"in e&&!("data"in e))}function a(e){return!l.isArray(e)&&("fields"in e&&"data"in e)}function o(e){return!l.isArray(e)&&("field"in e&&"data"in e)}function s(e){return!l.isArray(e)&&"signal"in e}Object.defineProperty(n,"__esModule",{value:!0});var l=e("./util");n.isVgRangeStep=i,n.isDataRefUnionedDomain=r,n.isFieldRefUnionDomain=a,n.isDataRefDomain=o,n.isSignalRefDomain=s},{"./util":102}],105:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.axis=e("./axis"),n.aggregate=e("./aggregate"),n.bin=e("./bin"),n.channel=e("./channel"),n.compositeMark=e("./compositemark");var i=e("./compile/compile");n.compile=i.compile,n.config=e("./config"),n.data=e("./data"),n.datetime=e("./datetime"),n.encoding=e("./encoding"),n.facet=e("./facet"),n.fieldDef=e("./fielddef"),n.legend=e("./legend"),n.mark=e("./mark"),n.scale=e("./scale"),n.sort=e("./sort"),n.spec=e("./spec"),n.stack=e("./stack"),n.timeUnit=e("./timeunit"),n.transform=e("./transform"),n.type=e("./type"),n.util=e("./util"),n.validate=e("./validate"),n.version=e("../package.json").version},{"../package.json":8,"./aggregate":9,"./axis":10,"./bin":11,"./channel":12,"./compile/compile":17,"./compositemark":79,"./config":80,"./data":81,"./datetime":82,"./encoding":83,"./facet":84,"./fielddef":85,"./legend":88,"./mark":91,"./scale":93,"./sort":95,"./spec":96,"./stack":97,"./timeunit":98,"./transform":100,"./type":101,"./util":102,"./validate":103}]},{},[105])(105)});