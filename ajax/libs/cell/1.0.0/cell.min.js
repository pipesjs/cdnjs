!function(e) {var t=this,n={inject:function(e,t) {var n=null;if (e.$type&&("head"===e.$type||"body"===e.$type)&&document.getElementsByTagName(e.$type))n=document.getElementsByTagName(e.$type)[0];else if (e.id&&document.getElementById(e.id)&&(n=document.getElementById(e.id)).nodeName.toLowerCase()!==(e.$type||"div")) {var o=i.$type(e,t);n.parentNode.replaceChild(o,n),n=o}return n&&!n.Meta&&(n.Meta={}),n},create:function(e,t,n,o) {var r=i.$type(t,o);return null!==n&&void 0!==n&&e.childNodes&&e.childNodes[n]?e.insertBefore(r,e.childNodes[n]):e.appendChild(r),r},build:function(e,t,o,r) {var i=n.inject(t,r);return i||n.create(e,t,o,r)}},o={set:function(e,t,n) {-1===["$init"].indexOf(t)?e.Genotype[t]=u.bind(e,n):e.Genotype[t]=n},update:function(e,t,n) {u.queue(e,t,"w"),o.set(e,t,n)},build:function(e,t,n,r) {e.Genotype={},e.Inheritance=n;for(var i in t)o.set(e,i,t[i])}},r={freeze:function(e) {var t=[],n=JSON.stringify(e,function(e,n) {if ("function"==typeof n)return n.toString();if ("object"==typeof n&&null!==n) {if (-1!==t.indexOf(n))return"[Circular]";t.push(n)}return n});return t=null,n},LCS:function(e,t) {var n,o,i=e.length,u=t.length,c=[],a=[],p=[];for(n=0;n<i;n++)a.push(r.freeze(e[n]));for(o=0;o<u;o++)p.push(r.freeze(t[o]));for(n=0;n<=i;n++)c.push([0]);for(o=0;o<u;o++)c[0].push(0);for(n=0;n<i;n++)for(o=0;o<u;o++)c[n+1][o+1]=a[n]===p[o]?c[n][o]+1:Math.max(c[n+1][o],c[n][o+1]);return function t(n,o) {return n*o==0?[]:a[n-1]===p[o-1]?t(n-1,o-1).concat([{item:e[n-1],_old:n-1,_new:o-1}]):c[n][o-1]>c[n-1][o]?t(n,o-1):t(n-1,o)}(i,u)},diff:function(e,t) {var n=r.LCS(e,t),o=[],i=n.map(function(e) {return e._old}),o=e.map(function(e,t) {return{item:e,index:t}}).filter(function(e,t) {return-1===i.indexOf(t)}),u=n.map(function(e) {return e._new});return{"-":o,"+":t.map(function(e,t) {return{item:e,index:t}}).filter(function(e,t) {return-1===u.indexOf(t)})}}},i={build:function(e,t) {for(var n in t)null!==t[n]&&void 0!==t[n]&&i.update(e,n,t[n]);i.$init(e)},multiline:function(e) {return/\/\*!?(?:\@preserve)?[ \t]*(?:\r\n|\n)([\s\S]*?)(?:\r\n|\n)[ \t]*\*\//.exec(e.toString())[1]},update:function(e,t,n) {if ("$"===t[0])if ("$type"===t) {var o=e.tagName?e.tagName.toLowerCase():"text";if (n.toLowerCase()!=o) {var r=i.$type({$type:"fragment"}).$build(e.Genotype,e.Inheritance,null,e.Meta.namespace);e.parentNode.replaceChild(r,e),e=r}}else"$text"===t?("function"==typeof n&&(n=i.multiline(n)),n.toString().length>0&&(e.innerHTML=n)):"$components"===t&&i.$components(e,n);else"_"===t[0]||("value"===t?e[t]=n:"number"==typeof n||"string"==typeof n||"boolean"==typeof n?e.setAttribute&&e.setAttribute(t,n):"function"==typeof n&&(e[t]=n))},$type:function(e,t) {var n,o={};return"text"===e.$type?(e.$text&&"function"==typeof e.$text&&(e.$text=i.multiline(e.$text)),n=document.createTextNode(e.$text)):"svg"===e.$type?(n=document.createElementNS("http://www.w3.org/2000/svg",e.$type),o.namespace=n.namespaceURI):t?(n=document.createElementNS(t,e.$type),o.namespace=n.namespaceURI):n="fragment"===e.$type?document.createDocumentFragment():document.createElement(e.$type||"div"),n.Meta=o,n},$components:function(e,t) {t||(t=[]);var n=i.$type({$type:"fragment"}),o=[].map.call(e.childNodes,function(e) {return e.Genotype}).filter(function(e) {return e});if (o.length>0) {var u=r.diff(o,t);u["-"].forEach(function(t) {e.childNodes[t.index].Kill=!0}),[].filter.call(e.childNodes,function(e) {return e.Kill}).forEach(function(t) {e.removeChild(t)}),u["+"].forEach(function(t) {var n=e.Inheritance;for(var o in e.Genotype)"_"===o[0]&&(n=n.concat([o]));e.$build(t.item,n,t.index,e.Meta.namespace),e.$components[t.index]=e.childNodes[t.index].Genotype})}else{var n=i.$type({$type:"fragment"}),c=e.Inheritance;for(var a in e.Genotype)"_"===a[0]&&(c=c.concat([a]));t.forEach(function(t,o) {n.$build(t,c,o,e.Meta.namespace)}),e.appendChild(n),e.$components=[].map.call(e.childNodes,function(e) {return e.Genotype})}},$init:function(e) {u.tick.call(t,function() {e.Genotype.$init&&u.bind(e,e.Genotype.$init)()})},$update:function(e) {if (e.parentNode&&!e.Meta.$updated&&e.$update) {e.Meta.$updated=!0,e.$update.call(e);for(var t in e.Dirty)i.update(e,t,e.Genotype[t]);e.Meta.$updated=!1,e.Dirty=null}}},u={tick:function() {return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.msRequestAnimationFrame||function(e) {return t.setTimeout(e,1e3/60)}}(),set:function(e,t) {Object.defineProperty(e,t,{configurable:!0,get:function() {if ("$"!==t[0]&&"_"!==t[0])return"value"===t?Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),t).get.call(e):t in e.Genotype?e.Genotype[t]:Object.getOwnPropertyDescriptor(window.HTMLElement.prototype,t).get.call(e);if (t in e.Genotype)return u.queue(e,t,"r"),e.Genotype[t];if ("_"!==t[0])return null;for(var n=e;n=n.parentNode;)if (n&&n.Genotype&&t in n.Genotype)return u.queue(n,t,"r"),n.Genotype[t]},set:function(n) {var r=e;if (!(t in e.Genotype)&&"_"===t[0])for(;(r=r.parentNode)&&!(r&&r.Genotype&&t in r.Genotype););if (o.update(r,t,n),"$"!==t[0]&&"_"!==t[0]) {if ("value"===t)return Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),t).set.call(e,n);"number"==typeof n||"string"==typeof n||"boolean"==typeof n?e.setAttribute(t,n):"function"==typeof n&&Object.getOwnPropertyDescriptor(window.HTMLElement.prototype,t).set.call(e,n)}}})},build:function(e) {["$type","$text","$components"].forEach(function(t) {t in e.Genotype||u.set(e,t)}),e.Inheritance&&e.Inheritance.forEach(function(t) {u.set(e,t)});for(var t in e.Genotype)u.set(e,t)},_queue:[],bind:function(e,n) {return"function"==typeof n?function() {return u.tick.call(t,function() {u._queue.forEach(function(e) {var t=!1;for(var n in e.Dirty)r.freeze(e.Genotype[n])!==e.Dirty[n]&&(i.update(e,n,e.Genotype[n]),"_"==n[0]&&(t=!0));t&&"$update"in e.Genotype&&"function"==typeof e.Genotype.$update?i.$update(e):e.Dirty=null});var t=u._queue.indexOf(e);-1!==t&&u._queue.splice(t,1)}),n.apply(e,arguments)}:n},queue:function(e,t,n) {var o=e.Genotype[t];("r"!==n||"object"==typeof o||Array.isArray(o))&&(-1===u._queue.indexOf(e)&&u._queue.push(e),e.Dirty||(e.Dirty={}),t in e.Dirty||(e.Dirty[t]=r.freeze(e.Genotype[t])))}},c={detect:function(e) {return void 0===e&&(e=this),Object.keys(e).filter(function(t) {try{return!(e[t]instanceof Element)&&(e[t]&&Object.prototype.hasOwnProperty.call(e[t],"$cell"))}catch(e) {return!1}}).map(function(t) {return e[t]})},create:function(e) {return void 0===e&&(e=this),e.DocumentFragment.prototype.$build=e.Element.prototype.$build=function(e,t,r,c) {var a=n.build(this,e,r,c);return o.build(a,e,t||[],r),u.build(a),i.build(a,a.Genotype),a},window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(e,t) {t=t||window;for(var n=0;n<this.length;n++)e.call(t,this[n],n,this)}),c.detect(e).map(function(t) {return e.document.body.$build(t,[])})}};if ("undefined"!=typeof exports) {var a={Phenotype:i,Genotype:o,Nucleus:u,Gene:r,Membrane:n,God:c};"undefined"!=typeof module&&module.exports&&(exports=module.exports=a),exports=a}t.addEventListener("load",function() {c.create(t)})}();